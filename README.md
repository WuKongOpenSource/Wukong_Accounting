# Wukong_Accounting

### ğŸŒRead This in [English](README_EN.md)

ä½“éªŒåœ°å€ï¼š[https://www.72crm.com](http://www.72crm.com)

## æ‚Ÿç©ºè´¢åŠ¡ç³»ç»Ÿä»‹ç»

æ‚Ÿç©ºè´¢åŠ¡ç³»ç»Ÿå¯æ»¡è¶³ä¸åŒè§’è‰²çš„è·¨çº§äººå‘˜èƒ½å¤„ç†æ—¥å¸¸ä¸šåŠ¡ï¼Œé€šè¿‡ç³»ç»Ÿç¼–åˆ¶æ”¶æ¬¾ã€ä»˜æ¬¾ã€è½¬è´¦å‡­è¯ã€æœŸæœ«è®°è´¦ä¸ç»“è´¦ç­‰ï¼Œè‡ªåŠ¨å½¢æˆæ€»åˆ†ç±»è´¦ã€æ˜ç»†è´¦å’Œè´¢åŠ¡æŠ¥è¡¨ï¼Œè‡ªåŠ¨è¿›è¡Œè´¢åŠ¡åˆ†æï¼Œæé«˜ä¼ä¸šè´¢åŠ¡æ ¸ç®—æ•ˆç‡çš„åŒæ—¶ï¼Œåˆèƒ½å¤Ÿåæ˜ ä¸šåŠ¡è¿è¥çŠ¶å†µã€‚

å®˜ç½‘åœ°å€ï¼š[http://www.5kcrm.com](http://www.5kcrm.com/)

æ‰«ç æ·»åŠ å°æ‚Ÿå®˜æ–¹å®¢æœå¾®ä¿¡ï¼Œé‚€æ‚¨åŠ å…¥åƒäººå¾®ä¿¡äº¤æµç¾¤ï¼š

<img src="https://images.gitee.com/uploads/images/2019/1231/115927_f9c580c8_345098.png" width="120">

å…³æ³¨æ‚Ÿç©ºCRMå…¬ä¼—å·ï¼Œäº†è§£æ›´å¤šæ‚Ÿç©ºèµ„è®¯

<img src="https://images.gitee.com/uploads/images/2019/1202/135713_d3566c6a_345098.jpeg" width="120">

æ‰«ç åŠ å…¥å¾®ä¿¡ç¾¤ï¼Œåœ¨çº¿å®¢æœè§£ç­”ç–‘é—®

<img src="https://github.com/WuKongOpenSource/Wukong_Accounting/blob/main/img/b1.png" width="120">

:boom:  :boom:  :boom: æ³¨ï¼šæ‚Ÿç©ºè´¢åŠ¡ç³»ç»Ÿé‡‡ç”¨å…¨æ–°çš„å‰åç«¯åˆ†ç¦»æ¨¡å¼ï¼Œæœ¬ä»“åº“ä»£ç ä¸­å·²é›†æˆå‰ç«¯vueæ‰“åŒ…åæ–‡ä»¶ï¼Œ  **å¯å…å»æ‰“åŒ…æ“ä½œï¼Œæ— éœ€è¿è¡Œå‰ç«¯**

# æ‚Ÿç©ºé¡¹ç›®ç®¡ç†ç›®å½•ç»“æ„

```lua
wk_open_finance
â”œâ”€â”€ common        -- åŸºç¡€æ¨¡å—
â”œâ”€â”€ DB        -- sqlæ–‡ä»¶
â”œâ”€â”€ finance        -- è´¢åŠ¡ç®¡ç†æ¨¡å—
â”œâ”€â”€ ux        -- å‰ç«¯æºç 
```

# æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

**å‡­è¯ç®¡ç†ï¼Œæ™ºèƒ½ç”Ÿæˆï¼šåœ¨çœŸå®ã€å¯é å½•å…¥å‡­è¯çš„åŸºç¡€ä¸Šï¼Œæ­£ç¡®ã€åŠæ—¶åœ°åæ˜  å„é¡¹ç»æµä¸šåŠ¡çš„å®Œæˆæƒ…å†µï¼Œä¸ºç™»è®°è´¦ç°¿æä¾›å¯é çš„ä¾æ®ã€‚** <br/>
**è´¦ç°¿ç®¡ç†ï¼Œå¤šç»´åº¦æŸ¥è¯¢ï¼šå¼ºå¤§çš„è´¦è–„åŠŸèƒ½ï¼Œè®©æ‚¨å¿«é€Ÿäº†è§£å„é¡¹è´¢åŠ¡æŒ‡æ ‡ï¼Œå½•â¼Š å‡­è¯å³å¯å¤šç»´åº¦æŸ¥è¯¢è´¦ç°¿ï¼Œæ”¯æŒæ€»è´¦ã€æ˜ç»†è´¦ã€å¤šæ  è´¦ã€æ•°é‡é‡‘é¢è´¦ã€æ ¸ç®—é¡¹ç›®ç±»è´¦ç°¿æŸ¥è¯¢ã€‚** <br/>
**è´¢åŠ¡æŠ¥è¡¨ç®¡ç†ï¼Œæä¾›ä¼ä¸šç»è¥è°ƒæ•´ä¾æ®ï¼šä¿è¯é«˜è´¨é‡çš„è´¢åŠ¡ä¿¡æ¯ï¼Œæ¸…æ™°ååº”ä¼ä¸šè´¢åŠ¡çŠ¶å†µï¼Œèµ„ äº§è¿è¥èƒ½åŠ›ï¼Œå¿å€ºèƒ½åŠ›ä¸ç›ˆåˆ©èƒ½åŠ›ï¼Œä¸ºä¼ä¸šæˆ˜ç•¥å†³ç­– æä¾›ç§‘å­¦æ€§çš„æŒ‡å¯¼ä¾æ®ã€‚** <br/>
**è¾…åŠ©æ ¸ç®—ï¼Œæå‡è´¢åŠ¡ä¸šåŠ¡å‡†ç¡®åº¦** <br/>
**å¿«æ·ç»“è´¦ï¼Œæé«˜è´¢åŠ¡å·¥ä½œæ•ˆç‡ï¼šè®¡ç®—å¹¶è®°å½•æœ¬æœŸå‘ç”Ÿé¢åˆè®¡åŠæœŸæœ«ä½™é¢ï¼Œå¹¶å°†å…¶ä½™é¢ è½¬å…¥æŒ‰è§„å®šåº”è½¬å…¥çš„è´¦æˆ·ï¼Œæˆ–ç»“è½¬ä¸‹æœŸçš„ä¼šè®¡æ ¸ç®—ç¯ èŠ‚ï¼Œå‡†ç¡®è€Œé«˜æ•ˆçš„å¤„ç†è´¢åŠ¡æ•°æ®ã€‚** <br/>
**ç²¾ç»†åŒ–ç§‘ç›®ç®¡ç†ï¼Œç³»ç»Ÿäº†è§£ç»æµä¸šåŠ¡** <br/>

# æ‚Ÿç©ºè´¢åŠ¡ç®¡ç†ä½¿ç”¨çš„ä¸»è¦æŠ€æœ¯æ ˆ

# åç«¯ï¼š

|åç§°                 | ç‰ˆæœ¬                     | è¯´æ˜   |
|---------------------|---------------------------|----  |
| spring-cloud-alibaba| 2021.0.5.0                 |  æ ¸å¿ƒæ¡†æ¶  |
| spring-boot         | 2.7.15                    |  springç‰ˆæœ¬  |
| mybatis-plus        | 3.5.3.2                    |  ORMæ¡†æ¶  |

# å‰ç«¯ï¼š

| æŠ€æœ¯ | è¯´æ˜ | ç‰ˆæœ¬ |
| --- | --- | --- |
| [Vue](https://vuejs.org) | æ¡†æ¶ | 2.5.17 |
| [Vue-router](https://router.vuejs.org) | è·¯ç”±æ¡†æ¶ | 3.0.1 |
| [Vuex](https://vuex.vuejs.org) | å…¨å±€çŠ¶æ€ç®¡ç†æ¡†æ¶ | 3.0.1 |
| [Element](https://element.eleme.io) | UIæ¡†æ¶ | 2.12.0 |
| [Axios](https://github.com/axios/axios) | HTTPæ¡†æ¶ | 0.18.0 |

# ä½¿ç”¨è¯´æ˜

### ä¸€ã€æœ¬é¡¹ç›®å®‰è£…éœ€è¦åœ¨Linuxç¯å¢ƒä¸‹è¿›è¡Œï¼Œå¯åœ¨è™šæ‹Ÿæœºä¸­å®‰è£…Linuxç¯å¢ƒ

Linux ç¯å¢ƒé…ç½®è¦æ±‚å¦‚ä¸‹ï¼š

æ¨èä½¿ç”¨ç³»ç»Ÿï¼šcentos
ç³»ç»Ÿå†…å­˜ï¼šâ‰¥16G
ç³»ç»ŸCPUï¼šâ‰¥4æ ¸
ç£ç›˜å¤§å°ï¼šâ‰¥100G

### äºŒã€å‰ç½®ç¯å¢ƒï¼Œéœ€è¦åœ¨Linuxç¯å¢ƒä¸‹å®‰è£…ä»¥ä¸‹é…ç½®

- Jdk1.8
- Maven3.5^
- Mysql8^
- Redis(ç‰ˆæœ¬ä¸é™)
- elasticsearch8.5.3

### å®‰è£…è¯´æ˜

#### ä¸€ã€ä¾èµ–ç¯å¢ƒå®‰è£…

###### 1. å®‰è£…jdk

```
yum -y install java-1.8.0-openjdk-devel;
```

###### 2. å®‰è£…redis

```
yum -y install epel-release;
yum -y install redis;
systemctl start redis

#-- ä¿®æ”¹rediså¯†ç ä¸º123456
yum -y install vim;
vim /etc/redis.conf;

#-- åœ¨æ–‡ä»¶æœ€ä¸‹é¢è¿½åŠ ä¸€è¡Œ
requirepass 123456
#-- æˆ–è€…è¾“å…¥ / æœç´¢ # requirepass foobared
#-- å°†å‰é¢çš„#åˆ é™¤ï¼Œå°†foobaredæ”¹ä¸º123456
#-- ä¿®æ”¹å®Œæˆä¹‹å :wq ä¿å­˜å¹¶é€€å‡º,é‡å¯redis

systemctl restart redis
```

###### 3.å®‰è£…mysql

```
wget https://repo.mysql.com//mysql80-community-release-el7-3.noarch.rpm
yum -y install mysql80-community-release-el7-3.noarch.rpm
yum -y install mysql-community-server --nogpgcheck
sudo systemctl start mysqld.service;
sudo systemctl enable mysqld.service;

--æŸ¥çœ‹å®‰è£…çš„mysqlé»˜è®¤å¯†ç 
grep "password" /var/log/mysqld.log
--è¿›å…¥mysql ä¾‹ï¼šmysql -u root -p"GXOO%eiI/7o>"
mysql - u root -p"æ­¤å¤„ä¸ºä¸Šä¸€æ­¥çš„é»˜è®¤å¯†ç " 
 
--ä¿®æ”¹mysqlå¯†ç ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º
set global validate_password.policy=LOW;
ALTER USER 'root'@'localhost' IDENTIFIED BY 'password';

--é€€å‡ºmysql
exit
    
--ä¿®æ”¹mysqlé…ç½®
vim /etc/my.cnf;
--è¾“å…¥ i è¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼Œä¿®æ”¹sql_modeè®¾ç½®ï¼Œå°†ä¸‹é¢sql_modeé…ç½®å¤åˆ¶ï¼Œåˆ° [mysqld]ä¸‹ä½¿ç”¨ shift+insert ç²˜è´´
sql_mode=STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION 
--ä¿®æ”¹å®Œæ¯•ï¼ŒæŒ‰escæŒ‰é”®ï¼Œç„¶å :wq ä¿å­˜å¹¶é€€å‡ºï¼Œé‡å¯mysql


service mysqld restart;
```

### 4.å®‰è£…elasticsearch(es)

```
--ä¸‹è½½es  

# æ³¨æ„ä¸è¦æ”¾åœ¨rootç›®å½•ä¸‹

useradd elasticsearch
wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.5.3-linux-x86_64.tar.gz
tar xvf elasticsearch-8.5.3-linux-x86_64.tar.gz
chown -R elasticsearch:elasticsearch  elasticsearch-8.5.3 
chmod -R 777  elasticsearch-8.5.3

--ä¿®æ”¹esé…ç½®æ–‡ä»¶:elasticsearch.yml

# å®‰è£…eså¦‚æœ‰ä»¥ä¸‹é…ç½®ä¿¡æ¯ï¼Œéœ€è¦ä¿®æ”¹é…ç½®ä¿¡æ¯

ingest.geoip.downloader.enabled: false  ## æ·»åŠ é…ç½®
xpack.security.enabled: true
xpack.security.enrollment.enabled: true

xpack.security.http.ssl:
  enabled: false        # æ”¹ä¸ºfalse
  keystore.path: certs/http.p12

Enable encryption and mutual authentication between cluster nodes
xpack.security.transport.ssl:
  enabled: false         # æ”¹ä¸ºfalse
  verification_mode: certificate
  keystore.path: certs/transport.p12
  truststore.path: certs/transport.p12

-- å®‰è£…esåˆ†è¯å™¨
./elasticsearch-plugin install analysis-icu
--é‡ç½® es è´¦æˆ·å¯†ç 
./elasticsearch-reset-password -u elastic

-- è¿›å…¥binå¯åŠ¨es
su elasticsearch
./elasticsearch
```

#### äºŒã€é¡¹ç›®é…ç½®ä¸å¯åŠ¨

yum -y install maven

###### 1.å¯¼å…¥DBç›®å½•ä¸‹æ•°æ®åº“

```
create database wk_open_finance character set utf8mb4 collate utf8mb4_general_ci;
 use wk_open_finance;
source XXX/wk_open_finance.sqlï¼ˆXXXä¸ºé¡¹ç›®è·¯å¾„ï¼‰
```

###### 2.åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œmvn install

###### 3.åœ¨é¡¹ç›®ä¸­ä¿®æ”¹ä»¥ä¸‹é…ç½®ä¿¡æ¯ï¼š

###### 3.åœ¨financeæ¨¡å—ä¸‹resourceç›®å½•é…ç½®æ•°æ®åº“å¸å·å¯†ç ä¿¡æ¯ä»¥åŠrediså¸å·ä¿¡æ¯`

###### 4. è®¿é—®[æ‚Ÿç©ºID](https://id.72crm.com/)è·å–è´¦å·

###### æ³¨å†Œä¹‹åç‚¹å‡»é»˜è®¤ä¼ä¸š,åº”ç”¨åˆ—è¡¨ä¸­é€‰æ‹©è´¢åŠ¡ç®¡ç†

![é»˜è®¤ä¼ä¸š](img/001.png "img1.png")

###### ç‚¹å‡»è´¢åŠ¡ç®¡ç†

![äººåŠ›èµ„æºç®¡ç†](img/002.png "img2.png")

##### å°†App IDï¼ŒaccessKeyï¼ŒsecretKeyå¤åˆ¶åˆ° finance-web\src\main\resources\application.ymlï¼Œåˆ†åˆ«å¯¹åº”appIdï¼ŒclientIdï¼ŒclientSecret å¦‚ä¸‹å›¾æ‰€ç¤º

![ä»£ç é…ç½®](img/003.png "img4.png")
å°†appIdå¤åˆ¶åˆ°finance-web\src\main\resources\static\APPLICATION_ID.txtå†…ï¼Œæ›¿æ¢é‡Œé¢å†…å®¹

###### 5. é¡¹ç›®æ‰“åŒ…éƒ¨ç½²

```
--é¡¹ç›®æ‰“åŒ…
mkdir /opt/package
mvn clean -Dmaven.test.skip=true package
cp finance-web/target/finance-web.zip /opt/package
cd /opt/package
unzip finance-web.zip -d finance
cd finance
sh 72crm.sh start
```

###### 6. å‰ç«¯é¡¹ç›®é¡¹ç›®è¿è¡Œã€æ‰“åŒ…

```
- ä¸‹è½½nodeå¹¶å®‰è£…(LTS)ï¼šhttps://nodejs.org/;
- è¯¥é¡¹ç›®ä¸ºå‰åç«¯åˆ†ç¦»é¡¹ç›®ï¼Œæœ¬åœ°è®¿é—®éœ€æ­å»ºåå°ç¯å¢ƒï¼Œè¯·å‚è€ƒ[åç«¯é¡¹ç›®](https://gitee.com/wukongcrm/crm_pro);
- è®¿é—®çº¿ä¸Šæ¥å£æ— éœ€æ­å»ºåå°ç¯å¢ƒï¼Œåªéœ€å°†config/index.jsæ–‡ä»¶ä¸­çš„devä¸‹çš„proxyTableä¸­çš„targetæ”¹ä¸ºçº¿ä¸Šåœ°å€å³å¯;
- æ‰§è¡Œ npm installï¼Œä¸‹è½½ç›¸å…³ä¾èµ–;
- æ‰§è¡Œ npm run devï¼Œè¿è¡Œé¡¹ç›®;
- æ‰§è¡ŒæˆåŠŸï¼Œå³å¯è®¿é—®http://localhost:8090ï¼ŒæŸ¥çœ‹;

æ‰“åŒ…ï¼š
- éœ€å°†config/prod.env.jsæ–‡ä»¶ä¸­çš„BASE_APIï¼Œè°ƒæ•´ä¸ºè‡ªå·±éœ€è¦çš„
- æ‰§è¡Œ npm run build
- æ‰“åŒ…å®Œæˆ
```

### ä¸‰ã€å…¶ä»–è¯´æ˜

#### 1.æ¥å£æ–‡æ¡£<br/>

```
æ¥å£æ–‡æ¡£åœ°å€ï¼šhttp://localhost:44316/doc.html
```

#### 2.dockeré•œåƒ<br/>

```
æ•¬è¯·æœŸå¾…
```

### å››ã€æ‚Ÿç©ºè´¢åŠ¡ç®¡ç†åŠŸèƒ½æ¨¡å—é¢„è§ˆ

![è¾“å…¥å›¾ç‰‡è¯´æ˜](img/01.png)
![è¾“å…¥å›¾ç‰‡è¯´æ˜](img/02.png)
![è¾“å…¥å›¾ç‰‡è¯´æ˜](img/03.png)
![è¾“å…¥å›¾ç‰‡è¯´æ˜](img/04.png)
![è¾“å…¥å›¾ç‰‡è¯´æ˜](img/05.png)
![è¾“å…¥å›¾ç‰‡è¯´æ˜](img/06.png)

