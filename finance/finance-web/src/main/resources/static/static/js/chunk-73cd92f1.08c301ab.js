(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-73cd92f1"],{"5ccb":function(e,t,i){},"5d0a":function(e,t,i){},"7a1c":function(e,t,i){"use strict";i("5d0a")},cb41:function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"subject-select-options"},[i("el-popover",{attrs:{disabled:e.disabled,placement:"bottom-start",width:e.popoverWidth,trigger:"manual","popper-class":"no-padding-popover"},model:{value:e.popoverVisible,callback:function(t){e.popoverVisible=t},expression:"popoverVisible"}},[e.selectedNode?e.showRelevance?i("div",{staticClass:"relevance"},e._l(e.relative,(function(t,s){return i("flexbox",{key:s,staticClass:"relevance_item"},[i("div",{staticClass:"labelName"},[e._v("\n          "+e._s(t.labelName)+"\n        ")]),e._v(" "),i("el-popover",{attrs:{placement:"bottom",width:"200",trigger:"click"},model:{value:t.popoverAssistVisible,callback:function(i){e.$set(t,"popoverAssistVisible",i)},expression:"item.popoverAssistVisible"}},[i("div",{staticClass:"wrapper"},[i("div",{staticClass:"subject-list"},[e._l(e.assistShowList(t.name,e.relationObj[t.adjuvantId]),(function(s){return i("div",{key:s.carteId,staticClass:"subject-list-item",on:{click:function(i){e.handleSelectAssist(s,t)}}},[e._v("\n                "+e._s(s.carteNumber)+"  "+e._s(s.carteName)+"\n              ")])})),e._v(" "),e.relationObj[t.adjuvantId]&&0===e.relationObj[t.adjuvantId].length?i("div",{staticClass:"empty-tips"},[e._v("\n                没有匹配的选项\n              ")]):e._e()],2),e._v(" "),i("flexbox",{staticClass:"create-btn",attrs:{align:"center",justify:"flex-start"},nativeOn:{click:function(i){e.addAdjuvant(t)}}},[i("i",{staticClass:"wk wk-add icon"}),e._v(" "),i("div",{staticClass:"text"},[e._v("新建辅助核算")])])],1),e._v(" "),i("el-input",{attrs:{slot:"reference"},on:{blur:function(i){e.assistBlur(t,e.relationObj[t.adjuvantId])},focus:function(t){e.assistFocus()}},slot:"reference",model:{value:t.name,callback:function(i){e.$set(t,"name",i)},expression:"item.name"}})],1)],1)}))):e._e():i("div",{staticClass:"wrapper"},[i("div",{ref:"subjectBox",staticClass:"subject-list"},[e._l(e.subjectShowList,(function(t,s){return i("div",{key:s,staticClass:"subject-list-item",class:{active:e.selectedNode&&e.selectedNode.subjectId===t.subjectId,keyselect:s===e.hoverIndex},on:{click:function(i){e.handleSelect(t)}}},[e._v("\n          "+e._s(t.number)+" "+e._s(t.subjectName)+"\n        ")])})),e._v(" "),0===e.subjectShowList.length?i("div",{staticClass:"empty-tips"},[e._v("\n          没有匹配的选项\n        ")]):e._e()],2),e._v(" "),e.canCreate?i("flexbox",{staticClass:"create-btn",attrs:{align:"center",justify:"flex-start"},nativeOn:{click:function(t){return e.handleToCreate(t)}}},[i("i",{staticClass:"wk wk-add icon"}),e._v(" "),i("div",{staticClass:"text"},[e._v("新建科目")])]):e._e()],1),e._v(" "),i("el-input",{ref:"inputCore",attrs:{slot:"reference",disabled:e.disabled},on:{focus:e.inputFocus,input:e.inputChange,blur:e.inputBlur},nativeOn:{keydown:[function(t){if(!("button"in t)&&e._k(t.keyCode,"down",40,t.key,["Down","ArrowDown"]))return null;t.stopPropagation(),t.preventDefault(),e.navigateOptions("next")},function(t){if(!("button"in t)&&e._k(t.keyCode,"up",38,t.key,["Up","ArrowUp"]))return null;t.stopPropagation(),t.preventDefault(),e.navigateOptions("prev")},function(t){return!("button"in t)&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),e.selectOption(t))}]},slot:"reference",model:{value:e.subjectName,callback:function(t){e.subjectName=t},expression:"subjectName"}},[e.disabled?e._e():i("el-button",{staticClass:"choose-btn",attrs:{slot:"suffix",type:"text"},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.handleToSelect(t)}},slot:"suffix"},[e._v("科目")])],1)],1),e._v(" "),e.selectDialogVisible?i("subject-select-dialog",e._b({attrs:{visible:e.selectDialogVisible,"before-choose":e.beforeChoose},on:{"update:visible":function(t){e.selectDialogVisible=t},confirm:e.handleSelect}},"subject-select-dialog",e.$attrs,!1)):e._e(),e._v(" "),e.createDialogVisible?i("subject-update-dialog",{attrs:{visible:e.createDialogVisible,"show-subject-select-options":"","subject-list":e.subjectListLib},on:{"update:visible":function(t){e.createDialogVisible=t},confirm:e.saveSuccess}}):e._e(),e._v(" "),i("el-dialog",{attrs:{visible:e.addDialogVisible,title:e.dialogTitle,"append-to-body":"",width:"25%"},on:{"update:visible":function(t){e.addDialogVisible=t}}},[i("el-form",{ref:"addForm",attrs:{model:e.addForm,rules:e.rules}},[i("el-form-item",{attrs:{"label-width":"80px",label:"编码：",prop:"carteNumber"}},[i("el-input",{model:{value:e.addForm.carteNumber,callback:function(t){e.$set(e.addForm,"carteNumber",t)},expression:"addForm.carteNumber"}})],1),e._v(" "),i("el-form-item",{attrs:{"label-width":"80px",label:"名称：",prop:"carteName"}},[i("el-input",{model:{value:e.addForm.carteName,callback:function(t){e.$set(e.addForm,"carteName",t)},expression:"addForm.carteName"}})],1),e._v(" "),6==e.currentAddAssist.label?i("el-form-item",{attrs:{"label-width":"80px",label:"规格：",prop:"specification"}},[i("el-input",{model:{value:e.addForm.specification,callback:function(t){e.$set(e.addForm,"specification",t)},expression:"addForm.specification"}})],1):e._e(),e._v(" "),6==e.currentAddAssist.label?i("el-form-item",{attrs:{"label-width":"80px",label:"单位：",prop:"unit"}},[i("el-input",{model:{value:e.addForm.unit,callback:function(t){e.$set(e.addForm,"unit",t)},expression:"addForm.unit"}})],1):e._e(),e._v(" "),[1,2].includes(e.currentAddAssist.label)?i("el-form-item",{attrs:{"label-width":"80px",label:"备注：",prop:"remark"}},[i("el-input",{attrs:{type:"textarea"},model:{value:e.addForm.remark,callback:function(t){e.$set(e.addForm,"remark",t)},expression:"addForm.remark"}})],1):e._e()],1),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.saveAdjuvant("addForm",e.currentAddAssist.adjuvantId)}}},[e._v("保存")]),e._v(" "),i("el-button",{on:{click:function(t){e.closeAccountDialog()}}},[e._v("关闭")])],1)],1)],1)},a=[],n=i("c7eb"),c=i("1da1"),o=i("5530"),l=(i("a9e3"),i("4de4"),i("d3b7"),i("99af"),i("caad"),i("2532"),i("7db0"),i("159b"),i("b64b"),i("b0c0"),i("d81d"),i("224e")),r=i("f6f4"),u=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{attrs:{visible:e.dialogVisible,"close-on-click-modal":!1,"before-close":e.handleClose,"append-to-body":"",width:"500px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("span",{staticClass:"el-dialog__title",attrs:{slot:"title"},slot:"title"},[e._v("\n    选择科目\n    "),e.helpObj?i("i",{staticClass:"wk wk-icon-fill-help wk-help-tips",attrs:{"data-type":e.helpObj.dataType,"data-id":e.helpObj.dataId}}):e._e()]),e._v(" "),i("SubjectSelectOptions",e._g(e._b({model:{value:e.selectedNode,callback:function(t){e.selectedNode=t},expression:"selectedNode"}},"SubjectSelectOptions",e.$attrs,!1),e.$listeners)),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:e.handleConfirm}},[e._v("确定")]),e._v(" "),i("el-button",{on:{click:e.handleClose}},[e._v("取消")])],1)],1)},d=[],b=i("b4e8"),h={name:"SubjectSelectOptionsDialog",components:{SubjectSelectOptions:b["a"]},props:{visible:{type:Boolean,default:!1},helpObj:Object},data:function(){return{dialogVisible:!1,selectedNode:null}},watch:{visible:{handler:function(){this.dialogVisible=this.visible},immediate:!0}},methods:{handleClose:function(){this.dialogVisible=!1,this.$emit("update:visible",!1),this.$emit("close")},handleConfirm:function(){this.$emit("confirm",this.selectedNode),this.handleClose()}}},f=h,v=(i("7a1c"),i("2877")),p=Object(v["a"])(f,u,d,!1,null,"ed1530a6",null),m=p.exports,j=i("8be7"),g=i("ed08"),N=i("6bfe"),k={name:"SubjectSelectOptions",components:{SubjectSelectDialog:m,SubjectUpdateDialog:j["a"]},mixins:[r["a"]],props:{value:{type:[String,Number]},isChildren:{type:Boolean,default:!1},isRelevance:{type:Boolean,default:!1},canCreate:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},relative:{type:Object,default:function(){return{}}},subjectObject:Object,relationObj:{type:Object,default:function(){return{}}},subjectList:{type:Array,default:null},beforeChoose:{type:Function,default:null},filterNodeMethod:{type:Function,default:null}},data:function(){return{popoverVisible:!1,subjectName:"",selectedNode:null,subjectListLib:[],popoverWidth:"",selectDialogVisible:!1,createDialogVisible:!1,hoverIndex:-1,currentAddAssist:{},addDialogVisible:!1,addForm:{carteNumber:"",carteName:"",specification:"",unit:"",remark:""},rules:{carteNumber:[{required:!0,message:"编码不能为空",trigger:"blur"}],carteName:[{required:!0,message:"名称不能为空",trigger:"blur"}]}}},computed:{subjectShowList:function(){var e=this;return this.subjectName?this.subjectListLib.filter((function(t){var i="".concat(t.number," ").concat(t.subjectName);return i.includes(e.subjectName)})):this.subjectListLib},assistShowList:function(){return function(e,t){return e?t?t.filter((function(t){var i="".concat(t.carteNumber," ").concat(t.carteName);return i.includes(e)})):[]:t||[]}},showRelevance:function(){return!!(this.isRelevance&&this.selectedNode&&this.selectedNode.adjuvantList&&this.selectedNode.adjuvantList.length)},dialogTitle:function(){return Object(N["c"])(this.currentAddAssist)?"新增":"新增"+this.currentAddAssist.labelName}},watch:{value:{handler:function(){this.setSelected()},immediate:!0},subjectShowList:{handler:function(){this.subjectListLib.length>0&&0===this.subjectShowList.length&&(this.subjectObject||(this.selectedNode=null,this.emitChange()))},immediate:!0,deep:!0},subjectList:{handler:function(){this.subjectList&&this.subjectList.length>0&&this.getSubjectList()},deep:!0,immediate:!0},popoverVisible:{handler:function(e){var t=this;this.hoverIndex=-1,e&&this.$nextTick((function(){t.popoverWidth=t.$el.offsetWidth<300?300:t.$el.offsetWidth}))}}},mounted:function(){this.popoverWidth=this.$el.offsetWidth<300?300:this.$el.offsetWidth,this.getSubjectList()},methods:{getSubjectList:function(){var e=this;if(this.subjectList&&this.subjectList.length>0){var t=Object(g["s"])(this.subjectList);this.formatList(t,"0"),this.filterNodeMethod&&(t=t.filter((function(i,s){var a=t.filter((function(e){return e.parentId===i.subjectId}));return e.filterNodeMethod(i,a,s)}))),this.subjectListLib=t,this.setSelected()}else Object(l["H"])({type:null,isTree:0}).then((function(t){if(!(e.subjectList&&e.subjectList.length>0)){var i=t.data||[];e.formatList(i,"0"),e.filterNodeMethod&&(i=i.filter((function(t,s){var a=i.filter((function(e){return e.parentId===t.subjectId}));return e.filterNodeMethod(t,a,s)}))),e.subjectListLib=i,e.setSelected()}})).catch((function(){}))},formatList:function(e,t){var i=this,s=e.filter((function(e){return e.parentId===t})),a=e.find((function(e){return e.subjectId===t}));s.forEach((function(t){a&&(t.subjectName="".concat(a.subjectName,"_").concat(t.subjectName));var s=e.filter((function(e){return e.parentId===t.subjectId}));s.forEach((function(s){s.subjectName="".concat(t.subjectName,"_").concat(s.subjectName),i.formatList(e,s.subjectId)}))}))},getChildren:function(e){return e?this.subjectListLib.filter((function(t){return t.parentId===e.subjectId})):[]},setSelected:function(){var e=this;if(0!==this.subjectListLib.length)if(this.value){var t=this.subjectListLib.find((function(t){return t.subjectId===e.value}));if(this.subjectObject&&!t&&(t=this.subjectObject),t){if(this.subjectName="".concat(t.number," ").concat(t.subjectName),this.$emit("update:subjectName",this.subjectName),this.isRelevance){if(t.adjuvantList)return t.adjuvantList.forEach((function(t){e.relative.hasOwnProperty(t.adjuvantId)?e.$set(e.relative[t.adjuvantId],"labelName",t.labelName):e.$set(e.relative,t.adjuvantId,Object(o["a"])(Object(o["a"])({},t),{},{relationId:"",name:""}))})),Object.keys(this.relative).forEach((function(i){t.adjuvantList.find((function(e){return e.adjuvantId==i}))||delete e.relative[i]})),this.selectedNode=t,this.$emit("change",this.selectedNode.subjectId,this.selectedNode),this.$emit("focus"),this.inputBlur(),void this.getAdjuvantList();Object.keys(this.relative).forEach((function(t){delete e.relative[t]}))}this.selectedNode=t,this.$emit("focus")}else this.selectedNode=null,this.subjectName="",this.emitChange()}else this.selectedNode=null,this.subjectName=""},navigateOptions:function(e){var t=this;this.popoverVisible&&0!==this.subjectShowList.length&&("next"===e?(this.hoverIndex++,this.hoverIndex===this.subjectShowList.length&&(this.hoverIndex=0)):"prev"===e&&(this.hoverIndex--,this.hoverIndex<0&&(this.hoverIndex=this.subjectShowList.length-1)),this.$nextTick((function(){return t.scrollToOption()})))},scrollToOption:function(){var e=this.$refs.subjectBox,t=document.querySelector(".subject-list .keyselect"),i=t?t.offsetTop:0;i+t.clientHeight>e.clientHeight?e.scrollTop=t.offsetTop-50:e.scrollTop=0},selectOption:function(){this.popoverVisible&&this.handleSelect(this.subjectShowList[this.hoverIndex])},assistFocus:function(){this.popoverVisible=!0},assistBlur:function(e,t){var i=t.some((function(t){var i="".concat(t.carteNumber," ").concat(t.carteName);return i.includes(e.name)}));i||(e.name="")},assistChange:function(e,t){t.name=this.relationObj[t.adjuvantId].find((function(t){return t.carteId==e})).carteName,this.checkRelative()&&(this.$emit("blur"),this.popoverVisible=!1)},getInitBalance:function(){var e=this,t={subjectId:this.selectedNode.subjectId,assistAdjuvantList:Object.keys(this.relative).map((function(t){return{adjuvantId:t,relationId:e.relative[t].relationId}}))};Object(l["C"])(t).then((function(t){var i=t.data;i&&e.$set(e.subjectObject,"adjuvantBalance",i.initialBalance||0)}))},getAdjuvantList:function(){var e=arguments,t=this;return Object(c["a"])(Object(n["a"])().mark((function i(){var s,a,c,o;return Object(n["a"])().wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(s=e.length>0&&void 0!==e[0]&&e[0],t.selectedNode.adjuvantList&&t.selectedNode.adjuvantList.length){i.next=3;break}return i.abrupt("return");case 3:a=0;case 4:if(!(a<t.selectedNode.adjuvantList.length)){i.next=16;break}if(c=t.selectedNode.adjuvantList[a],!t.relationObj.hasOwnProperty(c.adjuvantId)||s){i.next=8;break}return i.abrupt("continue",13);case 8:return t.$set(t.relationObj,c.adjuvantId,[]),i.next=11,Object(l["q"])({adjuvantId:c.adjuvantId,pageType:0,status:1});case 11:o=i.sent,t.$set(t.relationObj,c.adjuvantId,o.data.list);case 13:a++,i.next=4;break;case 16:t.checkRelative()&&t.getInitBalance();case 17:case"end":return i.stop()}}),i)})))()},inputChange:function(){var e=this;this.selectedNode&&(this.selectedNode=null,this.emitChange()),this.$nextTick((function(){e.popoverVisible||(e.popoverVisible=!0)}))},inputFocus:function(){var e=this;this.selectedNode&&!this.showRelevance||(this.$emit("focus"),this.popoverVisible=!0,this.$nextTick((function(){e.hoverIndex=0})))},inputBlur:function(e){e&&this.$el.contains(e.relatedTarget)||this.isRelevance&&this.selectedNode&&!this.selectedNode.adjuvantList||this.isRelevance&&this.selectedNode&&this.selectedNode.adjuvantList&&!this.checkRelative()||(this.$emit("blur"),this.popoverVisible=!1)},focus:function(){this.$refs.inputCore.focus()},checkRelative:function(){for(var e=0;e<this.selectedNode.adjuvantList.length;e++){var t=this.selectedNode.adjuvantList[e];if(!this.relative[t.adjuvantId]||!this.relative[t.adjuvantId].relationId)return!1}return!0},handleSelectAssist:function(e,t){t.relationId=e.carteId,t.name=e.carteName,t.carteNumber=e.carteNumber,t.specification=e.specification,t.popoverAssistVisible=!1,this.checkRelative()&&(this.getInitBalance(),this.$emit("blur"),this.popoverVisible=!1)},handleToSelect:function(e){this.$refs.inputCore.blur(),this.selectDialogVisible=!0},handleToCreate:function(){this.createDialogVisible=!0},handleSelect:function(e){if(e){if(this.selectedNode=this.subjectListLib.find((function(t){return t.subjectId===e.subjectId})),this.selectedNode.children=this.getChildren(e),this.beforeChoose){var t=this.beforeChoose(this.selectedNode);if(!t)return this.$refs.inputCore.blur(),void(this.selectedNode=null)}this.subjectName="".concat(e.number," ").concat(e.subjectName),this.emitChange(e.subjectId)}else{if(this.beforeChoose){var i=this.beforeChoose(null);if(!i)return void this.$refs.inputCore.focus()}this.subjectName="",this.selectedNode=null,this.emitChange()}},saveSuccess:function(){this.popoverVisible=!1,this.$emit("update-list"),this.getSubjectList()},emitChange:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.$emit("input",e),this.$emit("change",e,this.selectedNode),this.dispatch("ElFormItem","el.form.change",[e,this.selectedNode])},addAdjuvant:function(e){this.currentAddAssist=e,this.resetForm(),this.addDialogVisible=!0},saveAdjuvant:function(e,t){var i=this;this.$refs[e].validate((function(e){if(!e)return!1;var s=Object(o["a"])(Object(o["a"])({},i.addForm),{},{adjuvantId:t});Object(l["g"])(s).then((function(e){i.$message.success("保存成功"),i.getAdjuvantList(!0)})).catch((function(){})),i.resetForm(),i.addDialogVisible=!1}))},closeAccountDialog:function(){this.addDialogVisible=!1,this.resetForm()},resetForm:function(){this.addForm={carteNumber:"",carteName:"",specification:"",unit:"",remark:""}}}},_=k,L=(i("f455"),Object(v["a"])(_,s,a,!1,null,"3cdd76cb",null));t["a"]=L.exports},f455:function(e,t,i){"use strict";i("5ccb")}}]);