(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3c40e8e2"],{"224e":function(e,t,n){"use strict";n.d(t,"H",(function(){return r})),n.d(t,"D",(function(){return i})),n.d(t,"v",(function(){return o})),n.d(t,"C",(function(){return s})),n.d(t,"E",(function(){return c})),n.d(t,"F",(function(){return u})),n.d(t,"G",(function(){return l})),n.d(t,"I",(function(){return d})),n.d(t,"L",(function(){return f})),n.d(t,"J",(function(){return h})),n.d(t,"K",(function(){return p})),n.d(t,"u",(function(){return m})),n.d(t,"s",(function(){return b})),n.d(t,"t",(function(){return v})),n.d(t,"x",(function(){return j})),n.d(t,"w",(function(){return g})),n.d(t,"z",(function(){return y})),n.d(t,"y",(function(){return N})),n.d(t,"A",(function(){return C})),n.d(t,"B",(function(){return T})),n.d(t,"p",(function(){return O})),n.d(t,"k",(function(){return w})),n.d(t,"f",(function(){return D})),n.d(t,"r",(function(){return x})),n.d(t,"l",(function(){return I})),n.d(t,"g",(function(){return _})),n.d(t,"i",(function(){return S})),n.d(t,"h",(function(){return L})),n.d(t,"j",(function(){return k})),n.d(t,"q",(function(){return F})),n.d(t,"m",(function(){return A})),n.d(t,"n",(function(){return B})),n.d(t,"o",(function(){return U})),n.d(t,"a",(function(){return P})),n.d(t,"b",(function(){return $})),n.d(t,"d",(function(){return q})),n.d(t,"e",(function(){return E})),n.d(t,"c",(function(){return R}));n("d3b7"),n("159b"),n("b64b");var a=n("b775");function r(e){return Object(a["a"])({url:"financeSubject/queryListByType",method:"post",data:e,headers:{"Content-Type":"application/x-www-form-urlencoded"}})}function i(e){return Object(a["a"])({url:"/financeSubject/".concat(e.subjectId?"update":"add"),method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function o(e){return Object(a["a"])({url:"/financeInitial/deleteByAssistId",method:"post",data:e,headers:{"Content-Type":"application/x-www-form-urlencoded"}})}function s(e){return Object(a["a"])({url:"/financeInitial/queryByAdjuvant",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function c(e){return Object(a["a"])({url:"/financeSubject/deleteByIds",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function u(e){return Object(a["a"])({url:"/financeSubject/downloadExcel",method:"post",data:e,responseType:"blob",headers:{"Content-Type":"application/x-www-form-urlencoded"}})}function l(e){var t=new FormData;return Object.keys(e).forEach((function(n){t.append(n,e[n])})),Object(a["a"])({url:"/financeSubject/excelImport",method:"post",data:t,headers:{"Content-Type":"multipart/form-data"}})}function d(e){return Object(a["a"])({url:"/financeSubject/updateStatus",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function f(e){return Object(a["a"])({url:"/financeVoucher/queryList",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function h(e){return Object(a["a"])({url:"/financeVoucher/".concat(e.voucherId?"update":"add"),method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function p(e){return Object(a["a"])({url:"/financeVoucher/deleteById",method:"post",data:e,headers:{"Content-Type":"application/x-www-form-urlencoded"}})}function m(e){return Object(a["a"])({url:"/financeCurrency/queryAllList",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function b(e){return Object(a["a"])({url:"/financeCurrency/".concat(e.currencyId?"update":"add"),method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function v(e){return Object(a["a"])({url:"/financeCurrency/deleteById",method:"post",data:e,headers:{"Content-Type":"application/x-www-form-urlencoded"}})}function j(e){return Object(a["a"])({url:"/financeInitial/queryPageBySubjectType",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function g(e){return Object(a["a"])({url:"/financeInitial/add",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function y(e){return Object(a["a"])({url:"/financeInitial/update",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function N(e){return Object(a["a"])({url:"/financeInitial/queryTrialBalance",method:"post",data:e,headers:{"Content-Type":"application/x-www-form-urlencoded"}})}function C(e){return Object(a["a"])({url:"/financeParameter/queryParameter",method:"post",data:e,headers:{"Content-Type":"application/x-www-form-urlencoded"}})}function T(e){return Object(a["a"])({url:"/financeParameter/updateParameter",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function O(e){return Object(a["a"])({url:"financeAdjuvant/queryAllList",method:"post",data:e,headers:{"Content-Type":"application/x-www-form-urlencoded"}})}function w(e){return Object(a["a"])({url:"financeAdjuvant/queryCustomList",method:"post",data:e,headers:{"Content-Type":"application/x-www-form-urlencoded"}})}function D(e){return Object(a["a"])({url:"financeAdjuvant/add",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function x(e){return Object(a["a"])({url:"financeAdjuvant/update",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function I(e){return Object(a["a"])({url:"financeAdjuvant/deleteById",method:"post",data:e,headers:{"Content-Type":"application/x-www-form-urlencoded"}})}function _(e){return Object(a["a"])({url:"financeAdjuvantCarte/add",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function S(e){return Object(a["a"])({url:"financeAdjuvantCarte/update",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function L(e){return Object(a["a"])({url:"financeAdjuvantCarte/deleteById",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function k(e){return Object(a["a"])({url:"financeAdjuvantCarte/updateStatusById",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function F(e){return Object(a["a"])({url:"financeAdjuvantCarte/queryByAdjuvantId",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function A(e){return Object(a["a"])({url:"financeAdjuvantCarte/downloadExcel",method:"post",data:e,responseType:"blob",headers:{"Content-Type":"application/x-www-form-urlencoded"}})}function B(e){var t=new FormData;return Object.keys(e).forEach((function(n){t.append(n,e[n])})),Object(a["a"])({url:"financeAdjuvantCarte/excelImport",method:"post",data:t,headers:{"Content-Type":"multipart/form-data"}})}function U(e){return Object(a["a"])({url:"financeAdjuvantCarte/exportExcel",method:"post",data:e,responseType:"blob",headers:{"Content-Type":"application/json;charset=UTF-8"}})}function P(e){return Object(a["a"])({url:"financeSubject/exportListByType",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"},responseType:"blob"})}function $(e){return Object(a["a"])({url:"financeCertificate/exportPageBySubjectType",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"},responseType:"blob"})}function q(e){return Object(a["a"])({url:"/financeCertificate/downloadFinanceInitialExcel",method:"post",data:e,headers:{"Content-Type":"application/json"},responseType:"blob"})}function E(e){var t=new FormData;return Object.keys(e).forEach((function(n){t.append(n,e[n])})),Object(a["a"])({url:"/financeCertificate/financeInitialImport",method:"post",data:e,headers:{"Content-Type":"multipart/form-data"}})}function R(e){return Object(a["a"])({url:"/financeCertificate/checkSubjectCertificate",method:"post",data:e,headers:{"Content-Type":"application/x-www-form-urlencoded"}})}},4254:function(e,t,n){"use strict";n("6a63")},"50fc":function(e,t,n){},"6a63":function(e,t,n){},"8be7":function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{ref:"wkDialog",attrs:{visible:e.dialogVisible,"before-close":e.handleClose,"close-on-click-modal":!1,"append-to-body":"",width:e.showSubjectSelectOptions?"700px":"500px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[n("span",{staticClass:"el-dialog__title",attrs:{slot:"title"},slot:"title"},[e._v("\n    "+e._s(e.title)+"\n    "),e.nodeData&&e.helpObj?n("i",{staticClass:"wk wk-icon-fill-help wk-help-tips",attrs:{"data-type":e.helpObj.dataType,"data-id":e.helpObj.dataId}}):e._e()]),e._v(" "),n("flexbox",[e.showSubjectSelectOptions?n("SubjectSelectOptions"):e._e(),e._v(" "),n("el-form",{ref:"form",staticClass:"form",style:e.showSubjectSelectOptions?{marginLeft:"20px"}:{flex:"1"},attrs:{model:e.form,rules:e.rules,"validate-on-rule-change":!1,"label-width":"80px"}},[n("el-form-item",{attrs:{"inline-message":!0,label:"科目编码",prop:"number"}},[n("el-popover",{attrs:{value:e.selectVisible,placement:"bottom",title:"可用子集科目编码",width:"390",trigger:"manual"}},[!e.parentNode&&e.canUseSubject?n("div",{staticClass:"wrapper"},[n("div",{staticClass:"subject-list"},[n("div",{staticClass:"subject-list-item",on:{click:e.selectParentNumber}},[e._v("\n                "+e._s(e.canUseSubject.useNumber)+"\n              ")])])]):e._e(),e._v(" "),n("el-input",{attrs:{slot:"reference",disabled:e.getNumberDisabled,value:e.form.number},on:{input:e.checkNumber,change:function(t){e.getParentNodeId(e.form.number,null,e.subjectList)}},slot:"reference"})],1)],1),e._v(" "),n("div",{staticClass:"rule"},[e._v("\n        科目级次："+e._s(e.codeRule.join("-"))+"\n      ")]),e._v(" "),n("el-form-item",{attrs:{label:"科目名称",prop:"subjectName"}},[n("el-input",{model:{value:e.form.subjectName,callback:function(t){e.$set(e.form,"subjectName","string"===typeof t?t.trim():t)},expression:"form.subjectName"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"上级科目"}},[n("el-input",{attrs:{value:e.parentNodeName,disabled:""}})],1),e._v(" "),n("el-form-item",{attrs:{label:"科目类别",prop:"category"}},[n("el-select",{attrs:{disabled:e.categoryDisabled},model:{value:e.form.category,callback:function(t){e.$set(e.form,"category",t)},expression:"form.category"}},e._l(e.categoryOptions,(function(e,t){return n("el-option",{key:t,attrs:{label:e.name,value:e.value}})})))],1),e._v(" "),n("el-form-item",{staticClass:"no-margin",attrs:{label:"余额方向",prop:"balanceDirection"}},[n("el-radio-group",{attrs:{disabled:!!e.form.isRelevance},model:{value:e.form.balanceDirection,callback:function(t){e.$set(e.form,"balanceDirection",t)},expression:"form.balanceDirection"}},[n("el-radio",{attrs:{label:1}},[e._v("借")]),e._v(" "),n("el-radio",{attrs:{label:2}},[e._v("贷")])],1)],1),e._v(" "),n("el-form-item",{staticClass:"no-margin",staticStyle:{"margin-top":"20px"},attrs:{label:"辅助核算"}},[n("el-select",{attrs:{disabled:e.adjuvantDisable,multiple:""},model:{value:e.form.adjuvantIds,callback:function(t){e.$set(e.form,"adjuvantIds",t)},expression:"form.adjuvantIds"}},e._l(e.adjuvantOptions,(function(e,t){return n("el-option",{key:t,attrs:{label:e.adjuvantName,value:e.adjuvantId}})})))],1),e._v(" "),n("el-form-item",{staticClass:"no-margin",attrs:{"label-width":"20px"}},[n("el-checkbox",{attrs:{value:e.form.isAmount,"true-label":1,"false-label":0},on:{change:e.isAmountChange}},[e._v("数量核算")])],1),e._v(" "),e.form.isAmount?n("el-form-item",{staticClass:"no-margin",attrs:{label:"数量单位",prop:"amountUnit"}},[n("el-input",{model:{value:e.form.amountUnit,callback:function(t){e.$set(e.form,"amountUnit",t)},expression:"form.amountUnit"}})],1):e._e(),e._v(" "),n("el-form-item",{staticClass:"no-margin",attrs:{"label-width":"20px"}},[n("el-checkbox",{attrs:{disabled:!(!e.parentNode||!e.parentNode.isCash)||e.selectParent&&e.selectParent.isCash,"true-label":1,"false-label":0},model:{value:e.form.isCash,callback:function(t){e.$set(e.form,"isCash",t)},expression:"form.isCash"}},[e._v("现金及现金等价物")])],1)],1)],1),e._v(" "),e.visibleTipsDialog?n("SubjectTipsDialog",{attrs:{visible:e.visibleTipsDialog,"tips-form-field":e.tipsFormField,"node-data":e.nodeData,"parent-node":e.parentNode},on:{"update:visible":function(t){e.visibleTipsDialog=t},save:e.saveTipsHandle,close:e.closeTipsHandle}}):e._e(),e._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{directives:[{name:"debounce",rawName:"v-debounce",value:e.handleConfirm,expression:"handleConfirm"}],attrs:{type:"primary"}},[e._v("确定")]),e._v(" "),n("el-button",{on:{click:e.handleClose}},[e._v("取消")])],1)],1)},r=[],i=n("c7eb"),o=n("1da1"),s=n("5530"),c=n("2909"),u=(n("a9e3"),n("99af"),n("d81d"),n("4de4"),n("d3b7"),n("3ca3"),n("ddb0"),n("7db0"),n("ac1f"),n("5319"),n("38cf"),n("caad"),n("2532"),n("d9e2"),n("2ca0"),n("13d5"),n("fb6a"),n("224e")),l=n("b4e8"),d=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",e._g(e._b({attrs:{title:"提示",width:"400px","close-on-click-modal":!1,"show-close":!1,"append-to-body":""}},"el-dialog",e.$attrs,!1),e.$listeners),[n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"dialog-wrap"},[n("div",{staticClass:"dialog-title"},[e._v("\n      您正在为“"+e._s(e.subjectName)+"“科目配置辅助核算，此科目已被使用，数据将转移到辅助核算项目中。\n    ")]),e._v(" "),n("el-form",{ref:"form",attrs:{"label-position":"left",model:e.form,rules:e.rules,"label-width":"80px",inline:!1,size:"normal"}},[n("div",{staticClass:"form-title"},[e._v("请选择数据迁移的辅助核算项目：")]),e._v(" "),e._l(e.formField,(function(t,a){return n("el-form-item",{key:a,attrs:{label:t.label,prop:t.fieldName}},[n("el-select",{staticStyle:{width:"100%"},model:{value:e.form[t.fieldName],callback:function(n){e.$set(e.form,t.fieldName,n)},expression:"form[item.fieldName]"}},e._l(t.options,(function(e){return n("el-option",{key:e.carteId+e.carteName,attrs:{label:e.carteName,value:e.carteId}})})))],1)})),e._v(" "),n("div",{staticClass:"form-warning"},[e._v("该操作不可逆，您是否要继续？")])],2)],1),e._v(" "),n("span",{attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary"},on:{click:e.saveHandle}},[e._v("确定")]),e._v(" "),n("el-button",{on:{click:e.closeHandle}},[e._v("取消")])],1)])},f=[],h=(n("14d9"),n("b64b"),{props:{tipsFormField:{type:Array,default:function(){return[]}},nodeData:{type:Object,default:null},parentNode:{type:Object,default:null}},data:function(){return{loading:!1,formField:[],form:{},rules:{}}},computed:{subjectName:function(){var e=this.nodeData||this.parentNode;return(null===e||void 0===e?void 0:e.subjectName)||""}},created:function(){this.init()},methods:{init:function(){var e=this;return Object(o["a"])(Object(i["a"])().mark((function t(){var n,a,r;return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.loading=!0,n=[],a=0;case 3:if(!(a<e.tipsFormField.length)){t.next=15;break}return r=e.tipsFormField[a],r.label=r.adjuvantName,r.value=r.adjuvantId,r.fieldName=r.adjuvantId,t.next=10,e.getDataListById(r.adjuvantId);case 10:r.options=t.sent,n.push(r);case 12:a++,t.next=3;break;case 15:e.rules=n.reduce((function(e,t){return e[t.fieldName]=[{required:!0,message:"请输入".concat(t.label),trigger:"blur"}],e}),{}),e.formField=n,e.loading=!1;case 18:case"end":return t.stop()}}),t)})))()},saveHandle:function(){var e=this;this.$refs.form.validate((function(t){if(t){var n=Object.keys(e.form).reduce((function(t,n){var a;t[n]=e.formField.find((function(e){return e.adjuvantId==n})).options.find((function(t){return t.carteId==e.form[n]}));var r=e.nodeData||e.parentNode,i=null===(a=r.adjuvantList)||void 0===a?void 0:a.find((function(e){return e.adjuvantId==n}));return i&&(t[n].label=i.label,t[n].labelName=i.labelName),t}),{});e.$emit("save",n)}}))},closeHandle:function(){this.$emit("update:visible",!1),this.$emit("close")},getDataListById:function(e){var t={pageType:0,adjuvantId:e};return Object(u["q"])(t).then((function(e){return e.data.list}))}}}),p=h,m=(n("b54a"),n("2877")),b=Object(m["a"])(p,d,f,!1,null,"8485f994",null),v=b.exports,j=n("6bfe"),g=n("ed08"),y={name:"SubjectAddOrUpdate",components:{SubjectSelectOptions:l["a"],SubjectTipsDialog:v},props:{visible:{type:Boolean,default:!1},nodeData:{type:Object,default:null},parentNode:{type:Object,default:null},subjectType:{type:[String,Number],default:null},helpObj:Object,showSubjectSelectOptions:{type:Boolean,default:!1}},data:function(){return{loading:!1,dialogVisible:!1,form:{number:""},selectParent:null,codeRule:[],subjectList:[],selfSubjectType:null,adjuvantOptions:[],currencyList:[],visibleTipsDialog:!1,tipsFormField:[]}},computed:{title:function(){return this.nodeData?"编辑科目":this.parentNode?"新建下级科目":"新建科目"},parentNodeName:function(){return this.parentNode||this.selectParent?this.parentNode?"".concat(this.parentNode.number," ").concat(this.parentNode.subjectName):"".concat(this.selectParent.number," ").concat(this.selectParent.subjectName):"无上级科目"},selectVisible:function(){return!(this.parentNode||!this.canUseSubject||this.nodeData)},canUseSubject:function(){var e=this.getSubjectByNumber(this.subjectList,this.form.number);if(e){var t;if(e.children&&e.children.length)t=Math.max.apply(Math,Object(c["a"])(e.children.map((function(e){return Number(e.number)}))))+1;else{for(var n=e.number,a=1;a<this.codeRule[e.grade];a++)n+="0";n+="1",t=n}return Object(s["a"])(Object(s["a"])({},e),{},{useNumber:t})}return""},getNumberDisabled:function(){return!!(this.nodeData&&this.nodeData.children&&this.nodeData.children.length)},categoryOptions:function(){var e=this,t=[{name:"流动资产",value:1,type:1,category:1},{name:"非流动资产",value:2,type:1,category:2},{name:"流动负债",value:3,type:2,category:1},{name:"非流动负债",value:4,type:2,category:2},{name:"所有者权益",value:5,type:3,category:1},{name:"成本",value:6,type:4,category:1},{name:"营业收入",value:7,type:5,category:1},{name:"其他收益",value:8,type:5,category:2},{name:"期间费用",value:9,type:5,category:3},{name:"其他损失",value:10,type:5,category:4},{name:"营业成本及税金",value:11,type:5,category:5},{name:"以前年度损益调整",value:12,type:5,category:6},{name:"所得税",value:13,type:5,category:7}];return this.selfSubjectType?t.filter((function(t){return t.type===Number(e.selfSubjectType)})):t},categoryDisabled:function(){return Boolean(this.parentNode||this.selectParent)},rules:function(){return{number:[{required:!0,message:"请输入科目编号",trigger:"blur"},{validator:this.validatorNumber,trigger:"blur"}],subjectName:[{required:!0,message:"请输入科目名称",trigger:"blur"}],category:[{required:!0,message:"请选择科目类别",trigger:"blur"}],balanceDirection:[{required:!0,message:"请选择余额方向",trigger:"change"}]}},adjuvantDisable:function(){var e,t,n,a;return!!(this.nodeData&&null!==(e=this.nodeData)&&void 0!==e&&null!==(t=e.adjuvantList)&&void 0!==t&&t.length&&this.nodeData.isRelevance)||(!!(this.isLastLevel&&this.parentNode&&null!==(n=this.parentNode)&&void 0!==n&&null!==(a=n.adjuvantList)&&void 0!==a&&a.length&&this.parentNode.isRelevance)||!this.isCreate&&!this.isLastLevel&&!(!this.isCreate&&this.noSubordinates))},isCreate:function(){return null==this.nodeData&&null==this.parentNode},isLastLevel:function(){var e,t;return null==this.nodeData&&0==(null===(e=this.parentNode)||void 0===e||null===(t=e.children)||void 0===t?void 0:t.length)},isEditLastLevel:function(){var e,t;return this.nodeData&&0==(null===(e=this.nodeData)||void 0===e||null===(t=e.children)||void 0===t?void 0:t.length)},noSubordinates:function(){var e,t;return 0==(null===(e=this.nodeData)||void 0===e||null===(t=e.children)||void 0===t?void 0:t.length)}},watch:{visible:{handler:function(){var e=this;this.dialogVisible=this.visible,this.visible&&(this.loading=!0,Promise.all([this.getSubjectGroupList(),this.getCodeRule()]).then((function(){e.loading=!1,e.initForm()})).catch((function(){e.loading=!1})),this.subjectType&&(this.selfSubjectType=this.subjectType))},immediate:!0}},created:function(){this.getAllAdjuvantList(),this.getCurrencyGroupList()},methods:{getCodeRule:function(){var e=this;return new Promise((function(t,n){Object(u["A"])().then((function(a){a.data&&a.data.rule?(e.codeRule=a.data.rule.split("-").map((function(e){return Number(e)})),t()):n()})).catch((function(){n()}))}))},getAllAdjuvantList:function(){var e=this;Object(u["p"])().then((function(t){e.adjuvantOptions=t.data})).catch((function(){}))},getSubjectGroupList:function(){var e=this;return new Promise((function(t,n){Object(u["H"])({type:"",isTree:1}).then((function(n){e.subjectList=n.data,t()})).catch((function(){n()}))}))},getAdjuvantList:function(e){e.adjuvantList?this.$set(this.form,"adjuvantIds",e.adjuvantList.map((function(e){return e.adjuvantId}))):this.$set(this.form,"adjuvantIds",[])},getCurrencyGroupList:function(){var e=this;Object(u["u"])().then((function(t){e.currencyList=t.data}))},initForm:function(){var e=this;if(this.nodeData){var t;this.form=Object(g["s"])(this.nodeData),this.getAdjuvantList(this.nodeData),this.$set(this.form,"adjuvantIds",(null===(t=this.form.adjuvantList)||void 0===t?void 0:t.map((function(e){return e.adjuvantId})))||[]);var n=this.categoryOptions.find((function(t){return t.category===e.nodeData.category&&t.type===Number(e.selfSubjectType)}));n&&this.$set(this.form,"category",n.value),delete this.form.createTime,delete this.form.createUserId}else if(this.form={adjuvantIds:[],amountUnit:"",balanceDirection:1,currencyIds:[],grade:"",isAmount:0,isCash:0,number:"",subjectName:"",type:this.selfSubjectType||"",category:this.parentNode?this.categoryOptions[this.parentNode.category-1].value:""},this.parentNode){this.form.balanceDirection=this.parentNode.balanceDirection;var a=this.getSubjectByNumber(this.subjectList,this.parentNode.number);if(a&&a.children&&a.children.length)for(var r=a.number,i=a.children.map((function(e){return e.number.replace(r,"")})),o=this.codeRule[this.parentNode.grade],s=1;s<Number("9".repeat(o));s++){var c="0".repeat(o-String(s).length)+s;if(!i.includes(c)){this.form.number=r+c;break}}else if(this.codeRule[this.parentNode.grade]){for(var u=1*this.codeRule[this.parentNode.grade]-1,l=this.parentNode.number,d=0;d<u;d++)l+="0";l+="1",this.form.number=l}else this.form.number=this.parentNode.number+"01";this.getAdjuvantList(this.parentNode),this.parentNode.isCash&&(this.form.isCash=this.parentNode.isCash),this.parentNode.isAmount&&(this.form.isAmount=this.parentNode.isAmount,this.form.amountUnit=this.parentNode.amountUnit)}},isAmountChange:function(e){var t=this;!e&&(this.nodeData&&this.nodeData.isAmount||this.parentNode&&this.parentNode.isAmount)?this.$confirm("取消数量核算将无法查看之前录入的数量，也不能查询此科目的数量核算，也不能查询此科目的数量账簿！","系统提示",{confirmButtonText:"确定",cancelButtonText:"放弃",type:"warning"}).then((function(){t.form.isAmount=e})).catch((function(){})):this.form.isAmount=e},getSubjectByNumber:function(e,t){for(var n,a=0;a<e.length;a++){var r=e[a];if(r.children&&r.children.length&&(n=this.getSubjectByNumber(r.children,t)),r.number===t&&(n=r),n)return n}},getSubjectByName:function(e,t){for(var n,a=0;a<e.length;a++){var r=e[a];if(r.children&&r.children.length&&(n=this.getSubjectByNumber(r.children,t)),r.subjectName===t&&(n=r),n)return n}},selectParentNumber:function(){this.selectParent=this.canUseSubject,this.form.number=this.selectParent.useNumber,this.form.category=this.selectParent.category,this.form.isCash=this.selectParent.isCash,this.getAdjuvantList(this.selectParent)},validatorNumber:function(e,t,n){if(Object(j["c"])(t))n();else{if(isNaN(Number(t)))return void n(new Error("编码必须为数字"));if(this.parentNode)t.replace(this.parentNode.number,"").length!==this.codeRule[this.parentNode.grade]?n(new Error("不符合编码规则")):t.startsWith(this.parentNode.number)?n():n(new Error("不符合编码规则"));else{var a=this.getGradeByNumber(t);if(a){var r=this.codeRule.reduce((function(e,t,n){return n<a?e+t:e}));String(t).length!==r?n(new Error("不符合编码规则")):n()}else n(new Error("不符合编码规则"))}}},getParentNodeId:function(e,t,n){if(this.parentNode||this.selectParent)return this.parentNode?(this.getAdjuvantList(this.parentNode),this.parentNode.subjectId):(this.getAdjuvantList(this.selectParent),this.selectParent.subjectId);if(t||(t=this.getGradeByNumber(e)),t)for(var a=this.codeRule.reduce((function(e,n,a){return a<t-1?e+n:e})),r=0;r<n.length;r++){var i=n[r];if(e.startsWith(i.number)){if(i.grade===t-1)return this.setCategory(i.type),this.selectParent=i,this.getAdjuvantList(i),i.subjectId;if(i.children)return this.getParentNodeId(e,t,i.children)}else if(t===i.grade&&e.length===i.number.length&&e.slice(0,a)===i.number.slice(0,a))return this.setCategory(i.type),i.parentId}},getGradeByNumber:function(e){for(var t=0,n=0;n<this.codeRule.length;n++)if(t+=this.codeRule[n],String(this.form.number).length===t)return n+1},setCategory:function(e){var t=this;this.selfSubjectType=e,this.$nextTick((function(){var e=t.categoryOptions[0];t.$set(t.form,"category",e.value)}))},handleClose:function(){this.dialogVisible=!1,this.$emit("update:visible",!1),this.$emit("close"),this.$refs.form.resetFields()},checkNumber:function(e){this.parentNode?e.includes(this.parentNode.number)&&(this.form.number=e):(this.selectParent&&!this.getSubjectByNumber(this.subjectList,this.form.number)&&(this.selectParent=null),this.form.number=e)},handleConfirm:function(){var e=this;this.loading=!0,this.$refs.form.validate((function(t){if(t){var n=Object(g["s"])(e.form);if(e.parentNode)n.grade=e.parentNode.grade+1,n.parentId=e.parentNode.subjectId;else if(n.grade=e.getGradeByNumber(n.number),n.grade>1){var a=e.getParentNodeId(n.number,n.grade,e.subjectList);if(!a)return void e.$message.warning("您输入的编码为明细科目编码，但在当前类别找不到其上级科目");n.parentId=a}var r=e.categoryOptions.find((function(t){return t.value===e.form.category}));if(!r)return void e.$message.error("科目类别错误");n.type=r.type,n.category=r.category,delete n.companyId;var i=function(t){t&&(n.associationMap=t);var a=e.parentNode||e.selectParent,r=a&&a.children?a.children.length:"";if(a&&a.balance&&!r){var i="您正在为科目“".concat(a.subjectName,"”增加第一个下级科目，\n            系统将把该科目的数据全部转移到新增的下级科目中，该操作不可逆，您是否要继续？");e.$confirm(i,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.submitData(n)})).catch((function(){}))}else e.submitData(n)};if(e.getSubjectByName(e.subjectList,n.subjectName)&&!e.nodeData)e.$confirm("已存在相同名称的科目，请确定是否保存?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){if(!1===e.adjuvantDisable&&e.form.adjuvantIds.length){var t=e.isLastLevel?e.parentNode.subjectId:e.nodeData.subjectId;e.checkData(t).then((function(t){t?e.tipsFormDialog().then((function(e){i(e)})):i()}))}else i()})).catch((function(){}));else if(!1===e.adjuvantDisable&&e.form.adjuvantIds.length)if(e.parentNode||e.selectParent){var o=e.isLastLevel?e.parentNode.subjectId:e.nodeData.subjectId;e.checkData(o).then((function(t){t?e.tipsFormDialog().then((function(e){i(e)})):i()}))}else i();else i()}}))},tipsFormDialog:function(){var e=this;return new Promise((function(t,n){var a=e.form.adjuvantIds.map((function(t){return e.adjuvantOptions.find((function(e){return e.adjuvantId==t}))}));e.tipsFormField=a,e.visibleTipsDialog=!0,e._promiseCall={resolve:t,reject:n}}))},saveTipsHandle:function(e){this._promiseCall.resolve(e),this.visibleTipsDialog=!1},closeTipsHandle:function(){this._promiseCall.reject(),this.visibleTipsDialog=!1},checkData:function(e){return Object(o["a"])(Object(i["a"])().mark((function t(){return Object(i["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",Object(u["c"])({subjectId:e}).then((function(e){return e.data})));case 1:case"end":return t.stop()}}),t)})))()},submitData:function(e){var t=this;this.loading=!0,Object(u["D"])(e).then((function(e){t.loading=!1,t.$message.success("添加成功"),t.$emit("confirm"),t.handleClose(),t.$refs.form.resetFields()})).catch((function(){t.loading=!1}))}}},N=y,C=(n("b88a"),Object(m["a"])(N,a,r,!1,null,"632684d3",null));t["a"]=C.exports},"8cb7":function(e,t,n){},b4e8:function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"subject-select"},[n("flexbox",{staticClass:"headerList",attrs:{gutter:0}},[n("flexbox-item",e._l(e.typeList,(function(t,a){return n("el-button",{key:a,attrs:{type:e.activeType==t.label?"selected":""},on:{click:function(n){e.handleChangeType(t)}}},[e._v("\n        "+e._s(t.name)+"\n      ")])})))],1),e._v(" "),n("div",{staticClass:"content"},[n("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"elTree",attrs:{data:e.treeData,props:e.defaultProps,"expand-on-click-node":!1,"node-key":"subjectId","highlight-current":"","default-expand-all":""},on:{"node-click":e.handleNodeClick},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.data;return n("span",{staticClass:"custom-tree-node"},[e._v("\n        "+e._s(a.number+" "+a.subjectName)+"\n      ")])}}])})],1)],1)},r=[],i=(n("a434"),n("224e")),o=n("ed08"),s={props:{noUseDisabled:{type:Boolean,default:!1},isChildren:{type:Boolean,default:!1},beforeChoose:{type:Function,default:null}},data:function(){return{activeType:1,loading:!1,typeList:[{name:"资产",label:1},{name:"负债",label:2},{name:"权益",label:3},{name:"成本",label:4},{name:"损益",label:5}],selectedNode:null,dataCache:{},treeData:[],defaultProps:{children:"children",label:"subjectName"}}},mounted:function(){this.getSubjectList()},methods:{getSubjectList:function(){var e=this;this.loading=!0,Object(i["H"])({type:this.activeType,isTree:1}).then((function(t){e.loading=!1,e.dataCache[e.activeType]=t.data;var n=Object(o["s"])(t.data);e.noUseDisabled?e.treeData=e.filterSubjectList(n):e.treeData=n})).catch((function(){e.loading=!1}))},handleChangeType:function(e){if(this.activeType=e.label,this.dataCache[this.activeType]&&0!==this.dataCache[this.activeType].length){var t=Object(o["s"])(this.dataCache[this.activeType]);this.noUseDisabled?this.treeData=this.filterSubjectList(t):this.treeData=t}else this.getSubjectList();this.selectedNode=null},filterSubjectList:function(e){for(var t=0;t<e.length;t++){var n=e[t];n.children&&this.filterSubjectList(n.children),n.status||(n.children&&n.children.length?e=e.splice(e.indexOf(n),1,n.children):e.splice(e.indexOf(n),1))}return e},handleNodeClick:function(e){if(this.beforeChoose){var t=this.beforeChoose(e);if(!t)return}this.selectedNode=e,this.$emit("input",e)}}},c=s,u=(n("4254"),n("2877")),l=Object(u["a"])(c,a,r,!1,null,"0ffd3d5e",null);t["a"]=l.exports},b54a:function(e,t,n){"use strict";n("8cb7")},b88a:function(e,t,n){"use strict";n("50fc")}}]);