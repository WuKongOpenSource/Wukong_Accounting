(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-991a4b14"],{"03e1":function(e,t,a){},"0481":function(e,t,a){},"26ad":function(e,t,a){"use strict";a("8c49")},"38cf":function(e,t,a){var i=a("23e7"),n=a("1148");i({target:"String",proto:!0},{repeat:n})},"59d0":function(e,t,a){"use strict";a("f4aa")},"86f5":function(e,t,a){"use strict";a("9687")},"8c49":function(e,t,a){},9209:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("flexbox",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"app-container",attrs:{gutter:0,align:"flex-start",justify:"flex-start",direction:"column"}},[a("div",{staticClass:"main-header"},[a("span",{staticClass:"main-title"},[e._v("\n      结账\n      "),a("i",{staticClass:"wk wk-icon-fill-help wk-help-tips",attrs:{"data-type":"41","data-id":"323"}})]),e._v(" "),a("div",{staticClass:"buttons"},[a("el-button",{on:{click:e.getData}},[e._v("\n        重新测算\n        "),a("i",{staticClass:"wk wk-icon-fill-help wk-help-tips",staticStyle:{color:"#344563",background:"#f4f5f7"},attrs:{"data-type":"41","data-id":"330"}})]),e._v(" "),e.$auth("finance.checkOut.generate")?a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.handleToVoucher()}}},[e._v("生成凭证")]):e._e(),e._v(" "),e.$auth("finance.checkOut.checkOut")?a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.handleToSettleAccounts(1)}}},[e._v("结账")]):e._e(),e._v(" "),e.$auth("finance.checkOut.cancelClosing")&&e.showBackSettle?a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.handleToSettleAccounts(2)}}},[e._v("反结账")]):e._e()],1)]),e._v(" "),a("div",{staticClass:"wrapper"},[a("flexbox",{staticClass:"header"},[a("div",{staticClass:"info text-one-ellipsis"},[e._v("\n        "+e._s(e.infoText)+"\n      ")]),e._v(" "),a("el-checkbox",{attrs:{indeterminate:e.checkedHarf},on:{change:e.handleChangeAllChecked},model:{value:e.checkedAll,callback:function(t){e.checkedAll=t},expression:"checkedAll"}},[e._v("全选")])],1),e._v(" "),a("flexbox",{staticClass:"body",attrs:{align:"flex-start",justify:"flex-start",wrap:"wrap"}},[e._l(e.settleData.statements,(function(t,i){return a("flexbox",{key:i,staticClass:"list-item",attrs:{align:"center",justify:"center",direction:"column"}},[a("div",{staticClass:"box"},[a("flexbox",{staticClass:"box-title"},[a("el-checkbox",{on:{change:e.handleChangeItemChecked},model:{value:t.checked,callback:function(a){e.$set(t,"checked",a)},expression:"item.checked"}}),e._v(" "),a("flexbox-item",{staticClass:"type"},[e._v("\n              "+e._s(t.statementName)+"\n              "),e.getDataId(t.statementType)?a("i",{staticClass:"wk wk-icon-fill-help wk-help-tips",attrs:{"data-type":"41","data-id":e.getDataId(t.statementType)}}):e._e()]),e._v(" "),a("el-button",{attrs:{icon:"wk wk-icon-setup",type:"text"},on:{click:function(a){e.handleToEdit(t)}}})],1),e._v(" "),a("div",{staticClass:"box-content"},[a("div",[a("span",{staticClass:"num"},[e._v(e._s(e._f("separator")(t.balance)))])]),e._v(" "),a("flexbox",{staticClass:"des",attrs:{justify:"space-between"}},[a("div",{staticClass:"unit"},[e._v("金额")]),e._v(" "),t.certificates&&t.certificates.length>0?a("div",{staticClass:"name"},e._l(t.certificates,(function(t){return a("span",{key:t.certificateId,staticClass:"certificate-text",on:{click:function(a){e.handleToVoucherDetail(t)}}},[e._v("\n                  "+e._s(t.certificateNum)+"\n                ")])}))):e._e()])],1),e._v(" "),a("div",{staticClass:"box-handle"},[t.certificates&&t.certificates.length>0&&e.$auth("finance.checkOut.generate")?a("el-button",{staticClass:"create",attrs:{type:"text"},on:{click:function(a){e.handleToVoucher(t)}}},[e._v("\n              重新生成\n            ")]):e.$auth("finance.checkOut.generate")?a("el-button",{staticClass:"create",attrs:{type:"text"},on:{click:function(a){e.handleToVoucher(t)}}},[e._v("\n              生成凭证\n            ")]):e._e()],1)],1)])})),e._v(" "),a("flexbox",{staticClass:"list-item",attrs:{align:"center",justify:"center",direction:"column"}},[a("div",{staticClass:"box add-box",on:{click:e.handleAddTpl}},[a("i",{staticClass:"el-icon-plus"})]),e._v(" "),a("div",[e._v("期末结转凭证模板")])])],2)],1),e._v(" "),e.addTplDialogVisible?a("choose-tpl-dialog",{attrs:{visible:e.addTplDialogVisible,"tpl-item":e.statementItem,"help-obj":e.helpObj.choose},on:{"update:visible":function(t){e.addTplDialogVisible=t},confirm:function(t){e.getData()}}}):e._e(),e._v(" "),e.updateDialogVisible&&e.statementItem&&2!==e.statementItem.statementType?a("statement-detail-dialog",{attrs:{visible:e.updateDialogVisible,"statement-item":e.statementItem},on:{"update:visible":function(t){e.updateDialogVisible=t},confirm:function(t){e.getData()}}}):e._e(),e._v(" "),e.updateDialogVisible&&e.statementItem&&2===e.statementItem.statementType?a("profit-and-loss-dialog",{attrs:{visible:e.updateDialogVisible,"statement-item":e.statementItem,"statement-time":e.settleData.settleTime,"help-obj":e.helpObj.profit},on:{"update:visible":function(t){e.updateDialogVisible=t},confirm:function(t){e.getData()}}}):e._e(),e._v(" "),e.settleDialogVisible?a("settle-dialog",{attrs:{visible:e.settleDialogVisible,"settle-time":e.settleData.settleTime,"settle-type":e.settleType,"settle-ids":e.settleIds},on:{"update:visible":function(t){e.settleDialogVisible=t},confirm:function(t){e.getData()}}}):e._e()],1)},n=[],l=a("5530"),s=(a("99af"),a("4de4"),a("d3b7"),a("159b"),a("14d9"),a("d81d"),a("b775"));function o(e){return Object(s["a"])({url:"/financeStatement/queryStatement",method:"post",data:e})}function c(e){return Object(s["a"])({url:"/financeStatement/statement",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function r(e){return Object(s["a"])({url:"/financeStatement/statementCertificate",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function d(e){return Object(s["a"])({url:"/financeStatement/queryListByType",method:"post",data:e})}function u(e){return Object(s["a"])({url:"/financeStatement/querySubjectList",method:"post",data:e})}function m(e){return Object(s["a"])({url:"/financeStatement/add",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function p(e){return Object(s["a"])({url:"/financeStatement/update",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function h(e){return Object(s["a"])({url:"/financeStatement/addTemplate",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function f(e){return Object(s["a"])({url:"/financeStatement/updateTemplate",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}var b=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{visible:e.dialogVisible,"append-to-body":!0,"close-on-click-modal":!1,width:"800px"},on:{"update:visible":function(t){e.dialogVisible=t},close:e.handleCancel}},[a("span",{staticClass:"el-dialog__title",attrs:{slot:"title"},slot:"title"},[e._v("\n    新增期末结转凭证模板\n    "),e.helpObj?a("i",{staticClass:"wk wk-icon-fill-help wk-help-tips",attrs:{"data-type":e.helpObj.dataType,"data-id":e.helpObj.dataId}}):e._e()]),e._v(" "),a("flexbox",{staticClass:"tab-header"},e._l(e.dataList,(function(t,i){return a("el-button",{key:i,attrs:{type:e.activeTemplateType==t.templateType?"selected":""},on:{click:function(a){e.activeTemplateType=t.templateType}}},[e._v("\n      "+e._s(t.tabName)+"\n    ")])}))),e._v(" "),e._l(e.dataList,(function(t,i){return a("div",{directives:[{name:"show",rawName:"v-show",value:e.activeTemplateType==t.templateType,expression:"activeTemplateType==tab.templateType"}],key:i,staticClass:"tpl-list"},[e._l(t.list,(function(t){return a("div",{key:t.templateId,staticClass:"tpl-list-item",class:{active:e.getActiveStatus(t)},on:{click:function(a){e.handleChoose(t)}}},[e._v("\n      "+e._s(t.digestContent)+"\n      "),a("i",{staticClass:"wk wk-edit edit-btn",on:{click:function(a){a.stopPropagation(),e.handleAddCategory(t)}}})])})),e._v(" "),a("div",{staticClass:"tpl-list-item add-btn",on:{click:function(t){e.handleAddCategory()}}},[a("i",{staticClass:"el-icon-plus"})])],2)})),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"debounce",rawName:"v-debounce",value:e.handleConfirm,expression:"handleConfirm"}],attrs:{type:"primary"}},[e._v("保存")]),e._v(" "),a("el-button",{on:{click:e.handleCancel}},[e._v("取消")])],1),e._v(" "),e.addOrUpdateDialogVisible?a("update-tpl-dialog",{attrs:{visible:e.addOrUpdateDialogVisible,"tpl-data":e.selectedTpl,"tpl-type":e.activeTemplateType},on:{"update:visible":function(t){e.addOrUpdateDialogVisible=t},confirm:e.handleConfirmUpdate}}):e._e()],2)},v=[],g=a("c7eb"),y=a("1da1"),T=(a("7db0"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{visible:e.dialogVisible,title:e.title,"close-on-click-modal":!1,"append-to-body":"",width:"880px"},on:{"update:visible":function(t){e.dialogVisible=t},close:e.handleCancel}},[a("div",{staticClass:"category-create"},[a("el-form",{attrs:{"label-width":"auto","label-position":"left"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:18}},[a("el-form-item",{attrs:{label:"名称","label-width":"50px"}},[a("el-input",{model:{value:e.form.digestContent,callback:function(t){e.$set(e.form,"digestContent",t)},expression:"form.digestContent"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"","label-width":"0"}},[a("el-checkbox",{attrs:{"true-label":1,"false-label":0},on:{change:e.handleChangeEnd},model:{value:e.form.isEndOver,callback:function(t){e.$set(e.form,"isEndOver",t)},expression:"form.isEndOver"}},[e._v("\n              期末结转凭证\n            ")])],1)],1)],1),e._v(" "),e.form.isEndOver?a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"科目","label-width":"40px"}},[e.subjectList.length>0?a("subject-select-options",{attrs:{"subject-list":e.subjectList},model:{value:e.form.subjectId,callback:function(t){e.$set(e.form,"subjectId",t)},expression:"form.subjectId"}}):e._e()],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"取数规则"}},[a("el-select",{model:{value:e.form.gainRule,callback:function(t){e.$set(e.form,"gainRule",t)},expression:"form.gainRule"}},e._l(e.ruleOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})))],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"时间类型"}},[a("el-select",{model:{value:e.form.timeType,callback:function(t){e.$set(e.form,"timeType",t)},expression:"form.timeType"}},e._l(e.timeOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})))],1)],1)],1):e._e()],1),e._v(" "),a("el-table",{attrs:{data:e.tableData,height:"40vh"}},[a("el-table-column",{attrs:{prop:"digestContent",label:"摘要",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row,n=t.column;return[a("el-input",{model:{value:i[n.property],callback:function(t){e.$set(i,n.property,t)},expression:"row[column.property]"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"isLend",label:"借/贷",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row,n=t.column;return[a("el-select",{model:{value:i[n.property],callback:function(t){e.$set(i,n.property,t)},expression:"row[column.property]"}},[a("el-option",{attrs:{value:1,label:"借"}}),e._v(" "),a("el-option",{attrs:{value:2,label:"贷"}})],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"subjectId",label:"科目",width:"369"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row,n=t.column;return[e.subjectList.length>0?a("subject-select-options",{attrs:{"subject-list":e.subjectList},model:{value:i[n.property],callback:function(t){e.$set(i,n.property,t)},expression:"row[column.property]"}}):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"moneyRatio",label:"金额比例%",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row,n=t.column;return[a("el-input-number",{attrs:{controls:!1},model:{value:i[n.property],callback:function(t){e.$set(i,n.property,t)},expression:"row[column.property]"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.$index;return[a("el-button",{attrs:{type:"primary-text"},on:{click:function(t){e.handleDelete(i)}}},[e._v("删除")])]}}])})],1),e._v(" "),a("el-button",{staticClass:"add-btn",attrs:{type:"text",icon:"el-icon-plus",plain:""},on:{click:e.handleAdd}},[e._v("添加一条数据")])],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"debounce",rawName:"v-debounce",value:e.handleConfirm,expression:"handleConfirm"}],attrs:{type:"primary"}},[e._v("确定")]),e._v(" "),a("el-button",{on:{click:e.handleCancel}},[e._v("取消")])],1),e._v(" "),e.selectSubjectDialogVisible?a("subject-select-options",{attrs:{visible:e.selectSubjectDialogVisible},on:{"update:visible":function(t){e.selectSubjectDialogVisible=t},confirm:e.selectSubject}}):e._e()],1)}),_=[],j=(a("a9e3"),a("a434"),a("13d5"),a("224e")),k=a("cb41"),D={name:"TplDetailDialog",components:{SubjectSelectOptions:k["a"]},props:{visible:{type:Boolean,default:!1},tplType:{type:[String,Number]},tplData:{type:Object,default:null}},data:function(){return{loading:!1,dialogVisible:!1,form:{},ruleOptions:[{label:"余额",value:1},{label:"借方余额",value:2},{label:"贷方余额",value:3}],timeOptions:[{label:"期末",value:1},{label:"期初",value:2},{label:"年初",value:3}],subjectList:[],tableData:[],editRowIndex:null,selectSubjectDialogVisible:!1}},computed:{title:function(){return this.tplData?"编辑分类":"新增分类"}},watch:{visible:{handler:function(e){this.dialogVisible=e;var t="";e?this.tplData&&(t=this.tplData.digestContent||"",this.form=Object(l["a"])({},this.tplData),this.getTplSubjectByTplId()):t="",this.$set(this.form,"digestContent",t)},immediate:!0}},created:function(){this.getSubjectList()},methods:{getSubjectList:function(){var e=this;this.loading=!0,Object(j["H"])({type:null,isTree:0}).then((function(t){e.loading=!1,e.subjectList=t.data||[]})).catch((function(){e.loading=!1}))},getTplSubjectByTplId:function(){var e=this;this.loading=!0,u({templateId:this.tplData.templateId}).then((function(t){e.loading=!1,e.tableData=t.data||[]})).catch((function(){e.loading=!1}))},handleChangeEnd:function(){var e=this;if(1===this.form.isEndOver)this.$set(this.form,"subjectId",null),this.$set(this.form,"timeType",1),this.$set(this.form,"gainRule",1);else{var t=["subjectId","timeType","gainRule"];t.forEach((function(t){delete e.form[t]}))}},selectSubject:function(e){this.selectSubjectDialogVisible=!1,this.tableData[this.editRowIndex].number=e.subjectId,this.$set(this.tableData,this.editRowIndex,this.tableData[this.editRowIndex])},handleDelete:function(e){this.tableData.splice(e,1)},handleAdd:function(){this.tableData.push({digestContent:"",isLend:1,moneyRatio:0,number:""})},handleCancel:function(){this.dialogVisible=!1,this.$emit("update:visible",!1)},handleConfirm:function(){var e=this,t=Object(l["a"])(Object(l["a"])({},this.form),{},{templateType:this.tplType});if(this.tplData&&(t.templateId=this.tplData.templateId),0!==this.tableData.length){for(var a=0;a<this.tableData.length;a++){var i=this.tableData[a];if(!i.digestContent)return void this.$message.error("摘要不能为空");if(!i.subjectId)return void this.$message.error("科目不能为空")}var n=this.tableData.filter((function(e){return 1===e.isLend})).reduce((function(e,t){return e.moneyRatio+t.moneyRatio}),0);if(n>100)this.$message.error("借方科目百分比之和不能超过100%");else{var s=this.tableData.filter((function(e){return 1===e.isLend})).reduce((function(e,t){return e.moneyRatio+t.moneyRatio}),0);if(s>100)this.$message.error("贷方科目百分比之和不能超过100%");else{if(t.templateSubjects=this.tableData,!t.isEndOver||1!==t.isEndOver){var o=["subjectId","timeType","gainRule"];o.forEach((function(t){delete e.form[t]}))}var c=this.tplData?f:h;this.loading=!0,c(t).then((function(a){e.loading=!1,e.$emit("confirm",t.isEndOver),e.handleCancel()})).catch((function(){e.loading=!1}))}}}else this.$message.error("请添加科目数据")}}},C=D,x=(a("dc36"),a("2877")),w=Object(x["a"])(C,T,_,!1,null,"5b14f1e2",null),O=w.exports,I={name:"ChooseTplDialog",components:{UpdateTplDialog:O},props:{visible:{type:Boolean,required:!0,default:!1},helpObj:Object},data:function(){return{loading:!1,dialogVisible:!1,activeTemplateType:null,dataList:[],selectedTpl:null,addOrUpdateDialogVisible:!1}},computed:{},watch:{visible:{handler:function(){this.dialogVisible=this.visible},deep:!0},activeTemplateType:{handler:function(e){var t=this.dataList.find((function(t){return t.templateType===e}));t&&0===t.list.length&&this.getTplList(this.activeTemplateType)},deep:!0}},mounted:function(){this.dialogVisible=this.visible,this.getData()},methods:{getData:function(){this.dataList=[{templateType:"1",tabName:"日常开支",list:[]},{templateType:"2",tabName:"采购销售",list:[]},{templateType:"3",tabName:"往来款（含个人借款）",list:[]},{templateType:"4",tabName:"转账业务",list:[]}],this.activeTemplateType=this.dataList[0].templateType},getTplList:function(e){var t=this;this.loading=!0,d({type:e}).then((function(e){t.loading=!1;var a=t.dataList.find((function(e){return e.templateType===t.activeTemplateType}));a&&t.$set(a,"list",e.data||[])})).catch((function(){t.loading=!1}))},getTplSubjectByTplId:function(e){return new Promise((function(t,a){u({templateId:e}).then((function(e){t(e.data||[])})).catch((function(){a()}))}))},getActiveStatus:function(e){return!!this.selectedTpl&&this.selectedTpl.templateId===e.templateId},handleChoose:function(e){this.selectedTpl=e},handleCancel:function(){this.dialogVisible=!1,this.$emit("update:visible",!1)},handleConfirm:function(){var e=this;return Object(y["a"])(Object(g["a"])().mark((function t(){var a;return Object(g["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={statementType:e.activeTemplateType,statementName:e.selectedTpl.digestContent,isEndOver:e.selectedTpl.isEndOver},e.loading=!0,t.prev=3,t.next=6,e.getTplSubjectByTplId(e.selectedTpl.templateId);case 6:a.subjectList=t.sent,m(a).then((function(t){e.loading=!1,e.$emit("confirm"),e.handleCancel()})).catch((function(){e.loading=!1})),t.next=13;break;case 10:t.prev=10,t.t0=t["catch"](3),e.loading=!1;case 13:case"end":return t.stop()}}),t,null,[[3,10]])})))()},handleAddCategory:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.addOrUpdateDialogVisible=!0,this.selectedTpl=e},handleConfirmUpdate:function(e){this.getTplList(this.activeTemplateType),this.selectedTpl.isEndOver=e}}},$=I,S=(a("59d0"),Object(x["a"])($,b,v,!1,null,"22c25c76",null)),V=S.exports,L=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{visible:e.dialogVisible,"close-on-click-modal":!1,"append-to-body":"",width:"580px"},on:{"update:visible":function(t){e.dialogVisible=t},close:e.handleCancel}},[a("span",{staticClass:"el-dialog__title",attrs:{slot:"title"},slot:"title"},[e._v("\n    结转损益参数设置\n    "),e.helpObj?a("i",{staticClass:"wk wk-icon-fill-help wk-help-tips",attrs:{"data-type":e.helpObj.dataType,"data-id":e.helpObj.dataId}}):e._e()]),e._v(" "),a("el-form",{ref:"elForm",attrs:{model:e.form,rules:e.rules,"label-position":"left"}},[a("el-form-item",{attrs:{label:"凭证日期:","label-width":"80px",prop:"createTime"}},[a("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd",type:"date",placeholder:"选择日期"},model:{value:e.form.endTimeDays,callback:function(t){e.$set(e.form,"endTimeDays",t)},expression:"form.endTimeDays"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"凭证字:","label-width":"80px",prop:"voucherId"}},[a("el-select",{model:{value:e.form.voucherId,callback:function(t){e.$set(e.form,"voucherId",t)},expression:"form.voucherId"}},e._l(e.voucherList,(function(e){return a("el-option",{key:e.voucherId,attrs:{label:e.voucherName,value:e.voucherId}})})))],1),e._v(" "),a("el-form-item",{attrs:{label:"凭证摘要:","label-width":"80px",prop:"digestContent"}},[a("el-input",{model:{value:e.form.digestContent,callback:function(t){e.$set(e.form,"digestContent",t)},expression:"form.digestContent"}})],1),e._v(" "),a("el-form-item",{staticStyle:{margin:"-10px 0 5px"},attrs:{label:"凭证分类:",prop:"voucherType"}},[a("el-radio-group",{staticStyle:{"margin-top":"-20px"},model:{value:e.form.voucherType,callback:function(t){e.$set(e.form,"voucherType",t)},expression:"form.voucherType"}},[a("el-radio",{attrs:{label:1}},[e._v("收益和损失分开结转（分别生成收益凭证和损失凭证）")]),e._v(" "),a("el-radio",{attrs:{label:2}},[e._v("收益和损失同时结转")])],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"“以前年度损益调整”科目:","label-width":"240px",prop:"adjustSubjectId"}},[e.subjectList.length>0?a("subject-select-options",{attrs:{"can-create":!1,"subject-list":e.subjectList},model:{value:e.form.adjustSubjectId,callback:function(t){e.$set(e.form,"adjustSubjectId",t)},expression:"form.adjustSubjectId"}}):e._e()],1),e._v(" "),a("el-form-item",{attrs:{label:"“以前年度损益调整”科目的结转科目:","label-width":"240px",prop:"endSubjectId"}},[e.subjectList.length>0?a("subject-select-options",{attrs:{"can-create":!1,"subject-list":e.subjectList},model:{value:e.form.endSubjectId,callback:function(t){e.$set(e.form,"endSubjectId",t)},expression:"form.endSubjectId"}}):e._e()],1),e._v(" "),a("el-form-item",{attrs:{label:"其他损益科目的结转科目:","label-width":"240px",prop:"restSubjectId"}},[e.subjectList.length>0?a("subject-select-options",{attrs:{"can-create":!1,"subject-list":e.subjectList},model:{value:e.form.restSubjectId,callback:function(t){e.$set(e.form,"restSubjectId",t)},expression:"form.restSubjectId"}}):e._e()],1),e._v(" "),a("el-form-item",{attrs:{label:"","label-width":"0"}},[a("el-checkbox",{attrs:{"true-label":1,"false-label":0},model:{value:e.form.endWay,callback:function(t){e.$set(e.form,"endWay",t)},expression:"form.endWay"}},[e._v("\n        结转方式：按余额反向结转\n        "),a("el-tooltip",{attrs:{placement:"top"}},[a("div",{attrs:{slot:"content"},slot:"content"},[e._v("\n            选择“按余额反向结转”结转损益时，按科目余额的相反方向"),a("br"),e._v("\n            结转：没选中时，按科目属性中定义的科目方向反向结账。"),a("br"),e._v("\n            例：管理费用（科目属性定义为借方科目），期末余额为贷方10000"),a("br"),e._v("\n            如选择“按余额反向结转”时，结转分录为借：管理费用10000"),a("br"),e._v("\n            未选择时，结转分录为贷：管理费用-10000\n          ")]),e._v(" "),a("i",{staticClass:"wk wk-help tips-icon"})])],1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"debounce",rawName:"v-debounce",value:e.handleConfirm,expression:"handleConfirm"}],attrs:{type:"primary"}},[e._v("确定")]),e._v(" "),a("el-button",{on:{click:e.handleCancel}},[e._v("取消")])],1)],1)},R=[],E={name:"ProfitAndLossDialog",components:{SubjectSelectOptions:k["a"]},props:{visible:{type:Boolean,default:!1},statementItem:{type:Object,required:!0},statementTime:{type:String,required:!0},helpObj:Object},data:function(){return{loading:!1,dialogVisible:!1,form:{},rules:{voucherId:[{required:!0,message:"请选择凭证字",trigger:"change"}],digestContent:[{required:!0,message:"凭证摘要不能为空",trigger:["change","blur"]}],voucherType:[{required:!0,message:"请选择凭证分类",trigger:"change"}],adjustSubjectId:[{required:!0,message:"“以前年度损益调整”科目不能为空",trigger:"change"}],endSubjectId:[{required:!0,message:"“以前年度损益调整”科目的结转科目不能为空",trigger:"change"}],restSubjectId:[{required:!0,message:"其他损益科目的结转科目不能为空",trigger:"change"}]},voucherList:[],subjectList:[]}},watch:{visible:{handler:function(e){if(this.dialogVisible=e,this.statementItem&&e){this.form=Object(l["a"])({},this.statementItem);var t=this.$moment(this.statementTime).endOf("month");if(this.statementItem.endTimeDays&&!isNaN(Number(this.statementItem.endTimeDays))){var a=this.statementItem.endTimeDays,i=t.date();a<=i&&t.date(a)}delete this.form.companyId,this.$set(this.form,"endTimeDays",t.format("YYYY-MM-DD"))}},immediate:!0}},mounted:function(){this.getVoucherList(),this.getSubjectList()},methods:{getVoucherList:function(){var e=this;Object(j["L"])().then((function(t){e.voucherList=t.data||[]})).catch((function(){}))},getSubjectList:function(){var e=this;Object(j["H"])({type:null,isTree:0}).then((function(t){e.subjectList=t.data||[]})).catch((function(){}))},handleCancel:function(){this.dialogVisible=!1,this.$emit("update:visible",!1)},handleConfirm:function(){var e=this;this.$refs.elForm.validate((function(t){if(t){var a=Object(l["a"])({},e.form);a.endTimeDays&&(a.endTimeDays=e.$moment(a.endTimeDays).date()),e.loading=!0,p(a).then((function(t){e.loading=!1,e.$emit("confirm"),e.handleCancel()})).catch((function(){e.loading=!1}))}}))}}},A=E,Y=(a("dfb2"),Object(x["a"])(A,L,R,!1,null,"6d29e89a",null)),N=Y.exports,M=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{visible:e.dialogVisible,title:e.title,"close-on-click-modal":!1,"append-to-body":"",width:"880px"},on:{"update:visible":function(t){e.dialogVisible=t},close:e.handleCancel}},[a("div",{staticClass:"category-create"},[a("el-form",{attrs:{"label-width":"auto","label-position":"left"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:18}},[a("el-form-item",{attrs:{label:"名称","label-width":"50px"}},[a("el-input",{attrs:{disabled:e.statementItem&&1!==e.statementItem.statementType},model:{value:e.form.statementName,callback:function(t){e.$set(e.form,"statementName",t)},expression:"form.statementName"}})],1)],1),e._v(" "),e.showFinal?e._e():a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"","label-width":"0"}},[a("el-checkbox",{attrs:{"true-label":1,"false-label":0},on:{change:e.handleChangeEnd},model:{value:e.form.isEndOver,callback:function(t){e.$set(e.form,"isEndOver",t)},expression:"form.isEndOver"}},[e._v("\n              期末结转凭证\n            ")])],1)],1)],1),e._v(" "),!e.showFinal&&e.form.isEndOver?a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"科目","label-width":"40px"}},[a("subject-select-options",{model:{value:e.form.subjectId,callback:function(t){e.$set(e.form,"subjectId",t)},expression:"form.subjectId"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"取数规则"}},[a("el-select",{model:{value:e.form.gainRule,callback:function(t){e.$set(e.form,"gainRule",t)},expression:"form.gainRule"}},e._l(e.ruleOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})))],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"时间类型"}},[a("el-select",{model:{value:e.form.timeType,callback:function(t){e.$set(e.form,"timeType",t)},expression:"form.timeType"}},e._l(e.timeOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})))],1)],1)],1):e._e()],1),e._v(" "),a("el-table",{attrs:{data:e.tableData,border:"",height:"45vh"}},[a("el-table-column",{attrs:{prop:"digestContent",label:"摘要",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row,n=t.column;return[a("el-input",{model:{value:i[n.property],callback:function(t){e.$set(i,n.property,t)},expression:"row[column.property]"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"isLend",label:"借/贷",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row,n=t.column;return[a("el-select",{model:{value:i[n.property],callback:function(t){e.$set(i,n.property,t)},expression:"row[column.property]"}},[a("el-option",{attrs:{value:1,label:"借"}}),e._v(" "),a("el-option",{attrs:{value:2,label:"贷"}})],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"subjectId",label:"科目",width:"369"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row,n=t.column,l=t.$index;return[e.subjectList.length>0?a("subject-select-options",{attrs:{"subject-object":i,"no-use-disabled":!0,"filter-node-method":e.filterSubject,"subject-list":e.subjectList,"can-create":!1},on:{change:function(t){e.subjectSelect(arguments,l)}},model:{value:i[n.property],callback:function(t){e.$set(i,n.property,t)},expression:"row[column.property]"}}):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"moneyRatio",label:"金额比例%",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.row,n=t.column;return[a("el-input-number",{attrs:{controls:!1},model:{value:i[n.property],callback:function(t){e.$set(i,n.property,t)},expression:"row[column.property]"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.$index;return[a("el-button",{attrs:{type:"primary-text"},on:{click:function(t){e.handleDelete(i)}}},[e._v("删除")])]}}])})],1),e._v(" "),a("el-button",{staticClass:"add-btn",attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.handleAdd}},[e._v("添加一条数据")])],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"debounce",rawName:"v-debounce",value:e.handleConfirm,expression:"handleConfirm"}],attrs:{type:"primary"}},[e._v("确定")]),e._v(" "),a("el-button",{on:{click:e.handleCancel}},[e._v("取消")])],1)])},q=[],U={name:"StatementDetailDialog",components:{SubjectSelectOptions:k["a"]},props:{visible:{type:Boolean,default:!1},statementItem:{type:Object,default:null}},data:function(){return{loading:!1,dialogVisible:!1,form:{},ruleOptions:[{label:"余额",value:1},{label:"借方余额",value:2},{label:"贷方余额",value:3}],timeOptions:[{label:"期末",value:1},{label:"期初",value:2},{label:"年初",value:3}],subjectList:[],tableData:[],editRowIndex:null}},computed:{title:function(){return this.statementItem?"编辑分类":"新增分类"},showFinal:function(){return this.statementItem&&1!==this.statementItem.statementType}},watch:{visible:{handler:function(e){this.dialogVisible=e;var t="";e&&this.statementItem?(t=this.statementItem.statementName,this.form=Object(l["a"])({},this.statementItem),this.tableData=this.statementItem.subject||[]):t="",this.$set(this.form,"statementName",t)},immediate:!0}},mounted:function(){this.getSubjectList()},methods:{getSubjectList:function(){var e=this;this.loading=!0,Object(j["H"])({type:null,isTree:0}).then((function(t){e.loading=!1,e.subjectList=t.data||[]})).catch((function(){e.loading=!1}))},handleChangeEnd:function(){var e=this;if(1===this.form.isEndOver)this.$set(this.form,"subjectId",null),this.$set(this.form,"timeType",1),this.$set(this.form,"gainRule",1);else{var t=["subjectId","timeType","gainRule"];t.forEach((function(t){delete e.form[t]}))}},handleDelete:function(e){this.tableData.splice(e,1)},handleAdd:function(){this.tableData.push({digestContent:"",isLend:1,moneyRatio:0,subjectId:null})},subjectSelect:function(e,t){if(e[1])this.$set(this.tableData,t,Object(l["a"])(Object(l["a"])({},this.tableData[t]),e[1]));else{var a=this.tableData[t];this.$set(this.tableData,t,{digestContent:a.digestContent,isLend:a.isLend,moneyRatio:a.moneyRatio,subjectId:null})}},filterSubject:function(e,t,a){return(!t||0===t.length)&&e.status},handleCancel:function(){this.dialogVisible=!1,this.$emit("update:visible",!1)},handleConfirm:function(){var e=this,t=Object(l["a"])({},this.form);if(delete t.companyId,delete t.subject,0!==this.tableData.length){for(var a=0;a<this.tableData.length;a++){var i=this.tableData[a];if(!i.digestContent)return void this.$message.error("摘要不能为空");if(!i.subjectId)return void this.$message.error("科目不能为空")}var n=this.tableData.filter((function(e){return 1===e.isLend})).reduce((function(e,t){return e.moneyRatio+t.moneyRatio}));if(n>100)this.$message.error("借方科目百分比之和不能超过100%");else{var s=this.tableData.filter((function(e){return 1===e.isLend})).reduce((function(e,t){return e.moneyRatio+t.moneyRatio}));if(s>100)this.$message.error("贷方科目百分比之和不能超过100%");else{if(t.subjectList=this.tableData,!t.isEndOver||1!==t.isEndOver){var o=["subjectId","timeType","gainRule"];o.forEach((function(t){delete e.form[t]}))}this.loading=!0,p(t).then((function(t){e.loading=!1,e.$emit("confirm"),e.handleCancel()})).catch((function(){e.loading=!1}))}}}else this.$message.error("请添加科目数据")}}},B=U,F=(a("86f5"),Object(x["a"])(B,M,q,!1,null,"7b4e7a8c",null)),H=F.exports,P=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{visible:e.dialogVisible,"append-to-body":!0,"close-on-click-modal":!1,title:"提示",width:"500px"},on:{"update:visible":function(t){e.dialogVisible=t},close:e.handleCancel}},[a("el-form",[a("el-form-item",{attrs:{label:e.labelText}},[a("el-select",{model:{value:e.selectedTime,callback:function(t){e.selectedTime=t},expression:"selectedTime"}},e._l(e.optionsList,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})))],1)],1),e._v(" "),2===e.settleType?a("div",{staticClass:"warning-text"},[e._v("\n    反结账是违反会计法规的非正常操作，会影响历史报表数据，请慎用！\n  ")]):e._e(),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"debounce",rawName:"v-debounce",value:e.handleConfirm,expression:"handleConfirm"}],attrs:{type:"primary"}},[e._v("确定")]),e._v(" "),a("el-button",{on:{click:e.handleCancel}},[e._v("取消")])],1)],1)},W=[],J=a("2f62"),z={name:"SettleDialog",props:{visible:{type:Boolean,default:!1},settleTime:{type:String,required:!0},settleType:{type:Number,required:!0},settleIds:{type:Array,default:function(){return[]}}},data:function(){return{loading:!1,dialogVisible:!1,selectedTime:null,optionsList:[],maxTime:null,minTime:null}},computed:Object(l["a"])(Object(l["a"])({},Object(J["c"])(["financeTimeRange"])),{},{labelText:function(){return"请确认要".concat(1===this.settleType?"":"反","结账到")}}),watch:{visible:{handler:function(){this.dialogVisible=this.visible,this.loading=!1,this.visible&&(1===this.settleType?this.selectedTime=this.$moment(this.settleTime).add(1,"M").startOf("month").format("YYYY-MM-DD"):this.selectedTime=this.$moment(this.settleTime).subtract(1,"M").endOf("month").format("YYYY-MM-DD"),this.getTimeRange())},immediate:!0}},methods:Object(l["a"])(Object(l["a"])({},Object(J["b"])(["updateCurrentAccount"])),{},{getTimeRange:function(){if(this.maxTime=this.financeTimeRange.maxTime,this.minTime=this.financeTimeRange.minTime,1===this.settleType){var e=this.$moment(this.settleTime).startOf("month"),t=this.$moment(this.maxTime).startOf("month");this.generateOptions(e.add(1,"M"),t.add(1,"M"))}else{var a=this.$moment(this.settleTime).endOf("month"),i=this.$moment(this.minTime).endOf("month");this.generateOptions(i,a.subtract(1,"M"))}},generateOptions:function(e,t){var a=e,i=[],n=1===this.settleType?"startOf":"endOf";while(a[n]("month").isBefore(t[n]("month"))||a[n]("month").isSame(t[n]("month")))i.push({label:a[n]("month").format("YYYY年第MM期"),value:a[n]("month").format("YYYY-MM-DD")}),a[n]("month").add(1,"M");this.optionsList=i},handleConfirm:function(){var e=this,t={statementIds:this.settleIds,type:this.settleType,certificateTime:this.selectedTime};1===this.settleType&&(t.certificateTime=this.$moment(t.certificateTime).subtract(1,"M").endOf("month").format("YYYY-MM-DD")),this.loading=!0,c(t).then((function(t){e.$message.success("操作成功"),e.$emit("confirm"),e.updateCurrentAccount(),e.handleCancel()})).catch((function(){e.loading=!1}))},handleCancel:function(){this.$emit("update:visible",!1),this.$emit("close")}})},G=z,K=(a("26ad"),Object(x["a"])(G,P,W,!1,null,"0a2632ae",null)),Q=K.exports,X={name:"SettleAccounts",components:{StatementDetailDialog:H,ChooseTplDialog:V,ProfitAndLossDialog:N,SettleDialog:Q},data:function(){return{loading:!1,checkedAll:!1,settleData:{settleTime:"",statements:[]},addTplDialogVisible:!1,statementItem:{},updateDialogVisible:!1,settleDialogVisible:!1,settleType:null,settleIds:[],helpObj:{choose:{dataType:41,dataId:329},profit:{dataType:41,dataId:327}}}},computed:Object(l["a"])(Object(l["a"])({},Object(J["c"])(["financeTimeRange","financeCurrentAccount"])),{},{infoText:function(){var e=this.$moment(this.settleData.settleTime);return"".concat(e.year(),"年第").concat(e.month()+1,"期共录入凭证 ").concat(this.settleData.number||0," 张")},checkedHarf:function(){var e=this.settleData.statements.filter((function(e){return e.checked})).length;return 0!==e&&e!==this.settleData.statements.length},showBackSettle:function(){if(!this.financeCurrentAccount||!this.settleData.settleTime)return!1;var e=this.$moment(this.financeCurrentAccount.enableTime).format("YYYYMM"),t=this.$moment(this.settleData.settleTime).format("YYYYMM");return t!==e}}),mounted:function(){this.getData(),this.getVoucherTimeRange()},methods:Object(l["a"])(Object(l["a"])({},Object(J["b"])(["getVoucherTimeRange"])),{},{getData:function(){var e=this;this.loading=!0,o().then((function(t){e.loading=!1,e.settleData=t.data,e.settleData.statements.forEach((function(t){e.$set(t,"checked",!1)}))})).catch((function(){e.loading=!1}))},getDataId:function(e){return{3:324,4:325,5:326,2:328}[e]},handleToVoucherDetail:function(e){this.$router.push({path:"/fm/voucher/subs/create",query:{ids:e.certificateId,index:0}})},handleChangeAllChecked:function(){var e=this;this.settleData.statements.forEach((function(t){e.$set(t,"checked",e.checkedAll)}))},handleChangeItemChecked:function(){var e=this.settleData.statements.filter((function(e){return e.checked})).length;this.checkedAll=0!==e&&e===this.settleData.statements.length},handleToSettleAccounts:function(e){var t=this.settleData.statements.filter((function(e){return e.checked}));0===t.length?this.settleIds=this.settleData.statements.map((function(e){return e.statementId})):this.settleIds=t.map((function(e){return e.statementId})),this.settleType=e,this.settleDialogVisible=!0},handleToVoucher:function(e){var t=this,a={};if(e)a={certificateTime:this.settleData.settleTime,statementIds:[e.statementId]};else{var i=this.settleData.statements.filter((function(e){return e.checked})),n=[];n=0===i.length?this.settleData.statements.map((function(e){return e.statementId})):i.map((function(e){return e.statementId})),a={certificateTime:this.settleData.settleTime,statementIds:n}}this.loading=!0,r(a).then((function(e){t.loading=!1,t.getData(),t.getVoucherTimeRange(),t.$message.success("操作成功")})).catch((function(){t.loading=!1}))},handleToEdit:function(e){2!==e.statementType||this.$auth("finance.checkOut.profitAndLoss")?(this.statementItem=e,this.updateDialogVisible=!0):this.$message.error("权限不足")},handleAddTpl:function(){this.addTplDialogVisible=!0}})},Z=X,ee=(a("990c"),Object(x["a"])(Z,i,n,!1,null,"d73d1cb6",null));t["default"]=ee.exports},9687:function(e,t,a){},"990c":function(e,t,a){"use strict";a("0481")},cd50:function(e,t,a){},dc36:function(e,t,a){"use strict";a("cd50")},dfb2:function(e,t,a){"use strict";a("03e1")},f4aa:function(e,t,a){}}]);