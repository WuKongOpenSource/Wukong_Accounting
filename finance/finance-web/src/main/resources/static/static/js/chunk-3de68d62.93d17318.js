(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3de68d62"],{"0095":function(t,e,i){},"059e":function(t,e,i){},"083d":function(t,e,i){},"0be7":function(t,e,i){"use strict";i("a6d3")},1759:function(t,e,i){"use strict";i("52947")},"2adb":function(t,e,i){var n=i("772f"),a={s:i("a8bb"),b:i("f4fd")};t.exports=n(a.s,a.b)},"34b8":function(t,e,i){"use strict";i("a1e3")},"38cf":function(t,e,i){var n=i("23e7"),a=i("1148");n({target:"String",proto:!0},{repeat:a})},"3aec":function(t,e,i){"use strict";i("083d")},"3df0":function(t,e,i){"use strict";i("0095")},"4e63":function(t,e,i){t.exports=i.p+"static/img/audit.f5643d2f.png"},"4e82":function(t,e,i){"use strict";var n=i("23e7"),a=i("e330"),s=i("59ed"),c=i("7b0b"),o=i("07fa"),r=i("083a"),l=i("577e"),u=i("d039"),d=i("addb"),f=i("a640"),h=i("04d1"),m=i("d998"),p=i("2d00"),b=i("512ce"),v=[],g=a(v.sort),_=a(v.push),y=u((function(){v.sort(void 0)})),j=u((function(){v.sort(null)})),x=f("sort"),C=!u((function(){if(p)return p<70;if(!(h&&h>3)){if(m)return!0;if(b)return b<603;var t,e,i,n,a="";for(t=65;t<76;t++){switch(e=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:i=3;break;case 68:case 71:i=4;break;default:i=2}for(n=0;n<47;n++)v.push({k:e+n,v:i})}for(v.sort((function(t,e){return e.v-t.v})),n=0;n<v.length;n++)e=v[n].k.charAt(0),a.charAt(a.length-1)!==e&&(a+=e);return"DGBEFHACIJK"!==a}})),w=y||!j||!x||!C,k=function(t){return function(e,i){return void 0===i?-1:void 0===e?1:void 0!==t?+t(e,i)||0:l(e)>l(i)?1:-1}};n({target:"Array",proto:!0,forced:w},{sort:function(t){void 0!==t&&s(t);var e=c(this);if(C)return void 0===t?g(e):g(e,t);var i,n,a=[],l=o(e);for(n=0;n<l;n++)n in e&&_(a,e[n]);d(a,k(t)),i=o(a),n=0;while(n<i)e[n]=a[n++];while(n<l)r(e,n++);return e}})},52947:function(t,e,i){},"59b8":function(t,e,i){},"5ef9":function(t,e,i){},"772f":function(t,e,i){var n=i("a055"),a=i("92be");function s(t,e){return{encodeS:function(e,i){return i=a.extend({ww:!0,tenMin:!0},i),n.CL.call(t,e,i)},encodeB:function(t,i){return i=a.extend({ww:!0},i),n.CL.call(e,t,i)},decodeS:function(){return n.unCL.apply(t,arguments)},decodeB:function(){return n.unCL.apply(e,arguments)},toMoney:function(t,i){return i=a.extend({ww:!0},i),n.toMoney.call(e,t,i)}}}t.exports=s},"77e1":function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"app-container"},[i("div",{staticClass:"main"},[t._m(0),t._v(" "),i("div",{staticClass:"content-button"},[t.certificateIds.length&&(t.certificateIndex||0===t.certificateIndex)?[t.$auth("finance.voucher.save")?i("el-button",{attrs:{type:"primary"},on:{click:t.resetAdd}},[t._v("新增")]):t._e(),t._v(" "),!t.isPass&&t.canSave?i("el-button",{on:{click:function(e){t.saveSubmit(!1)}}},[t._v("保存")]):t._e(),t._v(" "),t.info.isStatement?t._e():[t.info.checkStatus&&t.$auth("finance.voucher.noExamine")?i("el-button",{on:{click:t.updateCheckStatus}},[t._v("\n            反审核\n          ")]):t._e(),t._v(" "),!t.info.checkStatus&&t.$auth("finance.voucher.examine")?i("el-button",{on:{click:t.updateCheckStatus}},[t._v("\n            审核\n          ")]):t._e(),t._v(" "),t.$auth("finance.voucher.delete")?i("el-button",{on:{click:t.deleteOne}},[t._v("\n            删除\n          ")]):t._e()],t._v(" "),t.$auth("finance.voucher.save")?i("el-button",{on:{click:t.copyOne}},[t._v("\n          复制\n        ")]):t._e(),t._v(" "),t.$auth("finance.voucher.save")?i("el-button",{on:{click:t.print}},[t._v("\n          打印\n        ")]):t._e(),t._v(" "),t.fromSearch?i("el-button",{on:{click:t.back}},[t._v(" 返回 ")]):t._e()]:[!t.isPass&&t.canSave?i("el-button",{attrs:{type:"primary"},on:{click:function(e){t.saveSubmit(!0)}}},[t._v("保存并新增")]):t._e(),t._v(" "),!t.isPass&&t.canSave?i("el-button",{on:{click:function(e){t.saveSubmit(!1)}}},[t._v("保存")]):t._e(),t._v(" "),i("el-dropdown",{staticClass:"receive-drop",attrs:{trigger:"click"},on:{command:t.templateClick}},[i("el-button",{staticClass:"dropdown-btn",attrs:{icon:"el-icon-more"}}),t._v(" "),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",{attrs:{command:"save"}},[t._v("保存为模板")]),t._v(" "),t.isPass?t._e():i("el-dropdown-item",{attrs:{command:"use"}},[t._v("使用模板")])],1)],1)],t._v(" "),i("div",{staticClass:"button-right"},[i("shortcut-keys",{staticClass:"key"}),t._v(" "),i("el-button-group",{staticClass:"wk-header-page-btn"},[i("el-button",{attrs:{disabled:!(t.certificateIds[t.certificateIndex-1]||t.certificateIds.length&&""===t.certificateIndex),type:"subtle",title:"上一张",icon:"el-icon-arrow-left"},on:{click:function(e){t.changeCertificateIndex(-1)}}}),t._v(" "),i("el-button",{attrs:{disabled:!t.certificateIds[t.certificateIndex+1],type:"subtle",title:"下一张",icon:"el-icon-arrow-right"},on:{click:function(e){t.changeCertificateIndex(1)}}})],1)],1)],2),t._v(" "),i("div",{staticClass:"note",attrs:{id:"note"}},[i("div",{staticClass:"note-header"},[i("div",{staticClass:"note-title"},[i("div",[t._v("记账凭证")]),t._v(" "),i("span",{staticClass:"note-title-time"},[t._v(t._s(t.voucherTime))])])]),t._v(" "),i("flexbox",{staticClass:"content-flex"},[i("div",{staticClass:"content-flex-item"},[t._v("\n          凭证字\n          "),i("el-select",{attrs:{disabled:t.isPass},on:{input:t.getVoucherNum},model:{value:t.info.voucherId,callback:function(e){t.$set(t.info,"voucherId",e)},expression:"info.voucherId"}},t._l(t.voucherOptions,(function(t,e){return i("el-option",{key:e,attrs:{label:t.voucherName,value:t.voucherId}})}))),t._v(" "),i("el-input",{attrs:{disabled:t.isPass,type:"number"},model:{value:t.info.certificateNum,callback:function(e){t.$set(t.info,"certificateNum",e)},expression:"info.certificateNum"}},[i("template",{slot:"append"},[t._v("号")])],2),t._v(" "),i("el-date-picker",{attrs:{"picker-options":t.datePicker,disabled:t.isPass,clearable:!1,"value-format":"yyyy-MM-dd",type:"date",placeholder:"选择日期"},on:{change:t.getVoucherNum},model:{value:t.info.certificateTime,callback:function(e){t.$set(t.info,"certificateTime",e)},expression:"info.certificateTime"}})],1),t._v(" "),i("div",{staticClass:"right content-flex-item"},[t._v("\n          付单据\n          "),t._v(" "),i("el-input",{attrs:{value:t.info.fileNum,disabled:t.isPass,type:"number",maxlength:10},on:{input:t.fileNumChange}},[i("template",{slot:"append"},[t._v("张")])],2)],1)]),t._v(" "),i("div",{staticClass:"subject-table"},[i("table",{staticClass:"voucher",attrs:{id:"voucher",cellpadding:"0",cellspacing:"0"}},[i("thead",[i("tr",[i("th",{staticClass:"col_operate"}),t._v(" "),i("th",{staticClass:"col_summary"},[t._v("摘要")]),t._v(" "),i("th",{staticClass:"col_subject"},[t._v("会计科目")]),t._v(" "),t.showNumColumn?i("th",{staticClass:"col_quantity"},[t._v("数量")]):t._e(),t._v(" "),i("th",{staticClass:"col_money"},[i("strong",{staticClass:"tit"},[t._v("借方金额")]),t._v(" "),i("div",{staticClass:"money_unit"},t._l(t.moneyUnits,(function(e,n){return i("span",{key:n},[t._v(t._s(e))])})))]),t._v(" "),i("th",{staticClass:"col_money"},[i("strong",{staticClass:"tit"},[t._v("贷方金额")]),t._v(" "),i("div",{staticClass:"money_unit"},t._l(t.moneyUnits,(function(e,n){return i("span",{key:n},[t._v(t._s(e))])})))])])]),t._v(" "),i("tbody",t._l(t.list,(function(e,n){return i("tr",{key:n,staticClass:"entry_item"},[i("td",{staticClass:"col_operate"},[i("el-dropdown",{staticClass:"receive-drop",attrs:{trigger:"hover",placement:"right-start"}},[i("i",{staticClass:"wk wk-add"}),t._v(" "),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",{nativeOn:{click:function(e){t.addLine(n)}}},[t._v("从上方插入行")]),t._v(" "),i("el-dropdown-item",{nativeOn:{click:function(e){t.addLine(n+1)}}},[t._v("从下方插入行")])],1)],1),t._v(" "),i("i",{staticClass:"wk wk-delete",on:{click:function(e){t.deleteLine(n)}}})],1),t._v(" "),i("td",{staticClass:"col_summary",attrs:{"data-edit":"summary",tabindex:"-1"},on:{focus:function(i){t.editSummaryFocus(e,n,i)}}},[e.edit_summary?i("el-input",{ref:n+"summary",refInFor:!0,staticClass:"edit_summary",attrs:{disabled:t.isPass},on:{blur:function(i){t.inputBlur(n,"summary",e)},focus:function(i){t.fillDigest(e,n)}},model:{value:e.digestContent,callback:function(i){t.$set(e,"digestContent",i)},expression:"item.digestContent"}}):i("div",[t._v("\n                  "+t._s(e.digestContent)+"\n                ")]),t._v(" "),i("el-button",{staticClass:"btn",attrs:{type:"primary-text"},on:{click:function(i){t.selectDigestOption(e)}}},[t._v("摘要")])],1),t._v(" "),i("td",{staticClass:"col_subject",attrs:{"data-edit":"subject"}},[t.subjectList&&t.subjectList.length?i("subject-select-options",{ref:n+"subject",refInFor:!0,style:{opacity:t.coord==n+"subject"?1:0},attrs:{"subject-object":e.subject,"no-use-disabled":!0,disabled:t.isPass,relative:e.associationBOS,"is-relevance":!0,"subject-list":t.subjectList,"before-choose":t.beforeChooseSubject,"filter-node-method":t.filterSubject,"help-obj":t.helpObj.subject,"can-create":""},on:{focus:function(e){t.inputFocus(n,"subject")},blur:function(e){t.inputBlur(n,"subject")},"update-list":t.getSubjectList,change:function(i){t.subjectSelect(arguments,e)}},model:{value:e.subjectId,callback:function(i){t.$set(e,"subjectId",i)},expression:"item.subjectId"}}):t._e(),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.coord!=n+"subject",expression:"coord != index + 'subject'"}],staticClass:"cell_val subject_val",on:{click:function(e){t.inputFocus(n,"subject")}}},[t._v("\n                  "+t._s(t.itemSubjectName(e))+"\n                ")]),t._v(" "),i("div",{staticClass:"balance"},[t._v("\n                  "+t._s(t.itemBalance(e))+"\n                ")])],1),t._v(" "),t.showNumColumn?i("td",{staticClass:"col_quantity"},[e.subject.isAmount?i("div",{staticClass:"cell_val quantity_val"},[i("p",[t._v("\n                    数量：\n                    "),i("el-input",{directives:[{name:"WkNumber",rawName:"v-WkNumber",value:"positiveFloat",expression:"'positiveFloat'"}],staticClass:"mini-input",attrs:{disabled:t.isPass},on:{change:function(i){t.countMoney(e)}},model:{value:e.quantity,callback:function(i){t.$set(e,"quantity",i)},expression:"item.quantity"}}),t._v(" "),e.subject.amountUnit?i("span",[t._v(t._s(e.subject.amountUnit))]):t._e()],1),t._v(" "),i("p",{staticStyle:{"margin-top":"4px"}},[t._v("\n                    单价：\n                    "),i("el-input",{directives:[{name:"WkNumber",rawName:"v-WkNumber",value:"positiveNum",expression:"'positiveNum'"}],staticClass:"mini-input",attrs:{disabled:t.isPass,oninput:"setTimeout(()=>{value=value.replace(/^(0+|(-\\d+))$/,'')},1000)"},on:{change:function(i){t.countMoney(e)}},model:{value:e.price,callback:function(i){t.$set(e,"price",i)},expression:"item.price"}})],1)]):t._e()]):t._e(),t._v(" "),i("td",{staticClass:"col_debite",attrs:{"data-edit":"money"},on:{click:function(e){t.inputFocus(n,"depite")}}},[i("el-input",{ref:n+"depite",refInFor:!0,staticClass:"edit_money",style:{opacity:t.coord==n+"depite"?1:0},attrs:{disabled:t.isPass,type:"number"},on:{focus:function(e){t.inputFocus(n,"depite")},change:function(i){t.moneyChange(i,e,"debtorBalance")},blur:function(e){t.inputBlur(n,"depite")},click:function(t){t.preventDefault(),t.stopPropagation()}},nativeOn:{keyup:function(i){t.balanceMoney(i,e,"debtorBalance")}},model:{value:e.debtorBalance,callback:function(i){t.$set(e,"debtorBalance",i)},expression:"item.debtorBalance"}}),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.coord!=n+"depite",expression:"coord != index + 'depite'"}],staticClass:"cell_val debit_val"},t._l(t.moneyStr(e.debtorBalance),(function(n,a){return i("span",{key:a,staticClass:"money-str",style:{color:t.filterMoney(e.debtorBalance)>=0?"":"red"}},[t._v("\n                    "+t._s(n)+"\n                  ")])})))],1),t._v(" "),i("td",{staticClass:"col_credit",attrs:{"data-edit":"money"},on:{click:function(e){t.inputFocus(n,"credit")}}},[i("el-input",{ref:n+"credit",refInFor:!0,staticClass:"edit_money",style:{opacity:t.coord==n+"credit"?1:0},attrs:{disabled:t.isPass,type:"number"},on:{focus:function(e){t.inputFocus(n,"credit")},change:function(i){t.moneyChange(i,e,"creditBalance")},blur:function(e){t.inputBlur(n,"credit")},click:function(t){t.preventDefault(),t.stopPropagation()}},nativeOn:{keyup:function(i){t.balanceMoney(i,e,"creditBalance")}},model:{value:e.creditBalance,callback:function(i){t.$set(e,"creditBalance",i)},expression:"item.creditBalance"}}),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.coord!=n+"credit",expression:"coord != index + 'credit'"}],staticClass:"cell_val credit_val"},t._l(t.moneyStr(e.creditBalance),(function(n,a){return i("span",{key:a,staticClass:"money-str",style:{color:t.filterMoney(e.creditBalance)>=0?"":"red"}},[t._v("\n                    "+t._s(n)+"\n                  ")])})))],1)])}))),t._v(" "),i("tfoot",[i("tr",[i("td",{staticClass:"col_operate"}),t._v(" "),i("td",{staticClass:"col_total",attrs:{colspan:t.showNumColumn?3:2}},[t._v("\n                合计："),i("span",{attrs:{id:"capAmount"}},[t._v(t._s(t.number_chinese))])]),t._v(" "),i("td",{staticClass:"col_debite"},[i("div",{staticClass:"cell_val debit_total",attrs:{id:"debit_total"}},t._l(t.moneyStr(t.totalDebite),(function(e,n){return i("span",{key:n,staticClass:"money-str",style:{color:t.filterMoney(t.totalDebite)>=0?"":"red"}},[t._v("\n                    "+t._s(e)+"\n                  ")])})))]),t._v(" "),i("td",{staticClass:"col_credit"},[i("div",{staticClass:"cell_val credit_total",attrs:{id:"credit_total"}},t._l(t.moneyStr(t.totalCredit),(function(e,n){return i("span",{key:n,staticClass:"money-str",style:{color:t.filterMoney(t.totalCredit)>=0?"":"red"}},[t._v("\n                    "+t._s(e)+"\n                  ")])})))])])])])]),t._v(" "),i("flexbox",{staticClass:"vch_ft",attrs:{justify:"space-between"}},[i("span",{attrs:{id:"vch_people_display"}},[t._v("\n          制单人："),i("span",[t._v(t._s(t.info.certificateId?t.info.createUserName:t.userInfo.realname))])]),t._v(" "),t.isPass?i("span",[t._v("\n          审核人："),i("span",{attrs:{id:"ldr_people_display"}},[t._v(t._s(t.info.examineUserName))])]):t._e()])],1),t._v(" "),i("flexbox",{staticClass:"bottom-flex"},[!t.isPass&&t.canSave?i("el-button",{attrs:{type:"primary"},on:{click:function(e){t.saveSubmit(!0)}}},[t._v("保存并新增")]):t._e(),t._v(" "),!t.isPass&&t.canSave?i("el-button",{on:{click:function(e){t.saveSubmit(!1)}}},[t._v("保存")]):t._e()],1),t._v(" "),t.isPass?i("img",{staticClass:"pass-pic",attrs:{src:t.passImg,alt:""}}):t._e()],1),t._v(" "),t.selectDigestDialogVisible?i("digest-select-dialog",{attrs:{"show-dialog-visible":t.selectDigestDialogVisible,"help-obj":t.helpObj.digest},on:{closeOptions:t.selectDigestClose,"select-digest":t.selectDigestSubmit}}):t._e(),t._v(" "),t.selectTemplateDialogVisible?i("voucher-template",{attrs:{"show-dialog-visible":t.selectTemplateDialogVisible},on:{close:function(e){t.selectTemplateDialogVisible=!1},select:t.selectTemplate}}):t._e(),t._v(" "),t.saveTemplateDialogVisible?i("save-template-dialog",{attrs:{"show-dialog-visible":t.saveTemplateDialogVisible,content:t.list},on:{close:function(e){t.saveTemplateDialogVisible=!1}}}):t._e(),t._v(" "),t.printSizeDialogVisible?i("PrintPageSetDialog",{attrs:{visible:t.printSizeDialogVisible},on:{"update:visible":function(e){t.printSizeDialogVisible=e},confirm:t.sizeConfirm}}):t._e()],1)},a=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"main-header"},[i("span",{staticClass:"main-title"},[t._v("\n        录凭证\n        "),i("i",{staticClass:"wk wk-icon-fill-help wk-help-tips",attrs:{"data-type":"37","data-id":"302"}})])])}],s=i("2909"),c=i("5530"),o=(i("99af"),i("b680"),i("a9e3"),i("7db0"),i("d3b7"),i("e9c4"),i("14d9"),i("a15b"),i("d81d"),i("159b"),i("b0c0"),i("b64b"),i("a434"),i("4e82"),i("4de4"),i("ac1f"),i("5319"),i("c740"),i("caad"),i("2532"),i("224e")),r=i("2a1a"),l=i("cb41"),u=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("el-dialog",{attrs:{visible:t.showDialogVisible,"close-on-click-modal":!1,"before-close":t.handleClose,"append-to-body":!0,title:"新增模板",width:"400px"},on:{"update:visible":function(e){t.showDialogVisible=e}}},[i("div",{staticClass:"content"},[i("el-form",{ref:"form",attrs:{model:t.info,rules:t.rules,"label-width":"80px"}},[i("el-form-item",{attrs:{label:"模板类型:",prop:"typeId"}},[i("el-popover",{attrs:{trigger:"click","popper-class":"no-padding-popover",width:"250"}},[i("el-input",{staticClass:"scene-select",attrs:{slot:"reference",readonly:!0},slot:"reference",model:{value:t.info.typeName,callback:function(e){t.$set(t.info,"typeName",e)},expression:"info.typeName"}},[i("i",{staticClass:"'el-input__icon' 'el-icon-arrow-down'",attrs:{slot:"suffix"},slot:"suffix"})]),t._v(" "),i("select-dropdown",{attrs:{list:t.typeList,prop:{label:"typeName",addTitle:"添加类型"}},on:{select:t.templateSelect,"handle-add":function(e){t.selectTemplateDialogVisible=!0}}})],1)],1),t._v(" "),i("el-form-item",{attrs:{label:"模板名称",prop:"name"}},[i("el-input",{model:{value:t.info.name,callback:function(e){t.$set(t.info,"name",e)},expression:"info.name"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"保存金额"}},[i("el-checkbox",{model:{value:t.info.saveMoney,callback:function(e){t.$set(t.info,"saveMoney",e)},expression:"info.saveMoney"}})],1)],1)],1),t._v(" "),i("span",{attrs:{slot:"footer",justify:"flex-end"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:t.confirm}},[t._v("确认")]),t._v(" "),i("el-button",{on:{click:t.handleClose}},[t._v("取消")])],1)]),t._v(" "),t.selectTemplateDialogVisible?i("template-select-dialog",{attrs:{"show-dialog-visible":t.selectTemplateDialogVisible},on:{close:t.selectTemplateClose,select:t.selectTemplateSubmit}}):t._e()],1)},d=[],f=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"select-container"},[i("div",{staticClass:"select-list"},t._l(t.list,(function(e,n){return i("div",{key:n,staticClass:"select-list-item",on:{click:function(i){t.select(e,n)}}},[t._v("\n      "+t._s(e[t.prop.label])+"\n      "),t._t("default",null,{slot:"label",slotScope:e})],2)}))),t._v(" "),i("div",{staticClass:"handle-interval"},[i("flexbox",{staticClass:"handle-button",nativeOn:{click:function(e){return t.addselect(e)}}},[i("i",{staticClass:"wk wk-add handle-button-icon"}),t._v(" "),i("div",{staticClass:"handle-button-name"},[t._v(t._s(t.prop.addTitle))])])],1)])},h=[],m={name:"SelectDropdown",components:{},props:{list:{type:Array,default:function(){return[]}},prop:{type:Object,default:function(){return{label:"name",addTitle:"新建"}}}},data:function(){return{}},computed:{},watch:{},mounted:function(){},methods:{select:function(t,e){this.$emit("select",t)},addselect:function(){this.$emit("handle-add")}}},p=m,b=(i("d547"),i("2877")),v=Object(b["a"])(p,f,h,!1,null,"6922fbeb",null),g=v.exports,_=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("el-dialog",{attrs:{visible:t.showDialogVisible,"close-on-click-modal":!1,"before-close":t.handleClose,"append-to-body":!0,title:"凭证摘要库",width:"500px"},on:{"update:visible":function(e){t.showDialogVisible=e}}},[i("div",{staticClass:"content"},[i("flexbox",[i("el-input",{staticClass:"addInut",attrs:{placeholder:"请输入类别名称"},model:{value:t.info.typeName,callback:function(e){t.$set(t.info,"typeName",e)},expression:"info.typeName"}}),t._v(" "),i("el-button",{on:{click:t.save}},[t._v("保存")]),t._v(" "),i("el-button",{on:{click:t.reset}},[t._v("取消")])],1),t._v(" "),i("el-table",{staticClass:"table",attrs:{data:t.list},on:{"row-dblclick":t.confirm}},[i("el-table-column",{attrs:{label:"操作",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button",{attrs:{type:"text"},on:{click:function(i){t.editItem(e.row)}}},[t._v("编辑")]),t._v(" "),i("el-button",{attrs:{type:"text"},on:{click:function(i){t.deleteItem(e.row)}}},[t._v("删除")])]}}])}),t._v(" "),i("el-table-column",{attrs:{label:"类别名称",prop:"typeName"}})],1)],1)])],1)},y=[],j=i("ed08"),x={name:"DigestSelectDialog",components:{},props:{showDialogVisible:Boolean},data:function(){return{lodaing:!1,info:{typeName:""},list:[]}},computed:{},watch:{},created:function(){this.getTypeList()},mounted:function(){},methods:{getTypeList:function(){var t=this;Object(r["t"])().then((function(e){t.list=e.data})).catch((function(){}))},save:function(){var t=this;this.lodaing=!0,Object(r["r"])(this.info).then((function(e){t.$message.success("添加成功"),t.getTypeList(),t.reset(),t.lodaing=!1})).catch((function(){t.lodaing=!1}))},editItem:function(t){this.info=Object(j["s"])(t)},deleteItem:function(t){var e=this;this.lodaing=!0,Object(r["s"])({typeId:t.typeId}).then((function(t){e.$message.success("删除成功"),e.getTypeList(),e.lodaing=!1})).catch((function(){e.lodaing=!1}))},reset:function(){this.info={typeName:""}},handleClose:function(){this.$emit("close",!1)},confirm:function(t){this.$emit("select",t),this.$emit("close",!1)}}},C=x,w=(i("3df0"),Object(b["a"])(C,_,y,!1,null,"1db09898",null)),k=w.exports,S={name:"VoucherTemplate",components:{SelectDropdown:g,TemplateSelectDialog:k},props:{content:Array,showDialogVisible:Boolean},data:function(){return{lodaing:!1,selectTemplateDialogVisible:!1,info:{typeName:"",typeId:"",templateTypeName:"",name:"",saveMoney:!1},typeList:[],rules:{typeId:[{required:!0,message:"请选择模板类型",trigger:"blur"}],name:[{required:!0,message:"模板名称不能为空",trigger:"blur"}]}}},computed:{},watch:{},created:function(){this.getList()},mounted:function(){},methods:{getList:function(){var t=this;Object(r["t"])().then((function(e){t.typeList=e.data})).catch((function(){}))},templateSelect:function(t){this.info.typeId=t.typeId,this.info.typeName=t.typeName},selectTemplateSubmit:function(t){this.info.typeId=t.typeId,this.info.typeName=t.typeName},handleClose:function(){this.$emit("close",!1)},selectTemplateClose:function(){this.selectTemplateDialogVisible=!1,this.getList()},confirm:function(t){var e=this;this.$refs.form.validate((function(t){if(t){e.lodaing=!0;var i=e.content.map((function(t){return e.info.saveMoney?{associationBOS:t.associationBOS,digestContent:t.digestContent,subject:t.subject,subjectId:t.subjectId,quantity:t.quantity,debtorBalance:t.debtorBalance,creditBalance:t.creditBalance}:{associationBOS:t.associationBOS,digestContent:t.digestContent,subject:t.subject,subjectId:t.subjectId,quantity:"",debtorBalance:"",creditBalance:""}}));Object(r["o"])(Object(c["a"])(Object(c["a"])({},e.info),{},{content:JSON.stringify(i)})).then((function(t){e.$message.success("保存成功"),e.lodaing=!1,e.$emit("close",!1)})).catch((function(){e.lodaing=!1}))}}))}}},O=S,I=(i("bb77"),Object(b["a"])(O,u,d,!1,null,"0a3a6e0a",null)),D=I.exports,$=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("el-dialog",{attrs:{visible:t.showDialogVisible,"close-on-click-modal":!1,"before-close":t.handleClose,"append-to-body":!0,title:"凭证模板库",width:"500px"},on:{"update:visible":function(e){t.showDialogVisible=e}}},[i("div",{staticClass:"content"},[i("el-table",{attrs:{data:t.list},on:{"row-dblclick":t.confirm}},[i("el-table-column",{attrs:{label:"操作",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button",{attrs:{type:"text"},on:{click:function(i){t.deleteItem(e.row)}}},[t._v("删除")])]}}])}),t._v(" "),i("el-table-column",{attrs:{label:"类别",prop:"typeName"}}),t._v(" "),i("el-table-column",{attrs:{label:"名称",prop:"name"}})],1)],1)])],1)},T=[],B={name:"VoucherTemplate",components:{},props:{showDialogVisible:Boolean},data:function(){return{lodaing:!1,info:{templateContent:""},list:[]}},computed:{},watch:{},created:function(){this.getList()},mounted:function(){},methods:{getList:function(){var t=this;Object(r["q"])().then((function(e){t.list=e.data})).catch((function(){}))},deleteItem:function(t){var e=this;this.lodaing=!0,Object(r["p"])({templateId:t.templateId}).then((function(t){e.$message.success("删除成功"),e.getList(),e.lodaing=!1})).catch((function(){e.lodaing=!1}))},handleClose:function(){this.$emit("close",!1)},confirm:function(t){this.$emit("select",t),this.$emit("close",!1)}}},N=B,A=(i("1759"),Object(b["a"])(N,$,T,!1,null,"430c1306",null)),M=A.exports,Y=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-popover",{attrs:{placement:"bottom",width:"420",trigger:"hover"}},[n("div",{staticClass:"wrapper"},[n("img",{staticClass:"img",attrs:{src:i("f303"),alt:""}})]),t._v(" "),n("el-button",{attrs:{slot:"reference",type:"text"},slot:"reference"},[t._v("快捷键")])],1)},V=[],L={name:"ShortcutKeys",data:function(){return{keysList:[{key:"保存并新增",value:"F12"},{key:"新增",value:"Alt + N"},{key:"录入第二条分录",value:"Enter"},{key:"自动平衡借贷方金额",value:"="},{key:"保存",value:"Ctrl + S"}],fieldList:[{prop:"key",value:"凭证"},{prop:"value",value:"快捷键"}]}}},P=L,F=(i("f032"),Object(b["a"])(P,Y,V,!1,null,"3c6c5e4c",null)),q=F.exports,z=i("eee7"),E=i("7a1a"),R=i("6bfe"),J=i("8c73"),K=i("b699"),U=i("2f62"),H=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-dialog",{attrs:{visible:t.showDialogVisible,"close-on-click-modal":!1,"before-close":t.handleClose,"append-to-body":!0,width:"500px"},on:{"update:visible":function(e){t.showDialogVisible=e}}},[i("span",{staticClass:"el-dialog__title",attrs:{slot:"title"},slot:"title"},[t._v("\n    凭证摘要库\n    "),t.helpObj?i("i",{staticClass:"wk wk-icon-fill-help wk-help-tips",attrs:{"data-type":t.helpObj.dataType,"data-id":t.helpObj.dataId}}):t._e()]),t._v(" "),i("div",{staticClass:"content"},[i("span",[t._v("摘要内容")]),t._v(" "),i("el-input",{staticClass:"addInut",attrs:{type:"textarea"},model:{value:t.info.digestContent,callback:function(e){t.$set(t.info,"digestContent",e)},expression:"info.digestContent"}}),t._v(" "),i("div",{staticClass:"btn-right"},[i("el-button",{attrs:{type:"primary"},on:{click:t.save}},[t._v("保存")]),t._v(" "),i("el-button",{on:{click:t.reset}},[t._v("取消")])],1),t._v(" "),i("el-table",{attrs:{data:t.list},on:{"row-dblclick":t.confirm}},[i("el-table-column",{attrs:{label:"摘要内容",prop:"digestContent"}}),t._v(" "),i("el-table-column",{attrs:{label:"操作",width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button",{attrs:{type:"primary-text"},on:{click:function(i){t.editItem(e.row)}}},[t._v("编辑")]),t._v(" "),i("el-button",{attrs:{type:"primary-text"},on:{click:function(i){t.deleteItem(e.row)}}},[t._v("删除")])]}}])})],1)],1)])},W=[],Z=(i("498a"),{name:"DigestSelectDialog",components:{},props:{showDialogVisible:Boolean,helpObj:Object},data:function(){return{lodaing:!1,info:{digestContent:""},list:[]}},computed:{},watch:{},created:function(){this.getDisgestList()},mounted:function(){},methods:{getDisgestList:function(){var t=this;Object(r["n"])().then((function(e){t.list=e.data})).catch((function(){}))},save:function(){var t=this;this.info.digestContent.trim()?(this.lodaing=!0,Object(r["l"])(this.info).then((function(e){t.$message.success("添加成功"),t.getDisgestList(),t.reset(),t.lodaing=!1})).catch((function(){t.lodaing=!1}))):this.$message.error("摘要内容不能为空")},editItem:function(t){this.info=Object(j["s"])(t)},deleteItem:function(t){var e=this;this.lodaing=!0,Object(r["m"])({digestId:t.digestId}).then((function(t){e.$message.success("删除成功"),e.getDisgestList(),e.lodaing=!1})).catch((function(){e.lodaing=!1}))},reset:function(){this.info={digestContent:""}},handleClose:function(){this.$emit("closeOptions",!1)},confirm:function(t){this.$emit("select-digest",t),this.$emit("closeOptions",!1)}}}),G=Z,Q=(i("fbbe"),Object(b["a"])(G,H,W,!1,null,"393388fb",null)),X=Q.exports,tt=i("2adb"),et=i.n(tt),it=i("cd42"),nt={name:"VoucherCreate",components:{SubjectSelectOptions:l["a"],VoucherTemplate:M,ShortcutKeys:q,DigestSelectDialog:X,SaveTemplateDialog:D,PrintPageSetDialog:z["a"]},mixins:[K["a"]],data:function(){return{loading:!1,voucherOptions:[],debounceSaveSubmit:null,relationObj:{},info:{fileNum:"",voucherId:"",certificateTime:"",certificateNum:""},list:[],helpObj:{subject:{dataType:37,dataId:304},digest:{dataType:37,dataId:300}},coord:"",subjectList:[],certificateIds:[],selectTemp:null,certificateIndex:"",moneyUnits:["亿","千","百","十","万","千","百","十","元","角","分"],selectDigestDialogVisible:!1,saveTemplateDialogVisible:!1,selectTemplateDialogVisible:!1,fieldList:[{label:"摘要",name:"digestContent"},{label:"会计科目",name:"subjectNumber"},{label:"借方金额",name:"debtorBalance"},{label:"贷方金额",name:"creditBalance"}],printSizeDialogVisible:!1}},computed:Object(c["a"])(Object(c["a"])({},Object(U["c"])(["userInfo","financeCurrentAccount","financeFilterTimeRange"])),{},{canSave:function(){return this.certificateIndex||0===this.certificateIndex?this.$auth("finance.voucher.update"):this.$auth("finance.voucher.save")},datePicker:function(){var t=this;return{disabledDate:function(e){var i=t.financeCurrentAccount.startTime;return!!(i&&new Date(i).getMonth()>new Date(e).getMonth()&&new Date(i).getFullYear()===new Date(e).getFullYear())||new Date(e).getTime()<new Date(t.financeFilterTimeRange.minTime.val+" 00:00:00").getTime()}}},showNumColumn:function(){for(var t=0;t<this.list.length;t++){var e=this.list[t];if(e.subject&&e.subject.isAmount)return!0}return!1},voucherTime:function(){if(this.info.certificateTime){var t=this.info.certificateTime.split("-");return"".concat(t[0],"年第").concat(t[1],"期")}return""},totalDebite:function(){for(var t=0,e=0;e<this.list.length;e++)t+=1*this.list[e].debtorBalance;return t.toFixed(2)},number_chinese:function(){return 1*!this.totalDebite||1*!this.totalCredit||this.totalDebite!==this.totalCredit?"":et.a.toMoney(Number(this.totalDebite),{outSymbol:!1})},fromSearch:function(){var t=Object(j["s"])(this.$route.query);return delete t.hideTab,!Object(R["c"])(t)},totalCredit:function(){for(var t=0,e=0;e<this.list.length;e++)t+=1*this.list[e].creditBalance;return t.toFixed(2)},isPass:function(){return!!this.info.isStatement||1===Number(this.info.checkStatus)},passImg:function(){return this.isPass?this.info.isStatement?i("fe0b"):i("4e63"):""},certificateNum:function(){var t=this,e=this.voucherOptions.find((function(e){return e.voucherId==t.info.voucherId}));return e?e.voucherName:""}}),watch:{"info.certificateTime":function(){this.getSubjectList()},financeCurrentAccount:function(){this.certificateIndex||0===this.certificateIndex||this.getInfoTime()},"$route.query":{handler:function(t){Object(R["c"])(t)&&this.resetAdd()},deep:!0,immediate:!0}},created:function(){this.initRouterQuery(),window.addEventListener("keydown",this.shortcutKeysDown),this.certificateIndex||0===this.certificateIndex||(this.initForm(),this.getInfoTime()),this.debounceSaveSubmit=Object(E["debounce"])(1e3,this.saveSubmit),this.getVoucherOption()},beforeDestroy:function(){window.removeEventListener("keydown",this.shortcutKeysDown)},methods:Object(c["a"])(Object(c["a"])({sizeConfirm:function(t){this.printSubmit(t)},print:function(){this.printSizeDialogVisible=!0},editSummaryFocus:function(t,e,i){var n=this;this.$set(t,"edit_summary",!0),this.$nextTick((function(){n.$refs[e+"summary"][0].focus()}))},printSubmit:function(t){for(var e=this,i=JSON.parse(JSON.stringify(this.info)),n=JSON.parse(JSON.stringify(this.list)),a=[Object(c["a"])(Object(c["a"])({},i),{},{certificateDetails:n,certificateNum:this.certificateNum+"_"+this.info.certificateNum})],s=[],o=0;o<a.length;o++){var l,u=a[o];if(null!==(l=u.certificateDetails)&&void 0!==l&&l.length)if(u.totalDebite=this.computeTotal("totalDebite",u),u.totalCredit=this.computeTotal("totalCredit",u),u.certificateDetails.length<=4){for(var d=4-u.certificateDetails.length,f=0;f<d;f++)u.certificateDetails.push({});s.push(Object(c["a"])(Object(c["a"])({},u),{},{currentPage:1,totalPage:1}))}else{for(var h=[],m=0,p=Math.ceil(u.certificateDetails.length/4),b=0;b<u.certificateDetails.length;b++){var v=u.certificateDetails[b];b&&b%4==0?(s.push(Object(c["a"])(Object(c["a"])({},u),{},{certificateDetails:h,currentPage:++m,totalPage:p})),h=[],h.push(v)):h.push(v)}if(h.length){for(var g=4-h.length,_=0;_<g;_++)h.push({});s.push(Object(c["a"])(Object(c["a"])({},u),{},{certificateDetails:h,currentPage:++m,totalPage:p}))}}}var y="\n      <head>\n      <style>\n        *{\n          margin:0;\n          padding:0;\n          font-size:".concat(t.fontSize||"14px",";\n        }\n        th,td{\n          padding:20px 0;\n        }\n        .title{\n          padding:10px 0;\n        }\n        .title-item{\n          display:inline-block;\n          width:33%;\n        }\n        .title-item:nth-child(2){\n          text-align: center;\n        }\n        .title-item:nth-child(3){\n          text-align: right;\n        }\n        .footer{\n          padding:10px 0;\n        }\n        .footer-item{\n          width:24%;\n          display:inline-block;\n        }\n        .footer-item:nth-child(2){\n          text-align: center;\n        }\n        .footer-item:nth-child(3){\n          text-align: center;\n        }\n        .footer-item:nth-child(4){\n          text-align: right;\n        }\n      </style>\n      ").concat(s.map((function(t){return'<div style="font-size: 20px;">\n      <div style="font-size: 30px;text-align: center;">记账凭证</div>\n      <div style="width: 200px;border-bottom: 1px solid;border-top: 1px solid;height: 5px; margin: 10px auto;"/>\n    </div>\n    <div style="overflow: hidden;">\n      <span style="float:right;">\n        附单据&nbsp;&nbsp;'.concat(e.info.fileNum||"",'&nbsp;&nbsp;张\n      </span>\n    </div>\n    <div class="title" style="display: flex;justify-content: space-between;padding: 5px 0;">\n      <div class="title-item">\n        <span>单位：').concat(e.financeCurrentAccount.companyName,'</span>\n      </div>\n      <div class="title-item">\n        <span>日期：').concat(e.voucherTime,'</span>\n      </div>\n      <div class="title-item">\n        <span> 凭证号：').concat(t.certificateNum+" ("+t.currentPage+"/"+t.totalPage+")",'</span>\n      </div>\n    </div>\n    <table border="1" cellspacing="0" cellpadding="0" style="border-collapse: collapse;width:100%">\n      <tr>\n        ').concat(e.fieldList.map((function(t){return"<th >\n      ".concat(t.label,"\n    </th>")})).join(" "),"\n      </tr>\n        ").concat(t.certificateDetails.map((function(t){return"<tr>\n        ".concat(e.fieldList.map((function(i){return"<td >\n      ".concat(e.formatter(t,i),"\n    </td>")})).join(" "),"\n      </tr>")})).join(" "),'\n\n      <tr>\n        <td colspan="2">合计： ').concat(e.number_chinese," </td>\n        <td> ").concat(Object(J["h"])(e.totalDebite)," </td>\n        <td> ").concat(Object(J["h"])(e.totalCredit),' </td>\n      </tr>\n    </table>\n    <div class="footer" style="display: flex;justify-content: space-between;padding: 5px 2px">\n      <div class="footer-item">\n        <span>财务主管：</span>\n      </div>\n      <div class="footer-item">\n        <span>审核：').concat(e.info.examineUserName,'</span>\n      </div>\n      <div class="footer-item">\n        <span>出纳：</span>\n      </div>\n      <div class="footer-item">\n        <span>制单：').concat(e.info.certificateId?e.info.createUserName:e.userInfo.realname,'</span>\n      </div>\n    </div>\n    <div style="page-break-after:always;"></div>\n    ')})).join(" "),"\n      ");Object(r["e"])({type:"pdf",content:y,orientation:t.orientation||"Portrait",marginLeft:"".concat(t.left||0,"mm"),marginTop:"".concat(t.top||0,"mm"),pageWidth:"".concat(t.width||0,"mm"),pageHeight:"".concat(t.height||0,"mm")}).then((function(t){var i=t.data,n=e.$router.resolve({name:"PrintPage",query:{key:i}});window.open(n.href,"_blank")}))},computeTotal:function(t,e){var i=0;return e.certificateDetails.forEach((function(e){i="totalDebite"==t?Object(it["a"])(i,e.debtorBalance):Object(it["a"])(i,e.creditBalance)})),Object(J["h"])(i)},formatter:function(t,e){return"subjectNumber"==e.name?this.itemSubjectName(t):"creditBalance"==e.name||"debtorBalance"==e.name?t[e.name]?Object(J["h"])(t[e.name]):"":t[e.name]||" "}},Object(U["b"])(["getVoucherTimeRange"])),{},{headerCellStyle:function(t,e){return{background:"#F2F2F2"}},subjectSelect:function(t,e){e.subject=t[1]||{}},selectDigestOption:function(t){this.selectTemp=t,this.selectDigestDialogVisible=!0},getSubjectList:function(){var t=this;Object(o["H"])({type:null,certificateTime:this.$moment(this.info.certificateTime).format("YYYYMM"),isTree:5}).then((function(e){t.subjectList=e.data||[]}))},beforeChooseSubject:function(t){return!(t.children&&t.children.length>0)||(this.$message.warning("不允许选择非明细科目"),!1)},filterSubject:function(t,e,i){return(!e||0===e.length)&&t.status},moneyStr:function(t){var e=""===this.filterMoney(t)?"":Math.abs(this.filterMoney(t));return String(e)},initForm:function(){this.list=[{digestContent:"",subject:{},subjectId:"",associationBOS:{},quantity:"",debtorBalance:"",creditBalance:""},{digestContent:"",subject:{},subjectId:"",associationBOS:{},quantity:"",debtorBalance:"",creditBalance:""},{digestContent:"",subject:{},subjectId:"",associationBOS:{},quantity:"",debtorBalance:"",creditBalance:""},{digestContent:"",subject:{},subjectId:"",associationBOS:{},quantity:"",debtorBalance:"",creditBalance:""}],this.info={fileNum:"",voucherId:"",certificateTime:this.info.certificateTime,certificateNum:""},this.info.certificateTime||this.getInfoTime(),this.getDefaultVoucher()},itemSubjectName:function(t,e){if(!t.subject||Object(R["c"])(t.subject))return"";var i=t.subject.number+" "+t.subject.subjectName;if(!t.subject.adjuvantList)return i;var n=Object.keys(t.associationBOS).map((function(e){var i="";return t.associationBOS[e].relationId?(i=t.associationBOS[e].carteNumber+t.associationBOS[e].name,t.associationBOS[e].specification&&(i+=" "+t.associationBOS[e].specification)):i=t.associationBOS[e].name,i}));return n.length&&(i+="_"+n.join("_")),i},itemBalance:function(t){return t.subject&&!Object(R["c"])(t.subject)?t.subject.labelName?"余额：".concat(t.subject.adjuvantBalance||0):"余额：".concat(t.subject.balance||0):""},getInfoTime:function(){var t=this.financeCurrentAccount.startTime,e=t?this.$moment(t):this.$moment();e.format("YYYY-MM")===this.$moment().format("YYYY-MM")?this.$set(this.info,"certificateTime",this.$moment().format("YYYY-MM-DD")):this.$set(this.info,"certificateTime",e.endOf("month").format("YYYY-MM-DD")),this.getVoucherNum()},changeCertificateIndex:function(t){this.certificateIds.length&&(-1!=t||this.certificateIds[this.certificateIndex-1]||""===this.certificateIndex?1!=t||this.certificateIds[this.certificateIndex+1]?(-1==t&&""===this.certificateIndex?this.certificateIndex=this.certificateIds.length-1:this.certificateIndex=this.certificateIndex+t,this.getDetail()):this.$message.warning("没有下一张了"):this.$message.warning("没有上一张了"))},getVoucherNum:function(t){var e=this;if(this.info.voucherId&&this.info.certificateTime){var i={voucherId:this.info.voucherId,settleTime:this.$moment(this.info.certificateTime).format("YYYYMM")};Object(r["j"])(i).then((function(t){e.info.certificateNum=t.data.certificateNum}))}},templateClick:function(t){"save"==t?this.checkForm()&&(this.saveTemplateDialogVisible=!0):this.selectTemplateDialogVisible=!0},selectTemplate:function(t){this.list=JSON.parse(t.content)},resetAdd:function(){this.$router.push({path:"/fm/voucher/subs/create"}),this.certificateIds=[],this.certificateIndex="",this.initForm()},updateCheckStatus:function(){var t=this;this.checkForm()&&(this.loading=!0,Object(r["v"])({ids:[this.info.certificateId],status:1==this.info.checkStatus?0:1}).then((function(e){t.$message.success("操作成功"),t.getDetail(),t.getVoucherTimeRange(),t.loading=!1})).catch((function(){t.loading=!1})))},addLine:function(t){this.list.splice(t,0,{digestContent:"",subject:{},subjectId:"",associationBOS:{},quantity:"",debtorBalance:"",creditBalance:""})},getDetail:function(){var t=this;this.loading=!0,Object(r["x"])({certificateId:this.certificateIds[this.certificateIndex]}).then((function(e){t.loading=!1,t.info=e.data,t.list=[],t.$nextTick((function(){t.list=e.data.certificateDetails.sort((function(t,e){return t.sort-e.sort})).map((function(t){var e={};return t.associationBOS&&t.associationBOS.forEach((function(t){e[t.adjuvantId]=t})),Object(c["a"])(Object(c["a"])({},t),{},{associationBOS:e,subject:JSON.parse(t.subjectContent)})}))}))})).catch((function(e){t.certificateIds=[],t.certificateIndex="",t.initForm(),t.loading=!1}))},getDefaultVoucher:function(){for(var t=0;t<this.voucherOptions.length;t++){var e=this.voucherOptions[t];e.isDefault&&(this.info.voucherId=e.voucherId,this.getVoucherNum())}},getVoucherOption:function(){var t=this;Object(o["L"])().then((function(e){t.voucherOptions=e.data,t.certificateIndex||0===t.certificateIndex||t.getDefaultVoucher()}))},deleteLine:function(t){this.list.length<=2?this.$message.warning("至少保留两条分录!"):this.list.splice(t,1)},checkForm:function(){if(!this.list.filter((function(t){return!Object(R["c"])(t.subject)&&(t.debtorBalance||t.creditBalance)})).length)return this.$message.error("请检查格式！"),!1;if(this.totalDebite!==this.totalCredit)return this.$message.error("录入借贷不平！"),!1;if(!this.list[0].digestContent)return this.$message.error("第一条摘要不能为空"),!1;for(var t=0;t<this.list.length;t++){var e=this.list[t];if(!Object(R["c"])(e.subject)&&!e.debtorBalance&&!e.creditBalance)return this.$message.error("第".concat(t+1,"条借贷金额不能为空")),!1;if(e.subject&&e.subject.adjuvantList&&e.subject.adjuvantList.length)for(var i=0;i<e.subject.adjuvantList.length;i++){var n=e.subject.adjuvantList[i];if(!e.associationBOS[n.adjuvantId]||!e.associationBOS[n.adjuvantId].relationId)return this.$message.error("第".concat(t+1,"条辅助核算不能为空")),!1}if((e.debtorBalance||e.creditBalance)&&Object(R["c"])(e.subject))return this.$message.error("第".concat(t+1,"条科目不能为空")),!1}return!0},inputFocus:function(t,e){var i=this;this.isPass||this.coord!=t+e&&(this.coord=t+e,this.$nextTick((function(){i.$refs[i.coord]instanceof Array?i.$refs[i.coord][0].focus():i.$refs[i.coord]&&i.$refs[i.coord].focus()})))},fileNumChange:function(t){String(t).length>10||(this.info.fileNum=t<0?0:t)},filterMoney:function(t){return!t||isNaN(Number(t))?"":Number(t).toFixed(2).replace(".","")},copyOne:function(){if(this.checkForm()){this.certificateIds=[],this.certificateIndex="";var t=Object(j["s"])(this.list.map((function(t){return Object(c["a"])(Object(c["a"])({},t),{},{certificateId:void 0,detailId:void 0})})));this.info.certificateTime="",this.initForm(),this.getVoucherTimeRange(),this.list=t}},deleteOne:function(){var t=this;this.$confirm("您确认要删除此凭证吗？删除后将不可恢复，并会产生断号","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.loading=!0,Object(r["w"])({ids:[t.info.certificateId]}).then((function(e){t.$message.success("操作成功"),t.fromSearch?t.$router.back():(t.certificateIds=[],t.certificateIndex="",t.initForm()),t.getVoucherTimeRange(),t.loading=!1})).catch((function(){t.loading=!1}))})).catch((function(){}))},moneyChange:function(t,e,i){t=(1*t).toFixed(2),e[i]=1*t,"creditBalance"==i?e.debtorBalance="":e.creditBalance=""},countMoney:function(t){t.balanceDirection?(t.debtorBalance="",t.creditBalance=Math.floor((t.quantity||0)*(t.price||0)*100)/100):(t.debtorBalance=Math.floor((t.quantity||0)*(t.price||0)*100)/100,t.creditBalance="")},balanceMoney:function(t,e,i){"="===t.key&&this.totalCredit!==this.totalDebite&&(Number(this.totalCredit),Number(this.totalDebite),"creditBalance"==i?(e[i]=0-(Number(this.totalCredit)-Number(this.totalDebite)),e.debtorBalance=0):(e.creditBalance=0,e.debtorBalance=Number(this.totalCredit)-Number(this.totalDebite)))},initRouterQuery:function(){if(this.fromSearch){var t=this.$route.query.ids;"string"==typeof t?this.certificateIds=this.$route.query.ids.split(","):"number"==typeof this.$route.query.ids?this.certificateIds.push(this.$route.query.ids):this.certificateIds=[this.$route.query.ids],this.certificateIndex=this.$route.query.index,this.getDetail()}},back:function(){this.$router.back()},selectDigestClose:function(){this.selectTemp=null,this.selectDigestDialogVisible=!1},selectDigestSubmit:function(t){this.isPass||(this.selectTemp.digestContent=t.digestContent,this.selectDigestClose())},fillDigest:function(t,e){var i=this;this.inputFocus(e,"summary"),this.isPass||0===e||!t.digestContent&&this.list[e-1].digestContent&&(t.digestContent=this.list[e-1].digestContent,this.$nextTick((function(){i.$refs[e+"summary"][0].select()})))},inputBlur:function(t,e,i){this.coord==t+e&&(this.coord=""),"summary"==e&&(i.edit_summary=!1)},saveSubmit:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(2!==Number(this.info.statementType))if(this.info.voucherId)if(this.info.certificateNum)if(this.info.certificateTime){if(this.checkForm()){var i=this.list.filter((function(t){return!Object(R["c"])(t.subject)&&(t.debtorBalance||t.creditBalance)})).map((function(t,e){var i=Object(j["s"])(t.subject);delete i.adjuvantList;var n=Object.keys(t.associationBOS).map((function(e){return t.associationBOS[e]}));return Object(c["a"])(Object(c["a"])({},t),{},{subjectId:t.subject.subjectId,subjectNumber:t.subject.number,sort:e+1,subjectContent:JSON.stringify(i),associationBOS:n,subject:void 0})}));this.loading=!0,Object(r["u"])(Object(c["a"])(Object(c["a"])({},this.info),{},{total:this.totalDebite,certificateDetails:i})).then((function(i){t.$message.success("保存成功"),t.info.certificateId||t.certificateIds.push(i.data.certificateId),e?t.initForm():(t.info.certificateId||(t.certificateIndex=t.certificateIds.length-1),t.getDetail()),t.getVoucherTimeRange(),t.loading=!1})).catch((function(){t.loading=!1}))}}else this.$message.error("请选择凭日期");else this.$message.error("请选择凭证字号");else this.$message.error("请选择凭证字");else this.$message.error("结转损益的凭证不允许编辑")},shortcutKeysDown:function(t){if(83==t.keyCode&&t.ctrlKey&&this.canSave&&!this.isPass)this.debounceSaveSubmit(!1),t.preventDefault();else if(123==t.keyCode&&this.canSave&&!this.isPass)this.debounceSaveSubmit(!0),t.preventDefault();else if(78==t.keyCode&&t.altKey&&this.$auth("finance.voucher.save"))this.resetAdd(),t.preventDefault();else if(13==t.keyCode&&this.coord){var e=Array.apply(void 0,Object(s["a"])(document.querySelectorAll("input"))),i=e.findIndex((function(t){return t==document.activeElement}));if(this.coord.includes("credit")&&Number(this.coord.replace("credit",""))==this.list.length-1)return this.list.push({digestContent:"",subject:{},subjectId:"",associationBOS:{},quantity:"",debtorBalance:"",creditBalance:""}),void this.$nextTick((function(){Object(s["a"])(document.querySelectorAll("input"))[i+1].focus()}));this.$nextTick((function(){e[i+1].focus()}))}else if(t.keyCode<=40&&t.keyCode>=37&&this.coord){var n;switch(t.keyCode){case 37:n=-1;break;case 38:n=-4;break;case 39:n=1;break;case 40:n=4;break;default:break}var a=Array.apply(void 0,Object(s["a"])(document.querySelectorAll("input"))),c=a.findIndex((function(t){return t==document.activeElement}));a[c+n]&&document.querySelector(".subject-table").contains(a[c+n])&&a[c+n].focus(),t.preventDefault()}}})},at=nt,st=(i("0be7"),i("3aec"),Object(b["a"])(at,n,a,!1,null,"5543249b",null));e["default"]=st.exports},"92be":function(t,e,i){"use strict";var n=/^([+-])?0*(\d+)(\.(\d+))?$/,a=/^([+-])?0*(\d+)(\.(\d+))?e(([+-])?(\d+))$/i,s=e.e2ten=function(t){var e=a.exec(t.toString());if(!e)return t;var i=e[2],n=e[4]||"",s=e[5]?+e[5]:0;if(s>0){var c=n.substr(0,s);c=c.length<s?c+new Array(s-c.length+1).join("0"):c,n=n.substr(s),i+=c}else{s=-s;var o=i.length-s;o=o<0?0:o;var r=i.substr(o,s);r=r.length<s?new Array(s-r.length+1).join("0")+r:r,i=i.substring(0,o),n=r+n}return i=""==i?"0":i,("-"==e[1]?"-":"")+i+(n?"."+n:"")};e.getNumbResult=function(t){var e=n.exec(t.toString());if(!e&&a.test(t.toString())&&(e=n.exec(s(t.toString()))),e)return{int:e[2],decimal:e[4],minus:"-"==e[1],num:e.slice(1,3).join("")}},e.centerArray=function t(e,i){if(e.splice.apply(e,[0,i.length].concat(i.splice(0,i.length))),arguments.length>2){var n=[].slice.call(arguments,2);n.unshift(e),t.apply(null,n)}return e};var c=e.hasAttr=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)};e.extend=function(t){for(var e,i=arguments[0]||{},n=Array.prototype.slice.call(arguments,1),a=0;a<n.length;a++){var s=n[a];for(e in s)c(s,e)&&(i[e]=s[e])}return i},e.getDigit=function(t){return t>=5?4*(t-4)+4:t},e.unshiftZero=function(t,e){if(null==e&&(e=1),!(e<=0))for(;e--;)t.unshift(0)},e.clearZero=function(t,e,i){if(null==t)return"";var n=~"*.?+$^[](){}|\\/".indexOf(e)?"\\"+e:e,a=new RegExp("^"+n+"+"),s=new RegExp(n+"+$"),c=new RegExp(n+"{2}","g");return t=t.toString(),"^"==i&&(t=t.replace(a,"")),i&&"$"!=i||(t=t.replace(s,"")),i&&"nto1"!=i||(t=t.replace(c,e)),t}},a055:function(t,e,i){var n=i("92be");function a(t,e){var i=n.getNumbResult(t);if(!i)return t;e=e||{};var a=this.ch,s=this.ch_u,c=this.ch_f||"",o=this.ch_d||".",r=a.charAt(0),l=i.int,u=i.decimal,d=i.minus,f="",h="",m=d?c:"",p=function t(i,c,o){i=n.getNumbResult(i).int;var l="",u=arguments.length>1?arguments[1]:e.tenMin,d=i.length;if(1==d)return a.charAt(+i);if(d<=4)for(var f=0,h=d;h--;){var m=+i.charAt(f);l+=u&&2==d&&0==f&&1==m?"":a.charAt(m),l+=m&&h?s.charAt(h):"",f++}else{var p=i.length/4>>0,b=i.length%4;while(0==b||!s.charAt(3+p))b+=4,p--;var v=i.substr(0,b),g=i.substr(b);l=t(v,u)+s.charAt(3+p)+("0"==g.charAt(0)?r:"")+t(g,g.length>4&&u)}return l=n.clearZero(l,r),l};if(u){u=n.clearZero(u,"0","$");for(var b=0;b<u.length;b++)h+=a.charAt(+u.charAt(b));h=h?o+h:""}if(f=p(l),e.ww&&s.length>5){var v=s.charAt(4),g=s.charAt(5),_=f.lastIndexOf(g);~_&&(f=f.substring(0,_).replace(new RegExp(g,"g"),v+v)+f.substring(_))}return m+f+h}function s(t){t=t.toString();var e=t.split(this.ch_d),i=e[0].replace(this.ch_f,""),a=e[1],s=!!~e[0].indexOf(this.ch_f),c=this.ch_u.charAt(1),o=this.ch_u.charAt(4),r=this.ch_u.charAt(5);i=i.replace(new RegExp(o+"{2}","g"),r);for(var l=i.split(""),u=0,d=0,f=[],h=[],m=[],p=0;p<l.length;p++){var b=l[p],v=0,g=0;if(~(v=this.ch.indexOf(b)))v>0&&m.unshift(v);else if(~(g=this.ch_u.indexOf(b))){var _=n.getDigit(g);u>g?(n.unshiftZero(m,_),n.centerArray(h,m)):g>=d?(0==p&&(m=[1]),n.centerArray(f,h,m),f.length>0&&n.unshiftZero(f,_),d=g):(0==m.length&&c==b&&(m=[1]),n.centerArray(h,m),n.unshiftZero(h,n.getDigit(g)),u=g)}}n.centerArray(f,h,m).reverse(),0==f.length&&f.push(0);var y=0;if(a){f.push("."),y="0.";for(p=0;p<a.length;p++)y+=this.ch.indexOf(a.charAt(p)),f.push(this.ch.indexOf(a.charAt(p)));y=+y}return s&&f.unshift("-"),parseFloat(f.join(""))}function c(t,e){var i={ww:!0,complete:!1,outSymbol:!0},s=n.getNumbResult(t),c=this.ch.charAt(0);if(e="object"==typeof e?e:{},!s)return t;e=n.extend(i,e);var o=s.num,r=s.decimal||"",l=e.outSymbol?this.m_t:"",u=r?"":this.m_z,d="";if(e.complete){for(var f=1;f<this.m_u.length;f++)d+=a.call(this,r.charAt(f-1)||"0")+this.m_u.charAt(f);u=a.call(this,o,e)+this.m_u.charAt(0)}else{if(r=r.substr(0,this.m_u.length-1),r=n.clearZero(r,"0","$"),r){var h;for(f=0;f<this.m_u.length-1;f++)r.charAt(f)&&"0"!=r.charAt(f)&&(d+=a.call(this,r.charAt(f))+this.m_u.charAt(f+1),h=!1),"0"!==r.charAt(f)||h||(0==f&&"0"==o||(d+=c),h=!0)}"0"==o&&!u&&d||(u=a.call(this,o,e)+this.m_u.charAt(0)+u)}return l+u+d}t.exports={CL:a,unCL:s,toMoney:c}},a1e3:function(t,e,i){},a6d3:function(t,e,i){t.exports={colorPrimary:"#0052cc",colorBlack:"#172b4d",colorSuccess:"#36b37e",colorWarning:"#ffab00",colorDanger:"#ff5630",colorN40:"#dfe1e6",axisLineColor:"#dfe1e6",axisLabelFontWeight:"500"}},a8bb:function(t,e){t.exports={ch:"零一二三四五六七八九",ch_u:"个十百千万亿",ch_f:"负",ch_d:"点"}},b034:function(t,e,i){},b699:function(t,e,i){"use strict";var n=i("5530"),a=(i("99af"),i("add5")),s=i.n(a),c=i("2f62"),o=i("bc95");e["a"]={data:function(){return{printFooterShow:!1,pageTitle:"",searchTime:""}},mixins:[o["a"]],computed:Object(n["a"])(Object(n["a"])({},Object(c["c"])(["financeCurrentAccount"])),{},{displayTime:function(){return this.searchTime||this.dataTime&&this.$moment(this.dataTime,"YYYYMM").format("YYYY年第MM期")||this.dateValue&&this.$moment(this.dateValue,"YYYYMM").format("YYYY年第MM期")||this.timeArray&&this.timeArray.length&&this.getTimeShowVal(this.timeArray)}}),methods:{HandlerPrint:function(t,e){var i=this,n=e.title,a=void 0===n?"":n,c=e.style,o=void 0===c?"":c,r=e.centerText,l=void 0===r?"":r,u=e.headerHtml,d=void 0===u?"":u,f=e.type,h=void 0===f?"html":f;this.printFooterShow=!0;var m="\n      <div >\n        <div style='text-align:center;font-size:30px; font-weight:bold'>".concat(this.pageTitle||a,"</div>\n        <div style='display:flex; font-size:26px;padding: 10px 0'>\n          <span style=\"flex:1\">编制单位：").concat(this.financeCurrentAccount.companyName,'</span>\n          <span style="flex:1; text-align:center">').concat(l,'</span>\n          <span style="flex:1; text-align:right">\n          ').concat(this.displayTime||this.$moment(this.financeCurrentAccount.startTime,"YYYYMM").format("YYYY年第MM期"),"\n          </span>\n        </div>\n      </div>\n      ");this.$nextTick((function(){s()({printable:t,header:d||m,type:h,scanStyles:!1,style:"@page {size: auto;size:A3;margin:6mm}\n                  td,th{border:1px solid !important;padding: 10px 0;}\n                  table{border-collapse: collapse;font-size:20px;}\n                  .el-table__cell.gutter{border:none !important;}\n                  .el-table__empty-text{text-align: center;width: 100%;}\n                  tr{page-break-inside:avoid}\n                  .el-table__empty-text{display:none}\n                  .el-table__footer-wrapper{display:none}\n                  "+o,onLoadingEnd:function(){i.printFooterShow=!1}})}))}}}},bb77:function(t,e,i){"use strict";i("b034")},bc95:function(t,e,i){"use strict";i("99af");e["a"]={methods:{getTimeShowVal:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=t[0]||null,i=t[1]||null;if(!e)return"";var n=this.$moment(e).format("YYYY年第MM期");if(!i)return n;var a=this.$moment(i).format("YYYY年第MM期");return n===a?n:"".concat(n," 至 ").concat(a)},getTimeInputWidth:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=this.$moment(t[0]||null),i=this.$moment(t[1]||null);return e.isValid()&&i.isValid()&&e.format("YYYY-MM")!==i.format("YYYY-MM")?"230px":"180px"}}}},cd42:function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));i("d3b7"),i("25f0"),i("a9e3"),i("ac1f"),i("5319");function n(t,e){var i=0,n=0;try{i=(t.toString().split(".")[1]||[]).length}catch(c){return t+e}try{n=(e.toString().split(".")[1]||[]).length}catch(c){return t+e}var s=Math.pow(10,Math.max(i,n));return Math.round(a(t,s)+a(e,s))/s}function a(t,e){var i=0,n=t.toString(),a=e.toString();try{i+=(n.split(".")[1]||[]).length}catch(s){return t*e}try{i+=(a.split(".")[1]||[]).length}catch(s){return t*e}return Number(n.replace(".",""))*Number(a.replace(".",""))/Math.pow(10,i)}},d547:function(t,e,i){"use strict";i("059e")},eee7:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-dialog",t._g(t._b({staticClass:"print-set-dialog",attrs:{title:"凭证打印",width:"500px","close-on-click-modal":!1},on:{close:t.closeHandle}},"el-dialog",t.$attrs,!1),t.$listeners),[i("el-form",{ref:"form",attrs:{"label-position":"top",model:t.form,rules:t.rules,"label-width":"80px",inline:!1,size:"normal"}},[i("el-form-item",{attrs:{label:"打印类型"}},[i("el-radio-group",{model:{value:t.form.printType,callback:function(e){t.$set(t.form,"printType",e)},expression:"form.printType"}},[i("el-radio",{attrs:{label:"A4"}},[t._v("\n          A4\n        ")]),t._v(" "),i("el-radio",{attrs:{label:"B5"}},[t._v("\n          B5\n        ")]),t._v(" "),i("el-radio",{attrs:{label:"custom"}},[t._v("\n          自定义纸张\n        ")])],1),t._v(" "),"custom"==t.form.printType?i("div",{staticClass:"set-item-wrap"},[i("div",{staticClass:"set-item"},[i("span",[t._v("宽度")]),t._v(" "),i("el-input",{attrs:{oninput:"value=value.replace(/[^0-9.]/g,'')",min:1,type:"number"},model:{value:t.form.width,callback:function(e){t.$set(t.form,"width",e)},expression:"form.width"}}),t._v(" "),i("span",[t._v("毫米")])],1),t._v(" "),i("div",{staticClass:"set-item"},[i("span",[t._v("长度")]),t._v(" "),i("el-input",{attrs:{type:"number",oninput:"value=value.replace(/[^0-9.]/g,'')",min:1},model:{value:t.form.height,callback:function(e){t.$set(t.form,"height",e)},expression:"form.height"}}),t._v(" "),i("span",[t._v("毫米")])],1)]):t._e()],1),t._v(" "),i("el-form-item",{attrs:{label:"图像方向"}},[i("el-radio-group",{model:{value:t.form.orientation,callback:function(e){t.$set(t.form,"orientation",e)},expression:"form.orientation"}},[i("el-radio",{attrs:{label:"Landscape"}},[t._v("\n          纵向\n        ")]),t._v(" "),i("el-radio",{attrs:{label:"Portrait"}},[t._v("\n          横向\n        ")])],1)],1),t._v(" "),i("el-form-item",{attrs:{label:"边框调整"}},[i("div",{staticClass:"border-set"},[i("div",{staticClass:"set-item"},[i("span",[t._v("左")]),t._v(" "),i("el-input",{attrs:{oninput:"value=value.replace(/[^0-9.]/g,'')",min:1,type:"number"},model:{value:t.form.left,callback:function(e){t.$set(t.form,"left",e)},expression:"form.left"}}),t._v(" "),i("span",[t._v("毫米")])],1),t._v(" "),i("div",{staticClass:"set-item"},[i("span",[t._v("上")]),t._v(" "),i("el-input",{attrs:{oninput:"value=value.replace(/[^0-9.]/g,'')",min:1,type:"number"},model:{value:t.form.top,callback:function(e){t.$set(t.form,"top",e)},expression:"form.top"}}),t._v(" "),i("span",[t._v("毫米")])],1)])]),t._v(" "),i("el-form-item",{attrs:{label:"字体大小"}},[i("div",{staticClass:"set-item"},[i("el-input",{attrs:{oninput:"value=value.replace(/[^0-9.]/g,'')",min:12,type:"number"},model:{value:t.form.fontSize,callback:function(e){t.$set(t.form,"fontSize",e)},expression:"form.fontSize"}}),t._v(" "),i("span",[t._v("像素")])],1)])],1),t._v(" "),i("span",{attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:t.submit}},[t._v("保存并打印")]),t._v(" "),i("el-button",{on:{click:t.closeHandle}},[t._v("取消")])],1)],1)},a=[],s=i("2a1a"),c="FM_PRINT_PAGE_SET",o={data:function(){return{form:{printType:"B5",orientation:"Portrait",top:0,left:0,width:0,height:0,fontSize:16},rules:{}}},created:function(){this.getData()},methods:{getData:function(){var t=this;Object(s["a"])({customKey:c}).then((function(e){e.data&&e.data.length&&(t.form=e.data[0])}))},getStyleData:function(){var t=this.getPageSize(this.form.printType),e=t.height,i=t.width;return{height:e,width:i,top:this.form.top,left:this.form.left,orientation:this.form.orientation,fontSize:this.form.fontSize+"px"}},getPageSize:function(t){return"A4"==t?{width:297,height:210}:"B5"==t?{width:250,height:176}:{width:this.form.width,height:this.form.height}},submit:function(){Object(s["b"])({customKey:c,data:[this.form]});var t=this.getStyleData();this.$emit("confirm",t)},closeHandle:function(){this.$emit("update:visible",!1)}}},r=o,l=(i("34b8"),i("2877")),u=Object(l["a"])(r,n,a,!1,null,"71d4df23",null);e["a"]=u.exports},f032:function(t,e,i){"use strict";i("5ef9")},f303:function(t,e,i){t.exports=i.p+"static/img/keys.95ea3b7a.png"},f4fd:function(t,e){t.exports={ch:"零壹贰叁肆伍陆柒捌玖",ch_u:"个拾佰仟万亿",ch_f:"负",ch_d:"点",m_t:"人民币",m_z:"整",m_u:"元角分"}},fbbe:function(t,e,i){"use strict";i("59b8")},fe0b:function(t,e,i){t.exports=i.p+"static/img/checkout.fecb0615.png"}}]);