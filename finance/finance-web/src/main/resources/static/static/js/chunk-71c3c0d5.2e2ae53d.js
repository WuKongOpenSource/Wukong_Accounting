(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-71c3c0d5"],{1027:function(t,e,o){t.exports=o.p+"static/img/project.78db2183.png"},"3d79":function(t,e,o){"use strict";o("d3d5")},"4d38":function(t,e,o){"use strict";o("58bc")},"58bc":function(t,e,o){},"58c0":function(t,e,o){},"5a5d":function(t,e,o){},"5d24":function(t,e,o){t.exports=o.p+"static/img/profit.eb974ec3.png"},"64bf":function(t,e,o){t.exports=o.p+"static/img/balanceSheet.cade541a.png"},c810:function(t,e,o){"use strict";o.r(e);var a=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("flexbox",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"app-container main",attrs:{gutter:0,direction:"column",align:"stretch"}},[o("xr-header",{attrs:{label:"账套管理"}},[o("template",{slot:"otherLabel"},[o("i",{staticClass:"wk wk-icon-fill-help wk-help-tips",attrs:{"data-type":"43","data-id":"338"}})])],2),t._v(" "),o("flexbox-item",{staticClass:"container"},[o("flexbox",{staticClass:"content",attrs:{align:"flex-start",justify:"flex-start",wrap:"wrap"}},[t._l(t.accountList,(function(e,a){return o("div",{key:a,staticClass:"content-item-wrap"},[o("flexbox",{staticClass:"content-item",attrs:{gutter:0,align:"center",justify:"flex-start",direction:"column"}},[o("flexbox",{staticClass:"content-item-top"},[o("flexbox-item",[t._v("\n              "+t._s(e.companyName)+"\n            ")]),t._v(" "),o("el-button",{attrs:{type:"primary-text"},on:{click:function(o){t.handleToEditAccount(e)}}},[t._v("编辑")])],1),t._v(" "),o("flexbox-item",{staticClass:"content-item-center"},[o("p",[t._v("联系人："+t._s(e.contacts))]),t._v(" "),o("p",[t._v("联系电话："+t._s(e.mobile))])]),t._v(" "),o("flexbox",{staticClass:"content-item-bottom",attrs:{align:"center",justify:"flex-start"}},[o("flexbox-item",[o("span",[t._v("会计期间：")]),o("span",[t._v(t._s(t.formatTime(e.startTime)))])]),t._v(" "),o("el-button",{attrs:{type:"primary-text"},on:{click:function(o){t.handleToEditAuth(e)}}},[t._v("授权")]),t._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:function(o){t.openTally(e)}}},[t._v("记账")])],1)],1)],1)})),t._v(" "),o("div",{staticClass:"content-item-wrap"},[o("div",{staticClass:"content-item"},[o("div",{staticClass:"create-box"},[o("div",{staticClass:"create-box-icon",on:{click:t.handleToCreateAccount}},[o("i",{staticClass:"el-icon-plus"})]),t._v(" "),o("p",{staticClass:"create-box-text"},[t._v("\n              新建账套\n            ")])])])])],2)],1),t._v(" "),t.dialogVisible?o("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{"lock-scroll":!0,visible:t.dialogVisible,"before-close":t.addaccountClose,title:t.accountDialogTitle,"close-on-click-modal":!1,width:"800px"}},[o("div",[o("create-sections",{attrs:{title:"基本信息"}},[o("el-form",{ref:"accountForm",attrs:{rules:t.basicInfFormRules,model:t.accountForm,"label-position":"top"}},[o("el-row",{attrs:{gutter:40}},t._l(t.accountFieldList,(function(e,a){return o("el-col",{key:a,attrs:{span:12}},[o("el-form-item",{attrs:{prop:e.prop,"label-width":t.formLabelWidth,label:e.title}},[o("el-input",{attrs:{autocomplete:"off"},model:{value:t.accountForm[e.prop],callback:function(o){t.$set(t.accountForm,e.prop,o)},expression:"accountForm[item.prop]"}})],1)],1)})))],1)],1),t._v(" "),o("create-sections",{attrs:{title:"联系方式"}},[o("el-form",{ref:"contactForm",attrs:{model:t.contactForm,"label-position":"top"}},[o("el-row",{attrs:{gutter:40}},t._l(t.contactFieldList,(function(e,a){return o("el-col",{key:a,attrs:{span:12}},[o("el-form-item",{attrs:{prop:e.prop,"label-width":t.formLabelWidth,label:e.title}},[o("el-input",{attrs:{autocomplete:"off"},model:{value:t.contactForm[e.prop],callback:function(o){t.$set(t.contactForm,e.prop,o)},expression:"contactForm[item.prop]"}})],1)],1)})))],1)],1)],1),t._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{type:"primary"},on:{click:t.handleSaveAccount}},[t._v("确定")]),t._v(" "),o("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取消")])],1)]):t._e(),t._v(" "),t.accountItem?o("el-dialog",{attrs:{visible:t.authDialogVisible,"close-on-click-modal":!1,title:"授权",width:"800px"},on:{"update:visible":function(e){t.authDialogVisible=e}}},[o("div",[o("flexbox",{staticClass:"power-title"},[o("flexbox-item",[t._v("账套名:"+t._s(t.accountItem.companyName))]),t._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:function(e){t.relateEmployeeShow=!0}}},[t._v("添加员工")])],1),t._v(" "),o("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],class:t.WKConfig.tableStyle.class,staticStyle:{width:"100%"},attrs:{data:t.accountUserList,stripe:t.WKConfig.tableStyle.stripe,height:250}},[o("el-table-column",{attrs:{type:"index",width:"50"}}),t._v(" "),o("el-table-column",{attrs:{prop:"realname",label:"姓名",width:"220"}}),t._v(" "),t._l(t.financeRoleList,(function(e,a){return o("el-table-column",{key:a,attrs:{prop:e.prop,label:e.label},scopedSlots:t._u([{key:"default",fn:function(a){var n=a.row;return[o("el-checkbox",{attrs:{disabled:1===n.isFounder},model:{value:n[e.prop],callback:function(o){t.$set(n,e.prop,o)},expression:"row[item.prop]"}})]}}])})})),t._v(" "),o("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row,n=e.$index;return[o("el-button",{attrs:{disabled:1===a.isFounder,type:"text"},nativeOn:{click:function(e){e.preventDefault(),t.deleteRow(a,n)}}},[t._v("\n              删除\n            ")])]}}])})],2)],1),t._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{type:"primary"},on:{click:function(e){t.handleSaveAuth(!1)}}},[t._v("确定")]),t._v(" "),o("el-button",{on:{click:function(e){t.authDialogVisible=!1}}},[t._v("取消")])],1)]):t._e(),t._v(" "),t.relateEmployeeShow?o("wk-dep-user-dialog",{attrs:{visible:t.relateEmployeeShow,props:{showDisableUser:!1,showDept:!1}},on:{"update:visible":function(e){t.relateEmployeeShow=e},change:t.employeesSave}}):t._e(),t._v(" "),t.showAccount?o("account-step-dialog",{attrs:{visible:t.showAccount,"company-info":t.companyInfo},on:{"update:visible":function(e){t.showAccount=e}}}):t._e()],1)},n=[],i=o("c7eb"),c=o("1da1"),r=o("5530"),s=(o("d3b7"),o("159b"),o("7db0"),o("14d9"),o("c740"),o("a9e3"),o("3c65"),o("a434"),o("d81d"),o("36bd")),l=o("2581"),u=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"section create-sections"},[t.title&&t.title.length>0?o("div",{staticClass:"section-header"},[o("div",{staticClass:"section-mark",style:{"border-left-color":t.mColor}}),t._v(" "),o("div",{staticClass:"section-title"},[t._v(t._s(t.title))]),t._v(" "),t.dropdownItems&&t.dropdownItems.length>0?o("el-dropdown",{staticClass:"create-sections__more",attrs:{trigger:"click"},on:{command:t.handleTypeClick}},[o("i",{staticClass:"el-icon-more",staticStyle:{cursor:"pointer"}}),t._v(" "),o("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},t._l(t.dropdownItems,(function(e,a){return o("el-dropdown-item",{key:a,attrs:{icon:e.icon,command:e.command}},[t._v(t._s(e.label))])})))],1):t._e(),t._v(" "),t._t("header")],2):t._e(),t._v(" "),o("div",{staticClass:"content create-sections-content"},[t._t("default")],2)])},d=[],p={name:"CreateSections",components:{},props:{title:{type:String,default:""},mColor:{type:String,default:"#2362FB"},dropdownItems:Array},data:function(){return{}},computed:{},mounted:function(){},methods:{handleTypeClick:function(t){this.$emit("command-select",t)}}},m=p,f=(o("3d79"),o("2877")),h=Object(f["a"])(m,u,d,!1,null,"2ae1283e",null),b=h.exports,v=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{visible:t.dialogVisible,"before-close":t.close,width:"600px",title:"创建全新账套"}},[o("el-form",{ref:"createForm",staticClass:"demo-ruleForm",attrs:{model:t.createForm,rules:t.createRules,"label-width":"100px"}},[o("el-form-item",{attrs:{label:"公司名称：",prop:"companyName"}},[o("el-input",{attrs:{disabled:!0},model:{value:t.createForm.companyName,callback:function(e){t.$set(t.createForm,"companyName",e)},expression:"createForm.companyName"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"本位币：",prop:"currencyId",required:""}},[o("el-select",{attrs:{placeholder:"请选币种"},model:{value:t.createForm.currencyId,callback:function(e){t.$set(t.createForm,"currencyId",e)},expression:"createForm.currencyId"}},t._l(t.RMBList,(function(t){return o("el-option",{key:t.currencyId,attrs:{label:t.currencyCoding,value:t.currencyId}})})))],1),t._v(" "),o("el-form-item",{attrs:{label:"启用期间：",required:""}},[o("el-date-picker",{attrs:{clearable:!1,"value-format":"yyyy-MM-dd",format:"yyyy 年 MM 期",type:"month",placeholder:"选择期间"},model:{value:t.createForm.startTime,callback:function(e){t.$set(t.createForm,"startTime",e)},expression:"createForm.startTime"}})],1),t._v(" "),o("el-form-item",{attrs:{label:"会计制度：",prop:"bookkeeperId"}},[o("el-select",{attrs:{placeholder:"请选择活动区域"},model:{value:t.createForm.bookkeeperId,callback:function(e){t.$set(t.createForm,"bookkeeperId",e)},expression:"createForm.bookkeeperId"}},t._l(t.accountSystemList,(function(t){return o("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})))],1),t._v(" "),o("el-form-item",{attrs:{label:"报表预览："}},[o("el-button",{attrs:{type:"text"},on:{click:function(e){t.imgClick(0)}}},[t._v("资产负债表")]),t._v(" "),o("el-button",{attrs:{type:"text"},on:{click:function(e){t.imgClick(1)}}},[t._v("科目预览表")]),t._v(" "),o("el-button",{attrs:{type:"text"},on:{click:function(e){t.imgClick(2)}}},[t._v("利润表")])],1)],1),t._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{type:"primary"},on:{click:function(e){t.submitForm()}}},[t._v("创建")]),t._v(" "),o("el-button",{on:{click:t.close}},[t._v("取消")])],1)],1)},g=[],y=(o("b0c0"),o("2f62")),_={name:"AccountStepDialog",props:{visible:{type:Boolean,default:!1},companyInfo:[String,Object]},data:function(){return{loading:!1,dialogVisible:!1,createForm:{companyName:"",accountId:"",bookkeeperId:"1",currencyId:"",startTime:""},createRules:{name:[{required:!0,message:"请输入活动名称",trigger:"blur"},{min:3,max:5,message:"长度在 3 到 5 个字符",trigger:"blur"}]},RMBList:[],accountSystemList:[{value:"1",label:"小企业会计准则（2013年颁）"}],imgList:[{id:999,showName:"资产负债表",name:"balanceSheet.png",url:o("64bf")},{id:998,showName:"科目预览表",name:"subject.png",url:o("1027")},{id:997,showName:"余额表",name:"profit.png",url:o("5d24")}]}},computed:Object(r["a"])({},Object(y["c"])(["userInfo"])),watch:{visible:{handler:function(){this.dialogVisible=this.visible},immediate:!0},companyInfo:{handler:function(t){this.createForm.companyName=t.companyName,this.createForm.accountId=t.accountId},deep:!0,immediate:!0}},created:function(){this.createForm.startTime=this.$moment().format("YYYY-MM-DD"),this.getRMBData()},methods:{getRMBData:function(){var t=this;Object(s["e"])({accountId:this.createForm.accountId}).then((function(e){t.RMBList=e.data;var o=t.RMBList[0]||{};t.$set(t.createForm,"currencyId",o.currencyId)}))},imgClick:function(t){this.$wkPreviewFile.preview({index:t||0,data:this.imgList.map((function(t){return{url:t.url,name:t.name}}))})},submitForm:function(){var t=this;this.$refs.createForm.validate((function(e){e&&(t.loading=!0,Object(s["d"])({accountId:t.createForm.accountId}).then((function(e){var o=e.data.userList.find((function(e){return e.userId==t.userInfo.userId}));o&&t.jumpMainPage()})))}))},jumpMainPage:function(){var t=this;Object(s["h"])(this.createForm).then((function(e){t.loading=!1,t.close(),t.$message.success("创建成功"),t.$router.push({path:"/fm/workbench",query:{id:t.createForm.accountId}})})).catch((function(){t.loading=!1}))},close:function(){this.$emit("update:visible",!1),this.$emit("close")}}},k=_,w=(o("c886"),Object(f["a"])(k,v,g,!1,null,"cf21d144",null)),x=w.exports,I=o("f468"),F={name:"AccountBook",components:{CreateSections:b,WkDepUserDialog:l["a"],AccountStepDialog:x,XrHeader:I["a"]},data:function(){return{loading:!1,accountList:[],accountItem:null,accountUserList:[],financeRoleList:[],accountFieldList:[{title:"公司编码",prop:"companyCode"},{title:"公司名称",prop:"companyName"},{title:"公司简介",prop:"companyProfile"},{title:"所在行业",prop:"industry"},{title:"所在地",prop:"location"},{title:"法人代表",prop:"legalRepresentative"},{title:"身份证号",prop:"idNum"},{title:"营业执照号",prop:"businessLicenseNum"},{title:"组织机构代码",prop:"organizationCode"},{title:"备注",prop:"remark"}],contactFieldList:[{title:"联系人",prop:"contacts"},{title:"办公电话",prop:"officeTelephone"},{title:"手机号",prop:"mobile"},{title:"传真号码",prop:"faxNum"},{title:"QQ",prop:"qqNum"},{title:"Email",prop:"email"},{title:"其它",prop:"other"},{title:"详细地址",prop:"address"}],basicInfFormRules:{companyCode:[{required:!0,message:"请输入公司编码",trigger:"blur"}],companyName:[{required:!0,message:"请输入公司名称",trigger:"blur"}]},accountForm:{},contactForm:{},dialogVisible:!1,formLabelWidth:"120px",accountDialogTitle:"新建账套",authDialogVisible:!1,relateEmployeeShow:!1,showAccount:!1,companyInfo:{companyName:"",accountId:""}}},computed:Object(r["a"])({},Object(y["c"])(["userInfo"])),watch:{accountUserList:{handler:function(t){var e=this;t.forEach((function(t){e.financeRoleList.forEach((function(o){t.hasOwnProperty(o.prop)||e.$set(t,o.prop,!1)}))}))},deep:!0,immediate:!0}},created:function(){this.getData()},methods:{getData:function(){var t=this;this.loading=!0,Object(s["f"])().then((function(e){t.loading=!1,t.accountList=e.data}))},formatTime:function(t){return t?this.$moment(t).format("YYYY年第MM期"):""},openTally:function(t){var e=this;return Object(c["a"])(Object(i["a"])().mark((function o(){var a,n;return Object(i["a"])().wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.next=2,Object(s["d"])({accountId:t.accountId});case 2:a=o.sent,n=a.data.userList.find((function(t){return t.userId===e.userInfo.userId})),n?1==t.status?(e.$message.success("跳转至现有记账"),e.$router.push({path:"/fm/workbench",query:{id:t.accountId}})):(e.companyInfo.companyName=t.companyName,e.companyInfo.accountId=t.accountId,e.showAccount=!0):e.$message.error("您没有该账套的权限");case 6:case"end":return o.stop()}}),o)})))()},getUserListByAccount:function(t){var e=this;this.loading=!0,Object(s["d"])({accountId:t}).then((function(t){var o=(t.data||{}).userList||[],a=o.findIndex((function(t){return t.hasOwnProperty("isFounder")&&1===Number(t.isFounder)}));-1!==a&&0!==a&&(o.unshift(o[a]),o.splice(a+1,1)),e.accountUserList=o,e.loading=!1}))},getRoleList:function(){var t=this;Object(s["c"])({type:4}).then((function(e){t.financeRoleList=(e.data||[]).map((function(t){return{prop:String(t.roleId),label:t.roleName}}))}))},handleToCreateAccount:function(){var t=this;this.accountDialogTitle="新建账套",this.accountItem=null,this.dialogVisible=!0,this.accountFieldList.forEach((function(e){t.$set(t.accountForm,e.prop,"")})),this.contactFieldList.forEach((function(e){t.$set(t.contactForm,e.prop,"")}))},handleToEditAccount:function(t){var e=this;this.accountItem=t,this.accountDialogTitle="编辑账套",this.accountFieldList.forEach((function(o){e.$set(e.accountForm,o.prop,t[o.prop])})),this.contactFieldList.forEach((function(o){e.$set(e.contactForm,o.prop,t[o.prop])})),this.dialogVisible=!0},handleSaveAccount:function(){var t=this;this.loading=!0,this.$refs.accountForm.validate((function(e){if(!e)return t.loading=!1,!1;var o=t.accountItem?s["j"]:s["a"];o(Object(r["a"])(Object(r["a"])(Object(r["a"])({},t.accountItem||{}),t.accountForm),t.contactForm)).then((function(e){setTimeout((function(){t.dialogVisible=!1,t.loading=!1,t.getData()}),2e3)})).catch((function(){t.loading=!1,t.dialogVisible=!1}))}))},handleToEditAuth:function(t){this.accountItem=t,this.getUserListByAccount(t.accountId),this.getRoleList(),this.authDialogVisible=!0},addaccountClose:function(){this.$refs.accountForm.clearValidate(),this.dialogVisible=!1},deleteRow:function(t,e){this.accountUserList.splice(e,1)},handleSaveAuth:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=[];this.accountUserList.forEach((function(e){if(!e.hasOwnProperty("isFounder")||1!==e.isFounder){var a=[];t.financeRoleList.forEach((function(t){e[t.prop]&&a.push(t.prop)})),o.push({roleIdList:a,userId:e.userId})}})),Object(s["g"])({accountId:this.accountItem.accountId,userList:o}).then((function(o){e?(t.authDialogVisible=!0,t.getUserListByAccount(t.accountItem.accountId)):(t.authDialogVisible=!1,t.$message.success("保存成功"))}))},employeesSave:function(t,e,o){this.addUserToList(o,!0),this.relateEmployeeShow=!1},addUserToList:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];e.forEach((function(e){var o=t.accountUserList.find((function(t){return t.userId===e.userId}));if(!o){var a={};t.financeRoleList.forEach((function(t){a[t.prop]=!1})),t.accountUserList.push(Object(r["a"])(Object(r["a"])({},e),a))}})),this.relateEmployeeShow=!1}}},C=F,L=(o("4d38"),Object(f["a"])(C,a,n,!1,null,"1471a3a3",null));e["default"]=L.exports},c886:function(t,e,o){"use strict";o("58c0")},d3d5:function(t,e,o){},f468:function(t,e,o){"use strict";var a=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("flexbox",{staticClass:"xr-header"},[t.iconClass?o("div",{staticClass:"xr-header__icon",style:{backgroundColor:t.iconColor}},[o("i",{class:t.iconClass})]):t._e(),t._v(" "),o("div",{staticClass:"xr-header__label"},[t.$slots.label?t._t("label"):[t._v(t._s(t.label)),t._t("otherLabel")]],2),t._v(" "),t.showSearch?o("el-input",t._b({staticClass:"xr-header__search",style:{"margin-top":t.ftTop},attrs:{placeholder:t.placeholder},on:{input:t.inputChange},nativeOn:{keyup:function(e){return!("button"in e)&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.searchClick(e)}},model:{value:t.search,callback:function(e){t.search=e},expression:"search"}},"el-input",t.inputAttr,!1),[o("el-button",{attrs:{slot:"suffix",type:"icon",icon:"wk wk-sousuo"},on:{click:t.searchClick},slot:"suffix"})],1):t._e(),t._v(" "),o("div",{staticClass:"xr-header__ft",style:{top:t.ftTop}},[t._t("ft")],2)],1)},n=[],i=(o("a9e3"),o("ac1f"),o("841c"),{name:"XrHeader",components:{},props:{iconClass:[String,Array],iconColor:String,label:String,showSearch:{type:Boolean,default:!1},placeholder:{type:String,default:"请输入内容"},ftTop:{type:String,default:"0"},content:[String,Number],inputAttr:{type:Object,default:function(){}}},data:function(){return{search:""}},computed:{},watch:{content:{handler:function(){this.search!=this.content&&(this.search=this.content)},immediate:!0}},mounted:function(){},beforeDestroy:function(){},methods:{inputChange:function(){this.$emit("update:content",this.search)},searchClick:function(){this.$emit("search",this.search)}}}),c=i,r=(o("f9b7"),o("2877")),s=Object(r["a"])(c,a,n,!1,null,"20e1a242",null);e["a"]=s.exports},f9b7:function(t,e,o){"use strict";o("5a5d")}}]);