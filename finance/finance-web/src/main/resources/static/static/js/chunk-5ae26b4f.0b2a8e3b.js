(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5ae26b4f"],{"01c9":function(e,t,i){"use strict";i("2ab9")},"0925":function(e,t,i){},"12d8":function(e,t,i){},1440:function(e,t,i){},"15db":function(e,t,i){"use strict";i("0925")},1962:function(e,t,i){},"21d7":function(e,t,i){},"278b":function(e,t,i){"use strict";i("a515")},"2ab9":function(e,t,i){},"2dde":function(e,t,i){"use strict";i("e5ab")},"2de0":function(e,t,i){},3277:function(e,t,i){"use strict";i("dc14")},3723:function(e,t,i){},"3ea7":function(e,t,i){"use strict";i("ba22")},4859:function(e,t,i){},"4a7a":function(e,t,i){"use strict";i("ebab")},"527f":function(e,t,i){"use strict";i("3723")},"53bd":function(e,t,i){"use strict";i("2de0")},"545c":function(e,t,i){},"5a0e":function(e,t,i){e.exports={colorPrimary:"#0052cc",colorBlack:"#172b4d",colorSuccess:"#36b37e",colorWarning:"#ffab00",colorDanger:"#ff5630",colorN40:"#dfe1e6",axisLineColor:"#dfe1e6",axisLabelFontWeight:"500"}},"5a5d":function(e,t,i){},6641:function(e,t,i){"use strict";i("a303")},"6ae5":function(e,t,i){"use strict";i("12d8")},"72db":function(e,t,i){},"7d86":function(e,t,i){},"7e8c":function(e,t,i){"use strict";i("a8c1")},"81c9":function(e,t,i){"use strict";i("1440")},"835e":function(e,t,i){"use strict";i("e2d9")},"87f0":function(e,t,i){},8871:function(e,t,i){"use strict";i("7d86")},"8d09":function(e,t,i){"use strict";i("90f4")},"90f4":function(e,t,i){},9144:function(e,t,i){"use strict";i("d851")},"987e":function(e,t,i){},9907:function(e,t,i){e.exports=i.p+"static/img/error.db4faeed.png"},"9bad":function(e,t,i){"use strict";i("f42b")},"9c9a":function(e,t,i){"use strict";i("21d7")},a0a5:function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i(e.currentComponent,{tag:"components"})},a=[],s=(i("ac1f"),i("5319"),function(){var e=this,t=e.$createElement,i=e._self._c||t;return 4!=e.label?i("div",{staticClass:"detail-main",attrs:{orient:"vertical"}},[i("flexbox",{staticClass:"d-container",attrs:{direction:"column",align:"stretch"}},[i("wk-detail-header",{staticClass:"is-shadow",attrs:{subtitle:e.subTitleObj[e.label]||"",title:e.detailInfo[e.headerTitleObj[e.label]]}})],1),e._v(" "),i("div",{staticClass:"d-container-body"},[i("flexbox",{staticClass:"left-right-wrap is-hidden-right",attrs:{align:"stretch"}},[i("div",{staticClass:"left"},[i("div",{staticClass:"img-accessory"},[i("div",{staticClass:"img-box"},e._l(e.detailInfo.img,(function(t,n){return i("img",{directives:[{name:"src",rawName:"v-src",value:t.url,expression:"item.url"}],key:n,staticClass:"main-img",on:{click:function(t){e.previewImage(e.detailInfo.img,n)}}})}))),e._v(" "),i("div",{staticClass:"accessory"},[i("file-cell",{attrs:{"file-list":e.detailInfo.file,"show-time":!1}})],1)]),e._v(" "),i("div",{staticStyle:{"padding-right":"12px"}},[i("related-business",{attrs:{"show-foot":!1,"show-add":!1,"show-add-btn":!1,"all-data":e.relatedBusinessInfo}})],1)]),e._v(" "),i("div",{staticClass:"right"},[i("examine-info-section",{attrs:{"examine-record":e.examineRecord,"examine-type":"archive","external-mailbox":!0},on:{success:function(t){e.getAllData()},"on-handle":e.examineHandle}})],1)])],1)],1):i("hrm-examine",{attrs:{"email-token":e.emailToken}})}),o=[],l=i("3835"),r=(i("a9e3"),i("d3b7"),i("3ca3"),i("ddb0"),function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"wk-detail-header"},[e.subtitle||e.$slots.subtitle?i("div",{staticClass:"wk-detail-header-subtitle"},[e._t("subtitle",[e._v(e._s(e.subtitle))])],2):e._e(),e._v(" "),i("flexbox",{staticClass:"wk-detail-header-body",attrs:{justify:"space-between"}},[i("div",{staticClass:"wk-detail-header-left"},[e._t("title"),e._v(" "),e.title&&!e.$slots.title?i("el-tooltip",{attrs:{disabled:!e.title,content:e.title,effect:"dark",placement:"top-start"}},[i("span",{staticClass:"wk-detail-header-title"},[e._v(e._s(e.title))])]):e._e(),e._v(" "),e._t("left"),e._v(" "),e.pageList&&e.pageList.length>1?i("el-button-group",{staticClass:"wk-detail-header-page-switch"},[i("el-button",{attrs:{type:"subtle",icon:"el-icon-arrow-left"},on:{click:function(t){e.$emit("pageChange","left")}}}),e._v(" "),i("el-button",{attrs:{type:"subtle",icon:"el-icon-arrow-right"},on:{click:function(t){e.$emit("pageChange","right")}}})],1):e._e()],2),e._v(" "),i("div",{staticClass:"wk-detail-header-right"},[e._t("right"),e._v(" "),e.dropdowns&&e.dropdowns.length>0?i("el-dropdown",{class:{"margin-left-interval":e.$slots.right},attrs:{trigger:"click"},on:{command:e.dropdownCommand}},[i("el-button",{staticClass:"dropdown-btn",attrs:{icon:"el-icon-more"}}),e._v(" "),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.dropdowns,(function(t,n){return i("el-dropdown-item",{key:n,attrs:{icon:t.icon,command:t.command}},[e._v(e._s(t.name))])})))],1):e._e()],2)])],1)}),c=[],d={name:"WkDetailHeader",components:{},props:{subtitle:String,title:String,dropdowns:Array,pageList:Array},data:function(){return{}},computed:{},watch:{},created:function(){},mounted:function(){},beforeDestroy:function(){},methods:{dropdownCommand:function(e){this.$emit("command",e)}}},u=d,m=(i("9144"),i("3277"),i("2877")),p=Object(m["a"])(u,r,c,!1,null,"43b39a5a",null),h=p.exports,f=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.examineFlowList&&e.examineFlowList.length>0?i("wk-head-section",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{label:"审批流信息"}},[i("el-popover",{ref:"popover",attrs:{slot:"right",placement:e.placement,width:"300",trigger:"click"},slot:"right",model:{value:e.showFlowPopover,callback:function(t){e.showFlowPopover=t},expression:"showFlowPopover"}},[i("check-flow",{ref:"checkFlow",attrs:{id:e.recordId,"type-id":e.id,show:e.showFlowPopover,"examine-type":e.examineType},on:{close:function(t){e.showFlowPopover=!1}}}),e._v(" "),i("el-button",{staticStyle:{"margin-right":"8px"},attrs:{slot:"reference",type:"text"},on:{click:function(e){e.stopPropagation()}},slot:"reference"},[e._v("查看历史审批流程")])],1),e._v(" "),i("el-timeline",e._l(e.examineFlowList,(function(t,n){return i("el-timeline-item",{key:n,attrs:{"hide-timestamp":""}},[7!=t.examineType?i("i",{staticClass:"examine-item-icon",class:e.getStatusIcon(t.examineStatus),style:{color:e.getStatusColor(t.examineStatus)},attrs:{slot:"dot"},slot:"dot"}):i("i",{staticClass:"examine-item-icon wk wk-source-line",staticStyle:{color:"#5e6c84"},attrs:{slot:"dot"},slot:"dot"}),e._v(" "),i("div",{staticClass:"examine-item"},[i("div",{staticClass:"examine-item__hd ei"},[i("div",[i("span",{staticClass:"ei-status"},[e._v(e._s(e.examineNodeName(t)))]),e._v(" "),e.examineCategory(t.type)&&7!=t.examineType&&t.userList&&t.userList.length>1?i("el-tag",{attrs:{"disable-transitions":!0}},[e._v(e._s(e.examineCategory(t.type)))]):e._e(),e._v(" "),e.singleNodeDisableUserShow(t)?i("flexbox",{staticStyle:{"margin-top":"10px"}},[i("xr-avatar",{attrs:{name:e.getDetailName(t),size:20}}),e._v(" "),i("span",{staticClass:"ei-name"},[e._v("\n                "+e._s(e.getDetailName(t))+"\n                "+e._s(7==t.examineType&&0==t.userList[0].userStatus?"(已停用)":"")+"\n                "),t.userList[0].hasOwnProperty("seekUser")&&t.userList[0].seekUser?i("span",{staticClass:"other-people"},[i("i",{staticClass:"wk wk-new-employee"}),e._v("\n                  已征求他人意见")]):e._e()]),e._v(" "),11!=t.userList[0].examineStatus&&7!=t.examineType&&13!=t.userList[0].examineStatus&&8!=t.userList[0].examineStatus?i("span",{staticClass:"ei-status"},[e._v(e._s(e.getShowStatusName(t.userList[0].examineStatus,t.isAdminSkip)))]):e._e()],1):e._e()],1),e._v(" "),1===t.userList.length?i("div",{staticClass:"ei-time"},[i("span",[e._v(e._s(t.userList[0].examineTime))]),e._v(" "),t.isAdminSkip?i("div",{staticClass:"examine-error"},[e._v(e._s(t.userList[0].remarks))]):e._e(),e._v(" "),e.showOneUserExamine(t)?i("div",{staticClass:"examine-error"},[i("i",{staticClass:"el-icon-warning"}),e._v("\n              "+e._s(e.showOneUserExamine(t))+"\n            ")]):e._e(),e._v(" "),(t.userList[0].duration||t.userList[0].passFlag)&&e.examineAdvancedConfigVO.advancedLimitTimeVO&&1!=e.examineAdvancedConfigVO.advancedLimitTimeVO.handleType&&0!=t.userList[0].userStatus?i("div",{staticClass:"ei-time-limit",style:e.autoExamineText(t.userList[0].duration,t.userList[0].examineStatus,t.userList[0].passFlag,t.userList[0])["class"]},[e._v(e._s(e.autoExamineText(t.userList[0].duration,t.userList[0].examineStatus,t.userList[0].passFlag,t.userList[0])["text"])+"\n            ")]):e._e(),e._v(" "),t.userList[0].duration&&0==t.userList[0].userStatus&&e.timeLimitStyleShow?i("div",{staticClass:"examine-error"},[i("i",{staticClass:"el-icon-warning"}),e._v("\n              "+e._s(e.limitDisableShow())+"\n            ")]):e._e()]):e._e(),e._v(" "),1===t.userList.length&&e.canCheckEditFieldData(t)&&!t.isAdminSkip?i("div",[i("el-button",{attrs:{type:"primary-text"},on:{click:function(i){e.checkEditFieldDataClick(t)}}},[e._v("查看节点编辑信息")])],1):e._e()]),e._v(" "),t.userList.length>1?i("div",{staticClass:"examine-item__bd"},[e._l(t.userList,(function(n,a){return i("div",{key:a,staticClass:"examine-item__hd ei"},[e.disableAvatarUserShow(n)?i("flexbox",{class:n.hasOwnProperty("handlerType")&&[1,3].includes(n.handlerType)?"examine-care-of":""},[n.hasOwnProperty("handlerType")&&[1,3].includes(n.handlerType)?i("i",{staticClass:"wk wk-icon-reply",class:n.hasOwnProperty("handlerType")&&[1,3].includes(n.handlerType)?"care-of":""}):e._e(),e._v(" "),i("xr-avatar",{attrs:{name:e.$getUserName(n),size:20}}),e._v(" "),i("span",{staticClass:"ei-name"},[e._v("\n                "+e._s(e.$getUserName(n)||n.outerUserEmail)+"\n                "+e._s(7==t.examineType&&0==n.userStatus?"(已停用)":"")+"\n                "),n.hasOwnProperty("seekUser")&&n.seekUser?i("span",{staticClass:"other-people"},[i("i",{staticClass:"wk wk-new-employee"}),e._v("\n                  已征求他人意见")]):e._e()]),e._v(" "),11!=n.examineStatus&&17!=n.examineStatus&&7!=t.examineType&&13!=n.examineStatus&&8!=n.examineStatus?i("span",{staticClass:"ei-status"},[e._v(e._s(e.getShowStatusName(n.examineStatus,t.isAdminSkip)))]):7==t.examineType&&[18,19,14,15].includes(Number(n.examineStatus))?i("span",{staticClass:"ei-status"},[e._v(e._s(e.getShowStatusName(n.examineStatus)))]):e._e(),e._v(" "),11==n.examineStatus?i("span",{staticClass:"ei-status"},[e._v("已转审")]):17==n.examineStatus?i("span",{staticClass:"ei-status"},[e._v("已委托")]):e._e()],1):e._e(),e._v(" "),0!=n.userStatus&&102!=n.passFlag&&202!=n.passFlag?i("div",{staticClass:"ei-time"},[e._v(e._s(n.examineTime))]):e._e(),e._v(" "),(n.duration||n.passFlag)&&e.examineAdvancedConfigVO.advancedLimitTimeVO&&1!=e.examineAdvancedConfigVO.advancedLimitTimeVO.handleType&&0!=n.userStatus?i("div",{staticClass:"ei-time-limit",style:e.autoExamineText(n.duration,n.examineStatus,n.passFlag,n)["class"]},[e._v("\n              "+e._s(e.autoExamineText(n.duration,n.examineStatus,n.passFlag,n)["text"])+"\n            ")]):e._e(),e._v(" "),e.disableUserShow(n.passFlag,n.examineStatus,n)?i("div",{staticClass:"examine-error"},[i("i",{staticClass:"el-icon-warning"}),e._v("\n              "+e._s(e.disableUserShow(n.passFlag,n.examineStatus,n))+"\n            ")]):e._e()],1)})),e._v(" "),302==t.passFlag?i("div",{staticClass:"examine-error"},[i("i",{staticClass:"el-icon-warning"}),e._v("\n            转交人不存在已自动终止\n          ")]):e._e(),e._v(" "),e.showMultiplayerExamine(t.passFlag,t.userList,!0)&&7!=t.examineType?i("div",{staticClass:"examine-error"},[i("i",{staticClass:"el-icon-warning"}),e._v("\n            "+e._s(e.showMultiplayerExamine(t.passFlag,t.userList))+"\n          ")]):e._e(),e._v(" "),e.canCheckEditFieldData(t)&&!t.isAdminSkip?i("div",[i("el-button",{attrs:{type:"primary-text"},on:{click:function(i){e.checkEditFieldDataClick(t)}}},[e._v("查看节点编辑信息")])],1):e._e()],2):e._e()])])}))),e._v(" "),i("div",{staticClass:"examine-config"},[i("span",{on:{click:e.checkExamineConfig}},[e._v("查看审批配置")])]),e._v(" "),e.isFieldAuthExamine&&!e.externalMailbox?[!e.isOptionalNode&&(1==e.examineInfo.isCheck||1==e.examineInfo.isRecheck)||e.isOptionalNode||!e.isOptionalNode&&e.superRestoreHandleShow||e.examineMoreHandle.length?i("div",{staticClass:"examine-footer"},[e.isOptionalNode||1!=e.examineInfo.isCheck?e._e():i("el-button",{attrs:{type:"primary"},on:{click:e.examineClick}},[e._v("审批")]),e._v(" "),e.isOptionalNode?i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.examineHandleClick("selectExamineUser")}}},[e._v(e._s(e.isOptionalNode.addBtnName))]):e._e(),e._v(" "),!e.isOptionalNode&&e.superRestoreHandleShow?i("el-button",{staticStyle:{"margin-left":"auto"},attrs:{type:"primary"},on:{click:function(t){e.examineHandleClick(19)}}},[e._v("恢复")]):e._e(),e._v(" "),e.examineMoreHandle.length?i("el-dropdown",{staticClass:"more-handle",style:e.isStageFlow?"margin-left: 10px;":"",on:{command:e.moreHandlerClick}},[i("el-button",[e._v("更多操作")]),e._v(" "),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.examineMoreHandle,(function(t,n){return i("el-dropdown-item",{key:n,attrs:{command:t.value},on:{click:function(e){e.stopPropagation()}}},["forwardOthers"==t.value?[e.isStageFlow?i("span",{on:{click:function(t){t.stopPropagation(),e.moreHandlerClick("selectUser")}}},[e._v("转他人处理")]):i("el-dropdown",{staticClass:"more-handle",on:{command:e.moreHandlerClick}},[i("div",[e._v("转他人处理")]),e._v(" "),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",{attrs:{command:"selectUser"}},[e._v("选择员工")])],1)],1)]:[e._v("\n              "+e._s(t.label)+"\n            ")]],2)})))],1):e._e()],1):e._e()]:i("examine-btn-bar",{staticStyle:{padding:"16px 0"},attrs:{"examine-info":e.examineInfo,"examine-more-handle":e.examineMoreHandle,"is-optional-node":e.isOptionalNode,"is-stage-flow":e.isStageFlow,"super-handle-show":e.superRestoreHandleShow},on:{examineHandle:e.examineHandleClick,moreHandler:e.moreHandlerClick}}),e._v(" "),i("examine-handle",{ref:"examineHandleRef",attrs:{id:e.id,show:e.examineHandleShow,"record-id":e.recordId,"examine-type":e.examineType,"flow-id":e.flowId,status:e.examineHandleInfo.status,props:e.examineHandleProps,"get-post-fields":e.getAuthFieldsParams},on:{close:function(t){e.examineHandleShow=!1},emailExamine:e.emailExamineHandleClick,save:e.examineHandleSuccess}}),e._v(" "),e.userViewDialogShow?i("wk-dep-user-dialog",{attrs:{props:e.selectUserProps,radio:"",visible:e.userViewDialogShow},on:{"update:visible":function(t){e.userViewDialogShow=t},change:e.selectUserChange}}):e._e(),e._v(" "),e.solicitOthersShow?i("solicit-others",{on:{submitParams:e.solicitOthersHandler},model:{value:e.solicitOthersShow,callback:function(t){e.solicitOthersShow=t},expression:"solicitOthersShow"}}):e._e(),e._v(" "),e.externalDialogShow?i("el-dialog",{attrs:{visible:e.externalDialogShow,"close-on-click-modal":!1,"append-to-body":!0,title:"外部联系人",width:"30%"},on:{"update:visible":function(t){e.externalDialogShow=t}}},[i("span",[e._v("请输入外部联系人邮箱")]),e._v(" "),i("el-input",{staticStyle:{"margin-top":"10px"},model:{value:e.email,callback:function(t){e.email=t},expression:"email"}}),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.externalDialogShow=!1}}},[e._v("取消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.verifyEmail}},[e._v("确定")])],1)],1):e._e(),e._v(" "),e.examineOptionalShow?i("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.dialogLoading,expression:"dialogLoading"}],attrs:{visible:e.examineOptionalShow,"close-on-click-modal":!1,"append-to-body":!0,title:e.isOptionalNode.addBtnName,width:"40%"},on:{"update:visible":function(t){e.examineOptionalShow=t}}},[i("flexbox",{staticClass:"user-wrap",attrs:{wrap:"wrap"}},[e._l(e.optionalUserList,(function(t,n){return i("el-tooltip",{key:n,staticClass:"item",attrs:{effect:"dark",offset:10,content:e.$getUserName(t)||t.email||t.outerUserEmail,placement:"top"}},[i("div",{staticClass:"user"},[i("xr-avatar",{attrs:{name:e.$getUserName(t)||t.email||t.outerUserEmail,size:40,src:t.img}}),e._v(" "),i("div",{staticClass:"user__name"},[e._v(e._s(e.$getUserName(t)||t.email||t.outerUserEmail))]),e._v(" "),i("i",{staticClass:"user__delete el-icon-close",on:{click:function(t){e.deleteUserClick(n)}}})],1)])})),e._v(" "),i("div",{staticClass:"user"},[e.isAddUser?[e.isStageFlow?i("el-button",{on:{click:function(t){e.addingMode("selectUser")}}},[e._v("选择员工")]):i("el-dropdown",{attrs:{trigger:"click",placement:"right"},on:{command:e.addingMode}},[i("span",{staticClass:"el-dropdown-link"},[i("el-button",{staticClass:"user__img",staticStyle:{"margin-bottom":"8px"},attrs:{icon:"el-icon-plus",circle:""}}),e._v(" "),i("div",{staticClass:"user__name"},[e._v("选择人员")])],1),e._v(" "),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",{attrs:{command:"selectUser"}},[e._v("选择员工")]),e._v(" "),i("el-dropdown-item",{attrs:{command:"external"}},[e._v("选择外部联系人")])],1)],1)]:e._e()],2)],2),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:e.selectExamineUserClose}},[e._v("取消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.submitExamineUser}},[e._v("确定")])],1)],1):e._e(),e._v(" "),e.editDetailVisible?i("examine-edit-data-detail",{attrs:{id:e.id,visible:e.editDetailVisible,"examine-info":e.examineInfo,"item-data":e.editDetailItem},on:{"update:visible":function(t){e.editDetailVisible=t}}}):e._e(),e._v(" "),e.configShow?i("xr-create",{attrs:{"card-style":{width:"auto",marginRight:"80px",marginLeft:"80px"},loading:e.loading,title:"配置审批流","show-cancel":!1,"show-confirm":!1},on:{close:function(t){e.configShow=!1}}},[i("wk-approve-flow",{ref:"wkApproveFlow",attrs:{props:e.configFlowProps,list:e.configFlowList,"send-node":e.sendNode}})],1):e._e()],2):e._e()},v=[],b=i("2909"),g=i("c7eb"),y=i("1da1"),x=i("5530"),w=(i("14d9"),i("caad"),i("2532"),i("4d90"),i("25f0"),i("159b"),i("4de4"),i("b0c0"),i("99af"),i("a15b"),i("d81d"),i("a434"),i("b775"));function _(e){return Object(w["a"])({url:"/examineSuperExamine/examine/record/list",method:"post",data:e,headers:{"Content-Type":"application/x-www-form-urlencoded"}})}function C(e){return Object(w["a"])({url:"/examineRecord/forwardOthers",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function k(e){return Object(w["a"])({url:"/examineRecord/solicitOthers",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function L(e){return Object(w["a"])({url:"/examineSuperExamines/useExamineEmailSend",method:"post",data:e,headers:{"Content-Type":"application/x-www-form-urlencoded"}})}function S(e){return Object(w["a"])({url:"/oaSuperExamine/actionExamine",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function N(e){return Object(w["a"])({url:"/examineSuperExamines/set/node/optional",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function T(e){return Object(w["a"])({url:"/oaExamineField/queryUserField/".concat(e.categoryId),method:"post",data:e})}function O(e){return Object(w["a"])({url:"/jxcField/queryUserField/".concat(e.label),method:"post",data:e})}function I(e){return Object(w["a"])({url:"examineRecord/auditExamine",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function E(e){return Object(w["a"])({url:"examineRecord/adminAuditExamine",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function F(e){return Object(w["a"])({url:"/examineSuperExamine/examine/end",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function j(e){return Object(w["a"])({url:"examines/queryExamineFlow",method:"post",data:e})}function D(e){return Object(w["a"])({url:"examineRecord/queryRecordLog",method:"post",data:e})}function $(e){return Object(w["a"])({url:"examineRecord/adminQueryExamineFlow",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function U(e){return Object(w["a"])({url:"examineRecord/queryAuthField",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function A(e){return Object(w["a"])({url:"examineRecord/queryExamineUpdateLog",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function V(e){return Object(w["a"])({url:"examineSuperExamines/useExamineEmailTokenForAuditExamine",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"},customConfig:{removeToken:!0}})}var P=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{ref:"wkDialog",attrs:{title:e.title,"append-to-body":!0,"close-on-click-modal":!1,visible:e.showDialog,width:"600px"},on:{"update:visible":function(t){e.showDialog=t},close:e.hiddenView}},[e.tips?i("div",{staticClass:"title-tips"},[e._v(e._s(e.tips))]):e._e(),e._v(" "),e.config.setBackNodeShow?i("el-form",{ref:"form",attrs:{"label-position":"top",model:e.form}},[i("el-form-item",{staticClass:"wk-form-item",attrs:{label:e.backNodeLabel}},[i("el-select",{model:{value:e.form.flowId,callback:function(t){e.$set(e.form,"flowId",t)},expression:"form.flowId"}},e._l(e.nodeList,(function(e){return i("el-option",{key:e.flowId,attrs:{label:e.name,value:e.flowId}})})))],1)],1):e._e(),e._v(" "),i("el-input",{attrs:{rows:8,maxlength:200,placeholder:e.placeholder,type:"textarea",resize:"none","show-word-limit":""},model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}}),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.handleClick("confirm")}}},[e._v("确定")]),e._v(" "),i("el-button",{attrs:{disabled:e.loading},on:{click:function(t){e.handleClick("cancel")}}},[e._v("取消")])],1)],1)},R=[],H={watch:{loading:function(e){if(e){var t=this.$refs.wkDialog.$refs.dialog;this.loadingInstance=this.$loading({target:t})}else this.loadingInstance&&this.loadingInstance.close()}}},B=i("2f62"),W=i("8ed6"),M={setBackNodeShow:!1},q={name:"ExamineHandle",components:{},mixins:[H],props:{show:{type:Boolean,default:!1},status:{type:[String,Number],default:1},id:[String,Number],recordId:[String,Number],examineType:{type:String,default:""},flowId:{type:[String,Number],default:""},props:Object,getPostFields:Function},data:function(){return{loading:!1,showDialog:!1,nodeList:[],form:{flowId:"",content:""}}},computed:Object(x["a"])(Object(x["a"])({},Object(B["c"])(["userInfo"])),{},{config:function(){return Object(W["a"])(Object(x["a"])({},M),this.props||{})},statusType:function(){return{isSuccess:1==this.status,isReject:2==this.status,isWithdraw:4==this.status,isTermination:13==this.status,isArchive:14==this.status,isInvalid:8==this.status,isSkip:18==this.status,isRecovery:19==this.status}},title:function(){return this.statusType.isSuccess?"审批通过":this.statusType.isReject?"审批拒绝":this.statusType.isWithdraw?"撤回审批":this.statusType.isTermination?"审批终止":this.statusType.isArchive?"归档":this.statusType.isInvalid?"作废":this.statusType.isSkip?"跳过":this.statusType.isRecovery?"恢复":""},tips:function(){return this.statusType.isSkip?"由流程管理员和超级管理员操作。跳过至哪一节点，则此节点之前的节点自动通过，在此节点继续审批流程。":this.statusType.isRecovery?"由流程管理员和超级管理员操作。恢复至哪一节点，从哪一节点开始重新审批，如果恢复至发起人节点，则发起人可以编辑数据重新发起审批。":""},isSuperAuth:function(){return this.statusType.isSkip||this.statusType.isRecovery},placeholder:function(){return this.statusType.isSuccess?"请输入审批意见（选填）":this.statusType.isReject?"请输入审批意见（必填）":this.statusType.isWithdraw?"请输入撤回理由（必填）":this.statusType.isTermination?"请输入终止理由（必填）":this.statusType.isArchive?"请输入归档意见（选填）":this.statusType.isInvalid?"请输入作废意见（选填）":this.statusType.isSkip?"请输入跳过理由（必填）":this.statusType.isRecovery?"请输入恢复理由（必填）":""},backNodeLabel:function(){return this.statusType.isReject?"驳回至哪一节点":this.statusType.isSkip?"跳过至哪一节点":this.statusType.isRecovery?"恢复至哪一节点":""}}),watch:{show:{handler:function(e){this.showDialog=e,e&&this.config.setBackNodeShow&&this.getNodeList()},deep:!0,immediate:!0}},methods:{getNodeList:function(){var e=this,t=null;this.statusType.isSkip?t=$:(this.statusType.isRecovery||this.statusType.isReject)&&(t=D),t({recordId:this.recordId}).then((function(t){e.nodeList=t.data,e.nodeList&&e.nodeList.length>0&&e.$nextTick((function(){e.form.flowId=e.nodeList[0].flowId}))})).catch((function(){}))},submitInfo:function(){var e=this;return Object(y["a"])(Object(g["a"])().mark((function t(){var i,n;return Object(g["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!(e.statusType.isReject||e.statusType.isWithdraw||e.statusType.isTermination||e.statusType.isSkip||e.statusType.isRecovery)||e.form.content){t.next=4;break}e.$message.error(e.placeholder),t.next=25;break;case 4:if(!e.$listeners.confirm){t.next=8;break}e.$emit("confirm",e.form.content),t.next=25;break;case 8:if(e.loading=!0,i=null,n=null,e.statusType.isTermination?(n=F,i={recordId:e.recordId,flowId:e.flowId,status:e.status,remarks:e.form.content,examineUserId:e.userInfo.userId}):(n=e.isSuperAuth?E:I,i={typeId:e.id,recordId:e.recordId,status:e.status,remarks:e.form.content}),e.config.setBackNodeShow&&(i.flowId=e.form.flowId),!e.getPostFields){t.next=24;break}return t.prev=14,t.next=17,e.getPostFields();case 17:i.flowFieldUpdateLogs=t.sent,t.next=24;break;case 20:return t.prev=20,t.t0=t["catch"](14),e.loading=!1,t.abrupt("return");case 24:n(i).then((function(t){e.loading=!1,e.$message.success("操作成功"),"crm_contract"!=e.examineType&&"crm_invoice"!=e.examineType&&"crm_receivables"!=e.examineType||e.$store.dispatch("GetMessageNum"),e.resetInfo(),e.$emit("save",{type:e.status}),e.hiddenView()})).catch((function(){e.loading=!1}));case 25:case"end":return t.stop()}}),t,null,[[14,20]])})))()},handleClick:function(e){if("cancel"==e)this.hiddenView(),this.resetInfo();else if("confirm"==e)if("batch_audit"===this.examineType){if(this.statusType.isReject&&!this.form.content)return void this.$message.error(this.placeholder);this.$emit("save",{examineType:"batch_audit",content:this.form.content})}else{if(!this.recordId&&"link"==this.$route.name){var t=(this.statusType.isReject||this.statusType.isWithdraw||this.statusType.isTermination)&&!this.form.content;return void this.$emit("emailExamine",this.form.content,t)}this.submitInfo()}},hiddenView:function(){this.$emit("close")},resetInfo:function(){this.form.content="",this.form.flowId=""}}},z=q,X=(i("be40"),Object(m["a"])(z,P,R,!1,null,"c7d86d7e",null)),J=X.exports,G=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"},{name:"empty",rawName:"v-empty",value:e.list,expression:"list"}],attrs:{"xs-empty-icon":"none","xs-empty-text":"暂无记录"}},[i("flexbox",{staticClass:"flow-head"},[i("div",{staticClass:"flow-head-name"},[e._v("审批流程")]),e._v(" "),i("i",{staticClass:"el-icon-close flow-head-close",on:{click:e.close}})]),e._v(" "),i("div",{staticClass:"flow-body"},e._l(e.list,(function(t,n){return i("flexbox",{key:n,staticClass:"cf-flow-item",attrs:{align:"stretch",justify:"flex-start"}},[i("i",{staticClass:"cf-flow-item-img",class:[11,17].includes(t.examineStatus)?"wk wk-icon-success":e.getStatusIcon(t.examineStatus),style:{color:[11,17].includes(t.examineStatus)?"#00875A":e.getStatusColor(t.examineStatus)}}),e._v(" "),i("div",[i("flexbox",{staticClass:"cf-flow-item-head"},[i("div",[e._v(e._s(t.examineTime))])]),e._v(" "),i("flexbox",{staticClass:"cf-flow-item-info"},[i("div",{staticClass:"cf-flow-item-name"},[e._v(e._s(e.getLogUserName(t)))]),e._v(" "),11!=t.examineStatus&&17!=t.examineStatus&&12!=t.examineStatus?i("div",[i("span",[e._v(e._s(e.getLogContent(t)))])]):11==t.examineStatus?i("div",[i("span",[e._v("已转审")])]):17==t.examineStatus?i("div",[i("span",[e._v("已委托")])]):12==t.examineStatus?i("div",[i("span",[e._v("已征求他人意见")])]):e._e()]),e._v(" "),t.remarks?i("div",{staticClass:"cf-flow-item-content"},[e._v(e._s(t.remarks)+"\n          "),i("div",{staticClass:"cf-flow-item-content-arrow"})]):e._e()],1),e._v(" "),i("div",{staticClass:"cf-flow-item-line"})])})))],1)},K=[],Q={methods:{getStatusColor:function(e){return 0==e?"#FF991F":1==e?"#00875A":2==e?"#DE350B":3==e?"#FF991F":4==e?"#5E6C84":5==e?"#FF991F":6==e||8==e?"#5E6C84":10==e?"#0052CC":11==e?"#FF991F":12==e?"#00875A":13==e||14==e||16==e||18==e||19==e?"#5E6C84":void 0},getStatusName:function(e){return 0==e?"待审核":1==e?"通过":2==e?"拒绝":3==e?"审核中":4==e?"撤回":5==e?"未提交":6==e?"发起":8==e?"已作废":10==e?"正常":11==e?"审核中":13==e?"终止":14==e?"归档":15==e?"抄送":16==e?"已作废":18==e?"跳过":19==e?"恢复":""},getStatusIcon:function(e){return 0==e?"wk wk-icon-invalid":1==e?"wk wk-icon-success":2==e?"wk wk-icon-refuse":3==e?"wk wk-icon-in-review":4==e?"wk wk-icon-withdraw":5==e?"wk wk-icon-uncommitted":6==e?"wk wk-icon-create":8==e?"wk wk-icon-invalid":10==e?"wk wk-icon-normal":11==e?"wk wk-icon-in-review":12==e?"wk wk-icon-success":13==e||14==e?"wk wk-icon-invalid":15==e?"wk wk-source-line":16==e?"wk wk-icon-invalid":18==e?"wk wk-d-arrow-right":19==e?"wk wk-icon-reset2":""}}},Y={name:"CheckFlow",components:{},filters:{},mixins:[Q],props:{examineType:{type:String,default:""},id:[String,Number],typeId:[String,Number],show:Boolean},data:function(){return{loading:!1,list:[]}},computed:{},watch:{show:function(e){e&&(this.list=[],this.getDetail())}},mounted:function(){},methods:{getDetail:function(){var e=this,t=this.$route,i=t.name,n=t.query;this.id?(this.loading=!0,crmExamineRecordLogListAPI({recordId:this.id,typeId:this.typeId}).then((function(t){e.loading=!1,e.list=t.data})).catch((function(){e.loading=!1}))):"link"===i&&n.k&&(this.loading=!0,examineSuperExaminesUseExamineEmailTokenForExamineRecordLogAPI({emailToken:n.k}).then((function(t){e.loading=!1,e.list=t.data})).catch((function(){e.loading=!1})))},getLogUserName:function(e){return e.examineUserName},getLogContent:function(e){return 16!=e.examineStatus?this.getStatusName(e.examineStatus)+"此申请":""},close:function(){this.$emit("close")}}},Z=Y,ee=(i("9bad"),Object(m["a"])(Z,G,K,!1,null,"3ead2078",null)),te=ee.exports,ie=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"wk-head-section wrap",class:{"is-no-border":!e.config.border}},[i("div",{staticClass:"section-head",class:{"is-unfold":e.unfold},style:{"background-color":e.config.headBgColor},on:{click:function(t){e.unfold=!e.unfold}}},["left"===e.config.arrows?i("i",{staticClass:"el-icon-arrow-down"}):e._e(),e._v(" "),i("div",{staticClass:"section-title text-one-line"},[e._v(e._s(e.label))]),e._v(" "),e._t("otherLabel"),e._v(" "),i("div",{staticClass:"section-right"},[e._t("right"),e._v(" "),"right"===e.config.arrows?i("i",{staticClass:"el-icon-arrow-down"}):e._e()],2)],2),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:e.unfold,expression:"unfold"}],staticClass:"section-body",style:{padding:e.config.bodyPadding}},[e._t("default")],2)])},ne=[],ae={headBgColor:"transparent",arrows:"right",border:!0,bodyPadding:"16px"},se={name:"WkHeadSection",components:{},props:{props:Object,label:[String,Number]},data:function(){return{unfold:!0}},computed:{config:function(){return Object(W["a"])(Object(x["a"])({},ae),this.props||{})}},watch:{},created:function(){},mounted:function(){},beforeDestroy:function(){},methods:{}},oe=se,le=(i("a2d1"),Object(m["a"])(oe,ie,ne,!1,null,"9b6264e8",null)),re=le.exports,ce=i("2581"),de=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"container"},[i("el-dialog",{attrs:{title:"征求他人意见",visible:e.value,"append-to-body":!0,"close-on-click-modal":!1,"before-close":e.close,width:"40%"},on:{"update:visible":function(t){e.value=t}}},[i("el-form",{ref:"form",staticClass:"examine-node-form",attrs:{model:e.solicitOthersForm,"label-position":"top"}},[i("el-form-item",{attrs:{label:"意见审批人",rules:{required:!0}}},[i("flexbox",{staticClass:"user-wrap",attrs:{wrap:"wrap"}},[e._l(e.solicitOthersForm.userList,(function(t,n){return i("div",{key:n,staticClass:"user"},[i("xr-avatar",{attrs:{name:e.$getUserName(t)||t.email,size:40,src:t.img}}),e._v(" "),i("div",{staticClass:"user__name"},[e._v(e._s(e.$getUserName(t)||t.email))]),e._v(" "),i("i",{staticClass:"user__delete el-icon-close",on:{click:function(t){e.deleteUserClick(n,e.solicitOthersForm.userList)}}})],1)})),e._v(" "),0===e.solicitOthersForm.userList.length||e.solicitOthersForm.userList.length<20?i("div",{staticClass:"user"},[i("span",{staticClass:"el-dropdown-link"},[i("el-button",{staticClass:"user__img",staticStyle:{"margin-bottom":"8px"},attrs:{icon:"el-icon-plus",circle:""},on:{click:function(t){e.addingMode(e.solicitOthersForm,"selectUser")}}}),e._v(" "),i("div",{staticClass:"user__name"},[e._v("选择员工")])],1)]):e._e()],2)],1),e._v(" "),i("el-form-item",{attrs:{label:"审批方式",prop:"examineType",rules:{required:!0,message:"请选择审批方式",trigger:"blur"}}},[i("el-radio",{staticClass:"radio",attrs:{label:"1"},model:{value:e.solicitOthersForm.examineType,callback:function(t){e.$set(e.solicitOthersForm,"examineType",t)},expression:"solicitOthersForm.examineType"}},[e._v("\n          在我之前\n          "),i("span",[e._v("流程先经过意见审批人，再由我审批")])]),e._v(" "),i("el-radio",{staticClass:"radio",attrs:{label:"2"},model:{value:e.solicitOthersForm.examineType,callback:function(t){e.$set(e.solicitOthersForm,"examineType",t)},expression:"solicitOthersForm.examineType"}},[e._v("\n          在我之后\n          "),i("span",[e._v("在我之后审批，即表示我同意该申请并增加审批人员")])])],1),e._v(" "),e.solicitOthersForm.userList.length>1?i("el-form-item",{attrs:{label:"多人审批方式",prop:"moreExamineType",rules:{required:!0,message:"请选择审批方式",trigger:"blur"}}},[i("el-radio",{attrs:{label:"1"},model:{value:e.solicitOthersForm.moreExamineType,callback:function(t){e.$set(e.solicitOthersForm,"moreExamineType",t)},expression:"solicitOthersForm.moreExamineType"}},[e._v("依次审批")]),e._v(" "),i("el-radio",{attrs:{label:"2"},model:{value:e.solicitOthersForm.moreExamineType,callback:function(t){e.$set(e.solicitOthersForm,"moreExamineType",t)},expression:"solicitOthersForm.moreExamineType"}},[e._v("会签")]),e._v(" "),i("el-radio",{attrs:{label:"3"},model:{value:e.solicitOthersForm.moreExamineType,callback:function(t){e.$set(e.solicitOthersForm,"moreExamineType",t)},expression:"solicitOthersForm.moreExamineType"}},[e._v("或签")])],1):e._e(),e._v(" "),i("el-form-item",{attrs:{label:"审证求意见说明"}},[i("wk-textarea",{attrs:{rows:3,autosize:{minRows:3},maxlength:200,placeholder:"请输入加签意见",resize:"none",type:"textarea"},model:{value:e.solicitOthersForm.remark,callback:function(t){e.$set(e.solicitOthersForm,"remark",t)},expression:"solicitOthersForm.remark"}})],1)],1),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:e.close}},[e._v("取消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.handlerClick}},[e._v("确定")])],1)],1),e._v(" "),e.depUserViewDialogShow?i("wk-dep-user-dialog",{attrs:{props:{showUser:!0,showDept:!1,showDisableUser:!1,disableUserLabel:"员工"},radio:"",visible:e.depUserViewDialogShow},on:{"update:visible":function(t){e.depUserViewDialogShow=t},change:e.selectUserChange}}):e._e(),e._v(" "),e.externalDialogShow?i("el-dialog",{attrs:{visible:e.externalDialogShow,"close-on-click-modal":!1,"append-to-body":!0,title:"外部联系人",width:"30%"},on:{"update:visible":function(t){e.externalDialogShow=t}}},[i("span",[e._v("请输入外部联系人邮箱")]),e._v(" "),i("el-input",{staticStyle:{"margin-top":"10px"},model:{value:e.email,callback:function(t){e.email=t},expression:"email"}}),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.externalDialogShow=!1}}},[e._v("取消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.verifyEmail}},[e._v("确定")])],1)],1):e._e()],1)},ue=[],me=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"wk-textarea"},[i("el-input",e._b({on:{input:e.valueChange},model:{value:e.dataValue,callback:function(t){e.dataValue=t},expression:"dataValue"}},"el-input",e.$attrs,!1)),e._v(" "),i("el-popover",{attrs:{title:e.title,placement:"bottom",width:"600",trigger:"click"}},[i("el-input",e._b({attrs:{autosize:{minRows:12}},on:{input:e.valueChange},model:{value:e.dataValue,callback:function(t){e.dataValue=t},expression:"dataValue"}},"el-input",e.$attrs,!1)),e._v(" "),i("i",{staticClass:"zoom el-icon-full-screen",attrs:{slot:"reference"},slot:"reference"})],1)],1)},pe=[],he=i("d010"),fe=i.n(he),ve={name:"WkTextarea",components:{},mixins:[fe.a],props:{value:[String,Number],title:String,rows:Number},data:function(){return{dataValue:""}},computed:{},watch:{value:{handler:function(e,t){this.validValue()},immediate:!0}},created:function(){},mounted:function(){},beforeDestroy:function(){},methods:{validValue:function(){this.dataValue=this.value},valueChange:function(){this.$emit("input",this.dataValue),this.$emit("change",this.dataValue),this.dispatch("ElFormItem","el.form.change",this.dataValue)}}},be=ve,ge=(i("4a7a"),Object(m["a"])(be,me,pe,!1,null,"0d761012",null)),ye=ge.exports,xe=i("ed08"),we={name:"SolicitOthers",components:{WkDepUserDialog:ce["a"],WkTextarea:ye},props:{value:{type:Boolean,default:!1}},data:function(){return{solicitOthersForm:{userList:[],examineType:"1"},depUserViewDialogShow:!1,externalDialogShow:!1,email:""}},watch:{value:function(e){e&&(this.solicitOthersForm.userList=[])}},methods:{handlerClick:function(){var e=this;this.$refs.form.validate((function(t){if(t&&e.solicitOthersForm.userList.length){var i=[];e.solicitOthersForm.userList.forEach((function(e){i.push({userId:e.userId,email:e.email})}));var n={insertFlag:e.solicitOthersForm.examineType,remark:e.solicitOthersForm.remark||"",userList:i};e.solicitOthersForm.moreExamineType&&(n.type=e.solicitOthersForm.moreExamineType),e.$emit("submitParams",n),e.close()}else e.$message.error("请完善基本信息")}))},deleteUserClick:function(e,t){t.splice(e,1)},selectUserChange:function(e,t,i){if(i.length){var n=this.solicitOthersForm.userList.map((function(e){return e.userId}));n.includes(i[0].userId)||this.solicitOthersForm.userList.push(i[0])}},addingMode:function(e,t){"selectUser"==t?this.depUserViewDialogShow=!0:"external"==t&&(this.externalDialogShow=!0,this.email=null)},verifyEmail:function(){if(Object(xe["t"])(this.email)){var e=this.solicitOthersForm.userList.map((function(e){return e.email}));e.includes(this.email)?this.$message.error("请勿重复添加"):(this.solicitOthersForm.userList.push({email:this.email}),this.externalDialogShow=!1)}else this.$message.error("邮箱格式有误")},close:function(){this.$emit("input",!1)}}},_e=we,Ce=(i("b4d1"),Object(m["a"])(_e,de,ue,!1,null,"17580c66",null)),ke=Ce.exports,Le=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"examine-btn-bar",style:!e.examineMoreHandle.length||e.isStageFlow?"justify-content: start;":""},[1==e.examineInfo.isCheck?i("el-button",{attrs:{type:"success",icon:"wk wk-success"},on:{click:function(t){e.examineHandle(1)}}},[e._v("通过")]):e._e(),e._v(" "),1==e.examineInfo.isCheck?i("el-button",{style:!e.examineMoreHandle.length||e.isStageFlow?"margin-left: 10px;":"",attrs:{type:"danger",icon:"wk wk-close"},on:{click:function(t){e.examineHandle(2)}}},[e._v("拒绝")]):e._e(),e._v(" "),e.isOptionalNode?i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.examineHandle("selectExamineUser")}}},[e._v(e._s(e.isOptionalNode.addBtnName))]):e._e(),e._v(" "),!e.isOptionalNode&&e.superHandleShow?i("el-button",{staticStyle:{"margin-left":"auto"},attrs:{type:"primary"},on:{click:function(t){e.examineHandle(19)}}},[e._v("恢复")]):e._e(),e._v(" "),e.examineMoreHandle.length&&!e.isOptionalNode?i("el-dropdown",{staticClass:"more-handle",style:e.isStageFlow?"margin-left: 10px;":"",on:{command:e.moreHandler}},[i("el-button",[e._v("更多操作")]),e._v(" "),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.examineMoreHandle,(function(t,n){return i("el-dropdown-item",{key:n,attrs:{command:t.value},on:{click:function(e){e.stopPropagation()}}},["forwardOthers"==t.value?[e.isStageFlow?i("span",{on:{click:function(t){t.stopPropagation(),e.moreHandler("selectUser")}}},[e._v("转他人处理")]):i("el-dropdown",{staticClass:"more-handle",on:{command:e.moreHandler}},[i("div",[e._v("转他人处理")]),e._v(" "),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",{attrs:{command:"selectUser"}},[e._v("选择员工")])],1)],1)]:[e._v("\n          "+e._s(t.label)+"\n        ")]],2)})))],1):e._e()],1)},Se=[],Ne={name:"ExamineBtnBar",props:{examineInfo:Object,examineMoreHandle:Array,isOptionalNode:Object,isStageFlow:Boolean,superHandleShow:Boolean},methods:{examineHandle:function(e){this.$emit("examineHandle",e)},moreHandler:function(e){this.$emit("moreHandler",e)}}},Te=Ne,Oe=(i("53bd"),Object(m["a"])(Te,Le,Se,!1,null,"213368ca",null)),Ie=Oe.exports,Ee=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{ref:"wkDialog",attrs:{title:"查看节点编辑信息",visible:e.visible,"append-to-body":!0,"close-on-click-modal":!1,width:"600px"},on:{close:e.close}},[i("div",{directives:[{name:"empty",rawName:"v-empty",value:e.list,expression:"list"}],staticClass:"rc-cont"},e._l(e.list,(function(t,n){return i("flexbox",{key:n,staticClass:"ha-cont",attrs:{align:"stretch",justify:"flex-start"}},[i("div",{staticClass:"ha-week"},[e._v(e._s(e._f("filterTimestampToFormatTime")(t.createTime,"MM-DD dddd")))]),e._v(" "),i("div",{staticClass:"ha-circle"}),e._v(" "),i("div",{staticClass:"ha-time"},[e._v(e._s(e._f("filterTimestampToFormatTime")(t.createTime,"HH:mm")))]),e._v(" "),i("xr-avatar",{staticClass:"ha-img",attrs:{id:t.createUserId,name:e.$getUserName(t),size:32,src:t.img,disabled:!1}}),e._v(" "),i("div",{staticClass:"ha-name"},[e._v(e._s(e.$getUserName(t)))]),e._v(" "),i("div",{staticClass:"ha-content"},e._l(t.content,(function(t,n){return i("p",{key:n},[e._v(e._s(t))])}))),e._v(" "),i("div",{staticClass:"ha-line"})],1)})))])},Fe=[],je={name:"ExamineEditDataDetail",mixins:[H],props:{visible:{type:Boolean,required:!0,default:!1},id:[String,Number],examineInfo:{type:Object,default:function(){return{}}},itemData:Object},data:function(){return{loading:!1,list:[]}},computed:{},mounted:function(){this.getDetail()},methods:{getDetail:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.loading=t,A({typeId:this.id,label:this.examineInfo.label,examineId:this.examineInfo.examineAdvancedConfigVO.examineId,flowId:this.itemData.flowId}).then((function(t){e.loading=!1,e.list=t.data.map((function(e){return e.createTime=new Date(e.createTime).getTime(),e}))})).catch((function(){e.loading=!1}))},close:function(){this.$emit("update:visible",!1)}}},De=je,$e=(i("01c9"),Object(m["a"])(De,Ee,Fe,!1,null,"03ee1adb",null)),Ue=$e.exports,Ae=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"add-node-btn"},[e.showAdd?i("el-popover",{attrs:{"visible-arrow":!1,placement:"right",trigger:"click","popper-class":"no-padding-popover"},model:{value:e.popoverShow,callback:function(t){e.popoverShow=t},expression:"popoverShow"}},[i("div",{staticClass:"add-node-approve"},[e.WkApproveFlow.config.examineAddShow?i("div",{staticClass:"add-node-approve-btn",on:{click:function(t){e.selectClick("approve")}}},[i("i",{staticClass:"wk wk-associate is-orange"}),e._v("审批人\n      ")]):e._e(),e._v(" "),e.WkApproveFlow.config.conditionAddShow?i("div",{staticClass:"add-node-approve-btn",on:{click:function(t){e.selectClick("condition")}}},[i("i",{staticClass:"wk wk-approve is-green"}),e._v("条件分支\n      ")]):e._e(),e._v(" "),e.WkApproveFlow.config.copyAddShow?i("div",{staticClass:"add-node-approve-btn",on:{click:function(t){e.selectClick("copy")}}},[i("i",{staticClass:"wk wk-source-line"}),e._v("抄送节点\n      ")]):e._e(),e._v(" "),e.WkApproveFlow.eventObj.copy?i("div",{staticClass:"add-node-approve-btn",on:{click:function(t){e.selectClick("paste")}}},[i("i",{staticClass:"wk wk-icon-transfer2"}),e._v("粘贴\n      ")]):e._e()]),e._v(" "),i("el-button",{attrs:{slot:"reference",type:"primary",icon:"el-icon-plus",circle:""},slot:"reference"})],1):e._e()],1)},Ve=[],Pe={name:"AddNodeBtn",components:{},inject:["WkApproveFlow"],props:{},data:function(){return{popoverShow:!1}},computed:{showAdd:function(){return this.WkApproveFlow.config.examineAddShow||this.WkApproveFlow.config.conditionAddShow||this.WkApproveFlow.config.copyAddShow}},watch:{},created:function(){},mounted:function(){},beforeDestroy:function(){},methods:{selectClick:function(e){this.popoverShow=!1,this.$emit("command",e)}}},Re=Pe,He=Object(m["a"])(Re,Ae,Ve,!1,null,null,null),Be=He.exports,We=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"condition-node"},[i("div",{staticClass:"condition-node-wrap"},[i("div",{staticClass:"condition-wrap",class:{"is-error":e.node.isError,"is-disabled":e.disabled},on:{click:e.click}},[i("div",{staticClass:"header"},[e.isEdit?i("el-input",{ref:"wkFlowInput",attrs:{type:"text",size:"mini",maxlength:"20"},on:{blur:e.nameInputBlur},model:{value:e.node.conditionName,callback:function(t){e.$set(e.node,"conditionName",t)},expression:"node.conditionName"}}):i("span",{staticClass:"title",on:{click:function(t){return t.stopPropagation(),e.titleEditClick(t)}}},[e._v(e._s(e.node.conditionName))]),e._v(" "),i("span",{staticClass:"priority"},[e._v("优先级"+e._s(e.index+1))]),e._v(" "),e.disabled?e._e():i("i",{staticClass:"wk wk-copy",on:{click:function(t){return t.stopPropagation(),e.copyClick(t)}}}),e._v(" "),e.disabled?e._e():i("i",{staticClass:"el-icon-close close",on:{click:function(t){return t.stopPropagation(),e.deleteClick(t)}}})],1),e._v(" "),i("div",{staticClass:"content"},[e.node.conditionDataList&&e.node.conditionDataList.length>0?[e._v("\n          "+e._s(e.getConditonContent())+"\n        ")]:[e._v("\n          无条件\n        ")]],2),e._v(" "),e.modal?i("div",{staticClass:"wk-flow-modal"}):e._e()]),e._v(" "),i("add-node-btn",{on:{command:e.handleCommand}})],1)])},Me=[],qe=(i("3c65"),{examineType:1,name:"审批人",conditionList:[],deptList:[],parentLevel:1,tempParentLevel:1,roleIdList:[],type:1,userList:[],memberUserList:[],chooseType:1,overType:1,rangeType:1,isError:!1}),ze={examineType:7,name:"抄送节点",conditionList:[],parentLevelList:[],isSelf:0,isAdd:0,roleIdList:[],userList:[],isError:!1},Xe={examineType:0,name:"",conditionList:[{conditionName:"条件",conditionDataList:[],examineDataList:[],isError:!1},{conditionName:"条件",conditionDataList:[],examineDataList:[],isError:!1}]},Je={conditionName:"条件",conditionDataList:[],examineDataList:[],isError:!1},Ge=[{label:"属于",value:7}],Ke=[{label:"完全等于",value:11},{label:"包含任意",value:7}],Qe=[{label:"小于",value:3},{label:"大于",value:2},{label:"小于等于",value:5},{label:"等于",value:1},{label:"大于等于",value:4},{label:"介于(两个数之间)",value:6}],Ye=[{label:"<",value:1},{label:"≤",value:2}];function Ze(e){var t={};return e.forEach((function(e){t[e.value]=e.label})),t}function et(e){return{name:"发起人",conditionType:8,userList:[],deptList:[],roleList:[],values:{userList:[],deptList:[],roleList:[]},checked:e}}var tt=i("6bfe"),it={name:"WkConditionNode",components:{AddNodeBtn:Be},inject:["WkApproveFlow"],props:{index:Number,disabled:{type:Boolean,default:!1},modal:{type:Boolean,default:!1},parent:Array,conditionParent:Array,node:{type:Object,default:function(){return{}}}},data:function(){return{selectOptionsObj:Ze(Ge),checkboxOptionsObj:Ze(Ke),numberOptionsObj:Ze(Qe),numberValueOptionsObj:Ze(Ye),isEdit:!1}},computed:{},watch:{},created:function(){},mounted:function(){},beforeDestroy:function(){},methods:{nameInputBlur:function(){this.isEdit=!1,""===this.node.conditionName&&(this.node.conditionName="条件")},titleEditClick:function(){var e=this;this.disabled||(this.isEdit=!0,this.$nextTick((function(){e.$refs.wkFlowInput.focus()})))},deleteClick:function(){this.$emit("delete")},handleCommand:function(e){if("approve"===e)this.parent.splice(0,0,Object(xe["s"])(qe));else if("condition"===e){var t=this.parent.splice(0),i=Object(xe["s"])(Xe);i.conditionList[1].examineDataList=t,this.parent.push(i)}else if("copy"===e)this.parent.splice(this.index+1,0,Object(xe["s"])(ze));else if("paste"===e){var n,a=Object(xe["s"])(Object(xe["s"])((null===(n=this.WkApproveFlow.eventObj.copy)||void 0===n?void 0:n.node)||qe));a.name="".concat(a.name,"（复制）"),this.parent.unshift(a)}},copyClick:function(){var e=Object(xe["s"])(this.node);e.conditionName="".concat(e.conditionName,"（复制）"),this.conditionParent.splice(this.index+1,0,e)},click:function(){this.disabled||this.$emit("node-click",this.$props)},getConditonContent:function(){var e=this,t=this.node.conditionDataList;return t.map((function(t){return e.getSectionConditionDes(t)})).join(" 或 ")},getSectionConditionDes:function(e){var t=this;return Array.isArray(e)?e.map((function(e){if(3===e.type){var i=e.values;if(e.setting){var n=[];e.setting.forEach((function(t){void 0!=t.value&&e.values.includes(t.value)&&n.push(t.label)})),n.length>0&&(i=n)}return"".concat(e.name," ").concat(t.selectOptionsObj[e.conditionType]," ").concat(i.join("或"))}return 9===e.type?"".concat(e.name," ").concat(t.checkboxOptionsObj[e.conditionType]," ").concat(e.values.join("、")):6===e.conditionType?"".concat(Object(tt["c"])(e.leftValue)?"":e.leftValue," ").concat(t.numberValueOptionsObj[e.leftCondition]," ").concat(e.name," ").concat(t.numberValueOptionsObj[e.rightCondition]," ").concat(Object(tt["c"])(e.rightValue)?"":e.rightValue):8===e.conditionType?"".concat(e.name,"属于 ").concat(e.deptList.map((function(e){return $getDeptName(e)})).join("或")).concat(e.deptList.length>0&&e.userList.length>0?"或":"").concat(e.userList.map((function(e){return $getUserName(e)})).join("或")).concat(e.userList.length>0&&e.roleList.length>0?"或":"").concat(e.roleList.map((function(e){return e.roleName})).join("或")):"".concat(e.name," ").concat(t.numberOptionsObj[e.conditionType]," ").concat(e.values)})).join(" 并且 "):""}}},nt=it,at=Object(m["a"])(nt,We,Me,!1,null,"2066fbc5",null),st=at.exports,ot=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"wk-conditon-node"},[i("div",{staticClass:"wk-conditon-node-wrap"},[i("div",{staticClass:"conditon-wrap-body",class:{"hide-condition-add":!e.WkApproveFlow.config.conditionAddShow}},[e.WkApproveFlow.config.conditionAddShow?i("el-button",{staticClass:"add-btn",attrs:{plain:""},on:{click:e.addClick}},[e._v("添加条件")]):e._e(),e._v(" "),e._l(e.node.conditionList,(function(t,n){return i("div",{key:n,staticClass:"condition"},[0===n?[i("div",{staticClass:"cover-line is-top-left"}),e._v(" "),i("div",{staticClass:"cover-line is-bottom-left"})]:e._e(),e._v(" "),n===e.node.conditionList.length-1?[i("div",{staticClass:"cover-line is-top-right"}),e._v(" "),i("div",{staticClass:"cover-line is-bottom-right"})]:e._e(),e._v(" "),i("wk-condition-node",{attrs:{index:n,parent:t.examineDataList,"condition-parent":e.node.conditionList,node:t,disabled:t.disabled,modal:t.modal},on:{delete:function(t){e.conditionDelete(n)},"node-click":e.nodeClick}}),e._v(" "),t.examineDataList&&t.examineDataList.length>0?[e._l(t.examineDataList,(function(n,a){return[0===n.examineType?i("wk-condition-wrap",{key:a,attrs:{level:e.level+1,index:a,node:n,parent:t.examineDataList}}):i("wk-node",{key:a,attrs:{index:a,node:n,disabled:n.disabled,modal:n.modal,"header-color":e.getHeaderStyle(n).bgColor,"header-icon":e.getHeaderStyle(n).icon,parent:t.examineDataList},on:{"node-click":e.nodeClick,"on-handle":e.nodeHandleClick}})]}))]:e._e()],2)}))],2),e._v(" "),i("div",{staticClass:"add-node-btn-wrap"},[i("add-node-btn",{on:{command:e.handleCommand}})],1)])])},lt=[],rt=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"wk-node"},[i("div",{staticClass:"wk-node-wrap",class:{"is-first":!e.visibleArrow,"is-error":e.node.isError,"is-disabled":e.disabled},on:{click:e.click}},[i("div",{staticClass:"header",style:{backgroundColor:e.headerColor}},[i("i",{staticClass:"icon",class:e.headerIcon}),e._v(" "),e.isEdit?i("el-input",{ref:"wkFlowInput",attrs:{type:"text",size:"mini"},on:{blur:function(t){e.isEdit=!1}},model:{value:e.node.name,callback:function(t){e.$set(e.node,"name",t)},expression:"node.name"}}):i("span",{staticClass:"title",on:{click:function(t){return t.stopPropagation(),e.titleEditClick(t)}}},[e._v(e._s(e.node.name))]),e._v(" "),e.disabled?e._e():i("i",{staticClass:"wk wk-copy",on:{click:function(t){return t.stopPropagation(),e.copyClick(t)}}}),e._v(" "),e.disabled?e._e():i("i",{staticClass:"el-icon-close close",on:{click:function(t){return t.stopPropagation(),e.deleteClick(t)}}})],1),e._v(" "),i("div",{staticClass:"body"},[e.showCustomContent?i("div",{staticClass:"content"},[e._v(e._s(e.node.content))]):i("div",{staticClass:"content"},[e._v(e._s(e.getContent()))]),e._v(" "),e.disabled?e._e():i("i",{staticClass:"el-icon-arrow-right"})]),e._v(" "),e.modal?i("div",{staticClass:"wk-flow-modal"}):e._e()]),e._v(" "),i("div",{staticClass:"add-node-btn-wrap"},[i("add-node-btn",{on:{command:e.handleCommand}})],1)])},ct=[],dt={1:"指定成员",2:"上级",3:"角色",4:"发起人自选",5:"连续多级上级"},ut={1:"依次审批",2:"会签",3:"或签"},mt={name:"WkNode",components:{AddNodeBtn:Be},mixins:[],inject:["memberControlFun","WkApproveFlow"],props:{visibleArrow:{type:Boolean,default:!0},index:Number,disabled:{type:Boolean,default:!1},modal:{type:Boolean,default:!1},headerColor:{type:String,default:"#FF991F"},headerIcon:String,parent:Array,showCustomContent:{type:Boolean,default:!1},node:{type:Object,default:function(){return{}}}},data:function(){return{isEdit:!1,examineTypeObj:dt,sendLevelObj:{},topLevelObj:{},levelObj:{}}},computed:{memberControlList:function(){return this.memberControlFun()}},watch:{},created:function(){for(var e=1;e<=20;e++){var t="第".concat(e,"级上级");this.levelObj[e]=t,1===e?(this.sendLevelObj[e]="直属上级",this.topLevelObj[e]="最高级上级"):(this.sendLevelObj[e]=t,this.topLevelObj[e]=t)}},mounted:function(){},beforeDestroy:function(){},methods:{titleEditClick:function(){var e=this;this.disabled||(this.isEdit=!0,this.$nextTick((function(){e.$refs.wkFlowInput.focus()})))},deleteClick:function(){this.parent.splice(this.index,1)},handleCommand:function(e){if("approve"===e)this.parent.splice(this.index+1,0,Object(xe["s"])(qe));else if("condition"===e){var t=this.parent.splice(this.index+1),i=Object(xe["s"])(Xe);i.conditionList[1].examineDataList=t,this.parent.push(i)}else if("copy"===e)this.parent.splice(this.index+1,0,Object(xe["s"])(ze));else if("paste"===e){var n,a=Object(xe["s"])(Object(xe["s"])((null===(n=this.WkApproveFlow.eventObj.copy)||void 0===n?void 0:n.node)||qe));a.name="".concat(a.name,"（复制）"),this.parent.splice(this.index+1,0,a)}},getContent:function(){var e=this.node,t=e.examineType,i=e.type,n=e.userList,a=e.memberUserList,s=e.parentLevel,o=e.parentLevelList,l=e.roleIdList,r=e.roleList,c=void 0===r?[]:r,d=e.overType,u=e.tempParentLevel,m=e.isAdd,p=e.isSelf,h=e.fieldName,f=e.parentLevelCheck,v=void 0!==f&&f,b=dt[t];if(1===t)return 1===(null===a||void 0===a?void 0:a.length)?"".concat(b," 1人"):(null===a||void 0===a?void 0:a.length)>1?"".concat(null===a||void 0===a?void 0:a.length,"人").concat(ut[i]):"请选择审批人";if(2===t)return"".concat(this.sendLevelObj[s]);if(3===t)return l&&l.length>0?"".concat(c.map((function(e){return e.roleName})).join("，")).concat(ut[i]):"请选择审批人";if(4===t)return l&&l.length>0?"发起人从".concat(c.map((function(e){return e.roleName})).join("，"),"中自选"):b;if(5===t)return 1===i?!l&&l.length>0?"请选择审批人":0===d?"从 直属上级 到 ".concat(c.map((function(e){return e.roleName})).join("，")):1===d?"从 直属上级 到 发起人向上的".concat(this.levelObj[s]):"":"从 直属上级 到 组织架构中由上至下的".concat(this.topLevelObj[u]);if(7===t){var g="";return n.length&&(g+="指定抄送人".concat(n.length,"人")),l&&l.length&&(g+=g?" 指定角色：":"指定角色：",c.forEach((function(e,t){g+="".concat(e.roleName).concat(t===l.length-1?"":"，")}))),o&&o.length&&(g+=g?" 指定上级：":"指定上级：",o.forEach((function(e,t){g+="".concat(1===e?"直属上级":"第".concat(e,"级上级")).concat(t===o.length-1?"":"，")}))),m&&(g+=g?" 发起人自选":"发起人自选"),p&&(g+=g?" 抄送给发起人自己":"抄送给发起人自己"),g||"请选择抄送人"}if(8===t){var y="",x="";return h&&(x=this.memberControlList.filter((function(e){return e.fieldName==h}))[0].name,y+=x),v&&(y+=1===s?"直属上级":"第".concat(s,"级上级")),1!=i&&(y+=ut[i]),y||"请选择审批人"}return""},click:function(){this.disabled||this.$emit("node-click",this.$props)},copyClick:function(){this.$emit("on-handle",Object(x["a"])({eventName:"copy"},this.$props))}}},pt=mt,ht=Object(m["a"])(pt,rt,ct,!1,null,"54714b6a",null),ft=ht.exports,vt={name:"WkConditionWrap",components:{AddNodeBtn:Be,WkNode:ft,WkConditionNode:st},inject:["WkApproveFlow"],props:{level:{type:Number,default:0},index:Number,parent:Array,node:{type:Object,default:function(){return{}}}},data:function(){return{tree:null}},computed:{wrapAddHide:function(){return this.parent.length===this.index+1&&1===this.node.conditionList.length}},watch:{},created:function(){"WkConditionWrap"===this.$parent.$options.name?this.tree=this.$parent.tree:this.tree=this},mounted:function(){},beforeDestroy:function(){},methods:{addClick:function(){this.node.conditionList.push(Object(xe["s"])(Je))},conditionDelete:function(e){if(this.node.conditionList.length>2)this.node.conditionList.splice(e,1);else{var t,i=0==e?1:0;(t=this.parent).splice.apply(t,[this.index,1].concat(Object(b["a"])(this.node.conditionList[i].examineDataList)))}},handleCommand:function(e){if("approve"===e)this.parent.splice(this.index+1,0,Object(xe["s"])(qe));else if("condition"===e){var t=this.parent.splice(this.index+1),i=Object(xe["s"])(Xe);i.conditionList[1].examineDataList=t,this.parent.push(i)}else if("copy"===e)this.parent.splice(this.index+1,0,Object(xe["s"])(ze));else if("paste"===e){var n,a=Object(xe["s"])(Object(xe["s"])((null===(n=this.WkApproveFlow.eventObj.copy)||void 0===n?void 0:n.node)||qe));a.name="".concat(a.name,"（复制）"),this.parent.splice(this.index+1,0,a)}},nodeClick:function(e){this.tree.$emit("node-click",e)},nodeHandleClick:function(e){this.tree.$emit("on-handle",e)},getHeaderStyle:function(e){var t={bgColor:"#0052cc",icon:""};return e.examineType>=1&&e.examineType<=5?(t.bgColor="#FF991F",t.icon="wk wk-approve-line"):7===e.examineType&&(t.bgColor="#6B778C",t.icon="wk wk-source-line"),t}}},bt=vt,gt=(i("835e"),Object(m["a"])(bt,ot,lt,!1,null,null,null)),yt=gt.exports,xt=function(){var e=this,t=e.$createElement;e._self._c;return e._m(0)},wt=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"wk-end-node"},[i("div",{staticClass:"circle"}),e._v(" "),i("div",{staticClass:"text"},[e._v("流程结束")])])}],_t={name:"WkEndNode",components:{},props:{},data:function(){return{}},computed:{},watch:{},created:function(){},mounted:function(){},beforeDestroy:function(){},methods:{}},Ct=_t,kt=Object(m["a"])(Ct,xt,wt,!1,null,"100619a6",null),Lt=kt.exports,St=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"wk-approve-flow-wrap"},[i("el-button-group",[i("el-button",{staticClass:"group-btn",attrs:{disabled:e.scale<=.5,icon:"el-icon-minus"},on:{click:function(t){e.scaleClick("minus")}}}),e._v(" "),i("el-button",{staticClass:"group-btn",attrs:{disabled:e.scale>3,icon:"el-icon-plus"},on:{click:function(t){e.scaleClick("plus")}}})],1),e._v(" "),i("div",{staticClass:"wk-approve-flow",style:{transform:"scale("+e.scale+")"}},[e.sendNode?i("wk-node",{attrs:{"visible-arrow":!1,"show-custom-content":"",node:e.sendNode,parent:e.list,disabled:"","header-color":"#0052cc","header-icon":"wk wk-visit-contract"}}):e._e(),e._v(" "),e._l(e.list,(function(t,n){return[0===t.examineType?i("wk-condition-wrap",{key:n,attrs:{index:n,node:t,parent:e.list},on:{"node-click":e.nodeClick,"on-handle":e.nodeHandleClick}}):i("wk-node",{key:n,attrs:{index:n,parent:e.list,node:t,disabled:t.disabled,modal:t.modal,"header-color":e.getHeaderStyle(t).bgColor,"header-icon":e.getHeaderStyle(t).icon},on:{"node-click":e.nodeClick,"on-handle":e.nodeHandleClick}})]})),e._v(" "),i("wk-end-node"),e._v(" "),i("wk-condition-set",{attrs:{visible:e.conditionSetVisible,node:e.editNode,"condition-parent":e.conditionParent,"condition-parent-index":e.conditionParentIndex,props:e.config},on:{"update:visible":function(t){e.conditionSetVisible=t}}}),e._v(" "),i("wk-node-set",{attrs:{visible:e.nodeSetVisible,node:e.editNode,props:e.config},on:{"update:visible":function(t){e.nodeSetVisible=t}}}),e._v(" "),i("WkCopyNodeSet",{attrs:{visible:e.copyNodeSetVisible,node:e.editNode,props:e.config},on:{"update:visible":function(t){e.copyNodeSetVisible=t}}})],2)],1)},Nt=[],Tt=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-drawer",{attrs:{visible:e.visible,"with-header":!1,size:"500px",title:"我是标题","append-to-body":""},on:{close:e.close}},[e.editNode?i("flexbox",{staticClass:"drawer-header"},[i("div",{staticClass:"edit-title"},[e.isNameEdit?i("el-input",{ref:"conditionNameInput",attrs:{maxlength:"20"},on:{blur:e.nameInputBlur},model:{value:e.editNode.conditionName,callback:function(t){e.$set(e.editNode,"conditionName",t)},expression:"editNode.conditionName"}}):[i("span",{staticClass:"title",on:{click:e.titleEditClick}},[e._v(e._s(e.editNode.conditionName))]),e._v(" "),i("i",{staticClass:"wk wk-edit",on:{click:e.titleEditClick}})]],2),e._v(" "),i("el-popover",{attrs:{placement:"bottom",width:"200",trigger:"click"}},[i("draggable",{attrs:{options:{group:"list",forceFallback:!1,fallbackClass:"draggingStyle",filter:"drag-item__label",preventOnFilter:!1}},model:{value:e.dragList,callback:function(t){e.dragList=t},expression:"dragList"}},e._l(e.dragList,(function(t,n){return i("flexbox",{key:n,staticClass:"drag-item"},[i("div",{staticClass:"drag-item__label"},[e._v(e._s(t.conditionName))]),e._v(" "),i("div",{staticClass:"drag-item__handle"},[e._v("⋮⋮")])])}))),e._v(" "),i("el-button",{attrs:{slot:"reference",type:"text"},slot:"reference"},[e._v("优先级设置")])],1),e._v(" "),i("i",{staticClass:"wk wk-icon-fill-help wk-help-tips",attrs:{"data-type":"26","data-id":"236"}}),e._v(" "),i("i",{staticClass:"el-icon-close ",on:{click:e.close}})],1):e._e(),e._v(" "),e.editNode?i("div",{staticClass:"drawer-body"},e._l(e.editNode.conditionDataList,(function(t,n){return i("div",{key:n},[i("div",{staticClass:"section"},[i("div",{staticClass:"section-header"},[i("span",{staticClass:"sh-title"},[e._v("条件组")]),e._v(" "),e.editNode.conditionDataList.length>1?i("el-button",{attrs:{type:"primary-text"},on:{click:function(t){e.deleteSection(n)}}},[e._v("删除")]):e._e()],1),e._v(" "),e._l(t,(function(t,a){return i("el-row",{key:a,staticClass:"set-row",attrs:{gutter:20,type:"flex",align:"middle"}},[i("el-col",{staticClass:"set-row__title",attrs:{span:5}},[e._v(e._s(t.name))]),e._v(" "),i("el-col",{staticClass:"set-row__center",attrs:{span:17}},[8===t.conditionType?i("flexbox",[i("div",{staticStyle:{flex:"1"}},[i("wk-user-dep-dialog-select",{staticStyle:{width:"100%"},attrs:{"user-value":t.values.userList,"dep-value":t.values.deptList,placeholder:"请选择员工或部门"},on:{"update:userValue":function(i){e.$set(t.values,"userList",i)},"update:depValue":function(i){e.$set(t.values,"deptList",i)},change:function(i){e.userDepSelectChange(arguments,t)}}}),e._v(" "),i("role-employee-select",{ref:"roleSelect",refInFor:!0,staticStyle:{width:"100%","margin-top":"8px"},attrs:{props:{onlyShowRole:!0},multiple:"",placeholder:"请选择角色","collapse-tags":"",clearable:""},on:{change:function(i){e.roleSelectChange(t,n)}},model:{value:t.values.roleList,callback:function(i){e.$set(t.values,"roleList",i)},expression:"item.values.roleList"}})],1),e._v(" "),i("div",{staticStyle:{"flex-shrink":"0","margin-left":"8px"}},[e._v("或")])]):[9,3].includes(t.type)?[3==t.type?i("el-select",{staticClass:"condition-select",model:{value:t.conditionType,callback:function(i){e.$set(t,"conditionType",i)},expression:"item.conditionType"}},e._l(e.selectOptions,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))):9==t.type?i("el-select",{staticClass:"condition-select",model:{value:t.conditionType,callback:function(i){e.$set(t,"conditionType",i)},expression:"item.conditionType"}},e._l(e.checkboxOptions,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))):e._e(),e._v(" "),i("el-select",{staticClass:"condition-value",attrs:{multiple:""},model:{value:t.values,callback:function(i){e.$set(t,"values",i)},expression:"item.values"}},e._l(t.setting,(function(e,t){return i("el-option",{key:t,attrs:{label:void 0!==e.value?e.label:e,value:void 0!==e.value?e.value:e}})})))]:[i("el-select",{class:["condition-select",{"is-block":6===t.conditionType}],model:{value:t.conditionType,callback:function(i){e.$set(t,"conditionType",i)},expression:"item.conditionType"}},e._l(e.numberOptions,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))),e._v(" "),6===t.conditionType?[i("div",{staticStyle:{"margin-top":"10px"}},[i("el-input-number",{staticClass:"small",attrs:{controls:!1},model:{value:t.leftValue,callback:function(i){e.$set(t,"leftValue",i)},expression:"item.leftValue"}}),e._v(" "),i("el-select",{staticClass:"small is-condition",model:{value:t.leftCondition,callback:function(i){e.$set(t,"leftCondition",i)},expression:"item.leftCondition"}},e._l(e.numberValueOptions,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))),e._v(" "),i("span",{staticClass:"small-select-label"},[e._v(e._s(t.name))]),e._v(" "),i("el-select",{staticClass:"small is-condition",model:{value:t.rightCondition,callback:function(i){e.$set(t,"rightCondition",i)},expression:"item.rightCondition"}},e._l(e.numberValueOptions,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))),e._v(" "),i("el-input-number",{staticClass:"small",attrs:{controls:!1},model:{value:t.rightValue,callback:function(i){e.$set(t,"rightValue",i)},expression:"item.rightValue"}})],1)]:i("el-input-number",{staticClass:"condition-value",attrs:{controls:!1},model:{value:t.values,callback:function(i){e.$set(t,"values",i)},expression:"item.values"}})]],2),e._v(" "),i("el-col",{staticClass:"set-row__footer",attrs:{span:1}},[i("i",{staticClass:"wk wk-delete",on:{click:function(t){e.deleteItem(n,a)}}})])],1)})),e._v(" "),i("div",[i("el-button",{attrs:{type:"text",icon:"el-icon-plus"},on:{click:function(t){e.conditionSelectClick(n)}}},[e._v("添加条件")]),e._v(" "),i("i",{staticClass:"wk wk-icon-fill-help wk-help-tips",attrs:{"data-type":"26","data-id":"237"}})],1)],2),e._v(" "),e.editNode.conditionDataList.length-1>n?i("div",{staticClass:"section-and"},[e._v("或")]):i("div",{staticClass:"section-footer"},[e.editNode.conditionDataList.length<4?i("el-button",{attrs:{icon:"el-icon-plus",type:"primary"},on:{click:function(t){e.addSection()}}},[e._v("添加条件组")]):e._e()],1)])}))):e._e(),e._v(" "),i("div",{staticClass:"drawer-footer"},[i("el-button",{directives:[{name:"debounce",rawName:"v-debounce",value:e.handleConfirm,expression:"handleConfirm"}],attrs:{type:"primary"}},[e._v("保存")]),e._v(" "),i("el-button",{nativeOn:{click:function(t){return e.close(t)}}},[e._v("取消")])],1),e._v(" "),i("wk-condition-select",{attrs:{props:e.props,checks:e.editNode&&null!==e.addSectionIndex?e.editNode.conditionDataList[e.addSectionIndex]:[],visible:e.conditionSelectVisible},on:{"update:visible":function(t){e.conditionSelectVisible=t},confirm:e.conditionSelectConfirm}})],1)},Ot=[],It=(i("7db0"),i("fb6a"),function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{attrs:{visible:e.visible,"append-to-body":!0,"close-on-click-modal":!1,title:"选择条件",width:"600px","custom-class":"no-padding-dialog"},on:{close:e.handleCancel}},[i("div",{staticStyle:{padding:"20px"}},[i("div",[e._v("请选择用来区分审批流程的条件字段 ")]),e._v(" "),i("div",{staticStyle:{"margin-top":"10px"}},e._l(e.list,(function(t,n){return i("el-checkbox",{key:n,attrs:{label:t.name},model:{value:t.checked,callback:function(i){e.$set(t,"checked",i)},expression:"item.checked"}})})))]),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{directives:[{name:"debounce",rawName:"v-debounce",value:e.handleConfirm,expression:"handleConfirm"}],attrs:{type:"primary"}},[e._v("确定")]),e._v(" "),i("el-button",{nativeOn:{click:function(t){return e.handleCancel(t)}}},[e._v("取消")])],1)])}),Et=[],Ft={name:"WkConditionSelect",components:{},inheritAttrs:!1,props:{visible:{type:Boolean,required:!0,default:!1},checks:Array,props:{type:Object,default:function(){return{}}}},data:function(){return{list:[]}},computed:{},watch:{visible:function(e){e&&this.getList()}},methods:{handleConfirm:function(){this.$emit("confirm",this.list.filter((function(e){return e.checked}))),this.handleCancel()},getList:function(){var e=this,t=this.props,i=t.conditionSelectRequest,n=t.conditionSelectParams,a=t.conditionSelectList;a?this.handleList(Object(xe["s"])(a)):i(n).then((function(t){var i=t.data||[];e.handleList(i)})).catch((function(){}))},handleList:function(e){var t=this,i=[],n=null;this.checks&&this.checks.forEach((function(e){8===e.conditionType?n=e:i.push(e.fieldName||e.name)}));var a=[];e.forEach((function(e,n){i.includes(e.fieldName||e.name)?(a.push(n),t.$set(e,"checked",!0)):t.$set(e,"checked",!1)})),a.forEach((function(i){var n=e[i],a=t.checks.find((function(e){return e.fieldName===n.fieldName||e.name===n.name}));t.$set(a,"checked",!0),e.splice(i,1,a)})),n?(this.$set(n,"checked",!0),e.splice(0,0,n),this.list=e):(e.splice(0,0,Object(xe["s"])(et(!1))),this.list=e)},handleCancel:function(){this.$emit("update:visible",!1)}}},jt=Ft,Dt=Object(m["a"])(jt,It,Et,!1,null,"412745e0",null),$t=Dt.exports,Ut=i("b76a"),At=i.n(Ut),Vt=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("wk-tags-view",{staticClass:"wk-user-dep-dialog-select",attrs:{selected:e.selected,visible:e.visible,disabled:e.disabled,placeholder:e.placeholder,"collapse-tags":e.collapseTags,"value-key":["nickname","realname","name"]},on:{"remove-tag":e.removeTag},nativeOn:{click:function(t){return e.click(t)}}},[i("wk-dep-user-dialog",e._b({ref:"depUserDialog",attrs:{"user-value":e.selectUserValue,"dep-value":e.selectDepValue,"sub-dept-contain":e.selectSubDeptContain,props:e.props,visible:e.visible,radio:e.radio,disabled:e.disabled},on:{"update:visible":function(t){e.visible=t},change:e.depUserDialogChange}},"wk-dep-user-dialog",e.$attrs,!1))],1)},Pt=[],Rt=i("58fa"),Ht={value:"deptId",label:"name"},Bt={name:"WkUserDepDialogSelect",components:{WkDepUserDialog:ce["a"],WkTagsView:Rt["a"]},mixins:[fe.a],props:{radio:Boolean,userValue:{type:Array,default:function(){return[]}},depValue:{type:Array,default:function(){return[]}},subDeptContain:[Number,Boolean],placeholder:{type:String,default:function(){return"请选择"}},collapseTags:Boolean,disabled:{type:Boolean,default:!1},props:{type:Object,default:function(){return{showDisableUser:!1}}}},data:function(){return{visible:!1,selectUserValue:[],selectDepValue:[],selectSubDeptContain:!1,dataValue:[]}},computed:Object(x["a"])(Object(x["a"])({},Object(B["c"])(["userDeptMap"])),{},{userSelectData:function(){var e=this,t=[];return this.selectUserValue.forEach((function(i){var n=e.userDeptMap["user-".concat(i)];n&&t.push(n)})),t},deptSelectData:function(){var e=this,t=[];return this.selectDepValue.forEach((function(i){var n=e.userDeptMap["dept-".concat(i)];n&&t.push(n)})),t},selected:function(){return this.userSelectData.concat(this.deptSelectData)},config:function(){return Object(W["a"])(Object(x["a"])({},Ht),this.props||{})}}),watch:{userValue:{handler:function(){this.selectUserValue=Object(xe["s"])(this.userValue)},immediate:!0},depValue:{handler:function(){this.selectDepValue=Object(xe["s"])(this.depValue)},immediate:!0},subDeptContain:{handler:function(){this.selectSubDeptContain=this.subDeptContain},immediate:!0}},created:function(){},mounted:function(){},beforeDestroy:function(){},methods:{removeTag:function(e){e<this.selectUserValue.length?this.selectUserValue.splice(e,1):this.selectDepValue.splice(e-this.selectUserValue.length,1),this.depUserDialogChange(this.selectUserValue,this.selectDepValue)},depUserDialogChange:function(e,t,i,n,a){var s=this;this.selectUserValue=e,this.selectDepValue=t,this.selectSubDeptContain=a,this.$emit("update:userValue",this.selectUserValue),this.$emit("update:depValue",this.selectDepValue),this.$emit("update:subDeptContain",this.selectSubDeptContain),this.$nextTick((function(){s.dispatch("ElFormItem","el.form.change",e.concat(t)),s.$emit("change",e,t,s.userSelectData,s.deptSelectData,s.selectSubDeptContain)}))},click:function(){this.disabled||(this.visible=!0)}}},Wt=Bt,Mt=Object(m["a"])(Wt,Vt,Pt,!1,null,"224c1725",null),qt=Mt.exports,zt=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-select",e._g(e._b({ref:"select",staticClass:"role-employee-select",on:{"visible-change":e.selectVisibleChange,change:e.selectChange},model:{value:e.selectValue,callback:function(t){e.selectValue=t},expression:"selectValue"}},"el-select",e.$attrs,!1),e.$listeners),[i("div",{staticClass:"role-employee-select__body"},[i("el-tabs",{ref:"roleTabs",class:{"el-tabs__header--hidden":e.config.onlyShowRole},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[i("el-tab-pane",{ref:"roleTabPane",attrs:{label:"自选角色",name:"role"}},e._l(e.roleOption,(function(t){return i("div",{key:t.parentId,attrs:{label:t.name}},[i("div",{staticClass:"role-employee-select__title"},[e._v(e._s(t.name))]),e._v(" "),e._l(t.list,(function(e){return i("el-option",{key:e.roleId,staticStyle:{padding:"0 10px"},attrs:{label:e.roleName,value:e.roleId}})}))],2)}))),e._v(" "),i("el-tab-pane",{attrs:{label:"按员工复制角色",name:"employee"}},[i("el-input",{staticClass:"search-input",attrs:{placeholder:"搜索成员",size:"small","prefix-icon":"el-icon-search"},on:{input:e.userSearch},model:{value:e.searchInput,callback:function(t){e.searchInput=t},expression:"searchInput"}}),e._v(" "),e._l(e.userOption,(function(t){return i("el-option",{directives:[{name:"show",rawName:"v-show",value:!t.isHide,expression:"!item.isHide"}],key:t.userId,staticStyle:{padding:"0 10px"},attrs:{label:t.realname,value:t.userId+"@"+t.roleId}},[i("flexbox",{staticClass:"cell"},[i("xr-avatar",{staticClass:"cell__img",attrs:{name:t.realname,size:24,src:t.img}}),e._v(" "),i("div",{staticClass:"cell__body"},[e._v(e._s(t.realname))]),e._v(" "),i("el-tooltip",{attrs:{content:t.roleName,effect:"dark",placement:"top"}},[i("div",{staticClass:"cell__footer text-one-line"},[e._v(e._s(t.roleName))])])],1)],1)}))],2)],1)],1)])},Xt=[];i("466d"),i("b64b");function Jt(e){return Object(w["a"])({url:"adminRole/getAllRoleList",method:"post",data:e})}var Gt=i("2934"),Kt=i("8122"),Qt=i("d22a"),Yt={onlyShowRole:!1,roleRequest:null},Zt={name:"RoleEmployeeSelect",components:{},props:{props:{type:Object,default:function(){return{}}},value:[Array,Number,String]},data:function(){return{selectValue:[],activeName:"",roleOption:[],userOption:[],searchInput:""}},computed:{config:function(){return Object(W["a"])(Object(x["a"])({},Yt),this.props||{})},select:function(){return this.$refs.select}},watch:{value:{handler:function(){Object(Kt["valueEquals"])(this.value,this.selectValue)||(this.selectValue=this.value)},immediate:!0}},created:function(){this.getRoleList(),this.getUserList()},mounted:function(){},beforeDestroy:function(){},methods:{selectVisibleChange:function(e){""!==this.activeName&&"0"!==this.activeName||(this.activeName="role")},getRoleList:function(){var e=this,t=this.config.roleRequest||Jt;t().then((function(t){e.roleOption=t.data||[]})).catch((function(){}))},getUserList:function(){var e=this;Object(Gt["i"])({pageType:0}).then((function(t){e.userOption=t.data.list||[]})).catch((function(){}))},selectChange:function(){this.$emit("input",this.selectValue)},userSearch:function(){var e=this;this.userOption.forEach((function(t){t.isHide=!!e.searchInput&&!Qt["a"].match(t.realname,e.searchInput)}))}}},ei=Zt,ti=(i("278b"),i("3ea7"),Object(m["a"])(ei,zt,Xt,!1,null,"60fbfdca",null)),ii=ti.exports,ni={name:"WkConditionSet",components:{WkConditionSelect:$t,Draggable:At.a,WkUserDepDialogSelect:qt,RoleEmployeeSelect:ii},props:{visible:{type:Boolean,required:!0,default:!1},node:{type:Object,default:function(){return{}}},conditionParent:Array,conditionParentIndex:Number,props:{type:Object,default:function(){return{}}}},data:function(){return{editNode:null,isNameEdit:!1,selectOptions:Ge,checkboxOptions:Ke,numberOptions:Qe,numberValueOptions:Ye,addSectionIndex:null,conditionSelectVisible:!1,dragList:[]}},computed:{},watch:{visible:function(e){var t=this;if(e){var i=Object(xe["s"])(this.conditionParent);this.editNode=i[this.conditionParentIndex],0===this.editNode.conditionDataList.length?this.editNode.conditionDataList.push([et(!0)]):this.validateSetting(this.editNode.conditionDataList),i.forEach((function(e,t){e.index=t})),this.dragList=i}else{var n=Object(xe["s"])(this.conditionParent);this.conditionParent.splice(0,this.conditionParent.length),this.dragList.forEach((function(e){t.conditionParent.push(n[e.index])})),this.editNode=null}}},created:function(){},mounted:function(){},beforeDestroy:function(){},methods:{validateSetting:function(e){var t=this,i=[];if(e.forEach((function(e){3!==e.type&&9!==e.type||e.setting||i.push(e)})),i&&i.length>0){var n=this.props,a=n.conditionSelectRequest,s=n.conditionSelectParams,o=n.conditionSelectList;if(o){var l=Object(xe["s"])(o);i.forEach((function(e){var i=l.find((function(t){return t.fieldName===e.fieldName}));i&&t.$set(e,"setting",i.setting)}))}else a(s).then((function(e){var n=e.data||[];i.forEach((function(e){var i=n.find((function(t){return t.fieldName===e.fieldName}));i&&t.$set(e,"setting",i.setting)}))})).catch((function(){}))}},nameInputBlur:function(){this.isNameEdit=!1,""===this.editNode.conditionName&&(this.editNode.conditionName="条件")},titleEditClick:function(){var e=this;this.isNameEdit=!0,this.$nextTick((function(){e.$refs.conditionNameInput.focus()}))},close:function(){this.$emit("update:visible",!1)},handleConfirm:function(){var e=this,t=this.editNode.conditionDataList||[],i=[];for(var n in t.forEach((function(t){var n=e.getValidCondition(t);n.length>0&&i.push(n)})),this.editNode.conditionDataList=i.length>4?i.slice(0,4):i,this.editNode.isError=!1,this.editNode)"examineDataList"!==n&&(this.node[n]=this.editNode[n]);this.close()},getValidCondition:function(e){return e.filter((function(e){return 3===e.type||9===e.type?e.values&&e.values.length>0:6===e.conditionType?!Object(tt["c"])(e.leftValue)&&!Object(tt["c"])(e.rightValue)&&e.leftValue<e.rightValue:8===e.conditionType?!Object(tt["c"])(e.userList)||!Object(tt["c"])(e.deptList)||!Object(tt["c"])(e.roleList):!Object(tt["c"])(e.values)}))},conditionSelectClick:function(e){this.addSectionIndex=e,this.conditionSelectVisible=!0},deleteItem:function(e,t){var i=this;this.$confirm("确定删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){i.editNode.conditionDataList[e].splice(t,1)})).catch((function(){}))},deleteSection:function(e){var t=this;this.$confirm("确定删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.editNode.conditionDataList.splice(e,1)})).catch((function(){}))},addSection:function(){this.editNode.conditionDataList.length<5&&this.editNode.conditionDataList.push([et(!0)])},conditionSelectConfirm:function(e){e.forEach((function(e){e.conditionType||(3===e.type||9===e.type?(e.conditionType=3===e.type?7:11,e.values=[]):5!==e.type&&6!==e.type||(e.conditionType=3,e.values=0,e.leftValue=0,e.leftCondition=1,e.rightCondition=1,e.rightValue=0))})),this.$set(this.editNode.conditionDataList,this.addSectionIndex,Object(xe["s"])(e))},userDepSelectChange:function(e,t){var i=e[2],n=e[3];t.userList=i,t.deptList=n},roleSelectChange:function(e,t){var i=this;this.$nextTick((function(){var n=i.$refs.roleSelect[t].select.selected;e.roleList=n.map((function(e){return{roleName:e.$props.label}}))}))}}},ai=ni,si=(i("db54"),Object(m["a"])(ai,Tt,Ot,!1,null,"9560d374",null)),oi=si.exports,li=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-drawer",{attrs:{visible:e.visible,"with-header":!1,size:"500px","append-to-body":""},on:{close:e.close}},[e.editNode?i("flexbox",{staticClass:"drawer-header"},[i("div",{staticClass:"edit-title"},[e.isNameEdit?i("el-input",{attrs:{maxlength:"20"},on:{blur:e.nameInputBlur},model:{value:e.editNode.name,callback:function(t){e.$set(e.editNode,"name",t)},expression:"editNode.name"}}):[i("span",{staticClass:"title",on:{click:function(t){e.isNameEdit=!0}}},[e._v(e._s(e.editNode.name))]),e._v(" "),i("i",{staticClass:"wk wk-edit",on:{click:function(t){e.isNameEdit=!0}}})]],2),e._v(" "),i("i",{staticClass:"el-icon-close ",on:{click:e.close}})]):e._e(),e._v(" "),e.tabsShow?i("el-tabs",{on:{"tab-click":e.activeTabClick},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},e._l(e.tabs,(function(e,t){return i("el-tab-pane",{key:t,attrs:{label:e.label,name:e.name}})}))):e._e(),e._v(" "),"base"===e.activeTab&&e.editNode?i("div",{staticClass:"drawer-body",class:{"is-tab":e.tabsShow}},[i("div",{staticClass:"section"},[i("el-radio-group",{on:{change:e.examineTypeChange},model:{value:e.editNode.examineType,callback:function(t){e.$set(e.editNode,"examineType",t)},expression:"editNode.examineType"}},e._l(e.examineTypeOptions,(function(t,n){return i("el-radio",{key:n,staticClass:"el-radio--type",attrs:{label:t.value}},[e._v(e._s(t.label))])}))),e._v(" "),1===e.editNode.examineType?i("div",{staticClass:"area-top"},[i("div",{staticClass:"section-handle"},[i("el-dropdown",{staticClass:"more-handle",on:{command:e.addCommandClick}},[i("el-button",{attrs:{type:"primary"}},[e._v("添加")]),e._v(" "),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",{attrs:{command:"selectUser"}},[e._v("选择员工")]),e._v(" "),e.props.examineNodeProps.addExternalUserShow?i("el-dropdown-item",{attrs:{command:"external"}},[e._v("选择外部联系人")]):e._e()],1)],1),e._v(" "),i("span",{staticClass:"text-des"},[e._v("不能超过20人")])],1),e._v(" "),i("div",{staticClass:"user-list-wrap"},e._l(e.editNode.memberUserList,(function(t,n){return i("el-tag",{key:n,staticClass:"user-item",attrs:{size:"medium","disable-transitions":"",closable:"",type:"info"},on:{close:function(t){e.typeUserDelete(n)}}},[e._v("\n            "+e._s(t.userId?e.$getUserName(t):t.outerUserEmail)+"\n          ")])})))]):e._e(),e._v(" "),2===e.editNode.examineType?i("div",{staticClass:"area-top"},[i("div",{staticClass:"section-handle"},[i("span",[e._v("发起人的")]),e._v(" "),i("el-select",{model:{value:e.editNode.parentLevel,callback:function(t){e.$set(e.editNode,"parentLevel",t)},expression:"editNode.parentLevel"}},e._l(e.sendLevelOption,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})))],1),e._v(" "),i("div",{staticClass:"area-top wk-checkbox"},[i("el-checkbox",{attrs:{"true-label":1,"false-label":0},model:{value:e.editNode.type,callback:function(t){e.$set(e.editNode,"type",t)},expression:"editNode.type"}}),e._v(" "),i("span",{staticClass:"wk-checkbox__label"},[e._v("找不到主管时，由上级主管代审批")])],1)]):e._e(),e._v(" "),3===e.editNode.examineType?i("div",{staticClass:"area-top"},[i("role-employee-select",{ref:"roleSelect",staticStyle:{width:"400px"},attrs:{multiple:"",props:{onlyShowRole:!0},clearable:""},on:{change:e.roleSelectChange},model:{value:e.editNode.roleIdList,callback:function(t){e.$set(e.editNode,"roleIdList",t)},expression:"editNode.roleIdList"}})],1):e._e(),e._v(" "),4===e.editNode.examineType?i("div",{staticClass:"area-top"},[i("div",{staticClass:"section-handle"},[i("el-select",{model:{value:e.editNode.chooseType,callback:function(t){e.$set(e.editNode,"chooseType",t)},expression:"editNode.chooseType"}},[i("el-option",{attrs:{value:1,label:"自选一人"}}),e._v(" "),i("el-option",{attrs:{value:2,label:"自选多人"}})],1)],1),e._v(" "),i("div",{staticClass:"area-top"},[i("div",{staticClass:"section__title"},[e._v("选择范围")]),e._v(" "),i("div",{staticClass:"area-top"},[i("el-select",{on:{change:e.rangeTypeChange},model:{value:e.editNode.rangeType,callback:function(t){e.$set(e.editNode,"rangeType",t)},expression:"editNode.rangeType"}},[i("el-option",{attrs:{value:1,label:"全公司"}}),e._v(" "),i("el-option",{attrs:{value:2,label:"指定成员"}}),e._v(" "),i("el-option",{attrs:{value:3,label:"指定角色"}})],1),e._v(" "),2===e.editNode.rangeType?[i("el-button",{attrs:{type:"primary"},on:{click:function(t){e.depUserViewDialogShow=!0}}},[e._v("添加员工")])]:e._e(),e._v(" "),3===e.editNode.rangeType?i("role-employee-select",{ref:"roleSelect",attrs:{multiple:"",props:{onlyShowRole:!0},clearable:""},on:{change:e.roleSelectChange},model:{value:e.editNode.roleIdList,callback:function(t){e.$set(e.editNode,"roleIdList",t)},expression:"editNode.roleIdList"}}):e._e()],2),e._v(" "),2===e.editNode.rangeType&&e.editNode.userList.length>0?i("div",{staticClass:"user-list-wrap",staticStyle:{"margin-top":"8px"}},e._l(e.editNode.userList,(function(t,n){return i("el-tag",{key:n,staticClass:"user-item",attrs:{size:"medium","disable-transitions":"",closable:"",type:"info"},on:{close:function(t){e.userDelete(n)}}},[e._v("\n              "+e._s(e.$getUserName(t))+"\n            ")])}))):e._e()])]):e._e(),e._v(" "),5===e.editNode.examineType?i("div",{staticClass:"area-top"},[i("div",{staticClass:"section__title"},[e._v("审批终点")]),e._v(" "),i("el-radio-group",{staticClass:"el-radio-group--block",on:{change:e.endTypeChange},model:{value:e.editNode.type,callback:function(t){e.$set(e.editNode,"type",t)},expression:"editNode.type"}},[i("el-radio",{staticClass:"el-radio--block",attrs:{label:1}},[i("div",[e._v("指定角色（连续多级上级须包含该角色）"),i("role-employee-select",{ref:"roleSelect",attrs:{props:{onlyShowRole:!0},multiple:"",clearable:""},on:{change:e.roleSelectChange},model:{value:e.editNode.roleIdList,callback:function(t){e.$set(e.editNode,"roleIdList",t)},expression:"editNode.roleIdList"}})],1)]),e._v(" "),i("div",{staticClass:"area-top wk-checkbox",staticStyle:{"margin-left":"20px","line-height":"34px"}},[i("el-checkbox",{attrs:{"true-label":1,"false-label":0},model:{value:e.editNode.overType,callback:function(t){e.$set(e.editNode,"overType",t)},expression:"editNode.overType"}}),e._v(" "),i("span",{staticClass:"wk-checkbox__label",staticStyle:{"margin-right":"8px","font-size":"13px"}},[e._v("同时不超过发起人向上的")]),e._v(" "),i("el-select",{model:{value:e.editNode.parentLevel,callback:function(t){e.$set(e.editNode,"parentLevel",t)},expression:"editNode.parentLevel"}},e._l(e.levelOption,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})))],1),e._v(" "),i("el-radio",{staticClass:"el-radio--block area-top",attrs:{label:2}},[i("span",[e._v("组织架构中由上至下的")]),i("el-select",{staticStyle:{"margin-left":"5px"},model:{value:e.editNode.tempParentLevel,callback:function(t){e.$set(e.editNode,"tempParentLevel",t)},expression:"editNode.tempParentLevel"}},e._l(e.topLevelOption,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})))],1)],1)],1):e._e(),e._v(" "),8===e.editNode.examineType?i("div",{staticClass:"area-top"},[i("div",{staticClass:"text-des"},[e._v("模板中必填的人员字段，可关联为审批人")]),e._v(" "),i("el-select",{staticStyle:{"margin-top":"5px"},attrs:{placeholder:"请选择人员字段"},on:{change:e.memberControlChange},model:{value:e.editNode.fieldName,callback:function(t){e.$set(e.editNode,"fieldName",t)},expression:"editNode.fieldName"}},e._l(e.memberControlList,(function(e,t){return i("el-option",{key:t,attrs:{label:e.name,value:e.fieldName}})}))),e._v(" "),i("flexbox",{staticStyle:{"margin-top":"10px"}},[i("el-checkbox",{on:{change:e.parentLevelCheckClick},model:{value:e.editNode.parentLevelCheck,callback:function(t){e.$set(e.editNode,"parentLevelCheck",t)},expression:"editNode.parentLevelCheck"}},[e._v("成员的")]),e._v(" "),i("el-select",{staticStyle:{"margin-left":"3px"},model:{value:e.editNode.parentLevel,callback:function(t){e.$set(e.editNode,"parentLevel",t)},expression:"editNode.parentLevel"}},e._l(e.sendLevelOption,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})))],1)],1):e._e()],1),e._v(" "),e.waySectionShow?i("div",{staticClass:"section"},[i("div",{staticClass:"section__title"},[i("span",[e._v("多人审批时采用的审批方式")])]),e._v(" "),i("div",{staticClass:"section__content"},[i("el-radio-group",{model:{value:e.editNode.type,callback:function(t){e.$set(e.editNode,"type",t)},expression:"editNode.type"}},[3!==e.editNode.examineType&&8!==e.editNode.examineType?i("el-radio",{staticClass:"el-radio--block",attrs:{label:1}},[e._v("依次审批")]):e._e(),e._v(" "),i("el-radio",{staticClass:"el-radio--block",attrs:{label:2}},[e._v("会签（需所有审批人同意）")]),e._v(" "),i("el-radio",{staticClass:"el-radio--block",attrs:{label:3}},[e._v("或签（一名审批人同意或拒绝即可）")])],1)],1)]):e._e()]):e._e(),e._v(" "),"field"===e.activeTab&&e.editNode?i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"drawer-body",class:{"is-tab":e.tabsShow}},[i("field-custom-auth",{ref:"fieldAuth",attrs:{"auth-data":e.editNode.fieldAuthList,"field-list":e.fieldList}})],1):e._e(),e._v(" "),i("div",{staticClass:"drawer-footer"},[i("el-button",{directives:[{name:"debounce",rawName:"v-debounce",value:e.handleConfirm,expression:"handleConfirm"}],attrs:{type:"primary"}},[e._v("保存")]),e._v(" "),i("el-button",{nativeOn:{click:function(t){return e.close(t)}}},[e._v("取消")])],1),e._v(" "),e.depUserViewDialogShow?i("wk-dep-user-dialog",{attrs:{"user-value":e.selectUserList,visible:e.depUserViewDialogShow,props:{showDisableUser:!1,showDept:!1}},on:{"update:visible":function(t){e.depUserViewDialogShow=t},change:e.selectUserChange}}):e._e(),e._v(" "),e.externalDialogShow?i("el-dialog",{attrs:{visible:e.externalDialogShow,"close-on-click-modal":!1,"append-to-body":!0,title:"外部联系人",width:"30%"},on:{"update:visible":function(t){e.externalDialogShow=t}}},[i("span",[e._v("请输入外部联系人邮箱")]),e._v(" "),i("el-input",{staticStyle:{"margin-top":"10px"},model:{value:e.outerUserEmail,callback:function(t){e.outerUserEmail=t},expression:"outerUserEmail"}}),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.externalDialogShow=!1}}},[e._v("取消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.verifyEmail}},[e._v("确定")])],1)],1):e._e()],1)},ri=[],ci=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"field-custom-auth"},[i("el-table",{attrs:{data:e.tableData}},[i("el-table-column",{attrs:{label:"字段名称","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.row;return[i("span",{class:{"sub-name":n.parentFieldId}},[e._v(e._s(n.name))])]}}])}),e._v(" "),i("el-table-column",{attrs:{width:110},scopedSlots:e._u([{key:"header",fn:function(t){return[i("el-checkbox",{attrs:{indeterminate:e.authViewHalf},on:{change:e.authViewAllChange},model:{value:e.authViewAll,callback:function(t){e.authViewAll=t},expression:"authViewAll"}}),e._v(" "),i("span",{staticClass:"header-text"},[e._v("可以查看")])]}},{key:"default",fn:function(t){var n=t.row,a=t.$index;return[i("el-checkbox",{on:{change:function(t){e.handleRowChange(n,"authView",a)}},model:{value:n.authView,callback:function(t){e.$set(n,"authView",t)},expression:"row.authView"}})]}}])}),e._v(" "),e.disabledEdit?e._e():i("el-table-column",{attrs:{width:110},scopedSlots:e._u([{key:"header",fn:function(t){return[i("el-checkbox",{attrs:{indeterminate:e.authEditHalf},on:{change:e.authEditAllChange},model:{value:e.authEditAll,callback:function(t){e.authEditAll=t},expression:"authEditAll"}}),e._v(" "),i("span",{staticClass:"header-text"},[e._v("可以修改")])]}},{key:"default",fn:function(t){var n=t.row,a=t.$index;return[e.getCanEditStatus(n)?i("el-checkbox",{on:{change:function(t){e.handleRowChange(n,"authEdit",a)}},model:{value:n.authEdit,callback:function(t){e.$set(n,"authEdit",t)},expression:"row.authEdit"}}):e._e(),e._v(" "),e.detailTableFormTypes.includes(n.formType)?i("el-popover",{attrs:{placement:"bottom",width:"200",trigger:"click"}},[i("div",{staticClass:"table-set"},[i("div",{staticClass:"set-item"},[i("el-checkbox",{model:{value:n.tableLineAddEdit,callback:function(t){e.$set(n,"tableLineAddEdit",t)},expression:"row.tableLineAddEdit"}}),e._v(" "),i("span",{staticClass:"header-text"},[e._v("新增行")])],1),e._v(" "),i("div",{staticClass:"set-item"},[i("el-checkbox",{model:{value:n.tableLineDeleteEdit,callback:function(t){e.$set(n,"tableLineDeleteEdit",t)},expression:"row.tableLineDeleteEdit"}}),e._v(" "),i("span",{staticClass:"header-text"},[e._v("删除已有行")])],1)]),e._v(" "),i("el-button",{staticStyle:{padding:"0","margin-left":"8px"},attrs:{slot:"reference",type:"primary-text"},slot:"reference"},[e._v("表格权限")])],1):e._e()]}}])})],1)],1)},di=[],ui={name:"FieldCustomAuth",props:{fieldList:{type:Array,required:!0},authData:Array,disabledEdit:{type:Boolean,default:!1}},data:function(){return{detailTableFormTypes:["detail_table","business_cause","examine_cause"],tableData:[],authViewAll:!1,authViewHalf:!1,authEditAll:!1,authEditHalf:!1}},computed:{observerObj:function(){return[this.fieldList,this.authData]}},watch:{observerObj:{handler:function(){this.initCom()},immediate:!0,deep:!0}},methods:{initCom:function(){var e=this,t=[],i=[];this.authData&&(i=this.authData),this.fieldList.forEach((function(n){if(t.push(e.getAuthItem(i,n)),e.detailTableFormTypes.includes(n.formType)&&n.fieldExtendList){var a=i.find((function(e){return e.fieldName===n.fieldName}));n.fieldExtendList.forEach((function(i){t.push(e.getAuthItem(null===a||void 0===a?void 0:a.fieldExtendList,i,n,a))}))}})),this.tableData=t,this.setAllCheckStatus()},getAuthItem:function(e,t,i,n){var a=null,s=null;e&&0!==e.length?(s=e.find((function(e){return e.fieldName===t.fieldName})),a=s?s.authLevel:1):a=2;var o={fieldId:t.fieldId,formType:t.formType,fieldName:t.fieldName,name:t.name,hideEdit:t.hideEdit,tableLevel:s&&s.tableLevel||0,authLevel:a,authView:[2,3].includes(a),authEdit:3===a};if(this.detailTableFormTypes.includes(t.formType)){var l=o.tableLevel.toString(2).padStart(3,"0");o.tableLineAddEdit=Boolean(Number(l.charAt(0))),o.tableLineEdit=Boolean(Number(l.charAt(1))),o.tableLineDeleteEdit=Boolean(Number(l.charAt(2)))}return i&&(o.parentFieldId=i.fieldId,n||(o.authLevel=1,o.authView=!1,o.authEdit=!1),o.fieldId=t.id),o},getCanEditStatus:function(e){return!this.disabledEdit&&!e.hideEdit&&!["serial_number"].includes(e.formType)},authViewAllChange:function(e){var t=this;this.tableData.forEach((function(i){t.$set(i,"authView",e)})),this.authViewHalf=!1,this.authViewAll=e,e||this.authEditAllChange(!1)},authEditAllChange:function(e){var t=this;this.tableData.forEach((function(i){t.$set(i,"authEdit",e),e&&t.$set(i,"authView",e)})),this.authEditHalf=!1,this.authEditAll=e},setAllCheckStatus:function(){var e=this,t=this.tableData.length;if(!t)return this.authViewAll=!1,this.authViewHalf=!1,this.authEditAll=!1,void(this.authViewHalf=!1);var i=["authView","authEdit"];i.forEach((function(i){var n=e.tableData.filter((function(e){return e[i]})).length;e["".concat(i,"All")]=n===t,e["".concat(i,"Half")]=n>0&&n!==t}))},handleRowChange:function(e,t,i){switch(t){case"authView":e.authView||(e.authEdit=!1);break;case"authEdit":e.authEdit&&(e.authView=!0);break}if(e.parentFieldId&&e[t]){var n=this.tableData.find((function(t){return t.fieldId===e.parentFieldId}));n&&(n[t]=!0)}this.setAllCheckStatus()},getSaveForm:function(){var e=this,t=[];return this.tableData.forEach((function(i){if(e.detailTableFormTypes.includes(i.formType)){var n=e.tableData.filter((function(e){return e.parentFieldId===i.fieldId})),a=n.map((function(t){return e.getPostItem(t)})),s=e.getPostItem(i);s.fieldExtendList=a,t.push(s)}else i.parentFieldId||t.push(e.getPostItem(i))})),t},getPostItem:function(e){var t;t=e.authEdit&&this.getCanEditStatus(e)?3:e.authView?2:1;var i={fieldId:e.fieldId,formType:e.formType,fieldName:e.fieldName,name:e.name,authLevel:t};if(this.detailTableFormTypes.includes(e.formType)){var n=[];n.push(e.tableLineAddEdit?"1":"0"),n.push(e.tableLineEdit?"1":"0"),n.push(e.tableLineDeleteEdit?"1":"0");var a=n.join("");i.tableLevel=parseInt(a,2)}return i}}},mi=ui,pi=(i("8871"),Object(m["a"])(mi,ci,di,!1,null,"608ec6d3",null)),hi=pi.exports,fi={methods:{getWkWayShowStatus:function(e){var t,i,n,a;return!!e&&(1===e.examineType&&(null===(t=e.memberUserList)||void 0===t?void 0:t.length)>1||3===e.examineType&&(null===(i=e.roleIdList)||void 0===i?void 0:i.length)>0||4===e.examineType&&2===e.chooseType&&(1===e.rangeType||2===e.rangeType&&(null===(n=e.userList)||void 0===n?void 0:n.length)>1||3===e.rangeType&&(null===(a=e.roleIdList)||void 0===a?void 0:a.length)>0))},getWkNodeErrorStatus:function(e){return 1===e.examineType?0===e.memberUserList.length:2!==e.examineType&&(3===e.examineType?!e.roleIdList||0===e.roleIdList.length:4===e.examineType?2===e.rangeType?0===e.userList.length:3===e.rangeType&&(!e.roleIdList||0===e.roleIdList.length):5===e.examineType?1===e.type?!e.roleIdList||0===e.roleIdList.length:2===e.type&&Object(tt["c"])(e.tempParentLevel):7===e.examineType?!(e.userList.length||e.parentLevelList.length||e.roleIdList.length||e.isSelf||e.isAdd):8===e.examineType?!!Object(tt["c"])(e.fieldName):void 0)}}},vi={name:"WkNodeSet",components:{WkDepUserDialog:ce["a"],RoleEmployeeSelect:ii,FieldCustomAuth:hi},mixins:[fi],inject:["memberControlFun"],props:{visible:{type:Boolean,required:!0,default:!1},node:{type:Object,default:function(){return{}}},props:{type:Object,default:function(){return{}}}},data:function(){return{loading:!1,editNode:null,isNameEdit:!1,sendLevelOption:[],topLevelOption:[],levelOption:[],depUserViewDialogShow:!1,activeTab:"base",fieldList:[],selectUserList:[],externalDialogShow:!1,outerUserEmail:""}},computed:{examineTypeOptions:function(){var e=[{label:"指定成员",value:1},{label:"上级",value:2},{label:"角色",value:3},{label:"发起人自选",value:4},{label:"连续多级上级",value:5},{label:"关联人员字段",value:8}];return this.props.examineTypeFilterFun?this.props.examineTypeFilterFun(e):e},waySectionShow:function(){return this.getWkWayShowStatus(this.editNode)||this.memberControlSectionShow},memberControlSectionShow:function(){var e=this.editNode,t=e.fieldName,i=e.examineType;if(8===i&&t){var n=this.memberControlList.filter((function(e){return e.fieldName==t}))[0];return 1===n.isMulti}return!1},memberControlList:function(){return this.memberControlFun()},tabsShow:function(){return this.tabs.length>1},tabs:function(){var e=[{label:"基础设置",name:"base"}];return this.props.nodeFieldSetShow&&e.push({label:"字段权限",name:"field"}),e}},watch:{visible:function(e){this.editNode=e?Object(xe["s"])(this.node):null}},created:function(){for(var e=1;e<=20;e++){var t="第".concat(e,"级上级");this.levelOption.push({label:t,value:e}),1===e?(this.sendLevelOption.push({label:"直属上级",value:e}),this.topLevelOption.push({label:"最高级上级",value:e})):(this.sendLevelOption.push({label:t,value:e}),this.topLevelOption.push({label:t,value:e}))}},mounted:function(){},beforeDestroy:function(){},methods:{memberControlChange:function(){this.memberControlSectionShow?this.$set(this.editNode,"type",2):this.$set(this.editNode,"type",1)},nameInputBlur:function(){this.isNameEdit=!1,""===this.editNode.name&&(this.editNode.name="审批人")},close:function(){this.$emit("update:visible",!1)},handleConfirm:function(){var e=this;for(var t in this.editNode.isError=this.getWkNodeErrorStatus(this.editNode),this.editNode)"conditionList"!==t&&(this.node[t]=this.editNode[t]);var i=this.$refs.fieldAuth;if(i){var n=i.getSaveForm();this.props.nodeFieldItemParamsFun&&n.forEach((function(t){e.props.nodeFieldItemParamsFun(t)})),this.node.fieldAuthList=n}this.close()},examineTypeChange:function(){this.editNode.parentLevel=1,this.$set(this.editNode,"userList",[]),this.$set(this.editNode,"memberUserList",[]),1===this.editNode.examineType?this.editNode.type=1:2===this.editNode.examineType?this.editNode.type=0:3===this.editNode.examineType?this.editNode.type=2:4===this.editNode.examineType?(this.editNode.rangeType||(this.editNode.rangeType=1),this.editNode.chooseType=1,this.editNode.type=1):5===this.editNode.examineType&&(this.editNode.type=1),this.editNode.roleIdList=[],this.editNode.chooseType=1},selectUserChange:function(e,t,i){var n=this;if(1===this.editNode.examineType){var a=[],s=[];this.editNode.memberUserList.forEach((function(e){e.userId?a.push(e.userId):s.push(e.outerUserEmail)})),i.forEach((function(e){!a.includes(e.userId)&&a.length+s.length<20&&n.editNode.memberUserList.push(e)})),this.editNode.type=1}else i.length>0?this.editNode.userList=i.length>20?i.slice(0,20):i:this.editNode.userList=[]},userDelete:function(e){this.editNode.userList.splice(e,1)},typeUserDelete:function(e){this.editNode.memberUserList.splice(e,1)},rangeTypeChange:function(){this.editNode.userList=[],this.editNode.roleIdList=[],this.editNode.type=1},endTypeChange:function(){this.editNode.overType=0},roleSelectChange:function(){var e=this;this.$nextTick((function(){var t=e.$refs.roleSelect.select.selected;e.$set(e.editNode,"roleList",t.map((function(e){return{roleName:e.$props.label}})))}))},activeTabClick:function(){"field"===this.activeTab&&this.props.nodeFieldSetShow&&this.getFieldList()},getFieldList:function(){var e=this;this.loading=!0,this.props.nodeFieldSetRequestFun().then((function(t){e.fieldList=t,e.loading=!1})).catch((function(){e.fieldList=[],e.loading=!1}))},addCommandClick:function(e){"selectUser"===e?(1===this.editNode.examineType?this.selectUserList=(this.editNode.memberUserList||[]).filter((function(e){return!!e.userId})).map((function(e){return e.userId})):this.selectUserList=(this.editNode.userList||[]).map((function(e){return e.userId})),this.depUserViewDialogShow=!0):"external"===e&&(this.externalDialogShow=!0)},verifyEmail:function(){if(Object(xe["t"])(this.outerUserEmail)){var e=[],t=[];this.editNode.memberUserList.forEach((function(i){i.userId?e.push(i.userId):t.push(i.outerUserEmail)})),!t.includes(this.outerUserEmail)&&e.length+t.length<20&&this.editNode.memberUserList.push({outerUserEmail:this.outerUserEmail}),this.outerUserEmail=null,this.externalDialogShow=!1}else this.$message.error("邮箱格式有误")},parentLevelCheckClick:function(){var e;this.editNode.parentLevelCheck&&!this.editNode.parentLevel&&(this.editNode.parentLevel=null===(e=this.sendLevelOption[0])||void 0===e?void 0:e.value)}}},bi=vi,gi=(i("eff5"),i("8d09"),Object(m["a"])(bi,li,ri,!1,null,"7c1c571a",null)),yi=gi.exports,xi=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-drawer",{attrs:{visible:e.visible,"with-header":!1,size:"500px",title:"我是标题","append-to-body":""},on:{close:e.close}},[e.editNode?i("flexbox",{staticClass:"drawer-header"},[i("div",{staticClass:"edit-title"},[e.isNameEdit?i("el-input",{attrs:{maxlength:"20"},on:{blur:e.nameInputBlur},model:{value:e.editNode.name,callback:function(t){e.$set(e.editNode,"name",t)},expression:"editNode.name"}}):[i("span",{staticClass:"title",on:{click:function(t){e.isNameEdit=!0}}},[e._v(e._s(e.editNode.name))]),e._v(" "),i("i",{staticClass:"wk wk-edit",on:{click:function(t){e.isNameEdit=!0}}})]],2),e._v(" "),i("i",{staticClass:"el-icon-close ",on:{click:e.close}})]):e._e(),e._v(" "),e.tabsShow?i("el-tabs",{on:{"tab-click":e.activeTabClick},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},e._l(e.tabs,(function(e,t){return i("el-tab-pane",{key:t,attrs:{label:e.label,name:e.name}})}))):e._e(),e._v(" "),"base"===e.activeTab&&e.editNode?i("div",{staticClass:"drawer-body",class:{"is-tab":e.tabsShow}},[i("div",{staticClass:"set-copy"},[i("div",{staticClass:"item"},[i("div",{staticClass:"item-title"},[e._v("\n          抄送人\n        ")]),e._v(" "),i("div",{staticClass:"item-body"},[e._l(e.editNode.userList,(function(t,n){return i("el-tag",{key:t.userId,attrs:{size:"medium","disable-transitions":"",closable:"",type:"info"},on:{close:function(t){e.handleRemoveUser(n)}}},[e._v("\n            "+e._s(e.$getUserName(t))+"\n          ")])})),e._v(" "),i("el-button",{staticClass:"add-btn",attrs:{type:"text",icon:"el-icon-circle-plus"},on:{click:function(t){e.handleToChooseUser()}}},[e._v("\n            添加成员\n          ")]),e._v(" "),i("div",{staticClass:"section-handle"},[i("p",{staticClass:"section-handle-title"},[e._v("指定上级")]),e._v(" "),i("el-select",{staticStyle:{width:"400px"},attrs:{multiple:""},on:{change:e.setContent},model:{value:e.editNode.parentLevelList,callback:function(t){e.$set(e.editNode,"parentLevelList",t)},expression:"editNode.parentLevelList"}},e._l(e.sendLevelOption,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})))],1),e._v(" "),i("div",{staticClass:"section-handle"},[i("p",{staticClass:"section-handle-title"},[e._v("指定角色")]),e._v(" "),i("role-employee-select",{ref:"roleSelect",staticStyle:{width:"400px"},attrs:{multiple:"",props:{onlyShowRole:!0,showCustomRoles:!0},clearable:""},on:{change:e.roleSelectChange},model:{value:e.editNode.roleIdList,callback:function(t){e.$set(e.editNode,"roleIdList",t)},expression:"editNode.roleIdList"}})],1),e._v(" "),i("div",{staticClass:"checkbox-wrapper"},[i("el-checkbox",{attrs:{"true-label":1,"false-label":0},on:{change:e.setContent},model:{value:e.editNode.isSelf,callback:function(t){e.$set(e.editNode,"isSelf",t)},expression:"editNode.isSelf"}},[e._v("\n              抄送给发起人本人\n            ")])],1),e._v(" "),i("div",{staticClass:"checkbox-wrapper"},[i("el-checkbox",{attrs:{"true-label":1,"false-label":0},on:{change:e.setContent},model:{value:e.editNode.isAdd,callback:function(t){e.$set(e.editNode,"isAdd",t)},expression:"editNode.isAdd"}},[e._v("\n              允许发起人添加抄送人\n            ")])],1)],2)]),e._v(" "),e.userDialogSelectVisible?i("wk-dep-user-dialog",{attrs:{visible:e.userDialogSelectVisible,"user-value":e.userList,props:{showDept:!1}},on:{"update:visible":function(t){e.userDialogSelectVisible=t},"update:userValue":function(t){e.userList=t},change:e.selectUserChange}}):e._e()],1)]):e._e(),e._v(" "),"field"===e.activeTab&&e.editNode?i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"drawer-body",class:{"is-tab":e.tabsShow}},[i("field-custom-auth",{ref:"fieldAuth",attrs:{"auth-data":e.editNode.fieldAuthList,"field-list":e.fieldList,"disabled-edit":""}})],1):e._e(),e._v(" "),i("div",{staticClass:"drawer-footer"},[i("el-button",{directives:[{name:"debounce",rawName:"v-debounce",value:e.handleConfirm,expression:"handleConfirm"}],attrs:{type:"primary"}},[e._v("保存")]),e._v(" "),i("el-button",{nativeOn:{click:function(t){return e.close(t)}}},[e._v("取消")])],1)],1)},wi=[],_i={name:"WkCopyNodeSet",components:{WkDepUserDialog:ce["a"],RoleEmployeeSelect:ii,FieldCustomAuth:hi},mixins:[fi],inject:["WkApproveFlow"],props:{visible:{type:Boolean,required:!0,default:!1},node:{type:Object,default:function(){return{}}},props:{type:Object,default:function(){return{}}}},data:function(){return{editNode:null,isNameEdit:!1,sendLevelOption:[],topLevelOption:[],levelOption:[],userDialogSelectVisible:!1,userList:[],activeTab:"base",fieldList:[]}},computed:{tabsShow:function(){return this.tabs.length>1},tabs:function(){return[]}},watch:{visible:function(e){this.editNode=e?Object(xe["s"])(this.node):null}},created:function(){for(var e=1;e<=20;e++){var t="第".concat(e,"级上级");this.levelOption.push({label:t,value:e}),1===e?(this.sendLevelOption.push({label:"直属上级",value:e}),this.topLevelOption.push({label:"最高级上级",value:e})):(this.sendLevelOption.push({label:t,value:e}),this.topLevelOption.push({label:t,value:e}))}},mounted:function(){},beforeDestroy:function(){},methods:{handleToChooseUser:function(){var e;this.userList=null===(e=this.editNode.userList)||void 0===e?void 0:e.map((function(e){return e.userId})),this.userDialogSelectVisible=!0},setContent:function(){},nameInputBlur:function(){this.isNameEdit=!1,""===this.editNode.name&&(this.editNode.name="抄送节点")},close:function(){this.$emit("update:visible",!1)},handleConfirm:function(){var e=this;for(var t in this.editNode.isError=this.getWkNodeErrorStatus(this.editNode),this.editNode)"conditionList"!==t&&(this.node[t]=this.editNode[t]);var i=this.$refs.fieldAuth;if(i){var n=i.getSaveForm();this.props.nodeFieldItemParamsFun&&n.forEach((function(t){e.props.nodeFieldItemParamsFun(t)})),this.node.fieldAuthList=n}this.close()},selectUserChange:function(e,t,i,n){this.editNode.userList=i,this.setContent(),this.userDialogSelectVisible=!1},handleRemoveUser:function(e){this.editNode.userList.splice(e,1),this.setContent(),this.$forceUpdate()},roleSelectChange:function(){var e=this;this.$nextTick((function(){var t=e.$refs.roleSelect.select.selected.map((function(e){return{roleName:e.label}}));e.$set(e.editNode,"roleList",t)}))},activeTabClick:function(){"field"===this.activeTab&&this.props.nodeFieldSetShow&&this.getFieldList()},getFieldList:function(){var e=this;this.loading=!0,this.props.nodeFieldSetRequestFun().then((function(t){e.fieldList=t,e.loading=!1})).catch((function(){e.fieldList=[],e.loading=!1}))}}},Ci=_i,ki=(i("9c9a"),Object(m["a"])(Ci,xi,wi,!1,null,"92acf894",null)),Li=ki.exports,Si={conditionSelectRequest:null,conditionSelectParams:null,conditionSelectList:null,nodeFieldSetShow:!1,nodeFieldItemParamsFun:null,nodeFieldSetRequestFun:null,examineTypeFilterFun:null,conditionAddShow:!0,examineAddShow:!0,copyAddShow:!0,examineNodeProps:{addExternalUserShow:!1}},Ni={name:"WkApproveFlow",components:{WkNode:ft,WkConditionWrap:yt,WkEndNode:Lt,WkConditionSet:oi,WkNodeSet:yi,WkCopyNodeSet:Li},mixins:[fi],inject:["memberControlFun"],provide:function(){return{WkApproveFlow:this}},props:{props:{type:Object,default:function(){return{}}},sendNode:Object,list:Array},data:function(){return{editNode:null,editNodeIndex:null,conditionParent:[],conditionParentIndex:0,conditionSetVisible:!1,nodeSetVisible:!1,copyNodeSetVisible:!1,errorList:[],scale:1,eventObj:{copy:null}}},computed:{config:function(){return Object(W["a"])(Object(x["a"])({},Si),this.props||{})},memberControlList:function(){return this.memberControlFun()}},watch:{},created:function(){},mounted:function(){},beforeDestroy:function(){},methods:{nodeClick:function(e){var t=e.node,i=e.index,n=e.conditionParent;this.editNode=t,t.examineType>0?7==t.examineType?this.copyNodeSetVisible=!0:this.nodeSetVisible=!0:(this.conditionParent=n,this.conditionParentIndex=i,this.conditionSetVisible=!0)},nodeHandleClick:function(e){"copy"===e.eventName&&(this.eventObj[e.eventName]=e,this.$message.success("复制成功"))},scaleClick:function(e){"minus"===e?this.scale=this.scale-.1:"plus"===e&&(this.scale=this.scale+.1)},getParams:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={needUserFieldNamesParams:!1},i=Object(W["a"])(Object(x["a"])({},t),e);this.errorList=[];var n=[],a={userFieldNames:[]};return this.getListParams(this.list,n,i,a),this.errorList.length>0?{isError:!0,list:this.errorList,paramsData:a}:{isError:!1,list:n,paramsData:a}},getListParams:function(e,t,i,n){var a=this;e.forEach((function(e){0===e.examineType?t.push(a.getConditonWrapParams(e,i,n)):t.push(a.getNodeParams(e,i,n))}))},getNodeParams:function(e,t,i){e.isError=this.getWkNodeErrorStatus(e),e.isError&&this.errorList.push(e);var n={examineType:e.examineType,name:e.name,deptList:e.deptList,roleIdList:e.roleIdList,type:e.type,userList:e.userList.map((function(e){return e.userId})),chooseType:e.chooseType,rangeType:e.rangeType};if(1==e.examineType)n.memberUserList=e.memberUserList,n.userList=[];else if(5===e.examineType)1===e.type?n.parentLevel=1===e.overType?e.parentLevel:0:2===e.type&&(n.parentLevel=e.tempParentLevel);else if(7===e.examineType)n={examineType:e.examineType,name:e.name,userList:e.userList.map((function(e){return e.userId})),isSelf:e.isSelf,isAdd:e.isAdd,roleIdList:e.roleIdList,parentLevelList:e.parentLevelList};else if(8==e.examineType){var a=e.parentLevelCheck,s=void 0!==a&&a,o=e.fieldName;if(n.parentLevel=s?e.parentLevel:null,n.fieldName=o,o){var l=this.memberControlList.filter((function(e){return e.fieldName==o}))[0].fieldId;n.fieldId=l,t.needUserFieldNamesParams&&i.userFieldNames.push(o)}}else n.parentLevel=e.parentLevel;return e.fieldAuthList&&(n.fieldAuthList=e.fieldAuthList),n},getConditionNodeParams:function(e,t){var i=this;e.isError=!1,e.isError&&this.errorList.push(e);var n={conditionName:e.conditionName,sort:t+1,conditionDataList:[]};return e.conditionDataList.forEach((function(e){n.conditionDataList.push(i.getSectionConditionParams(e))})),n},getSectionConditionParams:function(e){return e.map((function(e){var t={name:e.name,fieldName:e.fieldName,type:e.type,fieldId:e.fieldId,conditionType:e.conditionType};return 3===e.type||9===e.type?t.values=e.values:6===e.conditionType?t.values=[e.leftValue,e.leftCondition,e.rightCondition,e.rightValue]:8===e.conditionType?t.values=e.values:t.values=[e.values],t}))},getConditonWrapParams:function(e,t,i){var n=this,a={examineType:e.examineType,name:e.name,conditionList:[]};return e.conditionList.forEach((function(e,s){var o=n.getConditionNodeParams(e,s);o.examineDataList=[],a.conditionList.push(o),n.getListParams(e.examineDataList,o.examineDataList,t,i)})),a},getHeaderStyle:function(e){var t={bgColor:"#0052cc",icon:""};return e.examineType>=1&&e.examineType<=5?(t.bgColor="#FF991F",t.icon="wk wk-approve-line"):7===e.examineType?(t.bgColor="#6B778C",t.icon="wk wk-source-line"):8===e.examineType&&(t.bgColor="#FF991F",t.icon="wk wk-approve-line"),t}}},Ti=Ni,Oi=(i("dd75"),Object(m["a"])(Ti,St,Nt,!1,null,null,null)),Ii=Oi.exports,Ei=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("create-view",{ref:"createView",attrs:{"body-style":{height:"100%"},"card-style":e.cardStyle},on:{afterEnter:e.afterEnter}},[i("flexbox",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"xr-create",attrs:{direction:"column",align:"stretch"}},[i("flexbox",{staticClass:"xr-create__header"},[e.$slots.title?e._e():i("div",{staticClass:"title"},[e._v(e._s(e.title)),e._t("title-append")],2),e._v(" "),e._t("title"),e._v(" "),i("i",{staticClass:"el-icon-close close",on:{click:e.close}})],2),e._v(" "),i("div",{staticClass:"xr-create__body"},[e._t("default")],2),e._v(" "),i("div",{staticClass:"xr-create__footer"},[e._t("footer-left"),e._v(" "),e.showConfirm?i("el-button",{attrs:{disabled:e.confirmDisabled,type:"primary"},nativeOn:{click:function(t){e.debouncedSaveField(!1)}}},[e._v(e._s(e.confirmButtonText))]):e._e(),e._v(" "),e._t("footer"),e._v(" "),e.showCancel?i("el-button",{nativeOn:{click:function(t){return e.close(t)}}},[e._v("取消")]):e._e()],2)],1)],1)},Fi=[],ji=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("transition",{attrs:{name:"opacity-fade"},on:{"after-enter":e.afterEnter}},[i("div",{staticClass:"c-view create-view",style:{"background-color":e.backgroundColor,padding:e.padding+" 0","z-index":e.zIndex}},[i("el-card",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"create-view-content",style:Object.assign({},{width:e.width},e.cardStyle),attrs:{"body-style":e.bodyStyle}},[e._t("header"),e._v(" "),e._t("default")],2)],1)])},Di=[],$i={name:"CreateView",components:{},props:{bodyStyle:{type:Object,default:function(){return{}}},cardStyle:{type:Object,default:function(){return{}}},loading:{type:Boolean,default:!1},backgroundColor:{type:String,default:"rgba(23,43,77, 0.5)"},width:{type:String,default:"900px"},padding:{type:String,default:"40px"}},data:function(){return{zIndex:Object(xe["l"])(),loadingObj:null}},computed:{},watch:{},mounted:function(){},methods:{afterEnter:function(){this.$emit("afterEnter")}}},Ui=$i,Ai=(i("d2f4"),Object(m["a"])(Ui,ji,Di,!1,null,"a6542620",null)),Vi=Ai.exports,Pi=i("7a1a"),Ri={name:"XrCreate",components:{CreateView:Vi},props:{title:String,loading:Boolean,cardStyle:Object,appendToBody:{type:Boolean,default:!0},showCancel:{type:Boolean,default:!0},showConfirm:{type:Boolean,default:!0},confirmDisabled:{type:Boolean,default:!1},confirmButtonText:{type:String,default:"保存"}},data:function(){return{}},computed:{},watch:{},created:function(){this.debouncedSaveField=Object(Pi["debounce"])(300,this.save)},mounted:function(){this.appendToBody&&document.body.appendChild(this.$el)},destroyed:function(){this.appendToBody&&this.$el&&this.$el.parentNode&&this.$el.parentNode.removeChild(this.$el)},methods:{afterEnter:function(){this.$emit("afterEnter")},save:function(){this.$emit("save")},close:function(){this.$emit("close")}}},Hi=Ri,Bi=(i("527f"),Object(m["a"])(Hi,Ei,Fi,!1,null,"22ae937b",null)),Wi=Bi.exports,Mi=i("c1df"),qi=i.n(Mi),zi=i("da92"),Xi=i("53ca");i("e9c4");function Ji(e){return Object(w["a"])({url:"oaExamine/queryOaExamineInfo/".concat(e),method:"post"})}i("a630"),i("6062"),i("c740");var Gi=i("e170"),Ki=(i("d9e2"),{methods:{UniquePromise:function(e){return new Promise((function(e){e()}))},getRules:function(e,t){var i=this,n=[],a=t||this.action;if(1==e.isNull&&"serial_number"!==e.formType){var s=[];s=["number","floatnumber","leads","customer","contacts","product","business","contract","receivables","receivablesPlan"].includes(e.formType)?["blur"]:["supplier_cause","purchase_cause","sale_cause","warehouse_cause"].includes(e.formType)?[]:["blur","change"],n.push({required:!0,message:e.name+"不能为空",trigger:s}),"detail_table"==e.formType?n.push({validator:function(e,t,n){var a=e.item;i.getDetailTableIsEmpty(a.fieldExtendList,t)?n(new Error(a.name+"不能为空")):n()},item:e,trigger:["blur","change"]}):"checkbox"==e.formType&&n.push({validator:function(e,t,i){var n=e.item;if(Object(tt["a"])(t)&&0!==t.length){var a=t.find((function(e){return Object(tt["c"])(e)}));""===a?i(new Error(n.name+"不能为空")):i()}else i(new Error(n.name+"不能为空"))},item:e,trigger:["blur","change"]})}if(1==e.isUnique&&this.UniquePromise){var o=function(t,n,a){Object(tt["c"])(n)?a():i.UniquePromise({field:e,rule:t,value:n}).then((function(){a()})).catch((function(e){var t=Object(tt["d"])(e)?e.msg:e;a(new Error(t||"验证出错"))}))};n.push({validator:o,item:e,trigger:"checkbox"==e.formType||"select"==e.formType?["change","blur"]:["blur"]})}if("number"===e.formType||"percent"===e.formType){var l=function(t,n,a){e.hasOwnProperty("precisions")?i._getNumberRule(t,n,a):Object(tt["c"])(n)||Object(xe["w"])(n)?a():a(new Error("数字的整数部分须少于15位，小数部分须少于4位"))};n.push({validator:l,item:e,trigger:"number"===e.formType?["blur"]:["blur","change"]})}else if("floatnumber"===e.formType){var r=function(t,n,a){e.hasOwnProperty("precisions")?i._getNumberRule(t,n,a):Object(tt["c"])(n)||Object(xe["v"])(n)?a():a(new Error("货币的整数部分须少于15位，小数部分须少于2位"))};n.push({validator:r,item:e,trigger:["blur"]})}else if("mobile"===e.formType){var c=function(e,t,i){Object(tt["c"])(t)||Object(xe["u"])(t)?i():i(new Error("手机格式有误"))};n.push({validator:c,item:e,trigger:["blur"]})}else if("email"===e.formType){var d=function(e,t,i){Object(tt["c"])(t)||Object(xe["t"])(t)?i():i(new Error("邮箱格式有误"))};n.push({validator:d,item:e,trigger:["blur"]})}else if("location"===e.formType&&1==e.isNull){var u=function(t,i,n){!Object(tt["d"])(i)||Object(tt["d"])(i)&&Object(tt["c"])(i.lat)&&Object(tt["c"])(i.lng)&&Object(tt["c"])(i.address)?n(new Error(e.name+"不能为空")):n()};n.push({validator:u,item:e,trigger:["change"]})}else if("customer"===e.formType&&"superiorCustomerId"===e.fieldName){var m=function(e,t,i){a&&"update"===a.type&&Object(tt["a"])(t)&&t.length>0&&t[0].customerId===a.id?i(new Error("上级客户不能为当前客户")):i()};n.push({validator:m,item:e,trigger:["change"]})}else if("contacts"===e.formType&&"parentContactsId"===e.fieldName){var p=function(e,t,i){a&&"update"===a.type&&Object(tt["a"])(t)&&t.length>0&&t[0].contactsId===a.id?i(new Error("直属上级不能为当前联系人")):i()};n.push({validator:p,item:e,trigger:["change"]})}else if("customer_relations"===e.formType){var h=function(e,t,i){if(a&&"update"===a.type&&Object(tt["a"])(t)&&t.length>0){var n=t.some((function(e){return e.sourceCustomerId===e.targetCustomerId}));n?i(new Error("关联客户不能是当前客户")):i()}else i()};n.push({validator:h,item:e,trigger:["change"]})}return n},_getNumberRule:function(e,t,i){var n=e.item,a=String(t).split("."),s=String(t).replace(".","").replace("-","").length,o="percent"===n.formType?10:15,l=Object(tt["c"])(n.minNumRestrict)?-1/0:Number(n.minNumRestrict||-1/0),r=Object(tt["c"])(n.maxNumRestrict)?1/0:Number(n.maxNumRestrict||1/0);s>o?i(new Error("最多支持".concat(o,"位数字（包含小数位）"))):Object(tt["c"])(n.precisions)&&String(t).includes(".")?i(new Error("不支持小数")):a.length>1&&a[1].length>Number(n.precisions)?i(new Error("小数位不能大于".concat(n.precisions))):t<l?i(new Error("不能小于".concat(l))):t>r?i(new Error("不能大于".concat(r))):i()},getDetailTableIsEmpty:function(e,t){for(var i=0;i<t.length;i++){var n=t[i];if(this.judgeFormValueIsEmpty(e,n))return!0}return!1},judgeFormValueIsEmpty:function(e,t){for(var i=0;i<e.length;i++){var n=e[i],a=t[n.fieldName];if("location"===n.formType){if(Object(tt["d"])(a)&&(!Object(tt["c"])(a.lat)||!Object(tt["c"])(a.lng)||!Object(tt["c"])(a.address)))return!1}else if(!Object(tt["c"])(a))return!1}return!0}}}),Qi="其他",Yi={mixins:[Ki],props:{},methods:{getItemValue:function(e,t,i,n){var a=this;if(t=t||{},"contacts"==e.formType||"customer"==e.formType||"contract"==e.formType||"receivables"==e.formType||"business"==e.formType){if("update"===i)return e.value?Object(xe["s"])(e.value):[];var s=t[e.formType];return s?[s]:[]}if("category"==e.formType)return e.value?e.value:[];if("product"==e.formType)return e.value;if("map_address"==e.formType)return"update"==i?(e.value.address&&(e.value.address=e.value.address.split(",")),e.value):{};if("address"==e.formType){if("update"==i){if(e.value){if("string"===typeof e.value){var o=e.value.split(",");return{province:o[0]||"",city:o[1]||"",area:o[2]||""}}return e.value}return{}}return{}}if("single_user"==e.formType||"user"==e.formType&&(!e.isMulti||e.radio))return"update"===i?Object(tt["d"])(e.value)&&e.value.userId?e.value.userId:Object(tt["a"])(e.value)&&e.value.length>0?e.value[0].userId:"string"===typeof e.value?e.value:"":Object(tt["a"])(e.defaultValue)&&e.defaultValue.length>0?Object(xe["s"])(e.defaultValue[0]).userId:"";if("structure"!=e.formType||e.isMulti&&!e.radio){if("user"==e.formType||"structure"==e.formType||"file"==e.formType)return"update"===i?e.value?Object(xe["s"])(e.value):[]:e.defaultValue?Object(xe["s"])(e.defaultValue):[];if("number"==e.formType||"floatnumber"==e.formType||"percent"==e.formType)return"update"==i?Object(tt["c"])(e.value)?void 0:e.value:Object(tt["c"])(e.defaultValue)?void 0:e.defaultValue;if("field_attention"==e.formType)return"update"==i?Object(tt["c"])(e.value)?0:Number(e.value):Object(tt["c"])(e.defaultValue)?0:Number(e.defaultValue);if("detail_table"==e.formType){var l=Object(tt["c"])(e.value)?[e.fieldExtendList]:e.value;if("string"===typeof l&&l)try{l=JSON.parse(l)}catch(c){}var r=[];return l.forEach((function(t){var n={};r.push(n);var s=t.length>0&&t[0].batchId?t[0].batchId:Object(xe["q"])();t.forEach((function(t){if(["select","checkbox"].includes(t.formType)&&(t.optionsData=null),["structure","user"].includes(t.formType)){var o=e.fieldExtendList.find((function(e){return e.fieldName===t.fieldName}));o&&(t.isMulti=o.isMulti)}n[t.fieldName]=a.getItemValue(t,null,i,e),s&&(n.batchId=s)}))})),r}return"customer_relations"==e.formType?"update"==i?Object(tt["c"])(e.value)?[]:e.value:[]:"update"==i?null===e.value||void 0===e.value?"":e.value:null===e.defaultValue||void 0===e.defaultValue?"":e.defaultValue}return"update"===i?Object(tt["d"])(e.value)&&e.value.deptId?e.value.deptId||e.value.id:Object(tt["a"])(e.value)&&e.value.length>0?e.value[0].deptId||e.value[0].id:"string"===typeof e.value?e.value:"":Object(tt["a"])(e.defaultValue)&&e.defaultValue.length>0?Object(xe["s"])(e.defaultValue[0]).deptId:""},getUniquePromise:function(e,t,i,n){var a=this,s={paramFun:null,request:null},o=Object(W["a"])(Object(x["a"])({},s),n||{});return new Promise((function(n,s){var l={};l.fieldId=e.fieldId;var r=a.getRealParams(e,t);l.value=r&&"object"===Object(Xi["a"])(r)?JSON.stringify(r):r,"update"==i.type&&(l.batchId=i.batchId),o.paramFun&&o.paramFun(l),(o.request||Gi["e"])(l).then((function(t){var i=t.data||{};1===i.status?n():i.ownerUserName?s("".concat(e.name,"已存在，负责人为“").concat(i.ownerUserName,"”")):i.poolNames&&i.poolNames.length>0?s("".concat(e.name,"已存在，当前位于公海“").concat(i.poolNames.join("，"),"”")):s("".concat(e.name,"已存在"))})).catch((function(){s()}))}))},getFormItemDefaultProperty:function(e){var t=this,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=i?Object(xe["s"])(e):e;if(n.field=e.fieldName,"date_interval"===e.formType)2===e.precisions?(n.dateType="datetimerange",n.dateValueFormat="yyyy-MM-dd HH:mm:ss"):(n.dateType="daterange",n.dateValueFormat="yyyy-MM-dd");else if("position"===e.formType)n.showDetail=1===e.precisions,n.hideArea=3===e.precisions||4===e.precisions,n.onlyProvince=4===e.precisions;else if("detail_table"===e.formType){var a={};n.fieldExtendList.forEach((function(e){var i=Object(xe["s"])(e);t.getFormItemDefaultProperty(e,!1),e.show=1!==e.isHidden,e.show&&(e.rules=t.getRules(i)),t.getItemRadio(e,e),a[e.fieldName]=t.getItemValue(e)})),n.fieldForm=a;var s=Object(xe["s"])(e.fieldExtendList),o=Object(tt["c"])(e.value)?[s]:e.value;if("string"===typeof o&&o)try{o=JSON.parse(o)}catch(r){}var l=[];o.forEach((function(e){var i=[];e.forEach((function(e){var n=Object(xe["s"])(e),a=t.getFormItemDefaultProperty(e,!1);t.getItemRadio(e,a),a.show=1!==a.isHidden,a.show&&(a.rules=t.getRules(n)),i.push(a)})),l.push(i)})),n.fieldList=l}return n},getItemWithFromType:function(e,t){for(var i=null,n=0;n<e.length;n++){for(var a=e[n],s=0;s<a.length;s++){var o=a[s];if(o.formType===t){i=o;break}}if(i)break}return i},itemsForEach:function(e,t){for(var i=0;i<e.length;i++){var n=e[i];if(Object(tt["a"])(n))for(var a=0;a<n.length;a++){var s=n[a];t(s,i,a,n)}else t(n,i)}},getItemIsCanEdit:function(e,t){return!!Object(tt["c"])(e.authLevel)||("update"!==t||"serial_number"!==e.formType)&&3==e.authLevel},getItemRadio:function(e,t){"user"==e.formType||"structure"==e.formType?t.radio=!e.isMulti:"single_user"==e.formType&&(t.radio=!0)},getFormErrorMessage:function(e){if(e.fields)for(var t=0;t<e.fields.length;t++){var i=e.fields[t];if("error"==i.validateState){this.$message.error(i.validateMessage);break}}},getItemRelatveInfo:function(e,t){var i=null;if("relative"==this.action.type)i=this.action.data[t];else{var n=e.length>0&&Object(tt["a"])(e[0]),a=n?this.getItemWithFromType(e,t):e.find((function(e){return e.formType===t}));a&&a.value&&a.value.length>0&&(i=a.value[0])}return i},getSubmiteParams:function(e,t,i,n){for(var a=this,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:["desc_text"],o={entity:{},field:[]},l=function(){var l=e[r],c=null;if(c=l.hasOwnProperty("show")?l.show?t[l.fieldName]:null:t[l.fieldName],"product"==l.formType)a.getProductParams(o,c);else if("map_address"==l.formType)a.getCustomerAddressParams(o.entity,c);else if(1==l.fieldType){var d=a.getRealParams(l,c);o.entity[l.fieldName]=Object(tt["c"])(d)?"":d}else if(!s.includes(l.formType)){var u=Object(x["a"])(Object(x["a"])({},n?l:{}),{},{fieldName:l.fieldName,fieldType:l.fieldType,name:l.name,type:l.type,fieldId:l.fieldId,value:a.getRealParams(l,c)});Object(tt["a"])(i)&&i.forEach((function(e){u[e]=l[e]})),o.field.push(u)}},r=0;r<e.length;r++)l();return o},getProductParams:function(e,t){t?(e["product"]=t.product?t.product.map((function(e){return e.salesPrice=""==e.salesPrice?0:e.salesPrice,e.num=""==e.num?0:e.num,e.discount=""==e.discount?0:e.discount,e})):[],e.entity["totalPrice"]=t.totalPrice?t.totalPrice:0,e.entity["discountRate"]=t.discountRate?t.discountRate:0):(e["product"]=[],e.entity["totalPrice"]="",e.entity["discountRate"]="")},getCustomerAddressParams:function(e,t){t?(e["address"]=t.address?t.address.join(","):"",e["detailAddress"]=t.detailAddress,e["location"]=t.location,e["lng"]=t.lng,e["lat"]=t.lat):(e["address"]="",e["detailAddress"]="",e["location"]="",e["lng"]="",e["lat"]="")},getRealParams:function(e,t){var i=this,n=["customer","contacts","business","leads","contract","receivables","supplier_cause","purchase_cause","sale_cause","sale_return_cause","retreat_cause","warehouse_cause"];if(n.includes(e.formType))return Object(tt["c"])(t)?"":Object(tt["a"])(t)&&t.length>0&&Object(tt["d"])(t[0])?t[0]["".concat(e.formType,"Id")]:Object(tt["d"])(t)?t.id:Object(tt["a"])(t)?t[t.length-1]:["string","number"].includes(Object(Xi["a"])(t))?t:"";if("user"==e.formType||"structure"==e.formType){var a=t||[];return Object(tt["a"])(t)&&t.length>0?Object(tt["d"])(t[0])&&(a=t.map((function(t){return"user"==e.formType?t.userId:t.id}))):Object(tt["d"])(t)&&(a="user"==e.formType?t.userId:t.id),Object(tt["a"])(a)?a.join(","):a}if("file"==e.formType)return t&&t.length>0?t[0].batchId:"";if("category"==e.formType)return Object(tt["c"])(t)?"":Object(tt["a"])(t)?t&&t.length>0?t[t.length-1]:"":t;if("checkbox"==e.formType)return Object(tt["a"])(t)?t.join(","):t;if("select"==e.formType)return t;if("detail_table"==e.formType){for(var s=e.fieldExtendList||[],o=[],l=Array.isArray(t)?t:[],r=function(){var e=l[c];if(!i.getFormValueIsEmpty(s,e)){var t=e.batchId||Object(xe["q"])(),n=[];s.forEach((function(a){var s=Object(xe["s"])(a);delete s.companyId,s.value=i.getRealParams(s,e[s.fieldName]),s.batchId=t,n.push(s)})),o.push(n)}},c=0;c<l.length;c++)r();return o}return t},getFormValueIsEmpty:function(e,t){for(var i=0;i<e.length;i++){var n=e[i],a=t[n.fieldName];if("location"===n.formType){if(Object(tt["d"])(a)&&(!Object(tt["c"])(a.lat)||!Object(tt["c"])(a.lng)||!Object(tt["c"])(a.address)))return!1}else if(!Object(tt["c"])(a))return!1}return!0},getFormAssistIds:function(e,t){var i=this,n=[],a=t?null:{};t&&this.itemsForEach(e,(function(e){t.hasOwnProperty(e.field)||(t[e.field]=i.getItemValue(e))})),this.itemsForEach(e,(function(e){if(a&&(a[e.field]=i.getItemValue(e)),["select","checkbox"].includes(e.formType)&&"options_type"===e.remark&&e.optionsData)for(var t in e.optionsData)n=n.concat(e.optionsData[t]||[])})),n=n.filter((function(e){return Boolean(e)})),n=Array.from(new Set(n));var s=[];return this.getFormAssistData(e,t||a,n,s),n.filter((function(e){return!s.includes(e)}))},getFormAssistData:function(e,t,i,n){var a=n.length;if(this.itemsForEach(e,(function(e){if(["select","checkbox"].includes(e.formType)&&"options_type"===e.remark&&e.optionsData){var a=t?t[e.field||e.fieldName]:e.value;if(!i.includes(e.formAssistId)){if("select"===e.formType)if(Object(tt["c"])(a))a=[];else{var s=e.setting.find((function(e){return Object(tt["d"])(e)?e.value===a:e===a}));if(s){var o=Object(tt["d"])(s)?s.value:s;a=[o]}else a=[Qi]}else if("checkbox"===e.formType)if(Object(tt["a"])(a)){var l=Object(xe["s"])(a),r=l.filter((function(t){return!e.setting.includes(t)}));if(r.length>0){var c=l.filter((function(e){return!r.includes(e)}));c.push(Qi),a=c}}else a=[];var d=function(t){if(a){var i=a.findIndex((function(e){return e==t}));if(-1===i)return"continue";for(var s=e.optionsData[t]||[],o=0;o<s.length;o++){var l=s[o];n.includes(l)||n.push(l)}}};for(var u in e.optionsData)d(u)}}})),a!==n.length){var s=i.filter((function(e){return!n.includes(e)}));this.getFormAssistData(e,t,s,n)}},getFormContentByOptionsChange:function(e,t){var i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=arguments.length>4?arguments[4]:void 0,o=this.fieldRules||n,l=this.action&&this.action.data?this.action.data:a,r=this.action&&this.action.type?this.action.type:s,c={},d={},u=this.getFormAssistIds(e,t);return this.itemsForEach(e,(function(e){e.show=!u.includes(e.formAssistId),e.show&&!e.disabled&&(o[e.field]?c[e.field]=o[e.field]:c[e.field]=i.getRules(e)),e.show&&(t.hasOwnProperty(e.field)?d[e.field]=t[e.field]:d[e.field]=i.getItemValue(e,l,r))})),{fieldForm:d,fieldRules:c}}}},Zi={methods:{flowGetAuthPostFields:function(e,t,i,n){return new Promise((function(a,s){i&&i.getCustomFieldPostParams().then((function(i){var s=i.entity,o=i.field,l=n.batchId,r=[];t.forEach((function(t,i){if(3===t.authLevel){var n=null;if(1==t.fieldType)n=s?s[t.fieldName]:null;else{var a=o.find((function(e){return e.fieldName===t.fieldName}));n=a?a.value:null}var c=null;if(["detail_table"].includes(t.formType))if(Array.isArray(t.value)){var d=Object(xe["s"])(t.value);d.forEach((function(e){e.forEach((function(e){e.value=Yi.methods.getRealParams(e,e.value)}))})),c=d}else c=t.value;else c=Yi.methods.getRealParams(t,t.value);r.push({batchId:l,label:e,fieldName:t.fieldName,fieldId:t.fieldId,type:t.type,fieldType:t.fieldType,name:t.name,newValue:n&&"object"===Object(Xi["a"])(n)?JSON.stringify(n):n,oldValue:c&&"object"===Object(Xi["a"])(c)?JSON.stringify(c):c})}})),a(r)})).catch((function(e){s(e)}))}))},flowGetFlowStepList:function(e){return new Promise((function(t,i){_({recordId:e}).then((function(e){t(e)})).catch((function(e){i(e)}))}))},flowGetAuthFields:function(e){return new Promise((function(t,i){U(e).then((function(e){t(e)})).catch((function(e){i(e)}))}))},flowGetCurrentFlowId:function(e){var t="";return e.forEach((function(e){3==e.examineStatus&&(t=e.flowId)})),t},flowGetOADetailRequestFun:function(){return Ji}}};function en(e){return Object(w["a"])({url:"/crmField/queryUserField/".concat(e.label),method:"post",data:e})}function tn(e){return Object(w["a"])({url:"/crmFlow/queryFlowUserField/".concat(e.settingId),method:"post",data:e,headers:{"Content-Type":"application/x-www-form-urlencoded"}})}var nn=i("c9d9"),an=i("e297"),sn=i.n(an),on={data:function(){return{wkRoleOption:[],memberControlList:[]}},provide:function(){return{memberControlFun:this.memberControlFun}},methods:{getListInfo:function(e,t,i){var n=this,a=Object(W["a"])({additionalInfo:null,additionalInfoFun:null,cycleFun:null},i||{});e.forEach((function(i,s){0===i.examineType?t.push(n.getConditonWrapInfo(i,s,a,e,t)):t.push(n.getNodeInfo(i,s,a,e))}))},getNodeInfo:function(e,t,i,n){var a=this,s={examineType:e.examineType,name:e.name,conditionList:[],deptList:e.deptList,roleIdList:e.roleIdList,type:e.type,userList:e.userList||[],chooseType:e.chooseType,rangeType:e.rangeType,parentLevel:1,tempParentLevel:1,overType:1,isError:!1};if(1===e.examineType)s.memberUserList=e.userList;else if(5===e.examineType)1===e.type?0===e.parentLevel?(s.overType=0,s.parentLevel=1):(s.overType=1,s.parentLevel=e.parentLevel):2===e.type&&(s.overType=0,s.parentLevel=1,s.tempParentLevel=e.parentLevel);else if(7===e.examineType)s={examineType:e.examineType,name:e.name,userList:e.userList||[],isSelf:e.isSelf,isAdd:e.isAdd,roleIdList:e.roleIdList||[],roleList:e.roleList||[],parentLevelList:e.parentLevelList||[]};else if(8===e.examineType){var o=e.parentLevel,l=this.memberControlList.filter((function(t){return t.fieldName==e.fieldName})).length;l?(s.fieldName=e.fieldName,s.fieldId=e.fieldId,s.parentLevelCheck=Boolean(o),s.parentLevel=e.parentLevel):(s.fieldName="",s.fieldId="",s.type=1)}else s.parentLevel=e.parentLevel;if(s.roleList=[],e.roleIdList&&e.roleIdList.length>0&&this.getRoleList().then((function(t){a.getRoleItems(e.roleIdList,t,s.roleList)})),e.fieldAuthList&&(s.fieldAuthList=e.fieldAuthList),i.additionalInfo)for(var r in i.additionalInfo)s[r]=i.additionalInfo[r];return i.additionalInfoFun&&i.additionalInfoFun(s,e,t,n,t),s},getConditionNodeInfo:function(e,t,i,n,a){var s=this,o={conditionName:e.conditionName,sort:t+1,conditionDataList:[],examineDataList:[],isError:!1};if(e.conditionDataList.forEach((function(e){o.conditionDataList.push(s.getSectionConditionInfo(e))})),i.additionalInfo)for(var l in i.additionalInfo)o[l]=i.additionalInfo[l];return i.additionalInfoFun&&i.additionalInfoFun(o,e,t,n,a),o},getSectionConditionInfo:function(e){var t=this;return e.map((function(e){var i={name:e.name,fieldName:e.fieldName,fieldId:e.fieldId,type:e.type,conditionType:e.conditionType};if(3===e.type||9===e.type)i.values=e.values,t.validateSetting(i);else if(6===e.conditionType)e.values&&4===e.values.length?(i.leftValue=parseInt(e.values[0]),i.leftCondition=parseInt(e.values[1]),i.rightCondition=parseInt(e.values[2]),i.rightValue=parseInt(e.values[3])):(i.leftValue=0,i.leftCondition=1,i.rightCondition=1,i.rightValue=0),i.values=0;else if(8===e.conditionType){var n=e.values;i.values={deptList:n.deptList.map((function(e){return e.deptId})),roleList:n.roleList,userList:n.userList.map((function(e){return e.userId}))},i.deptList=n.deptList,i.userList=n.userList,i.roleList=[],n.roleList.length>0&&t.getRoleList().then((function(e){t.getRoleItems(n.roleList,e,i.roleList)}))}else i.leftValue=0,i.leftCondition=1,i.rightCondition=1,i.rightValue=0,e.values&&e.values.length>0?i.values=e.values[0]:i.values=0;return i}))},validateSetting:function(e){},getRoleList:function(){var e=this;return new Promise((function(t,i){e.wkRoleOption.length>0?t(e.wkRoleOption):Jt().then((function(i){e.wkRoleOption=i.data||[],t(e.wkRoleOption)})).catch((function(){}))}))},getRoleItems:function(e,t,i){for(var n=0;n<t.length;n++){var a=t[n];if(e.includes(a.roleId)&&(i.push(a),e.length===i.length))break;a.list&&this.getRoleItems(e,a.list,i)}},getRoleObj:function(e,t,i){for(var n=0;n<t.length;n++){var a=t[n];if(a.roleId===e){i.roleObj=a;break}a.list&&this.getRoleObj(e,a.list,i)}},getConditonWrapInfo:function(e,t,i,n,a){var s=this,o={examineType:e.examineType,name:e.name,conditionList:[]};return e.conditionList.forEach((function(l,r){var c=s.getConditionNodeInfo(l,r,i,n,t);o.conditionList.push(c),i.cycleFun&&i.cycleFun("conditionList",{conditionWrapInfo:o,index:r,conditionWrap:e,parentList:n,conditionIndex:t,newList:a}),s.getListInfo(l.examineDataList,c.examineDataList,i)})),o},getUserFieldList:function(e,t,i){var n=this;if(sn.a.get(nn["b"])){var a={},s=null;0==e?(a.categoryId=t,s=T):[1,2,3].includes(e)?(a.label={1:6,2:7,3:18}[e],s=en):[5,6,7,8,9,10,11,12].includes(e)?(a.label={5:3,6:4,7:5,8:6,9:9,10:10,11:11,12:12}[e],s=O):null!==i&&void 0!==i&&i.settingId&&(s=tn,a.settingId=null===i||void 0===i?void 0:i.settingId),s&&s(a).then((function(e){n.memberControlList=e.data||[]}))}},memberControlFun:function(){return this.memberControlList}}},ln={name:"ExamineInfoSection",components:{ExamineHandle:J,CheckFlow:te,WkHeadSection:re,WkDepUserDialog:ce["a"],SolicitOthers:ke,ExamineBtnBar:Ie,ExamineEditDataDetail:Ue,WkApproveFlow:Ii,XrCreate:Wi},filters:{},mixins:[Q,Zi,on],provide:function(){return{examineInfoSection:this}},props:{examineType:{type:String,default:""},id:[String,Number],recordId:[String,Number],examineRecord:{type:Object,default:function(){}},externalMailbox:{type:Boolean,default:!1},isStageFlow:{type:Boolean,default:!1},placement:{type:String,default:"bottom"},ignoreAction:{type:Array,default:function(){return[]}}},data:function(){return{dialogLoading:!1,loading:!1,examineInfo:{},showFlowPopover:!1,examineHandleInfo:{status:1},examineHandleProps:{setBackNodeShow:!1},examineHandleShow:!1,userViewDialogShow:!1,solicitOthersShow:!1,externalDialogShow:!1,email:"",flowId:"",examineAdvancedConfigVO:{},selectUserProps:{showUser:!0,showDept:!1,showDisableUser:!1,disableUserLabel:"员工"},examineOptionalShow:!1,optionalUserList:[],addUserType:"default",createType:"",authFields:[],createProps:null,crmCreateShow:!1,oaCreateShow:!1,jxcCreateShow:!1,editDetailItem:null,editDetailVisible:!1,configShow:!1,configFlowList:[],configFlowProps:{conditionAddShow:!1,examineAddShow:!1,copyAddShow:!1},sendNode:{name:"发起人",content:"具有新建权限的员工"}}},computed:Object(x["a"])(Object(x["a"])({},Object(B["c"])(["userInfo"])),{},{sendLevelOption:function(){for(var e=[],t=1;t<=20;t++){var i="第".concat(t,"级上级");1===t?e.push({label:"直属上级",value:t}):e.push({label:i,value:t})}return e},examineFlowList:function(){return this.examineInfo.examineFlowList?this.examineInfo.examineFlowList:[]},superRestoreHandleShow:function(){var e;return 1==(null===(e=this.examineInfo)||void 0===e?void 0:e.isRestore)&&!this.isStageFlow&&!this.ignoreAction.includes("recovery")},superSkipHandleShow:function(){var e;return 1==(null===(e=this.examineInfo)||void 0===e?void 0:e.isSkip)},isFieldAuthExamine:function(){return this.isCRMExamine||this.isOAExamine||this.isJXCExamine},isCRMExamine:function(){if(this.examineInfo){var e=this.examineInfo.label;return e>=1&&e<=3}return!1},isJXCExamine:function(){if(this.examineInfo){var e=this.examineInfo.label;return e>=5&&e<=12}return!1},isOAExamine:function(){if(this.examineInfo){var e=this.examineInfo.label;return 0===e}return!1},examineMoreHandle:function(){var e,t=this;if(this.isOptionalNode)return[];var i=1==this.examineInfo.isCheck,n=1==this.examineInfo.isRecheck,a=1==this.examineInfo.isSuperAdmin,s=this.examineInfo.createUser,o=null===(e=this.examineAdvancedConfigVO)||void 0===e?void 0:e.privilege,l=isNaN(o)?"000":o.toString(2).padStart(3,"0"),r="1"==l[0],c="1"==l[1],d="1"==l[2],u=[];if(this.externalMailbox)u=i&&r?[{label:"终止",value:"termination"}]:[];else{var m,p;if(i){var h,f,v=null===(h=this.examineAdvancedConfigVO)||void 0===h?void 0:h.isTransferable,b=null===(f=this.examineAdvancedConfigVO)||void 0===f?void 0:f.isConsult;v&&u.push({label:"转他人处理",value:"forwardOthers"}),b&&u.push({label:"征求他人意见",value:"solicitOthers"}),r&&u.push({label:"终止",value:"termination"})}var g=this.examineInfo,y=g.examineFlowList,x=void 0===y?[]:y,w=g.examineStatus,_=(null===(m=this.userInfo)||void 0===m?void 0:m.userId)===s.userId||a||1==(null===(p=this.userInfo)||void 0===p?void 0:p.isAdmin),C=_&&x.some((function(e){return 3===e.examineStatus}));C&&u.push({label:"邮件催办",value:"emailReminder"}),(i||_)&&14!==w&&8!==w&&13!==w&&(d&&u.push({label:"归档",value:"archive"}),c&&u.push({label:"作废",value:"cancellation"})),n&&u.push({label:"撤回",value:"retract"})}if(this.superSkipHandleShow&&u.push({label:"跳过",value:"skip"}),"hrm_salary"==this.examineType){var k=[],L=["archive","cancellation"];u.forEach((function(e,t){L.includes(e.value)||k.push(e)})),u=k}if(this.isStageFlow){var S=[],N=["termination","emailReminder","archive","cancellation"];u.forEach((function(e){N.includes(e.value)||S.push(e)})),u=S}return u.filter((function(e){return!t.ignoreAction.includes(e.value)}))},examineCategory:function(){return function(e){return ut[e]}},examineNodeName:function(){var e=this;return function(t){var i=t.name?12==t.examineStatus?t.name:t.name+"：":"",n="";return n=7!=t.examineType||[18,19,14,15].includes(Number(t.examineStatus))?105==t.passFlag?"管理员干涉跳过":e.getShowStatusName(t.examineStatus,t.isAdminSkip):"抄送","".concat(i).concat(n)}},passFlagNumText:function(){return function(e,t){var i,n,a,s=this,o={1:"审批人不存在，",2:"审批人不存在，",102:"未找到审批人，",202:"未找到审批人，",104:"审批人不存在，",204:"审批人不存在，"},l={1:"自动同意",2:"自动转交给 ".concat(null===(i=this.examineAdvancedConfigVO.nodeHandleUser)||void 0===i?void 0:i.map((function(e){return s.$getUserName(e)})).join()),102:"自动同意",202:"自动转交给 ".concat(null===(n=this.examineAdvancedConfigVO.nodeHandleUser)||void 0===n?void 0:n.map((function(e){return s.$getUserName(e)})).join()),104:"自动同意",204:"自动转交给 ".concat(null===(a=this.examineAdvancedConfigVO.nodeHandleUser)||void 0===a?void 0:a.map((function(e){return s.$getUserName(e)})).join())};return 0!=t?o[e]+"已"+l[e]:o[e]+"将"+l[e]}},showOneUserExamine:function(){return function(e){var t=e.passFlag,i=e.userList,n=e.examineType,a=i[0];if(7==n)return"";if((!t||[101,201,103,203,205].includes(t))&&!a.hasOwnProperty("isAdvance"))return"";var s=a.isAdvance||null;return[104,204].includes(t)?this.passFlagNumText(t,a.examineStatus):102==t||s&&1==s?this.passFlagNumText(102,a.examineStatus):202==t||s&&2==s?this.passFlagNumText(202,3,i):[402].includes(t)?"审批人不存在":void 0}},showMultiplayerExamine:function(){return function(e,t){var i=t.map((function(e){return e.isAdvance})).includes(2);if([101,201,103,203,205,401].includes(e)||!e&&!i)return"";var n=t.map((function(e){return e.passFlag})).includes(104)||t.map((function(e){return e.passFlag})).includes(204),a=t.map((function(e){return e.hasOwnProperty("duration")})).includes(!0);return i?this.passFlagNumText(202,1,t):a||n?"":this.passFlagNumText(e,1,t)}},disableUserShow:function(){return function(e,t,i){return 104!=e&&204!=e?"":204==e&&11==i.examineStatus||104==e&&1==t?this.passFlagNumText(e,t):void 0}},limitDisableShow:function(){return function(){var e=this.examineAdvancedConfigVO.nodeHandleType;return this.passFlagNumText(e,3,0)}},timeLimitStyleShow:function(){var e=this.examineAdvancedConfigVO.advancedLimitTimeVO||{};if(Object(tt["c"])(e))return!1;var t=e.handleType;return 1!=t},isOptionalNode:function(){var e=this.examineInfo,t=e.examineFlowList,i=e.createUser;if(!this.userInfo||i.userId!==this.userInfo.userId)return null;var n=t[t.length-1],a=n.examineType,s=n.isAdd,o=n.userList;return 7==a&&1==s&&!o.length||4==a&&!o.length?{examineType:a,addBtnName:{7:"选择抄送人",4:"选择审批人"}[a]}:null},isAddUser:function(){var e=this.examineInfo.examineFlowList,t=e[e.length-1],i=t.chooseType;return!(1==i&&1==this.optionalUserList.length||1!=i&&20==this.optionalUserList.length)},canCheckEditFieldData:function(){var e=this;return function(t){var i=e.isFieldAuthExamine&&7!=t.examineType&&!!t.examineType&&6!=t.examineStatus;return i&&(1===t.userList.length?i=!e.showOneUserExamine(t):t.userList.length>1&&(i=!e.showMultiplayerExamine(t.passFlag,t.userList))),i&&(1===t.userList.length?i=1==t.examineStatus:t.userList.length>1&&(i=t.userList.some((function(e){return 1==e.examineStatus})))),i}}}),watch:{loading:function(e){this.$emit("on-loading",e)},recordId:{handler:function(e){e&&this.refreshData()},deep:!0,immediate:!0},examineFlowList:{handler:function(e){this.flowId=this.flowGetCurrentFlowId(e)},immediate:!0,deep:!0},examineRecord:{handler:function(e){Object(tt["c"])(e)||this.updateExamineInfo(this.examineRecord)},deep:!0,immediate:!0}},methods:{refreshData:function(){this.examineInfo={},this.getFlowStepOAList(),this.$refs.checkFlow&&this.$refs.checkFlow.getDetail()},getShowStatusName:function(e,t){return 18===e?t?"跳过":"节点被跳过":this.getStatusName(e)},emailExamineHandleClick:function(e,t){var i=this;t?this.$message.error("请输入审批意见（必填）"):V({emailToken:this.$route.query.k,status:this.examineHandleInfo.status,remarks:e}).then((function(e){i.$message.success("操作成功"),i.$refs.examineHandleRef.resetInfo(),i.examineHandleShow=!1,i.$emit("success")})).catch((function(e){}))},getFlowStepOAList:function(){var e=this;this.loading=!0,this.flowGetFlowStepList(this.recordId).then((function(t){e.loading=!1;var i=t.data||{};e.updateExamineInfo(i)})).catch((function(){e.loading=!1}))},updateExamineInfo:function(e){this.examineAdvancedConfigVO=e.examineAdvancedConfigVO,this.examineInfo=e,this.getUserFieldList(this.examineInfo.label,this.examineAdvancedConfigVO.examineId)},examineClick:function(){return Object(y["a"])(Object(g["a"])().mark((function e(){return Object(g["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},moreHandlerClick:function(e){this.addUserType="default","selectUser"==e?(this.selectUserProps={showUser:!0,showDept:!1,showDisableUser:!1,disableUserLabel:"员工"},this.userViewDialogShow=!0):"external"==e?this.externalDialogShow=!0:"solicitOthers"==e?this.solicitOthersShow=!0:"termination"==e?this.examineHandleClick(13):"emailReminder"==e?this.emailReminder():"archive"==e?this.examineHandleClick(14):"cancellation"==e?this.examineHandleClick(8):"retract"==e?this.examineHandleClick(4):"skip"==e&&this.examineHandleClick(18)},examineHandleClick:function(e){if("selectExamineUser"!=e){var t=this.examineAdvancedConfigVO.isRejectChooseFlow;this.examineHandleProps.setBackNodeShow=(t&&2==e||this.superRestoreHandleShow&&19==e||this.superSkipHandleShow&&18==e)&&!this.externalMailbox,this.examineHandleInfo.status=e,this.examineHandleShow=!0}else this.examineOptionalShow=!0},getAuthFieldsParams:function(){if(this.isFieldAuthExamine){var e=null;if(this.isOAExamine)e=this.$refs.oaAllCreate;else if(this.isCRMExamine){var t;e=null===(t=this.$refs.crmAllCreate)||void 0===t?void 0:t.$refs.create}else if(this.isJXCExamine){var i;e=null===(i=this.$refs.jxcAllCreate)||void 0===i?void 0:i.$refs.create}if(e){var n=null;return this.isOAExamine?n=0:this.isCRMExamine&&(n={contract:6,receivables:7,invoice:18}[this.createType]),this.flowGetAuthPostFields(n,this.authFields,e,this.crmCreateAction.data)}}return null},archivedObsolete:function(e,t){var i=this,n={archiveOrVoidFlag:e,recordId:this.recordId};S(n).then((function(e){i.$message.success("操作成功"),i.getFlowStepOAList(),i.$emit("on-handle",t)}))},emailReminder:function(){var e=this;L({examineRecordId:this.recordId}).then((function(t){e.$message.success("操作成功"),e.getFlowStepOAList()}))},examineHandleSuccess:function(e){this.closeFieldView(),this.getFlowStepOAList(),this.$refs.checkFlow&&this.$refs.checkFlow.getDetail(),this.$emit("on-handle",e)},getDetailName:function(e){return e.userList&&0!==e.userList.length?1===e.userList.length?this.$getUserName(e.userList[0])?this.$getUserName(e.userList[0]):e.userList[0].outerUserEmail:5===e.examineType?"".concat(e.userList.length,"人").concat(ut[1]):"".concat(e.userList.length,"人").concat(ut[e.type]):"XX"},selectUserChange:function(e,t,i){var n=this;if("optional"!=this.addUserType){var a={examineFlowFinalUser:{userId:e[0]},flowFinalId:this.flowId,recordId:this.recordId};C(a).then((function(e){n.closeFieldView(),n.getFlowStepOAList()}))}else{var s;this.optionalUserList.map((function(e){return e.userId})).includes(i[0].userId)||(s=this.optionalUserList).push.apply(s,Object(b["a"])(i))}},verifyEmail:function(){var e=this;if(Object(xe["t"])(this.email)){if("optional"==this.addUserType)return this.optionalUserList.map((function(e){return e.email})).includes(this.email)||this.optionalUserList.push({email:this.email}),this.email=null,void(this.externalDialogShow=!1);var t={examineFlowFinalUser:{email:this.email},flowFinalId:this.flowId,recordId:this.recordId};C(t).then((function(t){e.getFlowStepOAList()})),this.email=null,this.externalDialogShow=!1}else this.$message.error("邮箱格式有误")},solicitOthersHandler:function(e){var t=this,i=Object(x["a"])(Object(x["a"])({},e),{},{insertTarget:this.flowId,recordId:this.recordId});k(i).then((function(){t.closeFieldView(),t.getFlowStepOAList()}))},autoExamineText:function(e,t,i,n){var a,s=Number(e||0),o=null===(a=this.examineAdvancedConfigVO)||void 0===a?void 0:a.advancedLimitTimeVO;if(!o||0==n.userStatus||!s)return{};var l=o.handleType,r=o.handleUserList,c=o.limitTime,d=o.limitTimeUnit,u={minute:Number(zi["a"].minus(zi["a"].times(c,60,1e3),s)),hour:Number(zi["a"].minus(zi["a"].times(c,60,60,1e3),s)),day:Number(zi["a"].minus(zi["a"].times(c,24,60,60,1e3),s))},m={minute:"分钟",hour:"小时",day:"天"};if(103==i)return{text:"【限时审批】流程在审批人处停留超过".concat(c).concat(m[d],"，系统已自动同意"),class:"background-color: #EBECF0;color:#999"};if(203==i)return{text:"【限时审批】流程在审批人处停留超过".concat(c).concat(m[d],"，系统已【自动转交】给").concat(this.getHandleUserList(r)),class:"background-color: #EBECF0;color:#999"};if(u[d]>0){var p=qi.a.duration(u[d]).days()?qi.a.duration(u[d]).days()+"天":"",h=qi.a.duration(u[d]).hours()?qi.a.duration(u[d]).hours()+"小时":"",f=qi.a.duration(u[d]).minutes()?qi.a.duration(u[d]).minutes()+"分钟":"";if(3==l)return{text:p||h||f?p+h+f+"后自动同意":"1分钟后自动同意",class:"color: red"};if(2==l)return{text:p||h||f?p+h+f+"后自动转交给"+this.getHandleUserList(r):"1分钟后自动转交给"+this.getHandleUserList(r),class:"color: red"}}else{if(2==l)return{text:"【限时审批】流程在审批人处停留超过".concat(c).concat(m[d],"，系统").concat(1==t?"已":"将","【自动转交】给").concat(this.getHandleUserList(r)),class:"background-color: #EBECF0;color:#999"};if(3==l)return{text:"【限时审批】流程在审批人处停留超过".concat(c).concat(m[d],"，系统").concat(1==t?"已":"将","自动同意"),class:"background-color: #EBECF0;color:#999"}}},getHandleUserList:function(e){var t=this;return e.map((function(e){var i=e.type,n=e.dataList;return 1==i?n.map((function(e){var i;return null===(i=t.sendLevelOption[e.parentLevel-1])||void 0===i?void 0:i.label})).join():n.map((function(e){return t.$getUserName(e)})).join()})).join()},singleNodeDisableUserShow:function(e){var t=e.userList;if(1!==(null===t||void 0===t?void 0:t.length))return!1;var i=t[0];return!(!this.$getUserName(i)&&!i.outerUserEmail||i.hasOwnProperty("userStatus")&&0==i.userStatus&&7!=e.examineType&&[104,204].includes(i.passFlag))||void 0},disableAvatarUserShow:function(e){var t=e.passFlag,i=e.examineStatus;return(104!=t||1!=i)&&(204!=t||11!=i)},submitExamineUser:function(){var e=this;if(0!=this.optionalUserList.length){this.dialogLoading=!0;var t=this.examineInfo.examineFlowList,i=t[t.length-1],n=i.flowId,a=i.examineType,s={flowId:n,examineType:a,recordId:this.recordId,userList:this.optionalUserList};N(s).then((function(){e.dialogLoading=!1,e.selectExamineUserClose(),e.getFlowStepOAList()})).catch((function(){e.dialogLoading=!1}))}},selectExamineUserClose:function(){this.optionalUserList=[],this.examineOptionalShow=!1},deleteUserClick:function(e){this.optionalUserList.splice(e,1)},addingMode:function(e){this.addUserType="optional","selectUser"==e?this.selectUserClick():"external"==e&&(this.externalDialogShow=!0,this.email=null)},selectUserClick:function(){var e=this.examineInfo.examineFlowList,t=e[e.length-1],i=t.chooseUserList,n=t.rangeType,a=t.examineType,s=null;4==a&&(2!=n&&3!=n||(s=i)),this.selectUserProps={showUser:!s,showDept:!1,showDisableUser:!!s,disableUserList:s,disableUserLabel:"员工"},this.userViewDialogShow=!0},checkEditFieldDataClick:function(e){this.editDetailItem=e,this.editDetailVisible=!0},closeFieldView:function(){this.crmCreateShow&&(this.crmCreateShow=!1),this.oaCreateShow&&(this.oaCreateShow=!1),this.jxcCreateShow&&(this.jxcCreateShow=!1)},checkExamineConfig:function(){var e=this;this.configShow=!0;var t=this.examineFlowList.map((function(e){return e.flowId})),i=this.examineFlowList.length>0?this.examineFlowList[this.examineFlowList.length-1].flowId:null,n=null;this.loading=!0,j({examineId:this.examineAdvancedConfigVO.examineId}).then((function(a){var s=a.data||[],o=[];e.getListInfo(s,o,{additionalInfoFun:function(e,a,s,o,l){e.disabled=!0,e.conditionName?(e.modal=!(i&&!n)||!a.examineDataList.some((function(e){return t.includes(e.flowId)})),a.flowId==i&&(n=a.flowId)):e.modal=!t.includes(a.flowId)},cycleFun:function(e,t){if("conditionList"===e&&t.conditionWrap.conditionList.length-1===t.index&&t.conditionWrapInfo.conditionList.every((function(e){return e.modal})))if((null===t||void 0===t?void 0:t.conditionIndex)>0){if(t.newList.length>0){var i=t.newList[t.newList.length-1];if(!i.modal&&!n)for(var a=0;a<t.conditionWrapInfo.conditionList.length;a++){var s=t.conditionWrapInfo.conditionList[a];if(!s.examineDataList.length){s.modal=!1;break}}}}else if(!n){var o;(null===(o=t.conditionWrapInfo)||void 0===o?void 0:o.conditionList.length)>0&&(t.conditionWrapInfo.conditionList[0].modal=!1)}}}),e.configFlowList=o,e.loading=!1})).catch((function(){e.loading=!1}))}}},rn=ln,cn=(i("d4afb"),Object(m["a"])(rn,f,v,!1,null,"09679ac8",null)),dn=cn.exports,un=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"cell"},e._l(e.fileList,(function(t,n){return i("flexbox",{key:n,staticClass:"cell-list"},[i("img",{staticClass:"cell-head",attrs:{src:e._f("fileIcon")(t.name),alt:""}}),e._v(" "),i("div",{staticClass:"cell-body text-one-line",class:{"cursor-pointer":e.cursorPointer}},[i("span",[e._v(e._s(t.name.length>20?t.name.substring(0,20)+"...":t.name))])]),e._v(" "),i("div",{staticClass:"info text-one-line"},[e._v("\n      ("+e._s(e._f("getFileSize")(t.size))+")\n      "),e.showTime?i("span",{staticStyle:{"margin-left":"15px"}},[e._v(e._s(e._f("changeTime")(t.createTime)))]):e._e()]),e._v(" "),e.isExposed?i("div",[i("el-button",{attrs:{type:"primary-text"},on:{click:function(i){e.handleCommand({type:"preview",data:t,fileIndex:n})}}},[e._v("预览")]),e._v(" "),i("el-button",{attrs:{type:"primary-text"},on:{click:function(i){e.handleCommand({type:"download",data:t,fileIndex:n})}}},[e._v("下载")]),e._v(" "),i("el-button",{attrs:{type:"primary-text"},on:{click:function(i){e.handleCommand({type:"delete",data:t,fileIndex:n})}}},[e._v("删除")])],1):i("el-dropdown",{attrs:{"hide-on-click":!1},on:{command:e.handleCommand}},[i("i",{staticClass:"el-icon-more more",staticStyle:{cursor:"pointer"}}),e._v(" "),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",{attrs:{command:{type:"preview",data:t,fileIndex:n}}},[i("span",[e._v("\n            预览\n          ")])]),e._v(" "),i("el-dropdown-item",{attrs:{command:{type:"download",data:t,fileIndex:n}}},[i("span",{attrs:{type:"text"}},[e._v("\n            下载\n          ")])]),e._v(" "),i("el-dropdown-item",{attrs:{command:{type:"delete",data:t,fileIndex:n}}},[e.showDelete?i("span",{attrs:{type:"text"}},[e._v("\n            删除\n          ")]):e._e()])],1)],1)],1)})))},mn=[],pn={name:"FileCell",filters:{getFileSize:function(e){return Object(xe["e"])(Number(e))},changeTime:function(e){var t=new Date(e).getTime();return Object(xe["x"])(t,"yyyy年MM月DD日 ah:mm:ss")},fileIcon:function(e){var t=e?e.split("."):[],i="";return i=t.length>0?t[t.length-1]:"",Object(xe["i"])(i)}},props:{fileList:Array,showFoot:{type:Boolean,default:!0},showTime:{type:Boolean,default:!0},showDelete:{type:Boolean,default:!1},cursorPointer:{type:Boolean,default:!1},moduleId:[String,Number],isExposed:{type:Boolean,default:!1}},data:function(){return{}},computed:{},watch:{},mounted:function(){},beforeDestroy:function(){},methods:{handleCommand:function(e){"download"===e.type?this.downloadClick(e.data):"preview"===e.type?this.previewClick(e.data,e.fileIndex):"delete"===e.type&&this.deleteClick(e.data,e.fileIndex)},downloadClick:function(e){Object(xe["c"])({path:e.filePath||e.url,name:e.name})},previewClick:function(e,t){Object(xe["a"])(e.name)?Object(xe["A"])(e.filePath||e.url,e.name):this.$wkPreviewFile.preview({index:t||0,data:this.fileList.map((function(e){return{url:e.filePath||e.url,name:e.name}}))})},deleteClick:function(e,t){var i=this;this.$confirm("确定删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(Gt["d"])({id:e.fileId}).then((function(n){i.$message.success("操作成功"),i.$emit("delete",t,e)})).catch((function(){}))})).catch((function(){}))}}},hn=pn,fn=(i("7e8c"),Object(m["a"])(hn,un,mn,!1,null,"0213e352",null)),vn=fn.exports,bn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"related-business-wrap",style:{"margin-left":e.marginLeft}},[i("div",{staticClass:"related-business"},e._l(e.relatedListData,(function(t,n){return i("div",{key:n,class:{"related-business-list":t.length>0}},e._l(t,(function(t,a){return i("related-business-cell",{key:a,staticClass:"related-business-items",attrs:{data:t,"cell-index":a,type:n,"show-foot":e.showFoot},on:{unbind:e.delRelevance}})})))}))),e._v(" "),e.showAdd?[e.showRelative?i("crm-relative",{ref:"crmrelative",attrs:{visible:e.showRelative,radio:!1,"selected-data":e.relatedListData,"show-types":e.showTypes},on:{"update:visible":function(t){e.showRelative=t},changeCheckout:e.checkInfos}}):e._e(),e._v(" "),e.showCRMPermission?i("span",{staticClass:"add-btn",attrs:{slot:"reference"},on:{click:function(t){e.showRelative=!0}},slot:"reference"},[i("i",{staticClass:"wk wk-l-plus"}),e._v(" "),i("span",{staticClass:"label"},[e._v("关联业务")])]):e._e()]:e._e()],2)},gn=[],yn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("flexbox",{staticClass:"cell"},[i("div",{staticClass:"cell-head"},[i("span",[e._v("\n      "+e._s("相关"+e.typeName+"-")+"\n    ")])]),e._v(" "),i("div",{staticClass:"cell-body text-one-line",class:{"cursor-pointer":e.cursorPointer},on:{click:e.bodyClick}},[e._v("\n    "+e._s(e.name)+"\n  ")]),e._v(" "),e.showFoot?i("div",{staticClass:"cell-foot"},[i("el-dropdown",{on:{command:e.handleClick}},[i("span",{staticClass:"el-dropdown-link"},[i("i",{staticClass:"el-icon-more",staticStyle:{cursor:"pointer"}})]),e._v(" "),i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",[i("a",{staticClass:"cancel-btn"},[e._v(" 取消关联 ")])])],1)],1)],1):e._e(),e._v(" "),i("c-r-m-full-screen-detail",{attrs:{id:e.detailId,visible:e.showFullDetail,"crm-type":e.type},on:{"update:visible":function(t){e.showFullDetail=t}}})],1)},xn=[],wn=(i("a4d3"),i("e01a"),{name:"RelatedBusinessCell",components:{CRMFullScreenDetail:function(){return i.e("chunk-3827bb22").then(i.bind(null,"df3e"))}},props:{type:{type:String,default:""},cellIndex:Number,data:Object,showFoot:{type:Boolean,default:!0},cursorPointer:{type:Boolean,default:!0}},data:function(){return{showFullDetail:!1,detailId:0}},computed:{typeName:function(){return"customer"==this.type?"客户":"contacts"==this.type?"联系人":"business"==this.type?"商机":"contract"==this.type?"合同":"receivables"==this.type?"回款":"product"==this.type||"module"==this.type?"产品":""},name:function(){return"receivables"==this.type?this.data.number||this.data.name:this.data.description||this.data.name||this.data.businessName||this.data.customerName||this.data.number}},watch:{},mounted:function(){},beforeDestroy:function(){},methods:{handleClick:function(){this.$emit("unbind",this.type,this.cellIndex,this.data)},footClick:function(){this.$emit("unbind",this.type,this.cellIndex,this.data)},bodyClick:function(){"module"!=this.type&&(this.detailId=this.data["".concat(this.type,"Id")]||this.data.id,this.showFullDetail=!0)}}}),_n=wn,Cn=(i("2dde"),Object(m["a"])(_n,yn,xn,!1,null,"42df6538",null)),kn=Cn.exports,Ln={name:"RelatedBusiness",components:{CrmRelative:function(){return i.e("chunk-0dccc60a").then(i.bind(null,"9a4b"))},RelatedBusinessCell:kn},props:{marginLeft:{type:String,default:"20px"},allData:{type:Object,default:function(){return{contacts:[],customer:[],business:[],contract:[]}}},showFoot:{type:Boolean,default:!1},showAdd:{type:Boolean,default:!0},showAddBtn:{type:Boolean,default:!0}},data:function(){return{showTypes:["customer","contacts","business","contract","receivables","module"],relatedListData:{},showRelative:!1}},computed:Object(x["a"])(Object(x["a"])({},Object(B["c"])(["crm"])),{},{showCRMPermission:function(){return this.showAddBtn}}),watch:{allData:function(){for(var e in this.relatedListData={},this.allData)this.allData[e]&&this.allData[e].length>0&&this.$set(this.relatedListData,e,this.allData[e])}},mounted:function(){for(var e in this.allData)this.allData[e]&&this.allData[e].length>0&&this.$set(this.relatedListData,e,this.allData[e])},methods:{checkInfos:function(e){for(var t in this.relatedListData={},e.data)e.data[t].length>0&&this.$set(this.relatedListData,t,e.data[t]);var i={},n=function(t){var n=e.data[t];i[t+"Ids"]="module"==t?n.map((function(e){return e["settingId"]})):n.map((function(e){return e[t+"Id"]}))};for(var a in e.data)n(a);this.$emit("checkInfos",i,e.data)},delRelevance:function(e,t,i){this.showCRMPermission?(this.relatedListData[e].splice(t,1),this.$emit("changeInfos",e,i)):this.$emit("unbind",e,i,t)}}},Sn=Ln,Nn=(i("6ae5"),Object(m["a"])(Sn,bn,gn,!1,null,"5297ed29",null)),Tn=Nn.exports,On=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"salary-index",attrs:{id:"employee-main-container"}},[i("xr-header",{attrs:{"ft-top":"0",label:"薪资管理"}},[i("template",{slot:"label"},[e._v("\n      薪资管理\n      "),e.startEndTimeValue?i("span",{staticClass:"time-label"},[e._v("（"+e._s(e.startEndTimeValue)+"）")]):e._e()]),e._v(" "),i("template",{slot:"ft"},[i("el-button",{attrs:{type:"text"},on:{click:function(t){e.checkClick("progress")}}},[e._v("查看审核进度")])],1)],2),e._v(" "),i("div",{staticClass:"crm-container"},[i("xr-table-header",[i("el-tabs",{staticStyle:{width:"100%","margin-bottom":"-8px"},on:{"tab-click":e.tabClick},model:{value:e.tabType,callback:function(t){e.tabType=t},expression:"tabType"}},e._l(e.tabList,(function(t){return i("el-tab-pane",{key:t.name,attrs:{name:t.name}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v(e._s(t.label)),t.num>0?i("span",{staticClass:"tab-pane-num",staticStyle:{"margin-left":"5px"}},[e._v(e._s(t.num))]):e._e()])])})))],1),e._v(" "),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"n-table--border el-table-header--white",class:e.WKConfig.tableStyle.class,staticStyle:{width:"100%"},attrs:{id:"crm-table","row-height":40,data:e.list,height:e.tableHeight,"summary-method":e.getSummaries,stripe:e.WKConfig.tableStyle.stripe,"show-summary":"","use-virtual":"","highlight-current-row":""}},[e._l(e.fieldList,(function(t,n){return i("el-table-column",{key:n,attrs:{fixed:0==n,prop:t.field,label:t.name,"min-width":t.width,formatter:e.fieldFormatter,"show-overflow-tooltip":""}})})),e._v(" "),i("el-table-column")],2),e._v(" "),i("div",{staticClass:"p-contianer"},[i("el-pagination",{staticClass:"p-bar",attrs:{"current-page":e.currentPage,"page-sizes":e.pageSizes,"page-size":e.pageSize,total:e.total,layout:"total, sizes, prev, pager, next, jumper"},on:{"update:pageSize":function(t){e.pageSize=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1),e._v(" "),i("examine-progress-dialog",{attrs:{detail:e.examineData,visible:e.examineProDialogShow},on:{"update:visible":function(t){e.examineProDialogShow=t},change:e.examineProgressChange,success:function(t){e.getExamineData()}}})],1)},In=[],En=i("f468"),Fn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"xr-table-header"},[i("flexbox",{directives:[{name:"show",rawName:"v-show",value:!e.handleShow,expression:"!handleShow"}],staticClass:"xr-table-header__body",attrs:{align:"center"}},[e._t("default")],2),e._v(" "),i("flexbox",{directives:[{name:"show",rawName:"v-show",value:e.handleShow,expression:"handleShow"}],staticClass:"xr-table-header__handle"},[i("div",{staticClass:"selected—title"},[e._v("已选中 "),i("span",{staticClass:"selected—count"},[e._v(e._s(e.selects.length))]),e._v(" 项")]),e._v(" "),i("flexbox",{staticClass:"selection-items-box"},[e._t("prefix"),e._v(" "),e._l(e.handles,(function(t,n){return i("el-button",{key:n,attrs:{icon:e._f("wkIconPre")(t.icon),size:"medium"},on:{click:function(i){e.selectionBarClick(t.command)}}},[e._v(e._s(t.label))])})),e._v(" "),e._t("suffix")],2)],1),e._v(" "),e._t("append")],2)},jn=[],Dn={name:"XrTableHeader",components:{},props:{selects:{type:Array,default:function(){return[]}},handles:{type:Array,default:function(){return[]}}},data:function(){return{}},computed:{handleShow:function(){return this.selects&&this.selects.length>0}},watch:{},mounted:function(){},beforeDestroy:function(){},methods:{selectionBarClick:function(e){this.$emit("command",e)}}},$n=Dn,Un=(i("6641"),Object(m["a"])($n,Fn,jn,!1,null,"4a1d5a74",null)),An=Un.exports,Vn=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{attrs:{visible:e.visible,"append-to-body":!0,"close-on-click-modal":!1,"show-close":!1,width:"550px"}},[i("div",{staticClass:"form-add-dialog-body"},[i("examine-info-section",{ref:"examineInfo",staticClass:"examine-info",attrs:{"examine-record":e.detail,"external-mailbox":!0},on:{success:e.examineSuccess,"on-handle":e.handleBack}})],1),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{nativeOn:{click:function(t){return e.handleCancel(t)}}},[e._v("关闭")])],1)])},Pn=[],Rn={name:"ExamineProgressDialog",components:{ExamineInfoSection:dn},mixins:[],props:{detail:{type:Object,default:function(){}},visible:{type:Boolean,required:!0,default:!1}},data:function(){return{title:"详情"}},computed:{id:function(){return this.detail?this.detail.srecordId:""},recordId:function(){return this.detail?this.detail.examineRecordId:""},createUserId:function(){return this.detail?this.detail.createUserId:""}},watch:{visible:{handler:function(e){e&&this.recordId&&this.$refs.examineInfo&&this.$refs.examineInfo.refreshData()},immediate:!0}},mounted:function(){},methods:{handleCancel:function(){this.close()},close:function(){this.$emit("update:visible",!1)},handleBack:function(e){this.close(),this.$emit("change")},examineSuccess:function(){this.$emit("success")}}},Hn=Rn,Bn=(i("f030"),Object(m["a"])(Hn,Vn,Pn,!1,null,"f3e85516",null)),Wn=Bn.exports,Mn={name:"SalaryIndex",components:{XrHeader:En["a"],XrTableHeader:An,ExamineProgressDialog:Wn},props:{emailToken:String},data:function(){return{loading:!1,noNum:0,tableHeight:400,list:[],fieldList:[],currentPage:1,pageSize:15,pageSizes:[15,30,60,100],total:0,popoverFilterWidth:document.documentElement.clientWidth-80,tabType:"0",tabList:[{label:"计薪人数",name:"0",num:0},{label:"新入职",name:"1",num:0},{label:"离职",name:"2",num:0},{label:"转正",name:"3",num:0},{label:"调岗",name:"4",num:0}],rowID:"",showDview:!1,lastData:null,editViewShow:!1,sumData:null,examineProDialogShow:!1,examineData:null}},computed:{startEndTimeValue:function(){return this.lastData?"计薪周期：".concat(qi()(this.lastData.startTime).format("MM月DD日"),"-").concat(qi()(this.lastData.endTime).format("MM月DD日")):""}},watch:{},created:function(){var e=this;this.getTableHeight(),window.onresize=function(){e.getTableHeight()},this.getList(),this.getExamineData()},methods:{getTableHeight:function(){this.tableHeight=document.documentElement.clientHeight-205-70},checkClick:function(e){this.examineProDialogShow=!0},examineProgressChange:function(){this.getExamineData()},handleSizeChange:function(e){this.pageSize=e,this.getList()},handleCurrentChange:function(e){this.currentPage=e,this.getList()},getList:function(){},getExamineData:function(){},getTabNum:function(e){this.tabList.forEach((function(t){"all"!=t.name&&(t.num=e[parseInt(t.name)]||0)}))},tabClick:function(){this.handleCurrentChange(1)},getSummaries:function(e){var t=this,i=e.columns,n=[];return i.forEach((function(e,i){n[i]=0===i?"总合计":i<=5?"":t.sumData?t.sumData[e.property]:""})),n},fieldFormatter:function(e,t){var i=e[t.property];return Object(tt["c"])(i)?"--":i}}},qn=Mn,zn=(i("b7d5"),Object(m["a"])(qn,On,In,!1,null,"041edc20",null)),Xn=zn.exports;i("0481f"),i("4069");function Jn(e,t){}function Gn(e,t,i){if(t){var n=[],a=[];e&&e.forEach((function(e){1==e.sysInformation?a.push(e):"product"!==e.formType&&n.push(e)}));var s=[{name:"基本信息",list:n},{name:"系统信息",list:a}];if(7==t){var o=[{formType:"text",fieldName:"contacts",name:"联系人",value:i.contacts},{formType:"text",fieldName:"telephone",name:"电话",value:i.telephone},{formType:"text",fieldName:"detailAddress",name:"地址",value:i.detailAddress}];s.splice(1,0,{name:"收货信息",list:o})}return s}return[{name:"基本信息",list:null===e||void 0===e?void 0:e.flat(1/0)}]}var Kn={name:"Detail",components:{WkDetailHeader:h,ExamineInfoSection:dn,FileCell:vn,RelatedBusiness:Tn,HrmExamine:Xn},mixins:[],props:{examineType:{type:String,default:""}},data:function(){return{detail:null,titleObj:{upcoming:"待办",track:"跟踪",archive:"归档",draft:"草稿"},headDetails:[],examineRecord:{},fieldList:[],detailInfo:{},subTitleObj:{5:"采购订单",6:"采购退货单",7:"销售订单",8:"销售退货单",9:"付款单",10:"回款单",11:"库存盘点",12:"库存调拨"},headerTitleObj:{0:"content",1:"content",2:"content",3:"content",5:"orderNumber",6:"orderNumber",7:"orderNumber",8:"orderNumber",9:"paymentNo",10:"collectionNo",11:"inventoryNumber",12:"allocationNumber"},emailToken:"",label:null}},computed:{relatedBusinessInfo:function(){return{business:this.detailInfo.businessList,contacts:this.detailInfo.contactsList,contract:this.detailInfo.contractList,customer:this.detailInfo.customerList}}},mounted:function(){this.label=Number(this.$route.query.label),this.emailToken=this.$route.query.k,4!=this.label&&this.getAllData()},methods:{getAllData:function(){var e=this,t={emailToken:this.$route.query.k},i={},n={};Promise.all([i[this.label](t),n[this.label](t)]).then((function(t){var i=Object(l["a"])(t,3),n=i[0],a=i[1],s=i[2];e.detailInfo=s["data"],e.headDetails=Jn(s["data"],Number(e.label));var o=a["data"];e.fieldList=Gn(o,e.label,s["data"]),e.examineRecord=n["data"]}))},examineHandle:function(e){}}},Qn=Kn,Yn=(i("b221"),Object(m["a"])(Qn,s,o,!1,null,"a3cb5b8a",null)),Zn=Yn.exports,ea=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"link-wrapper"},[i("div",{staticClass:"container"},[i("img",{staticClass:"logo",attrs:{src:"https://file.72crm.com/static/pc/images/logo-yun.png"}}),e._v(" "),i("img",{staticClass:"pic",attrs:{src:e.img,alt:""}}),e._v(" "),i("div",{staticClass:"title",class:{"is-primary":e.isPrimary}},[e._v(e._s(e.title))]),e._v(" "),e.showDesc?i("div",{staticClass:"desc"},[e._v(e._s(e.desc))]):e._e(),e._v(" "),e.showCountdown?i("div",{staticClass:"desc"},[i("span",{staticClass:"is-red"},[e._v(e._s(e.count))]),e._v("S后自动返回系统")]):e._e(),e._v(" "),e.showButton?i("el-button",{attrs:{type:"primary"},on:{click:e.goClick}},[e._v("立即跳转")]):e._e()],1)])},ta=[];function ia(e){return Object(w["a"])({url:"adminCompanyManager/verifyEmailInfo/?k=".concat(e),method:"get"})}var na=i("5f87"),aa={name:"VerifyEmail",components:{},props:{},data:function(){return{title:"",isPrimary:!1,desc:"",showDesc:!1,count:5,showCountdown:!1,intervalId:null,showButton:!0,img:i("dd1e")}},computed:{},watch:{},created:function(){},mounted:function(){var e=this.$route.query;"email"===e.type&&e.k&&this.verifyEmailInfo()},beforeDestroy:function(){},methods:{goClick:function(){var e=this;Object(na["b"])().then((function(t){e.$router.push("/")})).catch((function(){e.$router.push("/login")}))},startCountdown:function(){var e=this;this.count=5,this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null),this.intervalId=setInterval((function(){e.count--,0===e.count&&(clearInterval(e.intervalId),e.intervalId=null,e.goClick())}),1e3)},verifyEmailInfo:function(){var e=this,t=this.$route.query,n=t.k,a=t.edit;ia(n).then((function(t){var n=t.data||{};1===n?(e.title="1"===a?"恭喜您，邮箱地址修改成功":"恭喜您，账户验证成功",e.isPrimary=!0,e.showDesc=!1,e.showCountdown=!0,e.showButton=!0,e.startCountdown(),e.img=i("dd1e")):(e.title="1"===a?"无效的邮箱修改链接，请确认后重新尝试":"无效的账户验证链接，请确认后重新尝试",e.isPrimary=!1,e.showDesc=!1,e.showCountdown=!1,e.showButton=!1,e.img=i("9907"))})).catch((function(){}))}}},sa=aa,oa=(i("81c9"),Object(m["a"])(sa,ea,ta,!1,null,"5fb33354",null)),la=oa.exports,ra={name:"LinkPage",components:{Examine:Zn,VerifyEmail:la},computed:{currentComponent:function(){var e;return{email:"VerifyEmail",examineEmail:"Examine"}[null===(e=this.$route.query)||void 0===e?void 0:e.type]}},created:function(){var e;null!==(e=this.$route.query)&&void 0!==e&&e.type||this.$router.replace("/")}},ca=ra,da=(i("15db"),Object(m["a"])(ca,n,a,!1,null,"4aaf7567",null));t["default"]=da.exports},a2d1:function(e,t,i){"use strict";i("4859")},a303:function(e,t,i){},a515:function(e,t,i){e.exports={colorPrimary:"#0052cc",colorBlack:"#172b4d",colorSuccess:"#36b37e",colorWarning:"#ffab00",colorDanger:"#ff5630",colorN40:"#dfe1e6",axisLineColor:"#dfe1e6",axisLabelFontWeight:"500"}},a8c1:function(e,t,i){},b221:function(e,t,i){"use strict";i("1962")},b4d1:function(e,t,i){"use strict";i("e861")},b7d5:function(e,t,i){"use strict";i("72db")},ba22:function(e,t,i){},bc32:function(e,t,i){},bd2f:function(e,t,i){e.exports={colorPrimary:"#0052cc",colorBlack:"#172b4d",colorSuccess:"#36b37e",colorWarning:"#ffab00",colorDanger:"#ff5630",colorN40:"#dfe1e6",axisLineColor:"#dfe1e6",axisLabelFontWeight:"500"}},be40:function(e,t,i){"use strict";i("987e")},d2f4:function(e,t,i){"use strict";i("bc32")},d4afb:function(e,t,i){"use strict";i("f0e5")},d851:function(e,t,i){e.exports={colorPrimary:"#0052cc",colorBlack:"#172b4d",colorSuccess:"#36b37e",colorWarning:"#ffab00",colorDanger:"#ff5630",colorN40:"#dfe1e6",axisLineColor:"#dfe1e6",axisLabelFontWeight:"500"}},db54:function(e,t,i){"use strict";i("545c")},dc14:function(e,t,i){},dd1e:function(e,t,i){e.exports=i.p+"static/img/success.01f61b20.png"},dd75:function(e,t,i){"use strict";i("5a0e")},e2d9:function(e,t,i){e.exports={colorPrimary:"#0052cc",colorBlack:"#172b4d",colorSuccess:"#36b37e",colorWarning:"#ffab00",colorDanger:"#ff5630",colorN40:"#dfe1e6",axisLineColor:"#dfe1e6",axisLabelFontWeight:"500"}},e5ab:function(e,t,i){},e861:function(e,t,i){},ebab:function(e,t,i){},eff5:function(e,t,i){"use strict";i("bd2f")},f030:function(e,t,i){"use strict";i("87f0")},f0e5:function(e,t,i){},f42b:function(e,t,i){},f468:function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("flexbox",{staticClass:"xr-header"},[e.iconClass?i("div",{staticClass:"xr-header__icon",style:{backgroundColor:e.iconColor}},[i("i",{class:e.iconClass})]):e._e(),e._v(" "),i("div",{staticClass:"xr-header__label"},[e.$slots.label?e._t("label"):[e._v(e._s(e.label)),e._t("otherLabel")]],2),e._v(" "),e.showSearch?i("el-input",e._b({staticClass:"xr-header__search",style:{"margin-top":e.ftTop},attrs:{placeholder:e.placeholder},on:{input:e.inputChange},nativeOn:{keyup:function(t){return!("button"in t)&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchClick(t)}},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}},"el-input",e.inputAttr,!1),[i("el-button",{attrs:{slot:"suffix",type:"icon",icon:"wk wk-sousuo"},on:{click:e.searchClick},slot:"suffix"})],1):e._e(),e._v(" "),i("div",{staticClass:"xr-header__ft",style:{top:e.ftTop}},[e._t("ft")],2)],1)},a=[],s=(i("a9e3"),i("ac1f"),i("841c"),{name:"XrHeader",components:{},props:{iconClass:[String,Array],iconColor:String,label:String,showSearch:{type:Boolean,default:!1},placeholder:{type:String,default:"请输入内容"},ftTop:{type:String,default:"0"},content:[String,Number],inputAttr:{type:Object,default:function(){}}},data:function(){return{search:""}},computed:{},watch:{content:{handler:function(){this.search!=this.content&&(this.search=this.content)},immediate:!0}},mounted:function(){},beforeDestroy:function(){},methods:{inputChange:function(){this.$emit("update:content",this.search)},searchClick:function(){this.$emit("search",this.search)}}}),o=s,l=(i("f9b7"),i("2877")),r=Object(l["a"])(o,n,a,!1,null,"20e1a242",null);t["a"]=r.exports},f9b7:function(e,t,i){"use strict";i("5a5d")}}]);