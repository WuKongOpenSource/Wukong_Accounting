(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7e8723a0","chunk-73cd92f1"],{"080f":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("div",{staticClass:"main"},[a("flexbox",{staticClass:"main-header",attrs:{justify:"space-between"}},[a("span",{staticClass:"main-title"},[e._v("\n          "+e._s(e.pageTitle)+"\n          "),a("i",{staticClass:"wk wk-icon-fill-help wk-help-tips",attrs:{"data-type":"40","data-id":"321"}})]),e._v(" "),a("div",{staticClass:"buttons"},[e._l(e.btnList,(function(t,i){return a("el-button",{key:i,attrs:{plain:t.plain,type:t.primary},nativeOn:{click:function(a){e.btnClick(t.type)}}},[e._v("\n            "+e._s(t.name)+"\n            "),"adjust"===t.type?a("i",{staticClass:"wk wk-icon-fill-help wk-help-tips",staticStyle:{color:"white",background:"#0052cc"},attrs:{"data-type":"40","data-id":"322"}}):e._e()])})),e._v(" "),a("el-dropdown",{staticClass:"receive-drop",attrs:{trigger:"click"}},[a("el-button",{staticClass:"dropdown-btn",attrs:{icon:"el-icon-more"}}),e._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[e.$auth("finance.cashFlow.print")?a("el-dropdown-item",{nativeOn:{click:function(t){return e.printAll(t)}}},[e._v("打印")]):e._e(),e._v(" "),e.$auth("finance.cashFlow.export")?a("el-dropdown-item",{nativeOn:{click:function(t){e.btnClick("export")}}},[e._v("导出")]):e._e()],1)],1)],2)]),e._v(" "),a("flexbox",{staticClass:"content-flex",attrs:{justify:"space-between"}},[1==e.step?a("flexbox",{staticClass:"left-box"},[a("el-select",{staticClass:"select-quarter",attrs:{mode:"no-border"},on:{change:e.refreshClick},model:{value:e.type,callback:function(t){e.type=t},expression:"type"}},[a("el-option",{attrs:{value:1,label:"月报"}}),e._v(" "),a("el-option",{attrs:{value:2,label:"季报"}})],1),e._v(" "),1==e.type?a("el-date-picker",{staticClass:"select-date",attrs:{"picker-options":e.pickerOptions,clearable:!1,type:"month","value-format":"yyyyMM",placeholder:"选择月"},on:{change:e.refreshClick},model:{value:e.dateValue,callback:function(t){e.dateValue=t},expression:"dateValue"}}):e._e(),e._v(" "),2==e.type?a("choose-quarter",{attrs:{"default-value":e.dateValue,"get-value":e.getYearMounth}}):e._e(),e._v(" "),a("el-button",{directives:[{name:"debounce",rawName:"v-debounce",value:e.resSearch,expression:"resSearch"}],attrs:{plain:"",icon:"el-icon-refresh-right",type:"subtle"}})],1):a("flexbox",{staticClass:"left-box"},[1==e.type?a("span",[e._v("\n            调整辅助数据项 - "+e._s(e.dateValue)+"期\n          ")]):e._e(),e._v(" "),2==e.type?a("span",[e._v("\n            调整辅助数据项 - "+e._s(e.yearMounth.fromPeriod+"-"+e.yearMounth.toPeriod)+"期\n          ")]):e._e()])],1),e._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"table-wrapper"},[a("el-table",{staticStyle:{width:"100%"},attrs:{id:"cashSheet",data:e.tableData,height:e.tableHeight,"cell-class-name":e.cellClassName,border:"",stripe:""}},[e._l(e.fieldList,(function(t,i){return a("el-table-column",{key:i,attrs:{prop:t.field,align:t.align,label:t.label,width:t.width,"show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(i){var n=i.row,s=i.column;return["name"===t.field?[a("div",{staticClass:"name-box text-one-ellipsis",style:{paddingLeft:e.getNameIndent(n)},on:{click:function(t){e.openEditFormula(n)}}},[e._v("\n                  "+e._s(n[t.field])+"\n                  "),a("i",{directives:[{name:"show",rawName:"v-show",value:n.editable&&2===e.step,expression:"row.editable && step === 2"}],staticClass:"wk wk-icon-modify",on:{click:function(t){e.openEditFormula(n)}}})])]:1===e.step&&["yearValue","monthValue"].includes(t.field)?[a("span",[e._v(e._s(e._f("filterValue")(n[t.field])))])]:1!==e.step&&["yearValue","monthValue"].includes(t.field)?[0!==n.sort?a("el-input-number",{attrs:{controls:!1,disabled:e.getDisabledStatus(n)},on:{change:function(t){e.inputChange(n,s)}},model:{value:n[t.field],callback:function(a){e.$set(n,t.field,a)},expression:"row[item.field]"}}):e._e()]:[a("span",[e._v(e._s(0===n[s.property]?"":n[s.property]))])]]}}])})})),e._v(" "),e.printFooterShow?a("div",{staticStyle:{display:"flex","justify-content":"space-between",padding:"10px 0","font-size":"20px"},attrs:{slot:"append"},slot:"append"},[a("span",[e._v("单位负责人：")]),e._v(" "),a("span",[e._v("会计负责人:")]),e._v(" "),a("span",[e._v("制表人:")]),e._v(" "),a("span",[e._v("打印日期:"+e._s(e.$moment().format("YYYY-MM-DD")))])]):e._e()],2)],1),e._v(" "),a("div",{staticClass:"total-box"},[a("span",[e._v("共 "+e._s(e.tableData.length)+" 条")])]),e._v(" "),a("edit-formula",{attrs:{"edit-formula-visible":e.showEditFormula,"current-item":e.editItem,"sheet-type":"cashSheet"},on:{editFormulaClose:e.closeEditFormula,"save-success":e.editSuccess}}),e._v(" "),a("el-dialog",{staticClass:"balance-dialog",attrs:{visible:e.dialogVisible,"close-on-click-modal":!1,title:"系统提示",width:"40%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("div",{staticClass:"balance-content"},[a("div",{staticStyle:{height:"34px"}},[a("div",{staticClass:"el-message-box__status el-icon-warning"})]),e._v(" "),a("div",{staticClass:"text-box"},[e.judgeStep.includes(1)?a("div",{staticClass:"text"},[e._v("资产负债表不平,请检报表项目公式设置！")]):e._e(),e._v(" "),e.judgeStep.includes(2)?a("div",{staticClass:"text"},[e._v("您有未设置报表项目的科目：")]):e._e(),e._v(" "),e.judgeStep.includes(2)?a("div",{staticClass:"subject-box"},e._l(e.subjectList,(function(t,i){return a("div",{key:i,staticClass:"subject-item"},[e._v("\n                · "+e._s(t.number)+" "+e._s(t.subjectName)+"\n              ")])}))):e._e()])]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:e.targetBalance}},[e._v("立即检查")]),e._v(" "),a("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("关闭")])],1)])],1)])},n=[],s=a("5530"),o=(a("a9e3"),a("4de4"),a("d3b7"),a("99af"),a("caad"),a("2532"),a("ac1f"),a("5319"),a("7db0"),a("4e82"),a("159b"),a("1276"),a("4d63"),a("c607"),a("2c3e"),a("25f0"),a("14d9"),a("e9c4"),a("b0c0"),a("b46f")),l=a("cbe3"),r=a("949a"),c=a("ed08"),u=a("8c73"),d=a("2f62"),h=a("cb71"),f=a("b699"),p={name:"CashSheet",components:{EditFormula:l["a"],ChooseQuarter:r["a"]},filters:{filterValue:function(e){var t=Number(e);return isNaN(t)||0===t?"":Object(u["h"])(t)}},mixins:[f["a"]],data:function(){return{pageTitle:"现金流量表",step:1,type:1,dateValue:"",yearMounth:{fromPeriod:"",toPeriod:""},tableData:[],submitBeforeData:[],showEditFormula:!1,editItem:{},loading:!1,tableHeight:document.documentElement.clientHeight-240,dialogVisible:!1,judgeStep:[],subjectList:[],printFooterShow:!1}},computed:Object(s["a"])(Object(s["a"])({},Object(d["c"])(["financeCurrentAccount","financeFilterTimeRange"])),{},{pickerOptions:function(){var e=this;return{disabledDate:function(t){var a=e.$moment(t);return a.isBefore(e.financeFilterTimeRange.minTime.timeObj)||a.isAfter(e.financeFilterTimeRange.maxTime.timeObj)}}},btnList:function(){var e=this,t=[];return t=1===this.step?[{name:"调整",type:"adjust",plain:!1,primary:"primary",auth:"finance.cashFlow.update"}]:2===this.step?[{name:"下一步",type:"next2",plain:!0,primary:"",auth:""},{name:"清空并重算",type:"clear2",plain:!0,primary:"",auth:""},{name:"返回",type:"return2",plain:!0,primary:"",auth:""}]:[{name:"保存",type:"save3",plain:!1,primary:"primary",auth:""},{name:"上一步",type:"return3",plain:!0,primary:"",auth:""},{name:"清空并重算",type:"clear3",plain:!0,primary:"",auth:""}],t.filter((function(t){return!t.auth||e.$auth(t.auth)}))},fieldList:function(){return 2===this.step?[{label:"项目",field:"name",align:"left"},{label:"行次",field:"sort",align:"center",width:"100px"},{label:"本月数",field:"monthValue",align:"right",width:"260px"},{label:"本年数",field:"yearValue",align:"right",width:"260px"}]:[{label:"项目",field:"name",align:"left"},{label:"行次",field:"sort",align:"center",width:"100px"},{label:"本年累计金额",field:"yearValue",align:"right",width:"260px"},{label:"本月金额",field:"monthValue",align:"right",width:"260px"}]},mounthNum:function(){if(this.financeCurrentAccount&&this.financeCurrentAccount.startTime){var e=this.financeCurrentAccount.startTime.substring(0,7),t=e.split("-");return"".concat(t[0]).concat(t[1])}return""}}),watch:{step:{handler:function(e){2===e?this.getCashFlowStatementList():this.getCashSheetList()}}},created:function(){var e=this;window.onresize=function(){e.tableHeight=document.documentElement.clientHeight-240},this.mounthNum&&(this.dateValue=this.mounthNum,this.getCashSheetList(),this.judegBalance())},methods:{getDisabledStatus:function(e){return e.formula.includes("L")},getNameIndent:function(e){if(!e.grade)return"0";var t=Number(e.grade);return isNaN(t)||t-1<0?"0":"".concat(14*(e.grade-1),"px")},getValueByRule:function(e,t){var a=Number(e.replace("L",""));if(isNaN(a)||!t||!t.property)return 0;var i=this.tableData.find((function(e){return e.sort===a}));return i&&i[t.property]||0},inputChange:function(e,t){var a=this,i="L".concat(e.sort),n=this.tableData.filter((function(e){return e.formula.includes(i)}));n.forEach((function(e){try{var i=JSON.parse(e.formula)[0],n=i.split(/[+\-*\/\(\)\[\]]/g).filter((function(e){return Boolean(e)}));n.forEach((function(e){var n=a.getValueByRule(e,t),s=new RegExp("".concat(e,"(?!\\d)"),"g");i=i.replace(s,n)})),a.$set(e,t.property,Object(h["a"])(i))}catch(s){}}))},judegBalance:function(){var e=this;Object(o["c"])({fromPeriod:this.dateValue,toPeriod:this.dateValue,type:this.type}).then((function(t){!1===t.data.balanceSheet&&(e.dialogVisible=!0,e.judgeStep.push(1)),t.data.notContains.length>0&&(e.dialogVisible=!0,e.judgeStep.push(2),e.subjectList=t.data.notContains)})).catch((function(){}))},targetBalance:function(){this.dialogVisible=!1,this.$router.push({path:"/fm/report/subs/balanceSheet"})},resSearch:function(){this.getCashSheetList()},refreshClick:function(){1===this.type&&this.getCashSheetList()},getYearMounth:function(e,t){this.yearMounth={fromPeriod:e,toPeriod:t},this.getCashSheetList()},getCashSheetList:function(){var e=this;this.loading=!0;var t={fromPeriod:"",toPeriod:"",type:this.type};2===this.type?(t.fromPeriod=this.yearMounth.fromPeriod,t.toPeriod=this.yearMounth.toPeriod):(t.fromPeriod=this.dateValue,t.toPeriod=this.dateValue),Object(o["e"])(t).then((function(t){e.loading=!1,e.tableData=t.data})).catch((function(){e.tableData=[],e.loading=!1}))},getCashFlowStatementList:function(){var e=this;this.loading=!0;var t={fromPeriod:"",toPeriod:"",type:this.type,category:1};2===this.type?(t.fromPeriod=this.yearMounth.fromPeriod,t.toPeriod=this.yearMounth.toPeriod):(t.fromPeriod=this.dateValue,t.toPeriod=this.dateValue),Object(o["d"])(t).then((function(t){e.loading=!1,e.tableData=t.data,e.$nextTick((function(){e.submitBeforeData=Object(c["s"])(e.tableData)}))})).catch((function(){e.tableData=[],e.loading=!1}))},printAll:function(){this.HandlerPrint("cashSheet",{title:"cashSheet"})},updateCashFlowExtend:function(){for(var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=[],i=0;i<this.tableData.length;i++){var n=this.tableData[i];JSON.stringify(n)!==JSON.stringify(this.submitBeforeData[i])&&a.push(n)}Object(o["l"])({dataList:a,currentPeriod:this.dateValue}).then((function(a){e.loading=!1,t?e.step+=1:e.getCashFlowStatementList(),e.$message.success("保存成功")})).catch((function(){e.loading=!1}))},btnClick:function(e){var t=this;if("adjust"===e)this.step=2;else if("export"===e){var a={fromPeriod:"",toPeriod:"",type:this.type};2===this.type?(a.fromPeriod=this.yearMounth.fromPeriod,a.toPeriod=this.yearMounth.toPeriod):(a.fromPeriod=this.dateValue,a.toPeriod=this.dateValue),Object(o["g"])(a).then((function(e){Object(c["b"])(e)}))}else if("save2"===e)this.updateCashFlowExtend();else if("next2"===e)this.updateCashFlowExtend(!0);else if("clear2"===e)this.tableData.forEach((function(e){e.editable&&(e.monthValue=0,e.yearValue=0)}));else if("return2"===e)this.step=1;else if("save3"===e){var i={fromPeriod:"",toPeriod:"",type:this.type,dataList:this.tableData};2===this.type?(i.fromPeriod=this.yearMounth.fromPeriod,i.toPeriod=this.yearMounth.toPeriod):(i.fromPeriod=this.dateValue,i.toPeriod=this.dateValue),Object(o["m"])(i).then((function(e){t.$message.success("保存成功"),t.loading=!1,t.step=1})).catch((function(){t.loading=!1}))}else"return3"===e?this.step=2:"clear3"===e&&this.tableData.forEach((function(e){e.editable&&(e.monthValue=0,e.yearValue=0)}))},editSuccess:function(){this.showEditFormula=!1,this.getCashFlowStatementList()},openEditFormula:function(e){e.editable&&2===this.step&&(this.showEditFormula=!0,this.editItem=e)},closeEditFormula:function(){this.showEditFormula=!1},cellClassName:function(e){e.row;var t=e.column;e.rowIndex,e.columnIndex;t.name}}},b=p,m=(a("1e97"),a("2877")),v=Object(m["a"])(b,i,n,!1,null,"8d13728c",null);t["default"]=v.exports},1:function(e,t){},"1e97":function(e,t,a){"use strict";a("da4a")},"26b3":function(e,t,a){},"432d":function(e,t,a){"use strict";a("26b3")},"5ccb":function(e,t,a){},"5d0a":function(e,t,a){},"7a1c":function(e,t,a){"use strict";a("5d0a")},"949a":function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e._v("\n  选择季度\n  "),a("mark",{directives:[{name:"show",rawName:"v-show",value:e.showSeason,expression:"showSeason"}],staticStyle:{position:"fixed",top:"0",right:"0",bottom:"0",left:"0","z-index":"999",background:"rgba(0, 0, 0, 0)"},on:{click:function(t){t.stopPropagation(),e.showSeason=!1}}}),e._v(" "),a("el-input",{staticStyle:{width:"192px","margin-right":"10px"},attrs:{placeholder:"请选择季度"},on:{focus:function(t){e.showSeason=!0}},model:{value:e.showValue,callback:function(t){e.showValue=t},expression:"showValue"}},[a("i",{staticClass:"el-input__icon el-icon-date",attrs:{slot:"prefix"},slot:"prefix"})]),e._v(" "),a("el-card",{directives:[{name:"show",rawName:"v-show",value:e.showSeason,expression:"showSeason"}],staticClass:"box-card",staticStyle:{position:"fixed","z-index":"9999",width:"322px",padding:"0 3px 20px","margin-top":"10px"}},[a("div",{staticClass:"clearfix",staticStyle:{padding:"0","text-align":"center"},attrs:{slot:"header"},slot:"header"},[a("button",{staticClass:"el-picker-panel__icon-btn el-date-picker__prev-btn el-icon-d-arrow-left",attrs:{type:"button","aria-label":"前一年"},on:{click:e.prev}}),e._v(" "),a("span",{staticClass:"el-date-picker__header-label",attrs:{role:"button"}},[e._v(e._s(e.year)+"年")]),e._v(" "),a("button",{staticClass:"el-picker-panel__icon-btn el-date-picker__next-btn el-icon-d-arrow-right",attrs:{type:"button","aria-label":"后一年"},on:{click:e.next}})]),e._v(" "),a("div",{staticClass:"text item",staticStyle:{"text-align":"center"}},[a("el-button",{staticStyle:{float:"left",width:"40%",color:"#606266"},attrs:{disabled:e.canBtnOne,type:"text"},on:{click:function(t){e.selectSeason(0)}}},[e._v("第一季度")]),e._v(" "),a("el-button",{staticStyle:{float:"right",width:"40%",color:"#606266"},attrs:{disabled:e.canBtnTwo,type:"text"},on:{click:function(t){e.selectSeason(1)}}},[e._v("第二季度")])],1),e._v(" "),a("div",{staticClass:"text item",staticStyle:{"text-align":"center"}},[a("el-button",{staticStyle:{float:"left",width:"40%",color:"#606266"},attrs:{disabled:e.canBtnThree,type:"text"},on:{click:function(t){e.selectSeason(2)}}},[e._v("第三季度")]),e._v(" "),a("el-button",{staticStyle:{float:"right",width:"40%",color:"#606266"},attrs:{disabled:e.canBtnFour,type:"text"},on:{click:function(t){e.selectSeason(3)}}},[e._v("第四季度")])],1)])],1)},n=[],s=(a("a9e3"),a("99af"),a("d3b7"),a("25f0"),a("caad"),{name:"ChooseQuarter",props:{getValue:{default:function(){},type:Function},defaultValue:{default:"",type:String}},data:function(){return{canBtnOne:!1,canBtnTwo:!1,canBtnThree:!1,canBtnFour:!1,valueArr:["01-03","04-06","07-09","10-12"],showSeason:!1,season:"",nowYear:(new Date).getFullYear(),year:(new Date).getFullYear(),showValue:""}},watch:{defaultValue:function(e,t){},showValue:{handler:function(e){var t=e.substring(0,4),a=e.substring(5,6),i=this.valueArr[Number(a)-1],n=i.split("-");"".concat(t).concat(n[0]),"".concat(t).concat(n[1]);this.getValue("".concat(t).concat(n[0]),"".concat(t).concat(n[1]))}}},created:function(){if(this.defaultValue){var e=this.defaultValue;this.year=e.substring(0,4);var t=e.substring(4,6),a=this.quarter(t);this.showValue="".concat(this.year,"年").concat(a,"季度")}},methods:{quarter:function(e){var t=e.toString();return["01","02","03"].includes(t)?(this.canBtnOne=!1,this.canBtnTwo=!0,this.canBtnThree=!0,this.canBtnFour=!0,1):["04","05","06"].includes(t)?(this.canBtnOne=!1,this.canBtnTwo=!1,this.canBtnThree=!0,this.canBtnFour=!0,2):["07","08","09"].includes(t)?(this.canBtnOne=!1,this.canBtnTwo=!1,this.canBtnThree=!1,this.canBtnFour=!0,3):["10","11","12"].includes(t)?(this.canBtnOne=!1,this.canBtnTwo=!1,this.canBtnThree=!1,this.canBtnFour=!1,4):void 0},prev:function(){this.year=1*this.year-1},next:function(){1*this.year+1>this.nowYear?this.$message.error("不可以选择大于当前的年份"):this.year=1*this.year+1},selectSeason:function(e){var t=this;t.season=e+1,t.showSeason=!1,this.showValue="".concat(this.year,"年").concat(this.season,"季度")}}}),o=s,l=a("2877"),r=Object(l["a"])(o,i,n,!1,null,null,null);t["a"]=r.exports},b46f:function(e,t,a){"use strict";a.d(t,"b",(function(){return n})),a.d(t,"a",(function(){return s})),a.d(t,"k",(function(){return o})),a.d(t,"j",(function(){return l})),a.d(t,"i",(function(){return r})),a.d(t,"n",(function(){return c})),a.d(t,"e",(function(){return u})),a.d(t,"c",(function(){return d})),a.d(t,"m",(function(){return h})),a.d(t,"d",(function(){return f})),a.d(t,"l",(function(){return p})),a.d(t,"o",(function(){return b})),a.d(t,"f",(function(){return m})),a.d(t,"h",(function(){return v})),a.d(t,"g",(function(){return j}));var i=a("b775");function n(e){return Object(i["a"])({url:"/financeReport/balanceSheetReport",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function s(e){return Object(i["a"])({url:"/financeReport/balanceSheetReport/balanceCheck",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function o(e){return Object(i["a"])({url:"/financeReport/balanceSheetConfig/update",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function l(e){return Object(i["a"])({url:"/financeReport/incomeStatementReport",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function r(e){return Object(i["a"])({url:"/financeReport/incomeStatementReport/balanceCheck",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function c(e){return Object(i["a"])({url:"/financeReport/incomeStatementConfig/update",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function u(e){return Object(i["a"])({url:"/financeReport/cashFlowStatementReport",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function d(e){return Object(i["a"])({url:"/financeReport/cashFlowStatementReport/balanceCheck",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function h(e){return Object(i["a"])({url:"/financeReport/cashFlowStatementReport/update",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function f(e){return Object(i["a"])({url:"/financeReport/cashFlowStatementExtend/list",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function p(e){return Object(i["a"])({url:"/financeReport/cashFlowStatementExtend/update",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function b(e){return Object(i["a"])({url:"/financeReport/cashFlowStatementExtendConfig/update",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"}})}function m(e){return Object(i["a"])({url:"/financeReport/exportBalanceSheetReport",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"},responseType:"blob"})}function v(e){return Object(i["a"])({url:"financeReport/exportIncomeStatementReport",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"},responseType:"blob"})}function j(e){return Object(i["a"])({url:"financeReport/exportCashFlowStatementReport",method:"post",data:e,headers:{"Content-Type":"application/json;charset=UTF-8"},responseType:"blob"})}},b699:function(e,t,a){"use strict";var i=a("5530"),n=(a("99af"),a("add5")),s=a.n(n),o=a("2f62"),l=a("bc95");t["a"]={data:function(){return{printFooterShow:!1,pageTitle:"",searchTime:""}},mixins:[l["a"]],computed:Object(i["a"])(Object(i["a"])({},Object(o["c"])(["financeCurrentAccount"])),{},{displayTime:function(){return this.searchTime||this.dataTime&&this.$moment(this.dataTime,"YYYYMM").format("YYYY年第MM期")||this.dateValue&&this.$moment(this.dateValue,"YYYYMM").format("YYYY年第MM期")||this.timeArray&&this.timeArray.length&&this.getTimeShowVal(this.timeArray)}}),methods:{HandlerPrint:function(e,t){var a=this,i=t.title,n=void 0===i?"":i,o=t.style,l=void 0===o?"":o,r=t.centerText,c=void 0===r?"":r,u=t.headerHtml,d=void 0===u?"":u,h=t.type,f=void 0===h?"html":h;this.printFooterShow=!0;var p="\n      <div >\n        <div style='text-align:center;font-size:30px; font-weight:bold'>".concat(this.pageTitle||n,"</div>\n        <div style='display:flex; font-size:26px;padding: 10px 0'>\n          <span style=\"flex:1\">编制单位：").concat(this.financeCurrentAccount.companyName,'</span>\n          <span style="flex:1; text-align:center">').concat(c,'</span>\n          <span style="flex:1; text-align:right">\n          ').concat(this.displayTime||this.$moment(this.financeCurrentAccount.startTime,"YYYYMM").format("YYYY年第MM期"),"\n          </span>\n        </div>\n      </div>\n      ");this.$nextTick((function(){s()({printable:e,header:d||p,type:f,scanStyles:!1,style:"@page {size: auto;size:A3;margin:6mm}\n                  td,th{border:1px solid !important;padding: 10px 0;}\n                  table{border-collapse: collapse;font-size:20px;}\n                  .el-table__cell.gutter{border:none !important;}\n                  .el-table__empty-text{text-align: center;width: 100%;}\n                  tr{page-break-inside:avoid}\n                  .el-table__empty-text{display:none}\n                  .el-table__footer-wrapper{display:none}\n                  "+l,onLoadingEnd:function(){a.printFooterShow=!1}})}))}}}},bc95:function(e,t,a){"use strict";a("99af");t["a"]={methods:{getTimeShowVal:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=e[0]||null,a=e[1]||null;if(!t)return"";var i=this.$moment(t).format("YYYY年第MM期");if(!a)return i;var n=this.$moment(a).format("YYYY年第MM期");return i===n?i:"".concat(i," 至 ").concat(n)},getTimeInputWidth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=this.$moment(e[0]||null),a=this.$moment(e[1]||null);return t.isValid()&&a.isValid()&&t.format("YYYY-MM")!==a.format("YYYY-MM")?"230px":"180px"}}}},cb41:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"subject-select-options"},[a("el-popover",{attrs:{disabled:e.disabled,placement:"bottom-start",width:e.popoverWidth,trigger:"manual","popper-class":"no-padding-popover"},model:{value:e.popoverVisible,callback:function(t){e.popoverVisible=t},expression:"popoverVisible"}},[e.selectedNode?e.showRelevance?a("div",{staticClass:"relevance"},e._l(e.relative,(function(t,i){return a("flexbox",{key:i,staticClass:"relevance_item"},[a("div",{staticClass:"labelName"},[e._v("\n          "+e._s(t.labelName)+"\n        ")]),e._v(" "),a("el-popover",{attrs:{placement:"bottom",width:"200",trigger:"click"},model:{value:t.popoverAssistVisible,callback:function(a){e.$set(t,"popoverAssistVisible",a)},expression:"item.popoverAssistVisible"}},[a("div",{staticClass:"wrapper"},[a("div",{staticClass:"subject-list"},[e._l(e.assistShowList(t.name,e.relationObj[t.adjuvantId]),(function(i){return a("div",{key:i.carteId,staticClass:"subject-list-item",on:{click:function(a){e.handleSelectAssist(i,t)}}},[e._v("\n                "+e._s(i.carteNumber)+"  "+e._s(i.carteName)+"\n              ")])})),e._v(" "),e.relationObj[t.adjuvantId]&&0===e.relationObj[t.adjuvantId].length?a("div",{staticClass:"empty-tips"},[e._v("\n                没有匹配的选项\n              ")]):e._e()],2),e._v(" "),a("flexbox",{staticClass:"create-btn",attrs:{align:"center",justify:"flex-start"},nativeOn:{click:function(a){e.addAdjuvant(t)}}},[a("i",{staticClass:"wk wk-add icon"}),e._v(" "),a("div",{staticClass:"text"},[e._v("新建辅助核算")])])],1),e._v(" "),a("el-input",{attrs:{slot:"reference"},on:{blur:function(a){e.assistBlur(t,e.relationObj[t.adjuvantId])},focus:function(t){e.assistFocus()}},slot:"reference",model:{value:t.name,callback:function(a){e.$set(t,"name",a)},expression:"item.name"}})],1)],1)}))):e._e():a("div",{staticClass:"wrapper"},[a("div",{ref:"subjectBox",staticClass:"subject-list"},[e._l(e.subjectShowList,(function(t,i){return a("div",{key:i,staticClass:"subject-list-item",class:{active:e.selectedNode&&e.selectedNode.subjectId===t.subjectId,keyselect:i===e.hoverIndex},on:{click:function(a){e.handleSelect(t)}}},[e._v("\n          "+e._s(t.number)+" "+e._s(t.subjectName)+"\n        ")])})),e._v(" "),0===e.subjectShowList.length?a("div",{staticClass:"empty-tips"},[e._v("\n          没有匹配的选项\n        ")]):e._e()],2),e._v(" "),e.canCreate?a("flexbox",{staticClass:"create-btn",attrs:{align:"center",justify:"flex-start"},nativeOn:{click:function(t){return e.handleToCreate(t)}}},[a("i",{staticClass:"wk wk-add icon"}),e._v(" "),a("div",{staticClass:"text"},[e._v("新建科目")])]):e._e()],1),e._v(" "),a("el-input",{ref:"inputCore",attrs:{slot:"reference",disabled:e.disabled},on:{focus:e.inputFocus,input:e.inputChange,blur:e.inputBlur},nativeOn:{keydown:[function(t){if(!("button"in t)&&e._k(t.keyCode,"down",40,t.key,["Down","ArrowDown"]))return null;t.stopPropagation(),t.preventDefault(),e.navigateOptions("next")},function(t){if(!("button"in t)&&e._k(t.keyCode,"up",38,t.key,["Up","ArrowUp"]))return null;t.stopPropagation(),t.preventDefault(),e.navigateOptions("prev")},function(t){return!("button"in t)&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),e.selectOption(t))}]},slot:"reference",model:{value:e.subjectName,callback:function(t){e.subjectName=t},expression:"subjectName"}},[e.disabled?e._e():a("el-button",{staticClass:"choose-btn",attrs:{slot:"suffix",type:"text"},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.handleToSelect(t)}},slot:"suffix"},[e._v("科目")])],1)],1),e._v(" "),e.selectDialogVisible?a("subject-select-dialog",e._b({attrs:{visible:e.selectDialogVisible,"before-choose":e.beforeChoose},on:{"update:visible":function(t){e.selectDialogVisible=t},confirm:e.handleSelect}},"subject-select-dialog",e.$attrs,!1)):e._e(),e._v(" "),e.createDialogVisible?a("subject-update-dialog",{attrs:{visible:e.createDialogVisible,"show-subject-select-options":"","subject-list":e.subjectListLib},on:{"update:visible":function(t){e.createDialogVisible=t},confirm:e.saveSuccess}}):e._e(),e._v(" "),a("el-dialog",{attrs:{visible:e.addDialogVisible,title:e.dialogTitle,"append-to-body":"",width:"25%"},on:{"update:visible":function(t){e.addDialogVisible=t}}},[a("el-form",{ref:"addForm",attrs:{model:e.addForm,rules:e.rules}},[a("el-form-item",{attrs:{"label-width":"80px",label:"编码：",prop:"carteNumber"}},[a("el-input",{model:{value:e.addForm.carteNumber,callback:function(t){e.$set(e.addForm,"carteNumber",t)},expression:"addForm.carteNumber"}})],1),e._v(" "),a("el-form-item",{attrs:{"label-width":"80px",label:"名称：",prop:"carteName"}},[a("el-input",{model:{value:e.addForm.carteName,callback:function(t){e.$set(e.addForm,"carteName",t)},expression:"addForm.carteName"}})],1),e._v(" "),6==e.currentAddAssist.label?a("el-form-item",{attrs:{"label-width":"80px",label:"规格：",prop:"specification"}},[a("el-input",{model:{value:e.addForm.specification,callback:function(t){e.$set(e.addForm,"specification",t)},expression:"addForm.specification"}})],1):e._e(),e._v(" "),6==e.currentAddAssist.label?a("el-form-item",{attrs:{"label-width":"80px",label:"单位：",prop:"unit"}},[a("el-input",{model:{value:e.addForm.unit,callback:function(t){e.$set(e.addForm,"unit",t)},expression:"addForm.unit"}})],1):e._e(),e._v(" "),[1,2].includes(e.currentAddAssist.label)?a("el-form-item",{attrs:{"label-width":"80px",label:"备注：",prop:"remark"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.addForm.remark,callback:function(t){e.$set(e.addForm,"remark",t)},expression:"addForm.remark"}})],1):e._e()],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.saveAdjuvant("addForm",e.currentAddAssist.adjuvantId)}}},[e._v("保存")]),e._v(" "),a("el-button",{on:{click:function(t){e.closeAccountDialog()}}},[e._v("关闭")])],1)],1)],1)},n=[],s=a("c7eb"),o=a("1da1"),l=a("5530"),r=(a("a9e3"),a("4de4"),a("d3b7"),a("99af"),a("caad"),a("2532"),a("7db0"),a("159b"),a("b64b"),a("b0c0"),a("d81d"),a("224e")),c=a("f6f4"),u=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{visible:e.dialogVisible,"close-on-click-modal":!1,"before-close":e.handleClose,"append-to-body":"",width:"500px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("span",{staticClass:"el-dialog__title",attrs:{slot:"title"},slot:"title"},[e._v("\n    选择科目\n    "),e.helpObj?a("i",{staticClass:"wk wk-icon-fill-help wk-help-tips",attrs:{"data-type":e.helpObj.dataType,"data-id":e.helpObj.dataId}}):e._e()]),e._v(" "),a("SubjectSelectOptions",e._g(e._b({model:{value:e.selectedNode,callback:function(t){e.selectedNode=t},expression:"selectedNode"}},"SubjectSelectOptions",e.$attrs,!1),e.$listeners)),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:e.handleConfirm}},[e._v("确定")]),e._v(" "),a("el-button",{on:{click:e.handleClose}},[e._v("取消")])],1)],1)},d=[],h=a("b4e8"),f={name:"SubjectSelectOptionsDialog",components:{SubjectSelectOptions:h["a"]},props:{visible:{type:Boolean,default:!1},helpObj:Object},data:function(){return{dialogVisible:!1,selectedNode:null}},watch:{visible:{handler:function(){this.dialogVisible=this.visible},immediate:!0}},methods:{handleClose:function(){this.dialogVisible=!1,this.$emit("update:visible",!1),this.$emit("close")},handleConfirm:function(){this.$emit("confirm",this.selectedNode),this.handleClose()}}},p=f,b=(a("7a1c"),a("2877")),m=Object(b["a"])(p,u,d,!1,null,"ed1530a6",null),v=m.exports,j=a("8be7"),g=a("ed08"),y=a("6bfe"),_={name:"SubjectSelectOptions",components:{SubjectSelectDialog:v,SubjectUpdateDialog:j["a"]},mixins:[c["a"]],props:{value:{type:[String,Number]},isChildren:{type:Boolean,default:!1},isRelevance:{type:Boolean,default:!1},canCreate:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},relative:{type:Object,default:function(){return{}}},subjectObject:Object,relationObj:{type:Object,default:function(){return{}}},subjectList:{type:Array,default:null},beforeChoose:{type:Function,default:null},filterNodeMethod:{type:Function,default:null}},data:function(){return{popoverVisible:!1,subjectName:"",selectedNode:null,subjectListLib:[],popoverWidth:"",selectDialogVisible:!1,createDialogVisible:!1,hoverIndex:-1,currentAddAssist:{},addDialogVisible:!1,addForm:{carteNumber:"",carteName:"",specification:"",unit:"",remark:""},rules:{carteNumber:[{required:!0,message:"编码不能为空",trigger:"blur"}],carteName:[{required:!0,message:"名称不能为空",trigger:"blur"}]}}},computed:{subjectShowList:function(){var e=this;return this.subjectName?this.subjectListLib.filter((function(t){var a="".concat(t.number," ").concat(t.subjectName);return a.includes(e.subjectName)})):this.subjectListLib},assistShowList:function(){return function(e,t){return e?t?t.filter((function(t){var a="".concat(t.carteNumber," ").concat(t.carteName);return a.includes(e)})):[]:t||[]}},showRelevance:function(){return!!(this.isRelevance&&this.selectedNode&&this.selectedNode.adjuvantList&&this.selectedNode.adjuvantList.length)},dialogTitle:function(){return Object(y["c"])(this.currentAddAssist)?"新增":"新增"+this.currentAddAssist.labelName}},watch:{value:{handler:function(){this.setSelected()},immediate:!0},subjectShowList:{handler:function(){this.subjectListLib.length>0&&0===this.subjectShowList.length&&(this.subjectObject||(this.selectedNode=null,this.emitChange()))},immediate:!0,deep:!0},subjectList:{handler:function(){this.subjectList&&this.subjectList.length>0&&this.getSubjectList()},deep:!0,immediate:!0},popoverVisible:{handler:function(e){var t=this;this.hoverIndex=-1,e&&this.$nextTick((function(){t.popoverWidth=t.$el.offsetWidth<300?300:t.$el.offsetWidth}))}}},mounted:function(){this.popoverWidth=this.$el.offsetWidth<300?300:this.$el.offsetWidth,this.getSubjectList()},methods:{getSubjectList:function(){var e=this;if(this.subjectList&&this.subjectList.length>0){var t=Object(g["s"])(this.subjectList);this.formatList(t,"0"),this.filterNodeMethod&&(t=t.filter((function(a,i){var n=t.filter((function(e){return e.parentId===a.subjectId}));return e.filterNodeMethod(a,n,i)}))),this.subjectListLib=t,this.setSelected()}else Object(r["H"])({type:null,isTree:0}).then((function(t){if(!(e.subjectList&&e.subjectList.length>0)){var a=t.data||[];e.formatList(a,"0"),e.filterNodeMethod&&(a=a.filter((function(t,i){var n=a.filter((function(e){return e.parentId===t.subjectId}));return e.filterNodeMethod(t,n,i)}))),e.subjectListLib=a,e.setSelected()}})).catch((function(){}))},formatList:function(e,t){var a=this,i=e.filter((function(e){return e.parentId===t})),n=e.find((function(e){return e.subjectId===t}));i.forEach((function(t){n&&(t.subjectName="".concat(n.subjectName,"_").concat(t.subjectName));var i=e.filter((function(e){return e.parentId===t.subjectId}));i.forEach((function(i){i.subjectName="".concat(t.subjectName,"_").concat(i.subjectName),a.formatList(e,i.subjectId)}))}))},getChildren:function(e){return e?this.subjectListLib.filter((function(t){return t.parentId===e.subjectId})):[]},setSelected:function(){var e=this;if(0!==this.subjectListLib.length)if(this.value){var t=this.subjectListLib.find((function(t){return t.subjectId===e.value}));if(this.subjectObject&&!t&&(t=this.subjectObject),t){if(this.subjectName="".concat(t.number," ").concat(t.subjectName),this.$emit("update:subjectName",this.subjectName),this.isRelevance){if(t.adjuvantList)return t.adjuvantList.forEach((function(t){e.relative.hasOwnProperty(t.adjuvantId)?e.$set(e.relative[t.adjuvantId],"labelName",t.labelName):e.$set(e.relative,t.adjuvantId,Object(l["a"])(Object(l["a"])({},t),{},{relationId:"",name:""}))})),Object.keys(this.relative).forEach((function(a){t.adjuvantList.find((function(e){return e.adjuvantId==a}))||delete e.relative[a]})),this.selectedNode=t,this.$emit("change",this.selectedNode.subjectId,this.selectedNode),this.$emit("focus"),this.inputBlur(),void this.getAdjuvantList();Object.keys(this.relative).forEach((function(t){delete e.relative[t]}))}this.selectedNode=t,this.$emit("focus")}else this.selectedNode=null,this.subjectName="",this.emitChange()}else this.selectedNode=null,this.subjectName=""},navigateOptions:function(e){var t=this;this.popoverVisible&&0!==this.subjectShowList.length&&("next"===e?(this.hoverIndex++,this.hoverIndex===this.subjectShowList.length&&(this.hoverIndex=0)):"prev"===e&&(this.hoverIndex--,this.hoverIndex<0&&(this.hoverIndex=this.subjectShowList.length-1)),this.$nextTick((function(){return t.scrollToOption()})))},scrollToOption:function(){var e=this.$refs.subjectBox,t=document.querySelector(".subject-list .keyselect"),a=t?t.offsetTop:0;a+t.clientHeight>e.clientHeight?e.scrollTop=t.offsetTop-50:e.scrollTop=0},selectOption:function(){this.popoverVisible&&this.handleSelect(this.subjectShowList[this.hoverIndex])},assistFocus:function(){this.popoverVisible=!0},assistBlur:function(e,t){var a=t.some((function(t){var a="".concat(t.carteNumber," ").concat(t.carteName);return a.includes(e.name)}));a||(e.name="")},assistChange:function(e,t){t.name=this.relationObj[t.adjuvantId].find((function(t){return t.carteId==e})).carteName,this.checkRelative()&&(this.$emit("blur"),this.popoverVisible=!1)},getInitBalance:function(){var e=this,t={subjectId:this.selectedNode.subjectId,assistAdjuvantList:Object.keys(this.relative).map((function(t){return{adjuvantId:t,relationId:e.relative[t].relationId}}))};Object(r["C"])(t).then((function(t){var a=t.data;a&&e.$set(e.subjectObject,"adjuvantBalance",a.initialBalance||0)}))},getAdjuvantList:function(){var e=arguments,t=this;return Object(o["a"])(Object(s["a"])().mark((function a(){var i,n,o,l;return Object(s["a"])().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(i=e.length>0&&void 0!==e[0]&&e[0],t.selectedNode.adjuvantList&&t.selectedNode.adjuvantList.length){a.next=3;break}return a.abrupt("return");case 3:n=0;case 4:if(!(n<t.selectedNode.adjuvantList.length)){a.next=16;break}if(o=t.selectedNode.adjuvantList[n],!t.relationObj.hasOwnProperty(o.adjuvantId)||i){a.next=8;break}return a.abrupt("continue",13);case 8:return t.$set(t.relationObj,o.adjuvantId,[]),a.next=11,Object(r["q"])({adjuvantId:o.adjuvantId,pageType:0,status:1});case 11:l=a.sent,t.$set(t.relationObj,o.adjuvantId,l.data.list);case 13:n++,a.next=4;break;case 16:t.checkRelative()&&t.getInitBalance();case 17:case"end":return a.stop()}}),a)})))()},inputChange:function(){var e=this;this.selectedNode&&(this.selectedNode=null,this.emitChange()),this.$nextTick((function(){e.popoverVisible||(e.popoverVisible=!0)}))},inputFocus:function(){var e=this;this.selectedNode&&!this.showRelevance||(this.$emit("focus"),this.popoverVisible=!0,this.$nextTick((function(){e.hoverIndex=0})))},inputBlur:function(e){e&&this.$el.contains(e.relatedTarget)||this.isRelevance&&this.selectedNode&&!this.selectedNode.adjuvantList||this.isRelevance&&this.selectedNode&&this.selectedNode.adjuvantList&&!this.checkRelative()||(this.$emit("blur"),this.popoverVisible=!1)},focus:function(){this.$refs.inputCore.focus()},checkRelative:function(){for(var e=0;e<this.selectedNode.adjuvantList.length;e++){var t=this.selectedNode.adjuvantList[e];if(!this.relative[t.adjuvantId]||!this.relative[t.adjuvantId].relationId)return!1}return!0},handleSelectAssist:function(e,t){t.relationId=e.carteId,t.name=e.carteName,t.carteNumber=e.carteNumber,t.specification=e.specification,t.popoverAssistVisible=!1,this.checkRelative()&&(this.getInitBalance(),this.$emit("blur"),this.popoverVisible=!1)},handleToSelect:function(e){this.$refs.inputCore.blur(),this.selectDialogVisible=!0},handleToCreate:function(){this.createDialogVisible=!0},handleSelect:function(e){if(e){if(this.selectedNode=this.subjectListLib.find((function(t){return t.subjectId===e.subjectId})),this.selectedNode.children=this.getChildren(e),this.beforeChoose){var t=this.beforeChoose(this.selectedNode);if(!t)return this.$refs.inputCore.blur(),void(this.selectedNode=null)}this.subjectName="".concat(e.number," ").concat(e.subjectName),this.emitChange(e.subjectId)}else{if(this.beforeChoose){var a=this.beforeChoose(null);if(!a)return void this.$refs.inputCore.focus()}this.subjectName="",this.selectedNode=null,this.emitChange()}},saveSuccess:function(){this.popoverVisible=!1,this.$emit("update-list"),this.getSubjectList()},emitChange:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.$emit("input",e),this.$emit("change",e,this.selectedNode),this.dispatch("ElFormItem","el.form.change",[e,this.selectedNode])},addAdjuvant:function(e){this.currentAddAssist=e,this.resetForm(),this.addDialogVisible=!0},saveAdjuvant:function(e,t){var a=this;this.$refs[e].validate((function(e){if(!e)return!1;var i=Object(l["a"])(Object(l["a"])({},a.addForm),{},{adjuvantId:t});Object(r["g"])(i).then((function(e){a.$message.success("保存成功"),a.getAdjuvantList(!0)})).catch((function(){})),a.resetForm(),a.addDialogVisible=!1}))},closeAccountDialog:function(){this.addDialogVisible=!1,this.resetForm()},resetForm:function(){this.addForm={carteNumber:"",carteName:"",specification:"",unit:"",remark:""}}}},x=_,w=(a("f455"),Object(b["a"])(x,i,n,!1,null,"3cdd76cb",null));t["a"]=w.exports},cbe3:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{ref:"wkDialog",attrs:{visible:e.editFormulaVisible,"before-close":e.editFormulaClose,"close-on-click-modal":!1,"append-to-body":!0,width:"900px"},on:{"update:visible":function(t){e.editFormulaVisible=t}}},[a("div",{staticClass:"dialog-header",attrs:{slot:"title"},slot:"title"},[a("span",{staticClass:"title-box"},[e._v("编辑公式——"+e._s(e.currentItem.name?e.currentItem.name:""))])]),e._v(" "),a("flexbox",{staticClass:"content-flex"},[a("div",{staticClass:"flex-item"},[a("div",{staticClass:"text subject-text"},[e._v("科目：")]),e._v(" "),a("select-subject",{on:{change:e.receiveSubject},model:{value:e.subjectId,callback:function(t){e.subjectId=t},expression:"subjectId"}})],1),e._v(" "),a("div",{staticClass:"flex-item"},[a("div",{staticClass:"text"},[e._v("取数规则：")]),e._v(" "),"balanceSheet"==e.sheetType?a("el-select",{staticClass:"select-date",attrs:{placeholder:""},model:{value:e.balanceRules,callback:function(t){e.balanceRules=t},expression:"balanceRules"}},e._l(e.fetchOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))):a("el-select",{staticClass:"select-date",attrs:{placeholder:""},model:{value:e.cashRules,callback:function(t){e.cashRules=t},expression:"cashRules"}},e._l(e.fetchOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})))],1),e._v(" "),a("div",{staticClass:"flex-item"},[a("div",{staticClass:"text"},[e._v("运算符号：")]),e._v(" "),a("el-radio-group",{model:{value:e.operator,callback:function(t){e.operator=t},expression:"operator"}},[a("el-radio",{attrs:{label:1}},[e._v("+")]),e._v(" "),a("el-radio",{attrs:{label:2}},[e._v("-")])],1)],1),e._v(" "),a("el-button",{staticClass:"add",attrs:{type:"primary"},on:{click:e.addItem}},[e._v("添加")])],1),e._v(" "),a("el-table",{staticStyle:{width:"100%",margin:"20px 0"},attrs:{data:e.formulaList,"summary-method":e.getSummaries,"max-height":"250","show-summary":"",border:""}},[e._l(e.fieldList,(function(t,i){return a("el-table-column",{key:i,attrs:{prop:t.field,label:t.label,"show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(i){var n=i.row;return["rules"===t.field?a("span",[e._v(e._s(e._f("fetchValue")(n.rules)))]):"subjectName"===t.field?a("span",[e._v(e._s(n.subjectNumber)+"  "+e._s(n[t.field]))]):a("span",[e._v(e._s(n[t.field]))])]}}])})})),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){e.removeItem(t.row)}}},[e._v("删除")])]}}])})],2),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("flexbox",{staticClass:"footer-flex"},[a("div",{staticClass:"left tips"},[e._v("温馨提示：新公式只对未出报表进行计算，不影响历史报表数据。")]),e._v(" "),a("div",{staticClass:"right"},[a("el-button",{directives:[{name:"debounce",rawName:"v-debounce",value:e.save,expression:"save"}],attrs:{type:"primary"}},[e._v("保存")]),e._v(" "),a("el-button",{on:{click:e.editFormulaClose}},[e._v("取消")])],1)])],1)],1)},n=[],s=(a("7db0"),a("d3b7"),a("99af"),a("3c65"),a("c740"),a("a434"),a("159b"),a("d81d"),a("a9e3"),a("13d5"),a("4e82"),a("b46f")),o=a("cb41"),l=a("6bfe"),r=a("da92"),c={name:"EditFormula",components:{SelectSubject:o["a"]},filters:{fetchValue:function(e){return{0:"余额",1:"借方余额",2:"贷方余额",3:"科目借方余额",4:"科目贷方余额",5:"借方发生额",6:"贷方发生额",7:"损益发生额"}[e]}},props:{editFormulaVisible:Boolean,sheetType:{type:String,default:"balanceSheet"},currentItem:{type:Object,default:function(){return{}}}},data:function(){return{loading:!1,subjectId:"",subjectItem:{},balanceRules:0,cashRules:5,operator:1,formulaList:[]}},computed:{fetchOptions:function(){return"balanceSheet"===this.sheetType?[{value:0,label:"余额"},{value:1,label:"借方余额"},{value:2,label:"贷方余额"},{value:3,label:"科目借方余额"},{value:4,label:"科目贷方余额"}]:[{value:5,label:"借方发生额"},{value:6,label:"贷方发生额"},{value:7,label:"损益发生额"}]},fieldList:function(){return"balanceSheet"===this.sheetType?[{label:"科目",field:"subjectName"},{label:"运算符号",field:"operator"},{label:"取数规则",field:"rules"},{label:"期末数",field:"endPeriod"},{label:"年初数",field:"initialPeriod"}]:[{label:"科目",field:"subjectName"},{label:"运算符号",field:"operator"},{label:"取数规则",field:"rules"},{label:"本月数",field:"monthValue"},{label:"本年数",field:"yearValue"}]}},watch:{currentItem:{handler:function(e){!Object(l["c"])(e)&&e.formula&&(this.formulaList=JSON.parse(e.formula))},deep:!0,immediate:!0}},methods:{receiveSubject:function(e,t){this.subjectItem=t},addItem:function(){var e=this;if(Object(l["c"])(this.subjectItem))this.$message.warning("请填写科目！");else{var t=this.formulaList.find((function(t){return t.subjectId===e.subjectId}));if(t)this.$message.warning("科目不能重复添加！");else{var a={subjectId:this.subjectItem.subjectId,subjectName:"".concat(this.subjectItem.number," ").concat(this.subjectItem.subjectName),subjectNumber:this.subjectItem.subjectNumber,operator:1===this.operator?"+":"-"};"balanceSheet"===this.sheetType?(a.rules=this.balanceRules,a.endPeriod=0,a.initialPeriod=0):(a.rules=this.cashRules,a.lastMonthValue=0,a.monthValue=0,a.yearValue=0),this.formulaList.unshift(a),this.subjectItem=null,this.subjectId=null}}},removeItem:function(e){var t=this.formulaList.findIndex((function(t){return t.subjectId==e.subjectId}));this.formulaList.splice(t,1)},getSummaries:function(e){var t=e.columns,a=e.data,i=[];return t.forEach((function(e,t){if(0!==t)if("rules"!==e.property){var n=a.map((function(t){var a=Number(t[e.property]);if(!isNaN(a)){var i="+"===t.operator?1:-1;return a*i}return a}));n.every((function(e){return isNaN(e)}))?i[t]="":i[t]=n.reduce((function(e,t){return r["a"].plus(e,t)}))}else i[t]="";else i[t]="合计"})),i},editFormulaClose:function(){this.$emit("editFormulaClose")},save:function(){var e=this,t="balanceSheet"===this.sheetType?s["k"]:s["o"];t({formulaBOList:this.formulaList,id:this.currentItem.id,sort:this.currentItem.sort}).then((function(t){e.$message.success("保存成功"),e.$emit("save-success")})).catch((function(){}))}}},u=c,d=(a("432d"),a("2877")),h=Object(d["a"])(u,i,n,!1,null,"535d3e9c",null);t["a"]=h.exports},da4a:function(e,t,a){},f455:function(e,t,a){"use strict";a("5ccb")}}]);